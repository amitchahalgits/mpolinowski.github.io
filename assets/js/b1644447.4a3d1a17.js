"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[99905],{186334:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>n,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>i});var a=r(474848),o=r(28453);const c={sidebar_position:9070,slug:"2020-12-25",title:"Tomcat 10 Docker Cluster",authors:"mpolinowski",tags:["LINUX","Tomcat","Docker"]},n=void 0,s={id:"DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster/index",title:"Tomcat 10 Docker Cluster",description:"Siem Reap, Cambodia",source:"@site/docs/DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster/index.md",sourceDirName:"DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster",slug:"/DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster/2020-12-25",permalink:"/docs/DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster/2020-12-25",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Tomcat/2020-12-25-tomcat10-docker-cluster/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Tomcat",permalink:"/docs/tags/tomcat"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:9070,frontMatter:{sidebar_position:9070,slug:"2020-12-25",title:"Tomcat 10 Docker Cluster",authors:"mpolinowski",tags:["LINUX","Tomcat","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Tomcat 10 Cluster with individual Node Server",permalink:"/docs/DevOps/Tomcat/2020-12-26-tomcat10-cluster-with-individual-nodes/2020-12-26"},next:{title:"Tomcat 9 Cluster & Loadbalancing",permalink:"/docs/DevOps/Tomcat/2020-12-24-tomcat9-cluster-and-load-balancing/2020-12-24"}},l={},i=[{value:"Docker Image",id:"docker-image",level:2},{value:"Sample Web Application",id:"sample-web-application",level:3},{value:"Running the Docker Images",id:"running-the-docker-images",level:3},{value:"Building the Docker Image",id:"building-the-docker-image",level:3},{value:"Running a Cluster with Docker-Compose",id:"running-a-cluster-with-docker-compose",level:2}];function m(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Siem Reap, Cambodia",src:r(409396).A+"",width:"1500",height:"706"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"#docker-image",children:"Docker Image"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"#sample-web-application",children:"Sample Web Application"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"#running-the-docker-images",children:"Running the Docker Images"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"#building-the-docker-image",children:"Building the Docker Image"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"#running-a-cluster-with-docker-compose",children:"Running a Cluster with Docker-Compose"})}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"docker-image",children:"Docker Image"}),"\n",(0,a.jsxs)(t.p,{children:["You can download a version of Tomcat from ",(0,a.jsx)(t.a,{href:"https://hub.docker.com/_/tomcat?tab=tags&page=1&ordering=last_updated",children:"Docker Hub"}),". I have been working with Tomcat 9 before - but I will try the ",(0,a.jsx)(t.a,{href:"https://tomcat.apache.org/tomcat-10.0-doc/index.html",children:"version 10"})," that is not yet labeled as stable:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"docker pull tomcat:10-jdk11-corretto\n"})}),"\n",(0,a.jsx)(t.h3,{id:"sample-web-application",children:"Sample Web Application"}),"\n",(0,a.jsxs)(t.p,{children:["Tomcat offers a sample application that we can use with our container - ",(0,a.jsx)(t.a,{href:"https://tomcat.apache.org/tomcat-10.0-doc/appdev/sample/",children:"you can download it here"}),". The example app has been packaged as a ",(0,a.jsx)(t.code,{children:"sample.war"})," file. If you just want to browse the contents, you can unpack the war file with the jar command:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"jar -xvf sample.war\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The easiest way to run this application is simply to move the war file to your ",(0,a.jsx)(t.code,{children:"CATALINA_BASE/webapps"})," directory. A default Tomcat install will automatically expand and deploy the application for you. You can view it with the following URL (assuming that you're running tomcat on port 8080 which is the default):"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"http://<My-Server>:8080/sample\n"})}),"\n",(0,a.jsx)(t.h3,{id:"running-the-docker-images",children:"Running the Docker Images"}),"\n",(0,a.jsx)(t.p,{children:"To run the sample app in Docker copy the file onto your LINUX server and mount it into the Tomcat container:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"docker run -it --rm -p 8888:8080 \\\r\n-v /opt/tomcat/docker/sample.war:/usr/local/tomcat/webapps/sample.war \\\r\ntomcat:10-jdk11-corretto\r\n\r\nUsing CATALINA_BASE:   /usr/local/tomcat\r\nUsing CATALINA_HOME:   /usr/local/tomcat\r\nUsing CATALINA_TMPDIR: /usr/local/tomcat/temp\r\nUsing JRE_HOME:        /usr/lib/jvm/java-11-amazon-corretto\r\nUsing CLASSPATH:       /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar\n"})}),"\n",(0,a.jsxs)(t.p,{children:["I forwarded the Tomcat service on port ",(0,a.jsx)(t.code,{children:"8888"})," so I can now access the sample app under:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"http://<My-Server>:8888/sample/\n"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Tomcat 10 Docker Cluster",src:r(183869).A+"",width:"771",height:"234"})}),"\n",(0,a.jsx)(t.h3,{id:"building-the-docker-image",children:"Building the Docker Image"}),"\n",(0,a.jsxs)(t.p,{children:["Alternatively, you can build the sample application into your container (so you don't need to use a volume mount). For this, create a Dockerfile next to the ",(0,a.jsx)(t.code,{children:"sample.war"})," file:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-Dockerfile",children:'FROM tomcat:10-jdk11-corretto\r\nADD sample.war /usr/local/tomcat/webapps/\r\nEXPOSE 8080\r\nCMD chmod +x /usr/local/tomcat/bin/catalina.sh\r\nCMD ["catalina.sh", "run"]\n'})}),"\n",(0,a.jsx)(t.p,{children:"And build and run your docker container from it:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"docker build -t tomcat10 .\r\ndocker run -it -p 8888:8080 tomcat10\n"})}),"\n",(0,a.jsx)(t.h2,{id:"running-a-cluster-with-docker-compose",children:"Running a Cluster with Docker-Compose"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"docker-compose.yml"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yml",children:"portal:\r\n  image: nginx:stable-alpine\r\n  ports:\r\n    - '8888:80'\r\n  volumes:\r\n    - /opt/tomcat/docker/cluster/nginx/default.conf:/etc/nginx/conf.d/default.conf\r\n  links:\r\n    - tomcatOne:tomcat1\r\n    - tomcatTwo:tomcat2\r\n    - tomcatThree:tomcat3\r\ntomcatOne:\r\n  image: tomcat:10-jdk11-corretto\r\n  volumes:\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/server.xml:/usr/local/tomcat/conf/server.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/webapps/sample.war:/usr/local/tomcat/webapps/sample.war\r\ntomcatTwo:\r\n  image: tomcat:10-jdk11-corretto\r\n  volumes:\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/server.xml:/usr/local/tomcat/conf/server.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/webapps/sample.war:/usr/local/tomcat/webapps/sample.war\r\ntomcatThree:\r\n  image: tomcat:10-jdk11-corretto\r\n  volumes:\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/server.xml:/usr/local/tomcat/conf/server.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/conf/tomcat-users.xml:/usr/local/tomcat/conf/tomcat-users.xml\r\n    - /opt/tomcat/docker/cluster/tomcat/webapps/sample.war:/usr/local/tomcat/webapps/sample.war\n"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:"default.conf"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-cfg",children:"upstream backend  {\r\n  server tomcat1:8080;\r\n  server tomcat2:8080;\r\n  server tomcat3:8080;\r\n}\r\n\r\nserver {\r\n    listen       80;\r\n    server_name  localhost;\r\n\r\n    #charset koi8-r;\r\n    #access_log  /var/log/nginx/log/host.access.log  main;\r\n\r\n    location / {\r\n\tproxy_pass  http://backend;\r\n    }\r\n\r\n    #error_page  404              /404.html;\r\n\r\n    # redirect server error pages to the static page /50x.html\r\n    #\r\n    error_page   500 502 503 504  /50x.html;\r\n    location = /50x.html {\r\n        root   /usr/share/nginx/html;\r\n    }\r\n}\r\n\n"})}),"\n",(0,a.jsxs)(t.p,{children:["I forwarded the Tomcat service on port ",(0,a.jsx)(t.code,{children:"8888"})," so I can now access the sample app under:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"http://<My-Server>:8888/sample/\n"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Tomcat 10 Docker Cluster",src:r(183869).A+"",width:"771",height:"234"})})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},409396:(e,t,r)=>{r.d(t,{A:()=>a});const a=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-dbec03b1535301c8b293ac3087af0dd4.jpg"},183869:(e,t,r)=>{r.d(t,{A:()=>a});const a=r.p+"assets/images/tomcat10-docker-cluster_01-ee5d2ef1a8f5457b7245b32c7d7a3dce.png"},28453:(e,t,r)=>{r.d(t,{R:()=>n,x:()=>s});var a=r(296540);const o={},c=a.createContext(o);function n(e){const t=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:n(e.components),a.createElement(c.Provider,{value:t},e.children)}}}]);