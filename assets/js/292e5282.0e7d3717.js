"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[56696],{495267:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var t=s(474848),r=s(28453);const a={sidebar_position:7020,slug:"2021-08-23",title:"Hashicorp Vault - Rest API",authors:"mpolinowski",tags:["Vault","Linux"]},i=void 0,o={id:"DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/index",title:"Hashicorp Vault - Rest API",description:"Tsim Sha Tsui, Hongkong",source:"@site/docs/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/index.md",sourceDirName:"DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api",slug:"/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/2021-08-23",permalink:"/docs/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/2021-08-23",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/index.md",tags:[{label:"Vault",permalink:"/docs/tags/vault"},{label:"Linux",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:7020,frontMatter:{sidebar_position:7020,slug:"2021-08-23",title:"Hashicorp Vault - Rest API",authors:"mpolinowski",tags:["Vault","Linux"]},sidebar:"tutorialSidebar",previous:{title:"Hashicorp Vault - Logging",permalink:"/docs/DevOps/Hashicorp/2021-08-25--hashicorp-vault-logging/2021-08-25"},next:{title:"Hashicorp Vault - ACL Policies",permalink:"/docs/DevOps/Hashicorp/2021-08-22--hashicorp-vault-policies/2021-08-22"}},l={},c=[{value:"Accessing the REST API",id:"accessing-the-rest-api",level:2},{value:"Working with Payload Files",id:"working-with-payload-files",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Tsim Sha Tsui, Hongkong",src:s(471209).A+"",width:"1500",height:"500"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#accessing-the-rest-api",children:"Accessing the REST API"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#working-with-payload-files",children:"Working with Payload Files"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The Vault HTTP API gives you full access to Vault via HTTP. Every aspect of Vault can be controlled via this API. The Vault CLI uses the HTTP API to access Vault."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["All API routes are prefixed with ",(0,t.jsx)(n.code,{children:"/v1/"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"accessing-the-rest-api",children:"Accessing the REST API"}),"\n",(0,t.jsxs)(n.p,{children:["In the previous step I created a token ",(0,t.jsx)(n.code,{children:"s.GZHF5D5zYJk1zmzxLmxivPY8"})," that allowed me to read the key/value on the path ",(0,t.jsx)(n.code,{children:"secret/login/elastic"})," using the ",(0,t.jsx)(n.strong,{children:"Vault CLI"}),"::"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"vault kv get secret/login/elastic\r\n\r\n====== Data ======\r\nKey         Value\r\n---         -----\r\npassword    Hzo3aku+S37JDzeXGUxZX+H5WE\n"})}),"\n",(0,t.jsx)(n.p,{children:"To do the same with an HTTP GET request:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl \\\r\n    -H "X-Vault-Token: s.GZHF5D5zYJk1zmzxLmxivPY8" \\\r\n    -X GET \\\r\n    http://192.168.2.110:8200/v1/secret/login/elastic | jq\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "request_id": "84ee50f2-78ec-96ed-ffc7-432e9bb94e74",\r\n  "lease_id": "",\r\n  "renewable": false,\r\n  "lease_duration": 2764800,\r\n  "data": {\r\n    "password": "Hzo3aku+S37JDzeXGUxZX+H5WE"\r\n  },\r\n  "wrap_info": null,\r\n  "warnings": null,\r\n  "auth": null\r\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To update an existing value I can use the ",(0,t.jsx)(n.strong,{children:"PUT"})," request:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl \\\r\n    -H "X-Vault-Token: s.GZHF5D5zYJk1zmzxLmxivPY8" \\\r\n    -H "Content-Type: application/json" \\\r\n    -X PUT \\\r\n    -d \'{"password":"the_new_password"}\' \\\r\n    http://192.168.2.110:8200/v1/secret/login/elastic\n'})}),"\n",(0,t.jsx)(n.p,{children:"And the value is updated:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"HashiCorp Vault",src:s(232303).A+"",width:"1241",height:"292"})}),"\n",(0,t.jsx)(n.h3,{id:"working-with-payload-files",children:"Working with Payload Files"}),"\n",(0,t.jsxs)(n.p,{children:["With the root token we are now also able to do administrative work like ",(0,t.jsx)(n.a,{href:"https://www.vaultproject.io/api-docs/auth/token",children:"creating new user token"}),". First let's create a JSON file that holds all the instructions:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'tee test-user-token.json <<EOF\r\n{\r\n  "policies": ["root"],\r\n  "meta": {\r\n    "user": "test-user"\r\n  },\r\n  "ttl": "1h",\r\n  "renewable": true\r\n}\r\nEOF\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Now we can use the ",(0,t.jsx)(n.strong,{children:"POST"})," request to add this user token by authenticating with our root token to access the ",(0,t.jsx)(n.code,{children:"/auth"})," route:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl \\\r\n    -H "X-Vault-Token: s.TFCSNUDRJbuBGjOkgaqSfEQR" \\\r\n    -X POST \\\r\n    -d @test-user-token.json \\\r\n    http://192.168.2.110:8200/v1/auth/token/create | jq\n'})}),"\n",(0,t.jsxs)(n.p,{children:["And we created a new root user with the token ",(0,t.jsx)(n.code,{children:"s.3ionpxkpnV7FWR709o8JS4uo"})," and username ",(0,t.jsx)(n.code,{children:"test-user"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "request_id": "7ad054c1-c7a1-5c2c-f83f-a0d2ab756e4f",\r\n  "lease_id": "",\r\n  "renewable": false,\r\n  "lease_duration": 0,\r\n  "data": null,\r\n  "wrap_info": null,\r\n  "warnings": null,\r\n  "auth": {\r\n    "client_token": "s.3ionpxkpnV7FWR709o8JS4uo",\r\n    "accessor": "u8op0uCIPHuqgHhDJ59SVEW9",\r\n    "policies": [\r\n      "root"\r\n    ],\r\n    "token_policies": [\r\n      "root"\r\n    ],\r\n    "metadata": {\r\n      "user": "test-user"\r\n    },\r\n    "lease_duration": 3600,\r\n    "renewable": true,\r\n    "entity_id": "",\r\n    "token_type": "service",\r\n    "orphan": false\r\n  }\r\n}\n'})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},232303:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/HashiCorp_Vault_01-c100dab483422ea6d9278e49b7597bde.png"},471209:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-8750654e59e6d1e0d428c24817048952.jpg"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(296540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);