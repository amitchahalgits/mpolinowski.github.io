"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[16207],{33255:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>i,toc:()=>h});var t=a(474848),s=a(28453);const r={sidebar_position:9010,slug:"2021-10-14",title:"Zabbix Apache 2 Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Apache"]},o=void 0,i={id:"DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index",title:"Zabbix Apache 2 Monitor",description:"Guangzhou, China",source:"@site/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index.md",sourceDirName:"DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor",slug:"/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/2021-10-14",permalink:"/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/2021-10-14",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2021-01-14--zabbix-apache2-monitor/index.md",tags:[{label:"Zabbix",permalink:"/docs/tags/zabbix"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Apache",permalink:"/docs/tags/apache"}],version:"current",sidebarPosition:9010,frontMatter:{sidebar_position:9010,slug:"2021-10-14",title:"Zabbix Apache 2 Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Apache"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix Docker-Compose Setup",permalink:"/docs/DevOps/Zabbix/2021-10-13--zabbix-compose-setup/2021-10-13"},next:{title:"Slack Notifications in DevOps",permalink:"/docs/DevOps/Zabbix/2020-09-05--slack-notifications-in-devops/2020-09-05"}},c={},h=[{value:"Apache Module mod_status",id:"apache-module-mod_status",level:2},{value:"Configure Zabbix Agent",id:"configure-zabbix-agent",level:2},{value:"Solution",id:"solution",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Guangzhou, China",src:a(47309).A+"",width:"1500",height:"467"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#apache-module-mod_status",children:"Apache Module mod_status"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#configure-zabbix-agent",children:"Configure Zabbix Agent"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#solution",children:"Solution"})}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Update"}),": I had a couple of issues below. In the end ",(0,t.jsx)(n.a,{href:"#solution",children:"switching the template from HTTP to Zabbix Agent solved it"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"apache-module-mod_status",children:"Apache Module mod_status"}),"\n",(0,t.jsxs)(n.p,{children:["Activate the ",(0,t.jsx)(n.strong,{children:"Server Status"})," module:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo a2enmod status\n"})}),"\n",(0,t.jsx)(n.p,{children:"And add the configuration to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nano /etc/apache2/mods-available/status.conf\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://httpd.apache.org/docs/2.4/mod/mod_status.html",children:"Enabling Status Support"})," for the host you want to monitor:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<IfModule mod_status.c>\r\n        # Allow server status reports generated by mod_status,\r\n        # with the URL of http://servername/server-status\r\n        # Uncomment and change the "192.0.2.0/24" to allow access from other hosts.\r\n\r\n        <Location /server-status>\r\n                SetHandler server-status\r\n\r\n                ##Allow all IPs to access for testing\r\n                #Allow from all\r\n\r\n                ##Allow only localhost and local server IP\r\n                Order deny,allow\r\n                Deny from all\r\n                Allow from 127.0.0.1 ::1\r\n                Allow from Your.Server.IP.Address.Here\r\n\r\n                ##Limit access from other hosts\r\n                #Require local\r\n                #Require ip 192.0.2.0/24\r\n                #Require host example.com\r\n        </Location>\r\n\r\n        # Keep track of extended status information for each request\r\n        ExtendedStatus On\r\n\r\n        # Determine if mod_status displays the first 63 characters of a request or\r\n        # the last 63, assuming the request itself is greater than 63 chars.\r\n        # Default: Off\r\n        #SeeRequestTail On\r\n        <IfModule mod_proxy.c>\r\n                # Show Proxy LoadBalancer status in mod_status\r\n                ProxyStatus On\r\n        </IfModule>\r\n</IfModule>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Check config integrity and restart:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apachectl configtest\r\napache2 -t # or httpd -t\r\nsystemctl restart apache2 # or httpd\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or all in one line:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apache2ctl -t && apache2ctl graceful\n"})}),"\n",(0,t.jsx)(n.p,{children:"Test the status output by:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl http://127.0.0.1/server-status?auto\r\n127.0.0.1\r\nServerVersion: Apache/2.4.25 (Debian) OpenSSL/1.0.2q\r\nServerMPM: prefork\r\nServer Built: 2018-11-03T18:46:19\r\nCurrentTime: Tuesday, 09-Nov-2021 07:24:39 CET\r\nRestartTime: Tuesday, 09-Nov-2021 06:44:31 CET\r\nParentServerConfigGeneration: 1\r\nParentServerMPMGeneration: 0\r\nServerUptimeSeconds: 2408\r\nServerUptime: 40 minutes 8 seconds\r\nLoad1: 0.07\r\nLoad5: 0.24\r\nLoad15: 0.53\r\nTotal Accesses: 319\r\nTotal kBytes: 1554\r\nCPUUser: 5.52\r\nCPUSystem: 2.06\r\nCPUChildrenUser: 0\r\nCPUChildrenSystem: 0\r\nCPULoad: .314784\r\nUptime: 2408\r\nReqPerSec: .132475\r\nBytesPerSec: 660.837\r\nBytesPerReq: 4988.39\r\nBusyWorkers: 2\r\nIdleWorkers: 8\r\nScoreboard: _W____W___............................................................................................................................................\r\nTLSSessionCacheStatus\r\nCacheType: SHMCB\r\nCacheSharedMemory: 512000\r\nCacheCurrentEntries: 35\r\nCacheSubcaches: 32\r\nCacheIndexesPerSubcaches: 88\r\nCacheTimeLeftOldestAvg: 123\r\nCacheTimeLeftOldestMin: 0\r\nCacheTimeLeftOldestMax: 262\r\nCacheIndexUsage: 1%\r\nCacheUsage: 1%\r\nCacheStoreCount: 279\r\nCacheReplaceCount: 0\r\nCacheExpireCount: 244\r\nCacheDiscardCount: 0\r\nCacheRetrieveHitCount: 0\r\nCacheRetrieveMissCount: 38\r\nCacheRemoveHitCount: 0\r\nCacheRemoveMissCount: 0\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-zabbix-agent",children:"Configure Zabbix Agent"}),"\n",(0,t.jsx)(n.p,{children:"Stat by adding the Apache by HTML template:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(97093).A+"",width:"913",height:"327"})}),"\n",(0,t.jsx)(n.p,{children:"Currently I am only getting the Uptime and Ping:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(225294).A+"",width:"1090",height:"255"})}),"\n",(0,t.jsxs)(n.p,{children:["Those are the ",(0,t.jsx)(n.a,{href:"https://www.zabbix.com/integrations/apache",children:"only passively collected"})," items of Apache template. All other depend on the queried status from our Apache server. I found that the host address was not set to ",(0,t.jsx)(n.code,{children:"localhost"}),":"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(368311).A+"",width:"1160",height:"483"})}),"\n",(0,t.jsx)(n.p,{children:"So I added the macro and set:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"{$APACHE.STATUS.HOST} 127.0.0.1\n"})}),"\n",(0,t.jsx)(n.p,{children:"to make sure that the agent is querying from there and is not blocked (on the server IP address I am forcing an HTTPS upgrade of the connection - so using localhost instead allows me to get around that.):"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(93144).A+"",width:"1180",height:"322"})}),"\n",(0,t.jsxs)(n.p,{children:["But this did not solve the issue :( Initially I though it might be because of an outdated Apache Version - but this is ",(0,t.jsx)(n.em,{children:"fairly"})," up-2-date for Debian standards (I have seen the template work with ",(0,t.jsx)(n.code,{children:"Apache/2.4.37"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"apache2 -version\r\nServer version: Apache/2.4.25 (Debian)\n"})}),"\n",(0,t.jsx)(n.p,{children:"One more try - I edited the URL that is used by the Apache template:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"{$APACHE.STATUS.SCHEME}://{HOST.CONN}:{$APACHE.STATUS.PORT}/{\\$APACHE.STATUS.PATH}\n"})}),"\n",(0,t.jsx)(n.p,{children:"And hardcoded it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://127.0.0.1/server-status?auto\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(61409).A+"",width:"907",height:"360"})}),"\n",(0,t.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,t.jsxs)(n.p,{children:["For some reasons the template ",(0,t.jsx)(n.code,{children:"Template App Apache by HTTP"})," is not working for me. Switching to ",(0,t.jsx)(n.code,{children:"Template App Apache by Zabbix agent"})," solved it:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(112426).A+"",width:"938",height:"335"})}),"\n",(0,t.jsx)(n.p,{children:"I kept all changes I made above in place and all items started populating once I made the switch to the Agent template:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix Apache Monitor",src:a(267635).A+"",width:"1024",height:"674"})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},97093:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_01-b2b476e3bb6f8a8b16a5fecfa3d740b7.png"},225294:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_02-5471252ad8daff5663ab65dbc156e30e.png"},368311:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_03-b962990ae1c4a4ab4e19fbe39fb7ff6d.png"},93144:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_04-f9baa5fd1925acdc296076b235765aae.png"},61409:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_05-859ff9ff33464a761a27482fffb3700b.png"},112426:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_06-e27292f3202bd236a176d57aa6558558.png"},267635:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_Apache2_Monitor_07-6a7e10dca5ff713dce89021eb298aa64.png"},47309:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-539dc0d90c8fd4caf3d5cd5162b8ded5.jpg"},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>i});var t=a(296540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);