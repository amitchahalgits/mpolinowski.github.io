"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[85806],{496777:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=i(785893),s=i(603905);const o={sidebar_position:8010,slug:"2020-06-07",title:"Developing WikiJS in Docker",authors:"mpolinowski",tags:["Databases","Docker"]},t=void 0,l={id:"DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index",title:"Developing WikiJS in Docker",description:"Central, Hong Kong",source:"@site/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index.mdx",sourceDirName:"DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker",slug:"/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/2020-06-07",permalink:"/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/2020-06-07",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2020-06-07--setting-up-wikijs-in-docker/index.mdx",tags:[{label:"Databases",permalink:"/docs/tags/databases"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:8010,frontMatter:{sidebar_position:8010,slug:"2020-06-07",title:"Developing WikiJS in Docker",authors:"mpolinowski",tags:["Databases","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Infrastructure as Code",permalink:"/docs/DevOps/Provisioning/2020-07-13--infrastructure-as-code/2020-07-13"},next:{title:"Vanilla Forums Installation on Debian",permalink:"/docs/DevOps/Provisioning/2019-09-16--installing-vanilla-forum/2019-09-16"}},a={},c=[{value:"Preparations",id:"preparations",level:2},{value:"Dockerfile",id:"dockerfile",level:3},{value:"config.yml",id:"configyml",level:3},{value:"docker-compose.yml",id:"docker-composeyml",level:3},{value:"Spinning up Docker",id:"spinning-up-docker",level:2},{value:"Running the App",id:"running-the-app",level:3},{value:"Stopping the App",id:"stopping-the-app",level:3},{value:"Building production assets",id:"building-production-assets",level:2},{value:"Running the official Wiki.js Build",id:"running-the-official-wikijs-build",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Central, Hong Kong",src:i(502405).Z+"",width:"1500",height:"542"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#preparations",children:"Preparations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#dockerfile",children:"Dockerfile"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#configyml",children:"config.yml"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#docker-composeyml",children:"docker-compose.yml"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#spinning-up-docker",children:"Spinning up Docker"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#running-the-app",children:"Running the App"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#stopping-the-app",children:"Stopping the App"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#building-production-assets",children:"Building production assets"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"preparations",children:"Preparations"}),"\n",(0,r.jsxs)(n.p,{children:["Based on the official ",(0,r.jsx)(n.a,{href:"https://github.com/Requarks/wiki/tree/dev/dev/containers",children:"WikiJS Docker Sample"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Start by cloning the ",(0,r.jsx)(n.a,{href:"https://codeload.github.com/Requarks/wiki/zip/dev",children:"WikiJS Repository"})," into a folder called ",(0,r.jsx)(n.code,{children:"wiki-source"}),". Continue by creating the following 3 files next to this folder:"]}),"\n",(0,r.jsx)(n.h3,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:'FROM node:12\r\nLABEL maintainer "mpolinowski@gmail.com"\r\n\r\nRUN apt-get update && \\\r\n    apt-get install -y bash curl git python make g++ nano openssh-server gnupg && \\\r\n    mkdir -p /wiki\r\n\r\nWORKDIR /wiki\r\n\r\nENV dockerdev 1\r\nENV DEVDB postgres\r\n\r\nEXPOSE 3000\r\n\r\nCMD ["tail", "-f", "/dev/null"]\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"configyml",children:"config.yml"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:"port: 3000\r\nbindIP: 0.0.0.0\r\ndb:\r\n  type: postgres\r\n  host: db\r\n  port: 5432\r\n  user: wikijs\r\n  pass: wikijsrocks\r\n  db: wiki\r\nlogLevel: info\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'version: "3"\r\nservices:\r\n  db:\r\n    container_name: wiki-db\r\n    image: postgres:9-alpine\r\n    environment:\r\n      POSTGRES_DB: wiki\r\n      POSTGRES_PASSWORD: wikijsrocks\r\n      POSTGRES_USER: wikijs\r\n    logging:\r\n      driver: "none"\r\n    volumes:\r\n      - db-data:/var/lib/postgresql/data\r\n    ports:\r\n      - "15432:5432"\r\n\r\n  adminer:\r\n    container_name: wiki-adminer\r\n    image: adminer:latest\r\n    logging:\r\n      driver: "none"\r\n    ports:\r\n      - "3001:8080"\r\n\r\n  wiki:\r\n    container_name: wiki-app\r\n    build:\r\n      context: ./wiki-source\r\n      dockerfile: ../Dockerfile\r\n    depends_on:\r\n      - db\r\n    ports:\r\n      - "3000:3000"\r\n    volumes:\r\n      - ./wiki-source:/wiki\r\n      - /wiki/node_modules\r\n      - /wiki/.git\r\n\r\n\r\nvolumes:\r\n  db-data:\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"spinning-up-docker",children:"Spinning up Docker"}),"\n",(0,r.jsx)(n.p,{children:"Run the build command to pull / build your images:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker-compose build\n"})}),"\n",(0,r.jsx)(n.h3,{id:"running-the-app",children:"Running the App"}),"\n",(0,r.jsx)(n.p,{children:"Run the following commands:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose.yml up -d\r\ndocker exec wiki-app npm install   # only necessary the first time\r\ndocker exec wiki-app npm run dev\n"})}),"\n",(0,r.jsx)(n.p,{children:"This will start Wiki.js in dev mode. Client assets are compiled first (using Webpack), then the server will start automatically. Wait for this process to complete before loading the app!"}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"#building-production-assets",children:"how to build for production"})," below."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Run Wiki.js in Docker",src:i(807298).Z+"",width:"881",height:"536"})}),"\n",(0,r.jsxs)(n.p,{children:["Browse to the site, using the configuration you defined in config.yml. For example, if using port 3000 on your local machine, you would browse to ",(0,r.jsx)(n.code,{children:"http://localhost:3000/"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The first time you load the wiki, you'll get greeted with the setup wizard. Complete all the steps to finish the installation."}),"\n",(0,r.jsx)(n.h3,{id:"stopping-the-app",children:"Stopping the App"}),"\n",(0,r.jsx)(n.p,{children:"Run the following to shut down the app"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose.yml stop\n"})}),"\n",(0,r.jsx)(n.p,{children:"To completely remove the containers run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose.yml down\n"})}),"\n",(0,r.jsx)(n.p,{children:"To wipe the database as well, use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-compose.yml down --volumes\n"})}),"\n",(0,r.jsx)(n.h2,{id:"building-production-assets",children:"Building production assets"}),"\n",(0,r.jsx)(n.p,{children:"Once you're ready to deploy your changes, you need to build the client assets into a production optimized bundle:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker exec wiki-app npm run build\r\ndocker exec wiki-app npm run start\n"})}),"\n",(0,r.jsx)(n.h2,{id:"running-the-official-wikijs-build",children:"Running the official Wiki.js Build"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"wikijs-docker-compose.yaml"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'version: "3"\r\nservices:\r\n\r\n  db:\r\n    image: postgres:11-alpine\r\n    environment:\r\n      POSTGRES_DB: wiki\r\n      POSTGRES_PASSWORD: wikijsrocks\r\n      POSTGRES_USER: wikijs\r\n    logging:\r\n      driver: "none"\r\n    restart: unless-stopped\r\n    volumes:\r\n      - db-data:/var/lib/postgresql/data\r\n\r\n  wiki:\r\n    image: requarks/wiki:2\r\n    depends_on:\r\n      - db\r\n    environment:\r\n      DB_TYPE: postgres\r\n      DB_HOST: db\r\n      DB_PORT: 5432\r\n      DB_USER: wikijs\r\n      DB_PASS: wikijsrocks\r\n      DB_NAME: wiki\r\n    restart: unless-stopped\r\n    ports:\r\n      - "80:3000"\r\n\r\nvolumes:\r\n  db-data:\n'})}),"\n",(0,r.jsx)(n.p,{children:"Build with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo docker-compose -f wikijs-docker-compose.yaml up -d\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.ah)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},603905:(e,n,i)=>{i.d(n,{ah:()=>c});var r=i(667294);function s(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function o(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,r)}return i}function t(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?o(Object(i),!0).forEach((function(n){s(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function l(e,n){if(null==e)return{};var i,r,s=function(e,n){if(null==e)return{};var i,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)i=o[r],n.indexOf(i)>=0||(s[i]=e[i]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}var a=r.createContext({}),c=function(e){var n=r.useContext(a),i=n;return e&&(i="function"==typeof e?e(n):t(t({},n),e)),i},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var i=e.components,s=e.mdxType,o=e.originalType,a=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(i),u=s,g=h["".concat(a,".").concat(u)]||h[u]||d[u]||o;return i?r.createElement(g,t(t({ref:n},p),{},{components:i})):r.createElement(g,t({ref:n},p))}));p.displayName="MDXCreateElement"},807298:(e,n,i)=>{i.d(n,{Z:()=>r});const r=i.p+"assets/images/Wikijs_Docker_01-728a7772f2d77d2d01d869f74f61d5a7.png"},502405:(e,n,i)=>{i.d(n,{Z:()=>r});const r=i.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-072d216b41518884adc06d90cec9a075.jpg"}}]);