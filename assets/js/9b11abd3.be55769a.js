"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[53217],{732922:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var s=n(785893),i=n(603905);const a={sidebar_position:6080,slug:"2021-09-07",title:"Hashicorp Terraform - Providers, Variables & Attributes",authors:"mpolinowski",tags:["Terraform","Linux"]},t=void 0,l={id:"DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/index",title:"Hashicorp Terraform - Providers, Variables & Attributes",description:"Shenzhen, China",source:"@site/docs/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/index.md",sourceDirName:"DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes",slug:"/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/2021-09-07",permalink:"/docs/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/2021-09-07",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/index.md",tags:[{label:"Terraform",permalink:"/docs/tags/terraform"},{label:"Linux",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:6080,frontMatter:{sidebar_position:6080,slug:"2021-09-07",title:"Hashicorp Terraform - Providers, Variables & Attributes",authors:"mpolinowski",tags:["Terraform","Linux"]},sidebar:"tutorialSidebar",previous:{title:"Hashicorp Nomad in Production",permalink:"/docs/DevOps/Hashicorp/2021-10-10--hashicorp-nomad-in-production/2021-10-10"},next:{title:"Hashicorp Terraform - Setup",permalink:"/docs/DevOps/Hashicorp/2021-09-05--hashicorp-terraform-setup/2021-09-05"}},o={},d=[{value:"Providers",id:"providers",level:2},{value:"Resource Attributes",id:"resource-attributes",level:2},{value:"Dependency",id:"dependency",level:3},{value:"Input Variables",id:"input-variables",level:2},{value:"Default Variables",id:"default-variables",level:3},{value:"Precedence",id:"precedence",level:4},{value:"Variable Types",id:"variable-types",level:3},{value:"List",id:"list",level:4},{value:"Map",id:"map",level:4},{value:"Set",id:"set",level:4},{value:"Object",id:"object",level:4},{value:"Tuples",id:"tuples",level:4},{value:"Output Variables",id:"output-variables",level:2},{value:"State",id:"state",level:2}];function c(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.ah)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"Shenzhen, China",src:n(730254).Z+"",width:"1500",height:"469"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#providers",children:"Providers"})}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"#resource-attributes",children:"Resource Attributes"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#dependency",children:"Dependency"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"#input-variables",children:"Input Variables"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"#default-variables",children:"Default Variables"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#precedence",children:"Precedence"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"#variable-types",children:"Variable Types"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#list",children:"List"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#map",children:"Map"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#set",children:"Set"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#object",children:"Object"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#tuples",children:"Tuples"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#output-variables",children:"Output Variables"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"#state",children:"State"})}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"providers",children:"Providers"}),"\n",(0,s.jsxs)(r.p,{children:["Terraform offers a large quantity of ",(0,s.jsx)(r.a,{href:"https://registry.terraform.io/providers/hashicorp/random/latest",children:"providers"})," that you can use in your configuration file - e.g. the ",(0,s.jsx)(r.a,{href:"https://registry.terraform.io/providers/hashicorp/random/latest/docs",children:"Random Provider"})," that you can use to generate random:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"random_id"}),"\n",(0,s.jsx)(r.li,{children:"random_integer"}),"\n",(0,s.jsx)(r.li,{children:"random_password"}),"\n",(0,s.jsx)(r.li,{children:"random_pet"}),"\n",(0,s.jsx)(r.li,{children:"random_shuffle"}),"\n",(0,s.jsx)(r.li,{children:"random_string"}),"\n",(0,s.jsx)(r.li,{children:"random_uuid"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"resource-attributes",children:"Resource Attributes"}),"\n",(0,s.jsx)(r.p,{children:"Let's add this to our configuration:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo nano /etc/terraform.d/main.tf\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource "random_uuid" "uuid" {\r\n}\r\n\r\nresource "local_file" "resource_name" {\r\n  filename = "/opt/uuid"\r\n  content =  "${random_uuid.uuid.result}-rg"\r\n  directory_permission = "0777"\r\n  file_permission = "0700"\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Here I am using the ",(0,s.jsx)(r.a,{href:"https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/uuid#read-only",children:"result"})," of the ",(0,s.jsx)(r.code,{children:"random_uuid"})," as an attribute in the ",(0,s.jsx)(r.code,{children:"local_file"})," resource:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo terraform init\r\nsudo terraform plan\r\nsudo terraform apply\n"})}),"\n",(0,s.jsx)(r.p,{children:"And check the result - the file now contains the generated UUID:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo cat /opt/uuid\r\n833732a2-438a-76dd-828f-a7fe2a64f5bb-rg\n"})}),"\n",(0,s.jsx)(r.h3,{id:"dependency",children:"Dependency"}),"\n",(0,s.jsxs)(r.p,{children:["The example above works because the ",(0,s.jsx)(r.code,{children:"random_uuid"})," provider is run before the ",(0,s.jsx)(r.code,{children:"local_file"})," provider. But it is also possible to declare an explicit dependency:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource "local_file" "resource_name" {\r\n  filename = "/opt/uuid"\r\n  content =  "${random_uuid.uuid.result}-rg"\r\n  directory_permission = "0777"\r\n  file_permission = "0700"\r\n  depends_on = [\r\n    random_uuid.uuid\r\n  ]\r\n}\r\n\r\nresource "random_uuid" "uuid" {\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"input-variables",children:"Input Variables"}),"\n",(0,s.jsx)(r.p,{children:"To make configuration files re-useable we can variables instead of hardcoding values:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource "random_uuid" "uuid" {\r\n}\r\n\r\nresource "local_file" "resource_name" {\r\n  filename = var.filename\r\n  content =  "${random_uuid.uuid.result}-rg"\r\n  directory_permission = var.directory_permission\r\n  file_permission = var.file_permission\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"If no variables are provided the Terraform CLI will ask you for values when you try to run this configuration file. But they can also be provided with CLI flags:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'terraform apply -var "filename=/opt/uuid" -var "directory_permission=0777" -var "file_permission=0700"\n'})}),"\n",(0,s.jsx)(r.p,{children:"Or use environment variables:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'export TF_VAR_filename="/opt/uuid"\r\nexport TF_VAR_directory_permission="0777"\r\nexport TF_VAR_file_permission="0700"\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Or create variable definition file ",(0,s.jsx)(r.code,{children:"terraform.auto.tfvars"})]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yml",children:'filename = "/opt/uuid"\r\ndirectory_permission = "0777"\r\nfile_permission = "0700"\n'})}),"\n",(0,s.jsx)(r.h3,{id:"default-variables",children:"Default Variables"}),"\n",(0,s.jsxs)(r.p,{children:["You can also define default variable in a file ",(0,s.jsx)(r.code,{children:"variables.tf"})," next to our main configuration:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'variable "filename" {\r\n  default = "/opt/uuid"\r\n  type = string\r\n  description = "ID file location"\r\n}\r\nvariable "directory_permission" {\r\n  default = "0777"\r\n}\r\nvariable "file_permission" {\r\n  default = "0700"\r\n}\n'})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"sudo terraform plan\r\nsudo terraform apply\r\nsudo cat /opt/uuid\r\n4c148730-9cd1-bc23-04eb-ae3f5e5000d7-rg\n"})}),"\n",(0,s.jsx)(r.h4,{id:"precedence",children:"Precedence"}),"\n",(0,s.jsx)(r.p,{children:"These defaults will be overridden by the following in this order:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["Default ",(0,s.jsx)(r.code,{children:"variables.tf"})]}),"\n",(0,s.jsx)(r.li,{children:"Environment Variables"}),"\n",(0,s.jsx)(r.li,{children:"terraform.tfvars"}),"\n",(0,s.jsx)(r.li,{children:"*.auto.tfvars"}),"\n",(0,s.jsx)(r.li,{children:"CLI flags"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"variable-types",children:"Variable Types"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"types"})," can be ",(0,s.jsx)(r.strong,{children:"any"}),", ",(0,s.jsx)(r.strong,{children:"string"}),", ",(0,s.jsx)(r.strong,{children:"numbers"}),", ",(0,s.jsx)(r.strong,{children:"bool"}),", ",(0,s.jsx)(r.strong,{children:"list"}),", ",(0,s.jsx)(r.strong,{children:"set"}),", ",(0,s.jsx)(r.strong,{children:"map"}),", ",(0,s.jsx)(r.strong,{children:"object"}),", ",(0,s.jsx)(r.strong,{children:"tuple"}),":"]}),"\n",(0,s.jsx)(r.h4,{id:"list",children:"List"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "prefix" {\r\n  default = ["Mr.", "Mrs."]\r\n  type = list(string)\r\n}\n'})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource "random_pet" "pet" {\r\n  prefix = var.prefix[0]\r\n}\n'})}),"\n",(0,s.jsx)(r.h4,{id:"map",children:"Map"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "file-content" {\r\n  type = map(string)\r\n  default = {\r\n    "key1" = "value1"\r\n    "key2" = "value2"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "file-content" {\r\n  type = map(number)\r\n  default = {\r\n    "key1" = "1"\r\n    "key2" = "2"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource local_file "test" {\r\n  filename = "/opt/test"\r\n  content = var.file-content["key2"]\r\n}\n'})}),"\n",(0,s.jsx)(r.h4,{id:"set",children:"Set"}),"\n",(0,s.jsx)(r.p,{children:"A set is a list without duplicated elements:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "prefix" {\r\n  default = ["Mr.", "Mrs.", "Dr."]\r\n  type = set(string)\r\n}\n'})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "prefix" {\r\n  default = ["123", "456", "789]\r\n  type = set(number)\r\n}\n'})}),"\n",(0,s.jsx)(r.h4,{id:"object",children:"Object"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "product" {\r\n  type = object({\r\n    model = string\r\n    color = string\r\n    article = number\r\n    compatibility = set(string)\r\n    sale = bool\r\n  })\r\n\r\n  default = {\r\n    model = "IN-9408 WQHD"\r\n    color = "purple"\r\n    article = 479831\r\n    compatibility = ["Windows", "macOS", "LINUX"]\r\n    sale = false\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.h4,{id:"tuples",children:"Tuples"}),"\n",(0,s.jsx)(r.p,{children:"Just like lists but with mixed types:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'variable "not_a_list" {\r\n  default = ["Artemis", true, 666]\r\n  type = tuple([string, bool, number])\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"output-variables",children:"Output Variables"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://www.terraform.io/docs/language/values/outputs.html",children:"Output values"})," are like the return values of a Terraform module, and have several uses:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"A child module can use outputs to expose a subset of its resource attributes to a parent module."}),"\n",(0,s.jsx)(r.li,{children:"A root module can use outputs to print certain values in the CLI output after running terraform apply."}),"\n",(0,s.jsx)(r.li,{children:"When using remote state, root module outputs can be accessed by other configurations via a terraform_remote_state data source."}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Resource instances managed by Terraform each export attributes whose values can be used elsewhere in configuration. Output values are a way to ",(0,s.jsx)(r.a,{href:"https://learn.hashicorp.com/tutorials/terraform/aws-outputs",children:"expose some of that information to the user of your module"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'resource "random_uuid" "uuid" {\r\n}\r\n\r\nresource "local_file" "resource_name" {\r\n  filename = var.filename\r\n  content =  "${random_uuid.uuid.result}-rg"\r\n  directory_permission = var.directory_permission\r\n  file_permission = var.file_permission\r\n}\r\n\r\noutput uuid {\r\n  value = random_uuid.uuid.result\r\n  description = "Output the randomly generated UUID"\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"The UUID will now be output the the terminal when you run the job:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'sudo terraform apply\r\n\r\nrandom_uuid.uuid: Refreshing state... [id=4c148730-9cd1-bc23-04eb-ae3f5e5000d7]\r\nlocal_file.resource_name: Refreshing state... [id=59c2ee47c7e515c04607c0cfa3d0028dd32e2f13]\r\n\r\nChanges to Outputs:\r\n  + uuid = "4c148730-9cd1-bc23-04eb-ae3f5e5000d7"\r\n\r\nYou can apply this plan to save these new output values to the Terraform state, without changing any real infrastructure.\r\n\r\nDo you want to perform these actions?\r\n  Terraform will perform the actions described above.\r\n  Only \'yes\' will be accepted to approve.\r\n\r\n  Enter a value: yes\r\n\r\n\r\nApply complete! Resources: 0 added, 0 changed, 0 destroyed.\r\n\r\nOutputs:\r\n\r\nuuid = "4c148730-9cd1-bc23-04eb-ae3f5e5000d7"\n'})}),"\n",(0,s.jsx)(r.p,{children:"And it can also be directly queried to make it available for other applications:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:'terraform output\r\nuuid = "4c148730-9cd1-bc23-04eb-ae3f5e5000d7"\r\n\r\nterraform output uuid\r\n"4c148730-9cd1-bc23-04eb-ae3f5e5000d7"\n'})}),"\n",(0,s.jsx)(r.h2,{id:"state",children:"State"}),"\n",(0,s.jsxs)(r.p,{children:["The state of the ",(0,s.jsx)(r.code,{children:"result"})," is stored inside a file ",(0,s.jsx)(r.code,{children:"terraform.tfstate"})," next to the main configuration file and can also be read from there:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\r\n  "mode": "managed",\r\n  "type": "random_uuid",\r\n  "name": "uuid",\r\n  "provider": "provider[\\"registry.terraform.io/hashicorp/random\\"]",\r\n  "instances": [\r\n    {\r\n      "schema_version": 0,\r\n      "attributes": {\r\n        "id": "4c148730-9cd1-bc23-04eb-ae3f5e5000d7",\r\n        "keepers": null,\r\n        "result": "4c148730-9cd1-bc23-04eb-ae3f5e5000d7"\r\n      },\r\n      "sensitive_attributes": [],\r\n      "private": "bnVsbA=="\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["To update the ",(0,s.jsx)(r.strong,{children:"Terraform State"})," without applying changes to your infrastructure run:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform refresh\n"})}),"\n",(0,s.jsx)(r.p,{children:"To apply changes to your infrastructure from the existing state (instead of updating it):"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"terraform plan --refresh=false\n"})})]})}function u(e={}){const{wrapper:r}={...(0,i.ah)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},603905:(e,r,n)=>{n.d(r,{ah:()=>d});var s=n(667294);function i(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,s)}return n}function t(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){i(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,s,i=function(e,r){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=s.createContext({}),d=function(e){var r=s.useContext(o),n=r;return e&&(n="function"==typeof e?e(r):t(t({},r),e)),n},c={inlineCode:"code",wrapper:function(e){var r=e.children;return s.createElement(s.Fragment,{},r)}},u=s.forwardRef((function(e,r){var n=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=d(n),p=i,f=h["".concat(o,".").concat(p)]||h[p]||c[p]||a;return n?s.createElement(f,t(t({ref:r},u),{},{components:n})):s.createElement(f,t({ref:r},u))}));u.displayName="MDXCreateElement"},730254:(e,r,n)=>{n.d(r,{Z:()=>s});const s=n.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-127b11c4ee29cc62887ee4030cc352e7.jpg"}}]);