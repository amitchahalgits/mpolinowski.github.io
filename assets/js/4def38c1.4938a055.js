"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[45563],{894333:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=t(785893),s=t(603905);const i={sidebar_position:9030,slug:"2019-01-13",title:"Centos Administration",authors:"mpolinowski",tags:["LINUX"]},r=void 0,l={id:"DevOps/Linux/2019-01-13--centos-administration/index",title:"Centos Administration",description:"Abashiri, Japan",source:"@site/docs/DevOps/Linux/2019-01-13--centos-administration/index.mdx",sourceDirName:"DevOps/Linux/2019-01-13--centos-administration",slug:"/DevOps/Linux/2019-01-13--centos-administration/2019-01-13",permalink:"/docs/DevOps/Linux/2019-01-13--centos-administration/2019-01-13",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Linux/2019-01-13--centos-administration/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:9030,frontMatter:{sidebar_position:9030,slug:"2019-01-13",title:"Centos Administration",authors:"mpolinowski",tags:["LINUX"]},sidebar:"tutorialSidebar",previous:{title:"Setting up Docker on CentOS 8",permalink:"/docs/DevOps/Linux/2019-06-07--installing-docker-on-centos8/2019-06-07"},next:{title:"Centos Network Configuration",permalink:"/docs/DevOps/Linux/2019-01-12--centos-network-configuration/2019-01-12"}},a={},c=[{value:"Changing your SSH login",id:"changing-your-ssh-login",level:2},{value:"Running FirewallD",id:"running-firewalld",level:2},{value:"Changing the SSH Port",id:"changing-the-ssh-port",level:2},{value:"Changing the Hostname",id:"changing-the-hostname",level:2},{value:"Kernel Update Troubleshooting",id:"kernel-update-troubleshooting",level:2},{value:"Working with IP tables",id:"working-with-ip-tables",level:2},{value:"How do I view blocked ports rules?",id:"how-do-i-view-blocked-ports-rules",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.ah)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Abashiri, Japan",src:t(125378).Z+"",width:"1500",height:"745"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#changing-your-ssh-login",children:"Changing your SSH login"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#running-firewalld",children:"Running FirewallD"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#changing-the-ssh-port",children:"Changing the SSH Port"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#changing-the-hostname",children:"Changing the Hostname"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#kernel-update-troubleshooting",children:"Kernel Update Troubleshooting"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#working-with-ip-tables",children:"Working with IP tables"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#how-do-i-view-blocked-ports-rules",children:"How do I view blocked ports rules?"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"changing-your-ssh-login",children:"Changing your SSH login"}),"\n",(0,o.jsx)(n.p,{children:"SSH uses your linux user password. Simply use the passwd command after logging in. It will prompt you to change it. Or name a different user to change theirs:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"passwd\r\npasswd user1\n"})}),"\n",(0,o.jsx)(n.h2,{id:"running-firewalld",children:"Running FirewallD"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yum install -y firewalld\r\nsystemctl enable firewalld\r\nsystemctl start firewalld\r\nsystemctl status firewalld\r\nfirewall-cmd --permanent --zone=public --add-service=http\r\nfirewall-cmd --permanent --zone=public --add-port=1880/tcp\r\nfirewall-cmd --reload\r\nfirewall-cmd --list-all\n"})}),"\n",(0,o.jsx)(n.h2,{id:"changing-the-ssh-port",children:"Changing the SSH Port"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"firewall-cmd --permanent --zone=public --add-port=4444/tcp\r\nfirewall-cmd --reload\r\nsemanage port -a -t ssh_port_t -p tcp 4444\r\nnano /etc/ssh/sshd_config\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# If you want to change the port on a SELinux system, you have to tell\r\n# SELinux about this change.\r\n# semanage port -a -t ssh_port_t -p tcp #PORTNUMBER\r\n#\r\nPort 4444\r\n#AddressFamily any\r\n#ListenAddress 0.0.0.0\r\n#ListenAddress ::\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"service sshd restart\n"})}),"\n",(0,o.jsx)(n.h2,{id:"changing-the-hostname",children:"Changing the Hostname"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"hostnamectl set-hostname your-new-hostname\r\nhostnamectl\r\nsystemctl reboot\n"})}),"\n",(0,o.jsx)(n.h2,{id:"kernel-update-troubleshooting",children:"Kernel Update Troubleshooting"}),"\n",(0,o.jsxs)(n.p,{children:["How to fix: ",(0,o.jsx)(n.code,{children:"At least xMB more space needed on the /boot filesystem"}),". List all installed kernel packages with:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yum list kernel\n"})}),"\n",(0,o.jsx)(n.p,{children:"The kernel in-use will be underlined and cannot be removed. Now to remove unused kernels, install the yum-utils package and use the package-cleanup util:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"yum install yum-utils\r\npackage-cleanup --oldkernels --count=2\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To make this permanent, edit ",(0,o.jsx)(n.code,{children:"/etc/yum.conf"})," and change the following line:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"installonly_limit=2\n"})}),"\n",(0,o.jsx)(n.h2,{id:"working-with-ip-tables",children:"Working with IP tables"}),"\n",(0,o.jsx)(n.h3,{id:"how-do-i-view-blocked-ports-rules",children:"How do I view blocked ports rules?"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Use the iptables command:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# /sbin/iptables -L -n -v\r\n# /sbin/iptables -L -n -v | grep port\r\n# /sbin/iptables -L -n -v | grep -i DROP\r\n# /sbin/iptables -L OUTPUT -n -v\r\n# /sbin/iptables -L INPUT -n -v\n"})}),"\n",(0,o.jsx)(n.p,{children:"Generally Useful Rules\r\nThis section includes a variety of iptables commands that will create rules that are generally useful on most servers."}),"\n",(0,o.jsx)(n.p,{children:'Allow Loopback Connections\r\nThe loopback interface, also referred to as lo, is what a computer uses to forward network connections to itself. For example, if you run ping localhost or ping 127.0.0.1, your server will ping itself using the loopback. The loopback interface is also used if you configure your application server to connect to a database server with a "localhost" address. As such, you will want to be sure that your firewall is allowing these connections.'}),"\n",(0,o.jsx)(n.p,{children:"To accept all traffic on your loopback interface, run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -i lo -j ACCEPT\r\nsudo iptables -A OUTPUT -o lo -j ACCEPT\r\nAllow Established and Related Incoming Connections\r\nAs network traffic generally needs to be two-way\u2014incoming and outgoing\u2014to work properly, it is typical to create a firewall rule that allows established and related incoming traffic, so that the server will allow return traffic to outgoing connections initiated by the server itself. This command will allow that:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT\r\nAllow Established Outgoing Connections\r\nYou may want to allow outgoing traffic of all established connections, which are typically the response to legitimate incoming connections. This command will allow that:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nInternal to External\r\nAssuming eth0 is your external network, and eth1 is your internal network, this will allow your internal to access the external:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT\r\nDrop Invalid Packets\r\nSome network traffic packets get marked as invalid. Sometimes it can be useful to log this type of packet but often it is fine to drop them. Do so with this command:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -m conntrack --ctstate INVALID -j DROP\r\nBlock an IP Address\r\nTo block network connections that originate from a specific IP address, 15.15.15.51 for example, run this command:"}),"\n",(0,o.jsx)(n.p,{children:'sudo iptables -A INPUT -s 15.15.15.51 -j DROP\r\nIn this example, -s 15.15.15.51 specifies a source IP address of "15.15.15.51". The source IP address can be specified in any firewall rule, including an allow rule.'}),"\n",(0,o.jsx)(n.p,{children:'If you want to reject the connection instead, which will respond to the connection request with a "connection refused" error, replace "DROP" with "REJECT" like this:'}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -s 15.15.15.51 -j REJECT\r\nBlock Connections to a Network Interface\r\nTo block connections from a specific IP address, e.g. 15.15.15.51, to a specific network interface, e.g. eth0, use this command:"}),"\n",(0,o.jsx)(n.p,{children:"iptables -A INPUT -i eth0 -s 15.15.15.51 -j DROP\r\nThis is the same as the previous example, with the addition of -i eth0. The network interface can be specified in any firewall rule, and is a great way to limit the rule to a particular network."}),"\n",(0,o.jsx)(n.p,{children:"Service: SSH\r\nIf you're using a cloud server, you will probably want to allow incoming SSH connections (port 22) so you can connect to and manage your server. This section covers how to configure your firewall with various SSH-related rules."}),"\n",(0,o.jsx)(n.p,{children:"Allow All Incoming SSH\r\nTo allow all incoming SSH connections run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp --sport 22 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Allow Incoming SSH from Specific IP address or subnet\r\nTo allow incoming SSH connections from a specific IP address or subnet, specify the source. For example, if you want to allow the entire 15.15.15.0/24 subnet, run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp --sport 22 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established SSH connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Allow Outgoing SSH\r\nIf your firewall OUTPUT policy is not set to ACCEPT, and you want to allow outgoing SSH connections\u2014your server initiating an SSH connection to another server\u2014you can run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A OUTPUT -p tcp --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A INPUT -p tcp --sport 22 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nAllow Incoming Rsync from Specific IP Address or Subnet\r\nRsync, which runs on port 873, can be used to transfer files from one computer to another."}),"\n",(0,o.jsx)(n.p,{children:"To allow incoming rsync connections from a specific IP address or subnet, specify the source IP address and the destination port. For example, if you want to allow the entire 15.15.15.0/24 subnet to be able to rsync to your server, run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp -s 15.15.15.0/24 --dport 873 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp --sport 873 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established rsync connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Service: Web Server\r\nWeb servers, such as Apache and Nginx, typically listen for requests on port 80 and 443 for HTTP and HTTPS connections, respectively. If your default policy for incoming traffic is set to drop or deny, you will want to create rules that will allow your server to respond to those requests."}),"\n",(0,o.jsx)(n.p,{children:"Allow All Incoming HTTP\r\nTo allow all incoming HTTP (port 80) connections run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp --dport 80 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp --sport 80 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Allow All Incoming HTTPS\r\nTo allow all incoming HTTPS (port 443) connections run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp --dport 443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp --sport 443 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established HTTP connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Allow All Incoming HTTP and HTTPS\r\nIf you want to allow both HTTP and HTTPS traffic, you can use the multiport module to create a rule that allows both ports. To allow all incoming HTTP and HTTPS (port 443) connections run these commands:"}),"\n",(0,o.jsx)(n.p,{children:"sudo iptables -A INPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT\r\nsudo iptables -A OUTPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate ESTABLISHED -j ACCEPT\r\nThe second command, which allows the outgoing traffic of established HTTP and HTTPS connections, is only necessary if the OUTPUT policy is not set to ACCEPT."}),"\n",(0,o.jsx)(n.p,{children:"Run the following. It'll insert the rule at the top of your iptables and will allow all traffic unless subsequently handled by another rule."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"iptables -I INPUT -j ACCEPT\n"})}),"\n",(0,o.jsx)(n.p,{children:"You can also flush your entire iptables setup with the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"iptables -F\r\niptables -X\r\niptables -t nat -F\r\niptables -t nat -X\r\niptables -t mangle -F\r\niptables -t mangle -X\r\niptables -P INPUT ACCEPT\r\niptables -P FORWARD ACCEPT\r\niptables -P OUTPUT ACCEPT\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you flush it, you might want to run something like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'iptables -A INPUT -i lo -j ACCEPT -m comment --comment "Allow all loopback traffic"\r\niptables -A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT -m comment --comment "Drop all traffic to 127 that doesn\'t use lo"\r\niptables -A OUTPUT -j ACCEPT -m comment --comment "Accept all outgoing"\r\niptables -A INPUT -j ACCEPT -m comment --comment "Accept all incoming"\r\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT -m comment --comment "Allow all incoming on established connections"\r\niptables -A INPUT -j REJECT -m comment --comment "Reject all incoming"\r\niptables -A FORWARD -j REJECT -m comment --comment "Reject all forwarded"\n'})}),"\n",(0,o.jsx)(n.p,{children:'If you want to be a bit safer with your traffic, don\'t use the accept all incoming rule, or remove it with "iptables -D INPUT -j ACCEPT -m comment --comment "Accept all incoming"", and add more specific rules like:'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'iptables -I INPUT -p tcp --dport 80 -j ACCEPT -m comment --comment "Allow HTTP"\r\niptables -I INPUT -p tcp --dport 443 -j ACCEPT -m comment --comment "Allow HTTPS"\r\niptables -I INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT -m comment --comment "Allow SSH"\r\niptables -I INPUT -p tcp --dport 8071:8079 -j ACCEPT -m comment --comment "Allow torrents"\n'})}),"\n",(0,o.jsx)(n.p,{children:'NOTE: They need to be above the 2 reject rules at the bottom, so use I to insert them at the top. Or if you\'re anal like me, use "iptables -nL --line-numbers" to get the line numbers, then use "iptables -I INPUT ..." to insert a rule at a specific line number.'}),"\n",(0,o.jsx)(n.p,{children:"Finally, save your work with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"iptables-save > /etc/network/iptables.rules #Or wherever your iptables.rules file is\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.ah)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},603905:(e,n,t)=>{t.d(n,{ah:()=>c});var o=t(667294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,s=function(e,n){if(null==e)return{};var t,o,s={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var a=o.createContext({}),c=function(e){var n=o.useContext(a),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},h=o.forwardRef((function(e,n){var t=e.components,s=e.mdxType,i=e.originalType,a=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=c(t),u=s,m=p["".concat(a,".").concat(u)]||p[u]||d[u]||i;return t?o.createElement(m,r(r({ref:n},h),{},{components:t})):o.createElement(m,r({ref:n},h))}));h.displayName="MDXCreateElement"},125378:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/photo-19196703263_69f9f0df5f_o-ed363526b8d68d0023ae89ce699e9ef8.png"}}]);