"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[87917],{804977:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>a});var r=n(474848),i=n(28453);const t={sidebar_position:9060,slug:"2019-06-10",title:"Windows Server 2019 - Scripting and Sharing",authors:"mpolinowski",tags:["Windows"]},o=void 0,d={id:"DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing/index",title:"Windows Server 2019 - Scripting and Sharing",description:"Wan Chai, Hong Kong",source:"@site/docs/DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing/index.mdx",sourceDirName:"DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing",slug:"/DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing/2019-06-10",permalink:"/docs/DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing/2019-06-10",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Windows/2019-06-10--windows-server-2019-scripting-and-sharing/index.mdx",tags:[{label:"Windows",permalink:"/docs/tags/windows"}],version:"current",sidebarPosition:9060,frontMatter:{sidebar_position:9060,slug:"2019-06-10",title:"Windows Server 2019 - Scripting and Sharing",authors:"mpolinowski",tags:["Windows"]},sidebar:"tutorialSidebar",previous:{title:"Windows Server 2019 - Active Directory Installation",permalink:"/docs/DevOps/Windows/2019-06-11--windows-server-2019-active-directory/2019-06-11"},next:{title:"Getting Started with Windows Server 2019",permalink:"/docs/DevOps/Windows/2019-06-09--setting-up-windows-server-2019/2019-06-09"}},c={},a=[{value:"Windows Powershell",id:"windows-powershell",level:2},{value:"Running Powershell Commands",id:"running-powershell-commands",level:3},{value:"Powershell Scripting",id:"powershell-scripting",level:3},{value:"Creating a Samba Share",id:"creating-a-samba-share",level:2}];function l(e){const s={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Wan Chai, Hong Kong",src:n(366992).A+"",width:"1500",height:"654"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"#windows-powershell",children:"Windows Powershell"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#running-powershell-commands",children:"Running Powershell Commands"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#powershell-scripting",children:"Powershell Scripting"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"windows-powershell",children:"Windows Powershell"}),"\n",(0,r.jsxs)(s.p,{children:["We can access the Microsoft Windows Powershell directly from the ",(0,r.jsx)(s.a,{href:"/docs/DevOps/Windows/2019-06-09--setting-up-windows-server-2019/2019-06-09#windows-admin-center",children:"Windows Admin Center"}),". Connect the Admin Center to your Windows Server and search for ",(0,r.jsx)(s.strong,{children:"Powershell"})," under ",(0,r.jsx)(s.strong,{children:"Tools"})," you will be asked to log in with your account."]}),"\n",(0,r.jsx)(s.h3,{id:"running-powershell-commands",children:"Running Powershell Commands"}),"\n",(0,r.jsxs)(s.p,{children:["You can all ",(0,r.jsx)(s.a,{href:"https://devblogs.microsoft.com/scripting/table-of-basic-powershell-commands/",children:"Powershell Commands"})," directly from this web interface, e.g. creating a new user on your server with ",(0,r.jsx)(s.code,{children:"New-LocalUser -Name Peter"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(516737).A+"",width:"1273",height:"792"})}),"\n",(0,r.jsxs)(s.p,{children:["Search for ",(0,r.jsx)(s.strong,{children:"Local user & groups"})," under tools inside the Admin Center and ",(0,r.jsx)(s.em,{children:"right-ctrl-click"})," it to open the user management in a new tab. You will see that the user has been created:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(486154).A+"",width:"1275",height:"392"})}),"\n",(0,r.jsx)(s.p,{children:"Working with the filesystem works the same way - listing directories, creating folders and files and copying them to other locations:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"Get-ChildItem -Path C:\\\r\nNew-Item -Path 'C:\\scripts' -ItemType Directory\r\nNew-Item -Path 'C:\\scripts\\test' -ItemType Directory\r\nNew-Item -Path 'C:\\scripts\\test\\helloworld.ps1' -ItemType File\r\nCopy-Item -Path 'C:\\scripts\\test\\helloworld.ps1' -Destination 'C:\\scripts\\hello.ps1'\r\nRemove-Item -Path 'C:\\scripts\\test\\helloworld.ps1'\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(641363).A+"",width:"1273",height:"953"})}),"\n",(0,r.jsx)(s.p,{children:"Run the following commands to get an overview over all processes and services:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"Get-Process\r\nGet-Service\n"})}),"\n",(0,r.jsx)(s.h3,{id:"powershell-scripting",children:"Powershell Scripting"}),"\n",(0,r.jsxs)(s.p,{children:["We can also run local shell scripts through Powershell on our server. Those scripts can be stored on our server with the ",(0,r.jsx)(s.code,{children:".ps1"})," file extension. Here is a ",(0,r.jsx)(s.strong,{children:"Hello World"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"echo 'Hello World'\r\n\r\nsleep 10\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Save the file with the name ",(0,r.jsx)(s.code,{children:"helloworld.ps1"}),", navigate your into the directory and run the script as ",(0,r.jsx)(s.code,{children:".\\helloworld.ps1"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(286492).A+"",width:"1287",height:"413"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Hello World"})," will be displayed for 10 seconds and then disappear."]}),"\n",(0,r.jsx)(s.p,{children:"An example for a useful shell script would be:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:"Class DirToBackup\r\n{\r\n    [String]$path\r\n    DirToBackup([String]$path) {\r\n      $this.path = $path\r\n    }\r\n}\r\n$defaultListOfExcluded = 'C:\\inetpub\\wwwroot\\just_testing\\listOfBackupExcluded.txt'\r\n$pathFromPrefix = 'C:\\inetpub\\wwwroot\\just_testing\\test_data\\'\r\n$pathToPrefix = 'C:\\inetpub\\wwwroot\\just_testing\\backup_data\\'\r\nWrite-Output 'Plug external disk drive.'\r\npause\r\n$dirsToBackup = @(\r\n    New-Object DirToBackup 'backup'\r\n    New-Object DirToBackup 'development'\r\n)\r\n$dirsToBackup | ForEach-Object {\r\n    mkdir -Path $($pathToPrefix + $_.path) -Force\r\n    xcopy $($pathFromPrefix + $_.path) $($pathToPrefix + $_.path) /D /S /Y /H /EXCLUDE:$defaultListOfExcluded\r\n}\r\npause\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The file ",(0,r.jsx)(s.code,{children:"listOfBackupExcluded.txt"})," in the same directory as our script lists all files, file extensions and directories that we want to exclude from our backup:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"\\build\\\r\n\\.gitignore\\\r\n.secret\\\r\n\\notes\r\n\\node_modules\\\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This will exclude the directories ",(0,r.jsx)(s.code,{children:"build"})," and ",(0,r.jsx)(s.code,{children:"node_modules"}),", the ",(0,r.jsx)(s.code,{children:".gitignore"})," file, every file with the extension ",(0,r.jsx)(s.code,{children:".secret"})," and files who's name starts with ",(0,r.jsx)(s.code,{children:"notes"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["The script will then copy the content of the directory ",(0,r.jsx)(s.code,{children:"test_data"})," to ",(0,r.jsx)(s.code,{children:"backup_data"}),". Ideally ",(0,r.jsx)(s.code,{children:"backup_data"})," has to be on an external drive - so we added a prompt for the user to plugin the backup drive. But for testing we will leave both directories on the same harddrive. The main part of the script is a loop that goes through all dirsToBackup elements and executes mkdir and xcopy functions. mkdir creates directories in the target location. Flag -Force makes possible to not error the script when directory\u2019s already exists."]}),"\n",(0,r.jsx)(s.p,{children:"There are few flags that are very important:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"/D"})," \u2014 Copies only those files whose source time is newer than the destination time."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"/S"})," \u2014 Copies directories and subdirectories except empty ones."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"/Y"})," \u2014 Suppresses prompting to confirm you want to overwrite an\r\nexisting destination file."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"/H"})," \u2014 Copies hidden and system files also."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(369381).A+"",width:"1274",height:"491"})}),"\n",(0,r.jsx)(s.h2,{id:"creating-a-samba-share",children:"Creating a Samba Share"}),"\n",(0,r.jsxs)(s.p,{children:["This time we want to use the ",(0,r.jsx)(s.a,{href:"https://www.microsoft.com/en-us/p/microsoft-remote-desktop/9wzdncrfj3ps",children:"Microsoft Remote Desktop App"})," to connect to our Windows Server and enable the ",(0,r.jsx)(s.strong,{children:"Samba Share Functionality"}),". To be able to connect we first have to ensure that ",(0,r.jsx)(s.strong,{children:"Remote Desktop"})," is enabled on our server:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(599022).A+"",width:"1275",height:"348"})}),"\n",(0,r.jsxs)(s.p,{children:["Now we can ",(0,r.jsx)(s.strong,{children:"Add a Desktop"})," on our host machine inside ",(0,r.jsx)(s.strong,{children:"Remote Desktop"}),". Type in the server name or IP address and add the user account you want to use to connect to the remote server:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(544599).A+"",width:"1196",height:"666"})}),"\n",(0,r.jsxs)(s.p,{children:["Then click to connect to the remote server. If the connection fails, try to ping your server from your command prompt, e.g. ",(0,r.jsx)(s.code,{children:"ping WINSERVER2019"}),". You should be able to get a ping here - if not you need to troubleshoot your network:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(924688).A+"",width:"1197",height:"408"})}),"\n",(0,r.jsx)(s.p,{children:"Accept the self-signed certificate we used for our server and you should be able to see the server desktop in front of you:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(503331).A+"",width:"1326",height:"698"})}),"\n",(0,r.jsxs)(s.p,{children:["On the server right-click the directory you want to share, choose ",(0,r.jsx)(s.strong,{children:"Properties"}),", ",(0,r.jsx)(s.strong,{children:"Sharing"})," ",(0,r.jsx)(s.strong,{children:"Advanced Sharing"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(798106).A+"",width:"1124",height:"627"})}),"\n",(0,r.jsxs)(s.p,{children:["Name the share and click on ",(0,r.jsx)(s.strong,{children:"Permissions"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(406417).A+"",width:"1120",height:"628"})}),"\n",(0,r.jsx)(s.p,{children:"Add the user you want to use to connect to the share:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(166472).A+"",width:"1120",height:"628"})}),"\n",(0,r.jsxs)(s.p,{children:["And give him the ",(0,r.jsx)(s.strong,{children:"Full Control"})," over the share:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(441639).A+"",width:"1123",height:"629"})}),"\n",(0,r.jsx)(s.p,{children:"Everything is set up and you should be able to discover the share from your host machine and connect to it with the user you specified:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(570302).A+"",width:"1124",height:"631"})}),"\n",(0,r.jsxs)(s.p,{children:["Back on your host machine right-click ",(0,r.jsx)(s.strong,{children:"This PC"})," and click on ",(0,r.jsx)(s.strong,{children:"Add a network location"})," and follow the assistant:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(656053).A+"",width:"867",height:"382"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(573164).A+"",width:"1198",height:"740"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(169403).A+"",width:"1193",height:"742"})}),"\n",(0,r.jsx)(s.p,{children:"Type in the network address as follows:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["2 x ",(0,r.jsx)(s.code,{children:"\\"})]}),"\n",(0,r.jsxs)(s.li,{children:["Your server name in capital letters, e.g. ",(0,r.jsx)(s.code,{children:"WINSERVER2019"})," followed by a ",(0,r.jsx)(s.code,{children:"\\"})]}),"\n",(0,r.jsxs)(s.li,{children:["The name you gave the share, e.g. ",(0,r.jsx)(s.code,{children:"WinServer2019"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(904050).A+"",width:"1194",height:"731"})}),"\n",(0,r.jsxs)(s.p,{children:["After confirming you will be asked to sign in - use the user login that you specified in the share options and click on ",(0,r.jsx)(s.strong,{children:"Finish"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(824178).A+"",width:"1192",height:"743"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(539003).A+"",width:"1196",height:"741"})}),"\n",(0,r.jsxs)(s.p,{children:["The share should now be listed under ",(0,r.jsx)(s.strong,{children:"Network"}),":"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Windows Server 2019",src:n(760672).A+"",width:"1199",height:"608"})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},516737:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_01-a9e607eb3e0ddc1d06d34519b4dc9bec.png"},486154:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_02-97a720a8e3b8902ac795d203cdd64e7d.png"},641363:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_03-c59739b1bcef07c3c1f4d9361be5e817.png"},286492:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_04-f07efae32e6074f9e87e1d22cc8897cb.png"},369381:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_05-79dfdeefc1db5949cccce2b19c988419.png"},599022:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_06-ead147e272159a1bb2305aee88365596.png"},544599:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_07-34be4f6e32b14658e3777cf61a4e02fa.png"},924688:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_08-5bbbb7f5f6ac79d5834c9a3e49875068.png"},503331:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_10-b893467815a005e85791b272fa3b2e85.png"},798106:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_11-562cfc2daf31235deda594561b5f6c35.png"},406417:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_12-38d8fcf258620036402aaf06d1ab5d87.png"},166472:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_13-7746eb1f3b7ba1c192e9d3f5ff144f2a.png"},441639:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_14-4386fd314caa7f225ca7c79d299522e5.png"},570302:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_15-1528d206810188971ee9fa34f4d2cb95.png"},656053:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_16-62402880b516cf16e493917349cb9b5a.png"},573164:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_17-3e1848f51b1efba781d07a69207dd9a8.png"},169403:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_18-d1ddfa78e93d68016505cec72cbb8df2.png"},904050:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_19-3db238095611d7e49c2444bd53cb2173.png"},824178:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_20-d544555777f5d3d8f608377be4d8fe9e.png"},539003:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_21-b973c221f4683854ed43e1eb239cfbad.png"},760672:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/Windows_Server_2019_22-1ddab52487ced9fedcb07e8102f965ec.png"},366992:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/photo-fd6d_gj62544ethg4_d-4d3b4974f45b02cf184cd6862b4ce29a.jpg"},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>d});var r=n(296540);const i={},t=r.createContext(i);function o(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);