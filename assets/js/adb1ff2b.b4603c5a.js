"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[36558],{835664:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var n=t(785893),s=t(603905);const i={sidebar_position:5030,slug:"2022-10-16",title:"Provision OSticket with Docker",authors:"mpolinowski",tags:["LINUX","Docker","osTicket"],description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service"},a=void 0,o={id:"DevOps/Provisioning/2022-10-16--os-ticket-docker/index",title:"Provision OSticket with Docker",description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service",source:"@site/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/index.md",sourceDirName:"DevOps/Provisioning/2022-10-16--os-ticket-docker",slug:"/DevOps/Provisioning/2022-10-16--os-ticket-docker/2022-10-16",permalink:"/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/2022-10-16",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"},{label:"osTicket",permalink:"/docs/tags/os-ticket"}],version:"current",sidebarPosition:5030,frontMatter:{sidebar_position:5030,slug:"2022-10-16",title:"Provision OSticket with Docker",authors:"mpolinowski",tags:["LINUX","Docker","osTicket"],description:"Use Docker, Docker-Compose and Nomad to provide an OSTicket Service"},sidebar:"tutorialSidebar",previous:{title:"OSticket REST API Calls",permalink:"/docs/DevOps/Provisioning/2022-10-27--os-ticket-rest-api/2022-10-27"},next:{title:"Bind9 Server Configuration",permalink:"/docs/DevOps/Provisioning/2022-01-27--bind9-configuration/2022-01-27"}},c={},d=[{value:"Installation using Docker",id:"installation-using-docker",level:2},{value:"Customize",id:"customize",level:2},{value:"Adding Plugins",id:"adding-plugins",level:3},{value:"Language Packs",id:"language-packs",level:3},{value:"Docker-Compose",id:"docker-compose",level:2},{value:"Build a customized OSTicket Image",id:"build-a-customized-osticket-image",level:2},{value:"Backup &amp; Restore",id:"backup--restore",level:2},{value:"Restore from MySQL Dump",id:"restore-from-mysql-dump",level:3},{value:"Create a MySQL Dump",id:"create-a-mysql-dump",level:3}];function l(e){const r={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.ah)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"Shenzhen, China",src:t(734595).Z+"",width:"1500",height:"567"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#installation-using-docker",children:"Installation using Docker"})}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"#customize",children:"Customize"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#adding-plugins",children:"Adding Plugins"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#language-packs",children:"Language Packs"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#docker-compose",children:"Docker-Compose"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#build-a-customized-osticket-image",children:"Build a customized OSTicket Image"})}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"#backup--restore",children:"Backup & Restore"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#restore-from-mysql-dump",children:"Restore from MySQL Dump"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#create-a-mysql-dump",children:"Create a MySQL Dump"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Update"}),": The used Docker image in this tutorial is ",(0,n.jsx)(r.a,{href:"https://github.com/mpolinowski/osticket-nomad/issues/1",children:"currently not compatible with the latest version of OSTicket (v1.17.3)"})," => I recommend switching to ",(0,n.jsx)(r.a,{href:"/docs/DevOps/Provisioning/2023-03-09--os-ticket-docker-2023/2023-03-09",children:"this"})," instead."]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"installation-using-docker",children:"Installation using Docker"}),"\n",(0,n.jsxs)(r.p,{children:["Pull ",(0,n.jsx)(r.a,{href:"https://docs.osticket.com/en/latest/Getting%20Started/Installation.html",children:"osTicket"})," Image from ",(0,n.jsx)(r.a,{href:"https://hub.docker.com/r/osticket/osticket/",children:"hub.docker.com"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker pull osticket/osticket:latest\n"})}),"\n",(0,n.jsx)(r.p,{children:"Make sure you have a MySQL container running that osTicket can use to store its data:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker pull mariadb:latest\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker run --name osticket_mysql -d -e MYSQL_ROOT_PASSWORD=secret \\\r\n-e MYSQL_USER=osticket -e MYSQL_PASSWORD=secret -e MYSQL_DATABASE=osticket mariadb:latest\n"})}),"\n",(0,n.jsx)(r.p,{children:"Now run this image and link the MySQL container:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker run --name osticket -d --link osticket_mysql:mysql -p 8080:80 osticket/osticket\n"})}),"\n",(0,n.jsx)(r.p,{children:"Wait for the setup process to finish - this will download the latest version of OSticket and might take a while:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker logs osticket\r\nCloning into '.'...\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Once installation is completed then browse to your osTicket staff control panel at ",(0,n.jsx)(r.code,{children:"http://localhost:8080/scp"}),". Login with default admin user & password:"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["username: ",(0,n.jsx)(r.code,{children:"ostadmin"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["password: ",(0,n.jsx)(r.code,{children:"Admin1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"customize",children:"Customize"}),"\n",(0,n.jsx)(r.h3,{id:"adding-plugins",children:"Adding Plugins"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker exec -ti osticket /bin/bash\n"})}),"\n",(0,n.jsx)(r.p,{children:"All plugins can be found in the following directory. Use a volume mount to add community plugins:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ls -la /var/www/src/public/include/plugins\r\ntotal 2908\r\ndrwxr-xr-x 14 www-data www-data    4096 Oct 17 09:07 .\r\ndrwxr-xr-x 12 www-data www-data    4096 Oct 17 09:06 ..\r\ndrwxr-xr-x  8 www-data www-data    4096 Oct 17 09:06 .git\r\n-rw-r--r--  1 www-data www-data     364 Oct 17 09:06 .gitignore\r\n-rw-r--r--  1 www-data www-data       0 Oct 17 09:06 .keep\r\n-rw-r--r--  1 www-data www-data   18026 Oct 17 09:06 LICENSE\r\n-rw-r--r--  1 www-data www-data    1023 Oct 17 09:06 README.md\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:06 audit\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-2fa\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-cas\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-ldap\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 auth-oauth2\r\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 auth-passthru\r\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 auth-password-policy\r\n-rw-r--r--  1 www-data www-data     228 Oct 17 09:06 composer.json\r\n-rw-r--r--  1 www-data www-data   41176 Oct 17 09:07 composer.lock\r\n-rw-r--r--  1 www-data www-data 2808725 Oct 17 09:07 composer.phar\r\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 doc\r\ndrwxr-xr-x 15 www-data www-data    4096 Oct 17 09:07 lib\r\n-rw-r--r--  1 www-data www-data   24618 Oct 17 09:06 make.php\r\ndrwxr-xr-x  2 www-data www-data    4096 Oct 17 09:06 storage-fs\r\ndrwxr-xr-x  3 www-data www-data    4096 Oct 17 09:07 storage-s3\r\n-rw-r--r--  1 www-data www-data    1194 Oct 17 09:06 updates.pem\n"})}),"\n",(0,n.jsx)(r.p,{children:"Install them from Manage/Plugins:"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"Provision OSticket with Docker",src:t(438181).Z+"",width:"950",height:"254"})}),"\n",(0,n.jsx)(r.h3,{id:"language-packs",children:"Language Packs"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.a,{href:"https://osticket.com/download/",children:"Download the language files"})," and place them into:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ls -la /var/www/src/public/include/i18n/\r\ntotal 44\r\ndrwxr-xr-x  4 www-data www-data  4096 Oct 17 10:14 .\r\ndrwxr-xr-x 12 www-data www-data  4096 Oct 17 10:14 ..\r\n-rw-r--r--  1 www-data www-data  1097 Oct 17 10:14 README.md\r\ndrwxr-xr-x  4 www-data www-data  4096 Oct 17 10:14 en_US\r\n-rw-r--r--  1 www-data www-data 20586 Oct 17 10:14 langs.php\r\ndrwxr-xr-x  3 www-data www-data  4096 Oct 17 10:14 vendor\n"})}),"\n",(0,n.jsx)(r.p,{children:"by binding them into your container:"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"docker-compose.yml"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"volumes:\r\n    - type: bind\r\n      source: ./src/include/i18n/de.phar\r\n      target: /var/www/src/public/include/i18n/de.phar\r\n      read_only: true\n"})}),"\n",(0,n.jsx)(r.p,{children:"And select them from the Admin panel:"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"Provision OSticket with Docker",src:t(4474).Z+"",width:"955",height:"417"})}),"\n",(0,n.jsx)(r.h2,{id:"docker-compose",children:"Docker-Compose"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"version: '3.8'\r\nservices:\r\n\r\n  osticket-app:\r\n    image: osticket/osticket:latest\r\n    container_name: osticket\r\n    volumes:\r\n      - type: bind\r\n        source: ./src/include/i18n/de.phar\r\n        target: /var/www/src/public/include/i18n/de.phar\r\n        read_only: true\r\n    environment:\r\n      - CONTAINER_NAME=osticket\r\n      - MYSQL_USER=osticket\r\n      - MYSQL_HOST=osticket-db\r\n      - MYSQL_PASSWORD=secret\r\n      - MYSQL_DATABASE=osticket\r\n    ports:\r\n      - 8080:80\r\n    depends_on:\r\n      - osticket-db\r\n    networks:\r\n      - services\r\n    links:\r\n      - osticket-db\r\n    restart: unless-stopped\r\n\r\n  osticket-db:\r\n    image: mariadb:latest\r\n    container_name: osticket-db\r\n    volumes:\r\n      - /opt/osticket/db:/var/lib/mysql\r\n    environment:\r\n      - MYSQL_ROOT_PASSWORD=secret\r\n      - MYSQL_USER=osticket\r\n      - MYSQL_PASSWORD=secret\r\n      - MYSQL_DATABASE=osticket\r\n      - CONTAINER_NAME=osticket-db\r\n    networks:\r\n      - services\r\n    restart: unless-stopped\r\n\r\nnetworks:\r\n  services:\r\n    external: false\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Note"}),": The volume mount ",(0,n.jsx)(r.code,{children:"/opt/osticket/db:/var/lib/mysql"})," makes sure that all data written to MariaDB will be persisted. Make sure the host path ",(0,n.jsx)(r.code,{children:"/opt/osticket/db"})," exists and can be written to ~ or just change it to a dir that fulfills the requirement."]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"build-a-customized-osticket-image",children:"Build a customized OSTicket Image"}),"\n",(0,n.jsx)(r.p,{children:"The docker compose file contains a volume mount for the language file I added:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"volumes:\r\n  - type: bind\r\n    source: ./src/include/i18n/de.phar\r\n    target: /var/www/src/public/include/i18n/de.phar\r\n    read_only: true\n"})}),"\n",(0,n.jsxs)(r.p,{children:['Actually, there are a lot more files that I need to mount - logos, styles and additional scripts. It makes sense for me to simply "bake" all of them into a customized image of OSTicket using the ',(0,n.jsx)(r.code,{children:"docker build"})," command."]}),"\n",(0,n.jsxs)(r.p,{children:["Here I ran into a few issues with the official docker image and found this fork of it that is based on a ",(0,n.jsx)(r.a,{href:"https://github.com/devinsolutions/docker-osticket/blob/master/Dockerfile",children:"PHP8 Alpine Linux image"})," that is much more suitable for my task. You can build this image of OSTicket with:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker build -t my/osticket .\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Now we can use this image to add our customizations with a ",(0,n.jsx)(r.strong,{children:"Dockerfile"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dockerfile",children:"FROM instar/osticket:latest\r\n\r\n# add all your files here, e.g.\r\nCOPY ./src/include/staff/header.inc.php /var/www/html/include/staff/header.inc.php\r\n#...\n"})}),"\n",(0,n.jsx)(r.p,{children:"Now build this image and tag it according to your Docker Registry setup:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker build -t my.gitlab.com:12345/server_management/my-osticket:latest .\n"})}),"\n",(0,n.jsxs)(r.p,{children:["When you pull this image you can still use the ",(0,n.jsx)(r.code,{children:"docker-compose.yml"})," file from above - but you no longer have to provide the volumen mounts and source files. Everything is baked in!"]}),"\n",(0,n.jsx)(r.h2,{id:"backup--restore",children:"Backup & Restore"}),"\n",(0,n.jsxs)(r.p,{children:["The database image uses a volume mount to persist all written data ",(0,n.jsx)(r.code,{children:"/opt/osticket/db:/var/lib/mysql"}),". You can use it to drop in an SQL dump to ",(0,n.jsx)(r.code,{children:"/opt/osticket/db"})," enter the MariaDB image:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"docker exec -ti osticket-db /bin/bash\n"})}),"\n",(0,n.jsx)(r.p,{children:"And restore your old OSTicket state:"}),"\n",(0,n.jsx)(r.h3,{id:"restore-from-mysql-dump",children:"Restore from MySQL Dump"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"mysql -uosticket -p osticket < Ticketsystem_2022-10-20.sql\n"})}),"\n",(0,n.jsx)(r.h3,{id:"create-a-mysql-dump",children:"Create a MySQL Dump"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"mysqldump -uosticket -p osticket > backup-file.sql\r\nEnter password: secret\n"})})]})}function h(e={}){const{wrapper:r}={...(0,s.ah)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},603905:(e,r,t)=>{t.d(r,{ah:()=>d});var n=t(667294);function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function a(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function o(e,r){if(null==e)return{};var t,n,s=function(e,r){if(null==e)return{};var t,n,s={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(s[t]=e[t]);return s}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var c=n.createContext({}),d=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):a(a({},r),e)),t},l={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},h=n.forwardRef((function(e,r){var t=e.components,s=e.mdxType,i=e.originalType,c=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),u=d(t),w=s,p=u["".concat(c,".").concat(w)]||u[w]||l[w]||i;return t?n.createElement(p,a(a({ref:r},h),{},{components:t})):n.createElement(p,a({ref:r},h))}));h.displayName="MDXCreateElement"},438181:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/OSTicket_Docker_01-356106685fea9654593cbdf47b9676c9.png"},4474:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/OSTicket_Docker_02-b60bc54f63129d8be062ea36edb999e2.png"},734595:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-983e9af3d84f5fb9ebad02646e63767d.jpg"}}]);