"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[86347],{822453:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>d});var s=i(474848),a=i(28453);const t={sidebar_position:4575,slug:"2023-09-27",title:"MLOps with ZenML - SKLearn Classifier Pipeline",authors:"mpolinowski",tags:["Python","Machine Learning"],description:"Use ZenML to build a SciKit-Learn SVC Image Classifier Pipeline"},r="MLOps with ZenML",l={id:"IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline/index",title:"MLOps with ZenML - SKLearn Classifier Pipeline",description:"Use ZenML to build a SciKit-Learn SVC Image Classifier Pipeline",source:"@site/docs/IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline/index.md",sourceDirName:"IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline",slug:"/IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline/2023-09-27",permalink:"/docs/IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline/2023-09-27",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/AIOps/2023-09-27-zenml-intro-sklearn-pipeline/index.md",tags:[{label:"Python",permalink:"/docs/tags/python"},{label:"Machine Learning",permalink:"/docs/tags/machine-learning"}],version:"current",sidebarPosition:4575,frontMatter:{sidebar_position:4575,slug:"2023-09-27",title:"MLOps with ZenML - SKLearn Classifier Pipeline",authors:"mpolinowski",tags:["Python","Machine Learning"],description:"Use ZenML to build a SciKit-Learn SVC Image Classifier Pipeline"},sidebar:"tutorialSidebar",previous:{title:"MLFlow with PyTorch Lighning in Docker",permalink:"/docs/IoT-and-Machine-Learning/AIOps/2024-02-21-mlflow-pytorch-lightning-docker/2024-02-21"},next:{title:"Tensorflow Serving API",permalink:"/docs/IoT-and-Machine-Learning/AIOps/2023-08-19-tensorflow-serving-api/2023-08-19"}},o={},d=[{value:"Installation",id:"installation",level:2},{value:"ZenML Server with Docker-Compose",id:"zenml-server-with-docker-compose",level:3},{value:"ZenML Client Python Package",id:"zenml-client-python-package",level:3},{value:"Run the Classifier using a ZenML Pipeline",id:"run-the-classifier-using-a-zenml-pipeline",level:2},{value:"Define Steps",id:"define-steps",level:3},{value:"Define Pipeline of Steps",id:"define-pipeline-of-steps",level:3},{value:"Initialize Pipeline",id:"initialize-pipeline",level:3},{value:"Visualize the Results",id:"visualize-the-results",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Guangzhou, China",src:i(811771).A+"",width:"1061",height:"405"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#mlops-with-zenml",children:"MLOps with ZenML"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#installation",children:"Installation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#zenml-server-with-docker-compose",children:"ZenML Server with Docker-Compose"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#zenml-client-python-package",children:"ZenML Client Python Package"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#run-the-classifier-using-a-zenml-pipeline",children:"Run the Classifier using a ZenML Pipeline"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#define-steps",children:"Define Steps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#define-pipeline-of-steps",children:"Define Pipeline of Steps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#initialize-pipeline",children:"Initialize Pipeline"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#visualize-the-results",children:"Visualize the Results"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/mpolinowski/zenml-introduction",children:"Github Repository"})}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"mlops-with-zenml",children:"MLOps with ZenML"}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsx)(n.h3,{id:"zenml-server-with-docker-compose",children:"ZenML Server with Docker-Compose"}),"\n",(0,s.jsx)(n.p,{children:"Docker compose offers a simpl way of managing multi-container setups on your local machine, which is the case for instance if you are looking to deploy the ZenML server container and connect it to a MySQL database service also running in a Docker container."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"docker-compose.yml"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:'version: "3.9"\n\nservices:\n  mysql:\n    image: mysql:8.0\n    ports:\n      - 3306:3306\n    volumes:\n      - type: bind\n        source: ./data\n        target: /var/lib/mysql\n    environment:\n      - MYSQL_ROOT_PASSWORD=password\n  zenml:\n    image: zenmldocker/zenml-server\n    ports:\n      - "8888:8080"\n    environment:\n      - ZENML_STORE_URL=mysql://root:password@host.docker.internal/zenml\n      - ZENML_DEFAULT_USER_NAME=admin\n      - ZENML_DEFAULT_USER_PASSWORD=zenml\n    links:\n      - mysql\n    depends_on:\n      - mysql\n    extra_hosts:\n      - "host.docker.internal:host-gateway"\n    restart: on-failure\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Changes I made to this file - compared to the ",(0,s.jsx)(n.a,{href:"https://docs.zenml.io/deploying-zenml/zenml-self-hosted/deploy-with-docker#zenml-server-with-docker-compose",children:"official documentation"})," are that I mounted a directory into the MySQL container to persist my data. And I had to change the outer server port ",(0,s.jsx)(n.code,{children:"8080"})," used by the ZenML Server to ",(0,s.jsx)(n.code,{children:"8888"})," to avoid a port conflict on my server."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose -p zenml up  -d\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Verify that the ZenML interface is up and running by signing in - the dashboard will be hosted on your Servers IP on the outer port you defined in the compose file above (in my case port ",(0,s.jsx)(n.code,{children:"8888"}),"). The admin login is the default user name and password from the compose file:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"MLOps with ZenML",src:i(316237).A+"",width:"938",height:"574"})}),"\n",(0,s.jsx)(n.h3,{id:"zenml-client-python-package",children:"ZenML Client Python Package"}),"\n",(0,s.jsx)(n.p,{children:"ZenML is a Python package that can be installed directly via pip:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pip install zenml\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To be able to use ZenML with the ML Framework of our choice we need to install the corresponding ",(0,s.jsx)(n.strong,{children:"Integration"}),", e.g.:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zenml integration install sklearn\n"})}),"\n",(0,s.jsx)(n.p,{children:"Which works a bit like a package manager checking if you have all packages installed ZenML lists as a requirement when when working with SKLearn models."}),"\n",(0,s.jsx)(n.p,{children:"You can connect your ZenML client using the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"zenml connect --url http://my-server:8888 --username admin --password zenml\n"})}),"\n",(0,s.jsx)(n.p,{children:"And initialize the project pipeline:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"rm -rf .zen\nzenml init\n"})}),"\n",(0,s.jsx)(n.h2,{id:"run-the-classifier-using-a-zenml-pipeline",children:"Run the Classifier using a ZenML Pipeline"}),"\n",(0,s.jsx)(n.h3,{id:"define-steps",children:"Define Steps"}),"\n",(0,s.jsxs)(n.p,{children:["Define the classifier in 3 ZenML Pipeline steps - ",(0,s.jsx)(n.strong,{children:"Data Loading"}),", ",(0,s.jsx)(n.strong,{children:"Model Training"})," and ",(0,s.jsx)(n.strong,{children:"Model Evaluation"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"import numpy as np\nfrom sklearn.base import ClassifierMixin\nfrom sklearn.svm import SVC\nfrom sklearn.datasets import load_digits\nfrom sklearn.model_selection import train_test_split\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from zenml import step\nfrom typing_extensions import Annotated\nfrom typing import Tuple\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@step\ndef importer() -> Tuple[\n    Annotated[np.ndarray, "X_train"],\n    Annotated[np.ndarray, "X_test"],\n    Annotated[np.ndarray, "y_train"],\n    Annotated[np.ndarray, "y_test"],\n]:\n    """Load the digits dataset as numpy arrays."""\n    digits = load_digits()\n    data = digits.images.reshape((len(digits.images), -1))\n    X_train, X_test, y_train, y_test = train_test_split(\n        data, digits.target, test_size=0.2, shuffle=False\n    )\n    return X_train, X_test, y_train, y_test\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@step\ndef svc_trainer(\n            X_train: np.ndarray,\n            y_train: np.ndarray\n        ) -> ClassifierMixin:\n    """Train the SVC classifier."""\n    model = SVC(gamma=0.001)\n    model.fit(X_train, y_train)\n\n    return model\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@step\ndef evaluator(\n    X_test: np.ndarray,\n    y_test: np.ndarray,\n    model: ClassifierMixin\n) -> float:\n    """Calculate the model accuracy using the test set."""\n    score = model.score(X_test, y_test)\n    print(f"Test Accuracy: {score}")\n\n    return score\n'})}),"\n",(0,s.jsx)(n.h3,{id:"define-pipeline-of-steps",children:"Define Pipeline of Steps"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from zenml import pipeline\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@pipeline\ndef digits_classifier():\n    """SVC digits classifier pipeline"""\n    X_train, X_test, y_train, y_test = importer()\n    model = svc_trainer(X_train, y_train=y_train)\n    evaluator(X_test=X_test, y_test=y_test, model=model)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"initialize-pipeline",children:"Initialize Pipeline"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"classifier = digits_classifier()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Initiating a new run for the pipeline: digits_classifier.\nRegistered new version: (version 1).\nExecuting a new run.\nUsing user: admin\nUsing stack: default\norchestrator: default\nartifact_store: default\nStep importer has started.\nStep importer has finished in 3.163s.\nStep svc_trainer has started.\nStep svc_trainer has finished in 0.644s.\nStep evaluator has started.\nTest Accuracy: 0.9583333333333334\nStep evaluator has finished in 0.582s.\nRun digits_classifier-2023_09_27-08_22_04_011726 has finished in 6.684s.\nDashboard URL: ",(0,s.jsx)(n.a,{href:"http://my-server:8888/workspaces/default/pipelines/32b2fbc0-765b-48d9-badd-75d60e1f46fa/runs/a9ffc4c6-5a2b-4560-bb8b-beab259b4bf1/dag32b2fbc0-765b-48d9-badd-75d60e1f46fa/runs/a9ffc4c6-5a2b-4560-bb8b-beab259b4bf1/dag",children:"http://my-server:8888/workspaces/default/pipelines/32b2fbc0-765b-48d9-badd-75d60e1f46fa/runs/a9ffc4c6-5a2b-4560-bb8b-beab259b4bf1/dag32b2fbc0-765b-48d9-badd-75d60e1f46fa/runs/a9ffc4c6-5a2b-4560-bb8b-beab259b4bf1/dag"})]}),"\n",(0,s.jsx)(n.h2,{id:"visualize-the-results",children:"Visualize the Results"}),"\n",(0,s.jsx)(n.p,{children:"Head over to the dashboard URL given above to see the visualization of the pipeline run:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"MLOps with ZenML",src:i(434614).A+"",width:"1222",height:"848"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},316237:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/ZenML_MLFlow_01-69e1936cfdf9c8368d49aba7ebb431a1.png"},434614:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/ZenML_MLFlow_02-884a7b51fde67330b01aaf40f85e8df8.png"},811771:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-fe9bbb57ea8da08fea2f3fef2bf2515b.jpg"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var s=i(296540);const a={},t=s.createContext(a);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);