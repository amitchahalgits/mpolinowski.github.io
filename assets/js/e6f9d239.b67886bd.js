"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[29231],{384784:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>b,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var t=a(474848),i=a(28453);const r={sidebar_position:7070,slug:"2022-07-15",title:"Zabbix <3 Zimbra",authors:"mpolinowski",tags:["Markdown","React"]},s=void 0,o={id:"DevOps/Zabbix/2022-07-15-zabbix-for-zimbra/index",title:"Zabbix <3 Zimbra",description:"Sydney, Australia",source:"@site/docs/DevOps/Zabbix/2022-07-15-zabbix-for-zimbra/index.md",sourceDirName:"DevOps/Zabbix/2022-07-15-zabbix-for-zimbra",slug:"/DevOps/Zabbix/2022-07-15-zabbix-for-zimbra/2022-07-15",permalink:"/docs/DevOps/Zabbix/2022-07-15-zabbix-for-zimbra/2022-07-15",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2022-07-15-zabbix-for-zimbra/index.md",tags:[{label:"Markdown",permalink:"/docs/tags/markdown"},{label:"React",permalink:"/docs/tags/react"}],version:"current",sidebarPosition:7070,frontMatter:{sidebar_position:7070,slug:"2022-07-15",title:"Zabbix <3 Zimbra",authors:"mpolinowski",tags:["Markdown","React"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix v6 SMART HDD and CPU Temperature Check",permalink:"/docs/DevOps/Zabbix/2024-03-07--zabbix-v6-hdd-cpu-temp-check/2024-03-08"},next:{title:"Zabbix v6 Creating triggers for Baseline monitoring and Anomaly detection",permalink:"/docs/DevOps/Zabbix/2022-01-16--zabbix-v6-baseline-monitoring/2022-01-16"}},l={},c=[{value:"Zimbra Template",id:"zimbra-template",level:2},{value:"zmcontrol_status",id:"zmcontrol_status",level:2},{value:"Zabbix Agent",id:"zabbix-agent",level:2},{value:"Zabbix Agent 2",id:"zabbix-agent-2",level:3},{value:"Configure the Server",id:"configure-the-server",level:2}];function m(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Sydney, Australia",src:a(885094).A+"",width:"1594",height:"601"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#zimbra-template",children:"Zimbra Template"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#zmcontrol_status",children:"zmcontrol_status"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#zabbix-agent",children:"Zabbix Agent"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#zabbix-agent-2",children:"Zabbix Agent 2"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#configure-the-server",children:"Configure the Server"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"zimbra-template",children:"Zimbra Template"}),"\n",(0,t.jsxs)(n.p,{children:["Download the ",(0,t.jsx)(n.a,{href:"https://github.com/zabbix/community-templates/tree/main/Applications/Mail_servers/template_zimbra_zmcontrol_status/6.0",children:"Zimbra Template"})," for Zabbix version 6.0."]}),"\n",(0,t.jsxs)(n.p,{children:["In the ",(0,t.jsx)(n.code,{children:"Configuration"})," \u2192 ",(0,t.jsx)(n.code,{children:"Templates"})," section users can configure and maintain templates. Click on ",(0,t.jsx)(n.strong,{children:"Import"})," to load the template YAML file:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix for Zimbra",src:a(107178).A+"",width:"896",height:"478"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix for Zimbra",src:a(56161).A+"",width:"899",height:"818"})}),"\n",(0,t.jsx)(n.h2,{id:"zmcontrol_status",children:"zmcontrol_status"}),"\n",(0,t.jsxs)(n.p,{children:["Prepare the Zimbra server, by adding the following line to the ROOT CRONTAB. This will put the output of the ",(0,t.jsx)(n.code,{children:"zmcontrol_status"})," on a file in ",(0,t.jsx)(n.code,{children:"/tmp"}),". It will run every 3 min:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"crontab -u root -e\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"*/3 * * * * sudo -u zimbra /opt/zimbra/bin/zmcontrol status > /tmp/zmcontrol_status\n"})}),"\n",(0,t.jsx)(n.p,{children:"This will generate the following file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat /tmp/zmcontrol_status\nHost my.zimbra.com\n        amavis                  Running\n        antispam                Running\n        antivirus               Running\n        ldap                    Running\n        logger                  Running\n        mailbox                 Running\n        memcached               Running\n        mta                     Running\n        opendkim                Running\n        proxy                   Running\n        service webapp          Running\n        snmp                    Running\n        spell                   Running\n        stats                   Running\n        zimbra webapp           Running\n        zimbraAdmin webapp      Running\n        zimlet webapp           Running\n        zmconfigd               Running\n"})}),"\n",(0,t.jsx)(n.h2,{id:"zabbix-agent",children:"Zabbix Agent"}),"\n",(0,t.jsxs)(n.p,{children:["Add the following UserParameter to the ",(0,t.jsx)(n.code,{children:"zabbix_agentd.conf"})," file, or the ",(0,t.jsx)(n.code,{children:"zabbix_agentd.d"})," folder:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nano /etc/zabbix/zabbix_agentd.d/zimbra_template.conf\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Zimbra Monitor Template\nUserParameter=zimbra.amavis.status,awk '/amavis/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.antispam.status,awk '/antispam/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.antivirus.status,awk '/antivirus/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.mailbox.status,awk '/mailbox/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.mta.status,awk '/mta/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.zmconfigd.status,awk '/zmconfigd/{print $2}' /tmp/zmcontrol_status\nUserParameter=zimbra.webmail.status,awk '/service webapp/{print $3}' /tmp/zmcontrol_status\nUserParameter=zimbra.webadm.status,awk '/zimbraAdmin/{print $3}' /tmp/zmcontrol_status\nUserParameter=zimbra.proxy.status,awk '/proxy/{print $2}' /tmp/zmcontrol_status\n"})}),"\n",(0,t.jsx)(n.h3,{id:"zabbix-agent-2",children:"Zabbix Agent 2"}),"\n",(0,t.jsx)(n.p,{children:"The version 2 configuration file does not use this directory. But it imports conf files from:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"Include=./zabbix_agent2.d/plugins.d/*.conf\n"})}),"\n",(0,t.jsx)(n.p,{children:"So I am placing the Zimbra Template configuration there:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nano zabbix_agent2.d/plugins.d/zimbra_template.conf\n"})}),"\n",(0,t.jsx)(n.p,{children:"And restart the agent with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"service zabbix-agent2 restart\nservice zabbix-agent2 status\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-the-server",children:"Configure the Server"}),"\n",(0,t.jsx)(n.p,{children:"Now we can configure our server to use the Zimbra template:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix for Zimbra",src:a(571544).A+"",width:"899",height:"395"})}),"\n",(0,t.jsxs)(n.p,{children:["Wait a while and verify the latest data received from your server. ",(0,t.jsx)(n.strong,{children:"Note"}),": the template maps ",(0,t.jsx)(n.code,{children:"RUNNING"})," with the value ",(0,t.jsx)(n.code,{children:"0"}),". So seeing zeros is here a good thing:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Zabbix for Zimbra",src:a(363063).A+"",width:"855",height:"798"})})]})}function b(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},107178:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_for_Zimbra_01-242a3c162e1687bfdb77179585091ae6.png"},56161:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_for_Zimbra_02-dc82a08ef528430800218c2ec2d4314f.png"},571544:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_for_Zimbra_03-fb60b63a971c2b65f8138cf21ea63d8a.png"},363063:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Zabbix_for_Zimbra_04-f1572c27e4b1eed321ba8e226b294aa8.png"},885094:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-639bd38d59a5e55ec0c382905cd02a5c.jpg"},28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>o});var t=a(296540);const i={},r=t.createContext(i);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);