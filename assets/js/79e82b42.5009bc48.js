"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[81274],{181255:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var i=s(474848),a=s(28453);const l={sidebar_position:9090,slug:"2020-07-14",title:"Installing Nagios4 on Ubuntu Server 20.04",authors:"mpolinowski",tags:["LINUX","Nagios"]},o=void 0,r={id:"DevOps/Zabbix/2020-07-14--nagios-ubuntu-install/index",title:"Installing Nagios4 on Ubuntu Server 20.04",description:"Victoria Harbour, Hong Kong",source:"@site/docs/DevOps/Zabbix/2020-07-14--nagios-ubuntu-install/index.md",sourceDirName:"DevOps/Zabbix/2020-07-14--nagios-ubuntu-install",slug:"/DevOps/Zabbix/2020-07-14--nagios-ubuntu-install/2020-07-14",permalink:"/docs/DevOps/Zabbix/2020-07-14--nagios-ubuntu-install/2020-07-14",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2020-07-14--nagios-ubuntu-install/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Nagios",permalink:"/docs/tags/nagios"}],version:"current",sidebarPosition:9090,frontMatter:{sidebar_position:9090,slug:"2020-07-14",title:"Installing Nagios4 on Ubuntu Server 20.04",authors:"mpolinowski",tags:["LINUX","Nagios"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix Docker Installation",permalink:"/docs/DevOps/Zabbix/2020-07-15--zabbix-docker-installation/2020-07-15"},next:{title:"Installing Nagios4 with Docker",permalink:"/docs/DevOps/Zabbix/2020-07-12--nagios-docker-install/2020-07-12"}},t={},c=[{value:"Installation",id:"installation",level:2},{value:"Security-Enhanced Linux",id:"security-enhanced-linux",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Downloading the Source",id:"downloading-the-source",level:3},{value:"Compile",id:"compile",level:3},{value:"Create User And Group",id:"create-user-and-group",level:3},{value:"Install Binaries",id:"install-binaries",level:3},{value:"Install Service / Daemon",id:"install-service--daemon",level:3},{value:"Install Command Mode",id:"install-command-mode",level:3},{value:"Install Configuration Files",id:"install-configuration-files",level:3},{value:"Install Apache Config Files",id:"install-apache-config-files",level:3},{value:"Configure Firewall",id:"configure-firewall",level:3},{value:"Create nagiosadmin User Account",id:"create-nagiosadmin-user-account",level:3},{value:"Test your Installation",id:"test-your-installation",level:2},{value:"Start Apache Web Server",id:"start-apache-web-server",level:3},{value:"Start Service / Daemon",id:"start-service--daemon",level:3},{value:"Test Nagios",id:"test-nagios",level:2},{value:"Installing The Nagios Plugins",id:"installing-the-nagios-plugins",level:2},{value:"Downloading The Source",id:"downloading-the-source-1",level:3},{value:"Compile + Install",id:"compile--install",level:3},{value:"Test Plugins",id:"test-plugins",level:3},{value:"Restart Nagios",id:"restart-nagios",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Victoria Harbour, Hong Kong",src:s(774909).A+"",width:"1500",height:"524"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#installation",children:"Installation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#security-enhanced-linux",children:"Security-Enhanced Linux"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#prerequisites",children:"Prerequisites"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#downloading-the-source",children:"Downloading the Source"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#compile",children:"Compile"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#create-user-and-group",children:"Create User And Group"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-binaries",children:"Install Binaries"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-service--daemon",children:"Install Service / Daemon"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-command-mode",children:"Install Command Mode"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-configuration-files",children:"Install Configuration Files"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-apache-config-files",children:"Install Apache Config Files"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#configure-firewall",children:"Configure Firewall"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#create-nagiosadmin-user-account",children:"Create nagiosadmin User Account"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#test-your-installation",children:"Test your Installation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#start-apache-web-server",children:"Start Apache Web Server"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#start-service--daemon",children:"Start Service / Daemon"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#test-nagios",children:"Test Nagios"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#installing-the-nagios-plugins",children:"Installing The Nagios Plugins"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#downloading-the-source",children:"Downloading The Source"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#compile--install",children:"Compile + Install"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#test-plugins",children:"Test Plugins"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#restart-nagios",children:"Restart Nagios"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"security-enhanced-linux",children:"Security-Enhanced Linux"}),"\n",(0,i.jsx)(n.p,{children:"This guide is based on SELinux being disabled or in permissive mode. SELinux is not enabled by default on Ubuntu. If you would like to see if it is installed run the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo dpkg -l selinux*\n"})}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Perform these steps to install the pre-requisite packages."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"===== Ubuntu 20.x =====\r\n\r\nsudo apt-get update\r\nsudo apt-get install -y automake  libmcrypt-dev  libssl-dev openssl libapache2-mod-php\r\nsudo apt-get install -y autoconf gcc libc6 make wget unzip apache2 php libapache2-mod-php7.4 libgd-dev\n"})}),"\n",(0,i.jsx)(n.h3,{id:"downloading-the-source",children:"Downloading the Source"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /tmp\r\nwget -O nagioscore.tar.gz https://github.com/NagiosEnterprises/nagioscore/archive/nagios-4.4.5.tar.gz\r\ntar xzf nagioscore.tar.gz\n"})}),"\n",(0,i.jsx)(n.h3,{id:"compile",children:"Compile"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /tmp/nagioscore-nagios-4.4.5/\r\nsudo ./configure --with-httpd-conf=/etc/apache2/sites-enabled\r\nsudo make all\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-user-and-group",children:"Create User And Group"}),"\n",(0,i.jsx)(n.p,{children:"This creates the nagios user and group. The www-data user is also added to the nagios group."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install-groups-users\r\nsudo usermod -a -G nagios www-data\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-binaries",children:"Install Binaries"}),"\n",(0,i.jsx)(n.p,{children:"This step installs the binary files, CGIs, and HTML files."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-service--daemon",children:"Install Service / Daemon"}),"\n",(0,i.jsx)(n.p,{children:"This installs the service or daemon files and also configures them to start on boot."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install-daemoninit\n"})}),"\n",(0,i.jsx)(n.p,{children:"Information on starting and stopping services will be explained further on."}),"\n",(0,i.jsx)(n.h3,{id:"install-command-mode",children:"Install Command Mode"}),"\n",(0,i.jsx)(n.p,{children:"This installs and configures the external command file."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install-commandmode\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-configuration-files",children:"Install Configuration Files"}),"\n",(0,i.jsxs)(n.p,{children:["This installs the ",(0,i.jsx)(n.em,{children:"SAMPLE"})," configuration files. These are required as Nagios needs some configuration files to allow it to start."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install-config\n"})}),"\n",(0,i.jsx)(n.p,{children:"*** Config files installed ***"}),"\n",(0,i.jsxs)(n.p,{children:["Remember, these are ",(0,i.jsx)(n.em,{children:"SAMPLE"})," config files.  You'll need to read the documentation for more information on how to actually define services, hosts, etc. to fit your particular needs."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/usr/bin/install -c -m 775 -o nagios -g nagios -d /usr/local/nagios/etc\r\n/usr/bin/install -c -m 775 -o nagios -g nagios -d /usr/local/nagios/etc/objects\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/nagios.cfg /usr/local/nagios/etc/nagios.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/cgi.cfg /usr/local/nagios/etc/cgi.cfg\r\n/usr/bin/install -c -b -m 660 -o nagios -g nagios sample-config/resource.cfg /usr/local/nagios/etc/resource.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/templates.cfg /usr/local/nagios/etc/objects/templates.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/commands.cfg /usr/local/nagios/etc/objects/commands.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/contacts.cfg /usr/local/nagios/etc/objects/contacts.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/timeperiods.cfg /usr/local/nagios/etc/objects/timeperiods.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/localhost.cfg /usr/local/nagios/etc/objects/localhost.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/windows.cfg /usr/local/nagios/etc/objects/windows.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/printer.cfg /usr/local/nagios/etc/objects/printer.cfg\r\n/usr/bin/install -c -b -m 664 -o nagios -g nagios sample-config/template-object/switch.cfg /usr/local/nagios/etc/objects/switch.cfg\n"})}),"\n",(0,i.jsx)(n.h3,{id:"install-apache-config-files",children:"Install Apache Config Files"}),"\n",(0,i.jsx)(n.p,{children:"This installs the Apache web server configuration files and configures Apache settings."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo make install-webconf\r\nsudo a2enmod rewrite\r\nsudo a2enmod cgi\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configure-firewall",children:"Configure Firewall"}),"\n",(0,i.jsx)(n.p,{children:"You need to allow port 80 inbound traffic on the local firewall so you can reach the Nagios Core web interface."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ufw allow Apache\r\nsudo ufw reload\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-nagiosadmin-user-account",children:"Create nagiosadmin User Account"}),"\n",(0,i.jsx)(n.p,{children:"You'll need to create an Apache user account to be able to log into Nagios."}),"\n",(0,i.jsx)(n.p,{children:"The following command will create a user account called nagiosadmin and you will be prompted to provide a password for the account."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-your-installation",children:"Test your Installation"}),"\n",(0,i.jsx)(n.h3,{id:"start-apache-web-server",children:"Start Apache Web Server"}),"\n",(0,i.jsx)(n.p,{children:"Need to restart it because it is already running."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"===== Ubuntu 15.x / 16.x / 17.x / 18.x / 20.x =====\r\n\r\nsudo systemctl restart apache2.service\n"})}),"\n",(0,i.jsx)(n.h3,{id:"start-service--daemon",children:"Start Service / Daemon"}),"\n",(0,i.jsx)(n.p,{children:"This command starts Nagios Core."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"===== Ubuntu 15.x / 16.x / 17.x / 18.x / 20.x =====\r\n\r\nsudo systemctl enable nagios.service\r\nsudo systemctl start nagios.service\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-nagios",children:"Test Nagios"}),"\n",(0,i.jsx)(n.p,{children:"Nagios is now running, to confirm this you need to log into the Nagios Web Interface. Point your web browser to the ip address or FQDN of your Nagios Core server, for example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"http://192.168.2.110/nagios\r\n\r\nhttp://core-013.domain.local/nagios\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You will be prompted for a username and password. The username is ",(0,i.jsx)(n.code,{children:"nagiosadmin"})," (you created it in a previous step) and the password is what you provided earlier."]}),"\n",(0,i.jsx)(n.p,{children:"Once you have logged in you are presented with the Nagios interface. Congratulations you have installed Nagios Core."}),"\n",(0,i.jsx)(n.p,{children:"BUT WAIT ...\r\nCurrently you have only installed the Nagios Core engine. You'll notice some errors under the hosts and services along the lines of:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"(No output on stdout) stderr: execvp(/usr/local/nagios/libexec/check_load, ...) failed. errno is 2: No such file or directory\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Nagios on Ubuntu",src:s(874674).A+"",width:"1032",height:"265"})}),"\n",(0,i.jsx)(n.p,{children:"These errors will be resolved once you install the Nagios Plugins, which is covered in the next step."}),"\n",(0,i.jsx)(n.h2,{id:"installing-the-nagios-plugins",children:"Installing The Nagios Plugins"}),"\n",(0,i.jsx)(n.p,{children:"Nagios Core needs plugins to operate properly. The following steps will walk you through installing Nagios Plugins."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["These steps install nagios-plugins 2.2.1. Newer versions will become available in the future and you can use those in the following installation steps. Please see the ",(0,i.jsx)(n.a,{href:"https://github.com/nagios-plugins/nagios-plugins/releases",children:"releases page on GitHub for all available versions"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Please note that the following steps install most of the plugins that come in the Nagios Plugins package. However there are some plugins that require other libraries which are not included in those instructions. Please refer to the following KB article for detailed installation instructions:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://support.nagios.com/kb/article.php?id=569",children:"Documentation - Installing Nagios Plugins From Source"})}),"\n",(0,i.jsx)(n.h3,{id:"downloading-the-source-1",children:"Downloading The Source"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /tmp\r\nwget --no-check-certificate -O nagios-plugins.tar.gz https://github.com/nagios-plugins/nagios-plugins/archive/release-2.2.1.tar.gz\r\ntar zxf nagios-plugins.tar.gz\n"})}),"\n",(0,i.jsx)(n.h3,{id:"compile--install",children:"Compile + Install"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /tmp/nagios-plugins-release-2.2.1/\r\n./tools/setup\r\n./configure\r\nmake\r\nmake install\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-plugins",children:"Test Plugins"}),"\n",(0,i.jsx)(n.p,{children:"Point your web browser to the ip address or FQDN of your Nagios Core server, for example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"http://192.168.2.110/nagios\r\n\r\nhttp://core-013.domain.local/nagios\n"})}),"\n",(0,i.jsx)(n.p,{children:'Go to a host or service object and "Re-schedule the next check" under the Commands menu. The error you previously saw should now disappear and the correct output will be shown on the screen.'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Nagios on Ubuntu",src:s(205641).A+"",width:"1037",height:"459"})}),"\n",(0,i.jsx)(n.h2,{id:"restart-nagios",children:"Restart Nagios"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"service nagios start\r\nservice nagios stop\r\nservice nagios restart\r\nservice nagios status\n"})}),"\n",(0,i.jsx)(n.p,{children:"or"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl start nagios.service\r\nsystemctl stop nagios.service\r\nsystemctl restart nagios.service\r\nsystemctl status nagios.service\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},874674:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/Nagios_on_Ubuntu_01-4d50a2f13db1cc64c05043e5576eea58.png"},205641:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/Nagios_on_Ubuntu_02-ec26085beca6c3a74a9e272e901961c2.png"},774909:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-883b41484a7c9af0b41ec25782ac66b4.jpg"},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var i=s(296540);const a={},l=i.createContext(a);function o(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);