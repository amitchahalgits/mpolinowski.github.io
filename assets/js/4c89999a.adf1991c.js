"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[37782],{762288:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var t=o(785893),r=o(603905);const a={sidebar_position:8020,slug:"2019-09-24",title:"Installing MotionEye on CentOS8 with Podman",authors:"mpolinowski",tags:["LINUX","Smarthome","IoT","Docker"]},i=void 0,s={id:"Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8/index",title:"Installing MotionEye on CentOS8 with Podman",description:"Shanghai, China",source:"@site/docs/Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8/index.mdx",sourceDirName:"Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8",slug:"/Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8/2019-09-24",permalink:"/docs/Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8/2019-09-24",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Home_Automation/2019-09-24--motioneye-podman-centos8/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Smarthome",permalink:"/docs/tags/smarthome"},{label:"IoT",permalink:"/docs/tags/io-t"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:8020,frontMatter:{sidebar_position:8020,slug:"2019-09-24",title:"Installing MotionEye on CentOS8 with Podman",authors:"mpolinowski",tags:["LINUX","Smarthome","IoT","Docker"]},sidebar:"tutorialSidebar",previous:{title:"MotionEye Video Surveillance",permalink:"/docs/Automation_and_Robotics/Home_Automation/2019-02-07--motioneye-on-debian/2019-02-07"},next:{title:"Zigbee Sensors in FHEM",permalink:"/docs/Automation_and_Robotics/Home_Automation/2019-01-05--zigbee2mqtt-xiaomi-fhem/2019-01-05"}},c={},d=[{value:"Installation of MotionEye through Podman on CentOS8",id:"installation-of-motioneye-through-podman-on-centos8",level:2},{value:"Access MotionEye and Create a Camera",id:"access-motioneye-and-create-a-camera",level:3},{value:"Video Recording Persistence",id:"video-recording-persistence",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.ah)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Shanghai, China",src:o(746435).Z+"",width:"1500",height:"868"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#installation-through-podman-on-centos8",children:"Installation through Podman on CentOS8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#access-motioneye-and-create-a-camera",children:"Access MotionEye and Create a Camera"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#video-recording-persistence",children:"Video Recording Persistence"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"installation-of-motioneye-through-podman-on-centos8",children:"Installation of MotionEye through Podman on CentOS8"}),"\n",(0,t.jsxs)(n.p,{children:["The automatically built images are available on ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/r/ccrisan/motioneye/",children:"Docker Hub"}),". Download the image with one of the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman pull ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or on an non-internet device - run the docker or podman command on your PC with an internet connection, e.g. on a Windows PC:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ccrisan/motioneye:master-amd64\r\ndocker save -o motioneye.docker ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsxs)(n.p,{children:["And copy the ",(0,t.jsx)(n.code,{children:"motioneye.docker"})," file to your CentOS system and run:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman load -i motioneye.docker\r\npodman run ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To run the container use the following command (",(0,t.jsx)(n.strong,{children:"see correction below!"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman run --name='motioneye' \\\r\n    -p 8765:8765 \\\r\n    --hostname='motioneye' \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -v /opt/motioneye:/etc/motioneye \\\r\n    --restart='always' \\\r\n    --detach=true \\\r\n    ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsxs)(n.p,{children:["But I ran into some security-related issues with SELinux and permissions on ",(0,t.jsx)(n.code,{children:"/opt/motioneye/"})," and ",(0,t.jsx)(n.code,{children:"/opt/motioneye/lib"}),". Make sure to run ",(0,t.jsx)(n.code,{children:"chmod"})," with the necessary rights (",(0,t.jsx)(n.code,{children:"chmod -R 777 /opt/motioneye"})," to open it up completely - some might prefer ",(0,t.jsx)(n.code,{children:"755"})," instead) and ",(0,t.jsx)(n.code,{children:"chcon -Rt svirt_sandbox_file_t /opt/motioneye"}),". I also added ",(0,t.jsx)(n.code,{children:"--security-opt label=disable \\"})," tag and the re-stream port ",(0,t.jsx)(n.code,{children:"8081"})," for my camera."]}),"\n",(0,t.jsxs)(n.p,{children:["Additionally I added a ",(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/ccrisan/motioneye/78a89fbc2e2d2c284408f8eb1037c8598b4e715a/extra/motioneye.conf.sample",children:"motioneye.conf template"})," to the ",(0,t.jsx)(n.code,{children:"/opt/motioneye"})," directory on my host system."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman run --name='motioneye' \\\r\n    -p 8765:8765 \\\r\n    --hostname='motioneye' \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -v /opt/motioneye:/etc/motioneye \\\r\n    --security-opt label=disable \\\r\n    --restart='always' \\\r\n    --detach=true \\\r\n    ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Currently the video recordings from MotionEye are not persisted. To find out where those are stored we first have to run the container, check the location and revisit this run command (",(0,t.jsx)(n.a,{href:"#video-recording-persistence",children:"see below"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Add additional port mappings with the ",(0,t.jsx)(n.code,{children:"-p"})," parameter if you want to use the streaming feature of motion: ",(0,t.jsx)(n.code,{children:"-p 8765:8765 -p 8081:8081"}),"; for cameras added, numbering of ports used for streaming starts from ",(0,t.jsx)(n.code,{children:"8081"})," (second camera will use port ",(0,t.jsx)(n.code,{children:"8082"}),", etc). Ports used for streaming can be later changed in motionEye (Advanced Settings -> Video Streaming -> Streaming Port) but should always match the ones that are being exposed from Docker."]}),"\n",(0,t.jsxs)(n.p,{children:["If using additional services that make use of ports in the 808x range, then default mapping can be edited to avoid conflicting by mapping higher range port numbers that are not in use by other services (i.e., ",(0,t.jsx)(n.code,{children:"-p 8765:8765 -p 58081:8081 -p 58082:8082"}),")"]}),"\n",(0,t.jsxs)(n.p,{children:["Change the bind path ",(0,t.jsx)(n.code,{children:"/etc/motioneye"}),"  according to your needs. The first contains the configuration files for motionEye. The bound file ",(0,t.jsx)(n.code,{children:"/etc/localtime"})," is necessary for a proper timezone configuration inside the container using the timezone of the host."]}),"\n",(0,t.jsx)(n.p,{children:"To forward a video device of your host use an additional parameter like the following"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"--device=/dev/video0\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.a,{href:"https://github.com/containers/libpod/blob/master/commands.md",children:"Podman Commands"})," for more details."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"access-motioneye-and-create-a-camera",children:"Access MotionEye and Create a Camera"}),"\n",(0,t.jsxs)(n.p,{children:["Now that MotionEye is running we can access it on your servers IP address + the default port ",(0,t.jsx)(n.code,{children:"8765"})," that we forwarded out of the container to all network interfaces, when ran the container."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"MotionEye CentOS8 Podman",src:o(412544).Z+"",width:"774",height:"498"})}),"\n",(0,t.jsxs)(n.p,{children:["Click on the drop down menu marked with the red arrow to add a camera. The RTSP streaming URL for your camera is it's IP address + the stream that you want extract (with falling resolution) ",(0,t.jsx)(n.code,{children:"/11"}),", ",(0,t.jsx)(n.code,{children:"/12"})," or ",(0,t.jsx)(n.code,{children:"/13"})," - e.g."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"rtsp://192.168.2.116/11\n"})}),"\n",(0,t.jsx)(n.p,{children:"The directory that will store our video recordings is given by the marked root directory:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/var/lib/motioneye/{Camera Name}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Apply your settings and you should see your cameras live video."}),"\n",(0,t.jsx)(n.h3,{id:"video-recording-persistence",children:"Video Recording Persistence"}),"\n",(0,t.jsx)(n.p,{children:"At the moment all video recordings that we create will be stored inside the container and thus be deleted once we shut it down. To prevent this from happening we log us into the container, locate the media storage directory and and mount a volume to persists this data."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman ps -a\r\nCONTAINER ID  IMAGE                                     COMMAND               STATUS                   PORTS                   NAMES\r\nb2352521ed1a  localhost/ccrisan/motioneye:master-amd64  /bin/sh -c test -...  Up 6 minutes ago         0.0.0.0:8765->8765/tcp  motioneye\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now we know the container ID is ",(0,t.jsx)(n.code,{children:"b2352521ed1a"})," (we could also use the container name - since we set it to ",(0,t.jsx)(n.code,{children:"motioneye"}),")."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"[root@CentOS8 ~]# podman exec -ti b2352521ed1a /bin/bash\r\nroot@motioneye:/# find / -name motioneye\r\n/etc/motioneye\r\n/usr/local/lib/python2.7/dist-packages/motioneye\r\n/usr/local/share/motioneye\r\n/usr/share/motioneye\r\n/var/lib/motioneye\r\nroot@motioneye:/# ll /var/lib/motioneye\r\ntotal 0\r\ndrwxrwxrwx. 3 root root 21 Jan 29 15:32 ./\r\ndrwxr-xr-x. 1 root root 23 Jan 29 00:56 ../\r\ndrwxr-xr-x. 2 root root  6 Jan 29 15:32 Camera1/\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We can see that the directory ",(0,t.jsx)(n.code,{children:"/var/lib/motioneye"})," was created and holds a folder for our camera's recordings. We can now stop and delete the container and mount this directory as a volume to our host system to persist the data:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman stop motioneye\r\npodman rm motioneye\r\npodman run --name='motioneye' \\\r\n    -p 8765:8765 \\\r\n    -p 8081:8081 \\\r\n    -p 8082:8082 \\\r\n    --hostname='motioneye' \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -v /opt/motioneye:/etc/motioneye \\\r\n    -v /opt/motioneye/lib:/var/lib/motioneye \\\r\n    --security-opt label=disable \\\r\n    --restart='always' \\\r\n    --detach=true \\\r\n    ccrisan/motioneye:master-amd64\n"})}),"\n",(0,t.jsx)(n.p,{children:"Camera re-stream ports collided with the default ports used by ioBroker =>"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"podman run --name='motioneye' \\\r\n    -p 8765:8765 \\\r\n    -p 7777:7777 \\\r\n    -p 7778:7778 \\\r\n    --hostname='motioneye' \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -v /opt/motioneye:/etc/motioneye \\\r\n    -v /opt/motioneye/lib:/var/lib/motioneye \\\r\n    --security-opt label=disable \\\r\n    --restart='always' \\\r\n    --detach=true \\\r\n    ccrisan/motioneye:master-amd64\n"})})]})}function m(e={}){const{wrapper:n}={...(0,r.ah)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},603905:(e,n,o)=>{o.d(n,{ah:()=>d});var t=o(667294);function r(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function a(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?a(Object(o),!0).forEach((function(n){r(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function s(e,n){if(null==e)return{};var o,t,r=function(e,n){if(null==e)return{};var o,t,r={},a=Object.keys(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||(r[o]=e[o]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)o=a[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=t.createContext({}),d=function(e){var n=t.useContext(c),o=n;return e&&(o="function"==typeof e?e(n):i(i({},n),e)),o},l={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var o=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),h=d(o),p=r,u=h["".concat(c,".").concat(p)]||h[p]||l[p]||a;return o?t.createElement(u,i(i({ref:n},m),{},{components:o})):t.createElement(u,i({ref:n},m))}));m.displayName="MDXCreateElement"},412544:(e,n,o)=>{o.d(n,{Z:()=>t});const t=o.p+"assets/images/MotionEye_CentOS8_Podman_01-dd72c2c583fc11d77d2b17babe3f2b9a.png"},746435:(e,n,o)=>{o.d(n,{Z:()=>t});const t=o.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-04d2128579094a11a5f5e572cb2ad3e2.jpg"}}]);