"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[21175],{142:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>b,frontMatter:()=>r,metadata:()=>l,toc:()=>o});var s=i(474848),a=i(28453);const r={sidebar_position:9070,slug:"2020-07-16",title:"Zabbix Agent",authors:"mpolinowski",tags:["LINUX","Zabbix","Docker"]},t=void 0,l={id:"DevOps/Zabbix/2020-07-16--zabbix-agent/index",title:"Zabbix Agent",description:"Shenzhen, China",source:"@site/docs/DevOps/Zabbix/2020-07-16--zabbix-agent/index.md",sourceDirName:"DevOps/Zabbix/2020-07-16--zabbix-agent",slug:"/DevOps/Zabbix/2020-07-16--zabbix-agent/2020-07-16",permalink:"/docs/DevOps/Zabbix/2020-07-16--zabbix-agent/2020-07-16",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2020-07-16--zabbix-agent/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Zabbix",permalink:"/docs/tags/zabbix"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:9070,frontMatter:{sidebar_position:9070,slug:"2020-07-16",title:"Zabbix Agent",authors:"mpolinowski",tags:["LINUX","Zabbix","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix Monitoring a Website",permalink:"/docs/DevOps/Zabbix/2020-07-17--zabbix-website-monitor/2020-07-17"},next:{title:"Zabbix Docker Installation",permalink:"/docs/DevOps/Zabbix/2020-07-15--zabbix-docker-installation/2020-07-15"}},d={},o=[{value:"Adding New Hosts",id:"adding-new-hosts",level:2},{value:"Option1 Zabbix Agent Container",id:"option1-zabbix-agent-container",level:3},{value:"Option2 Zabbix Agent Package",id:"option2-zabbix-agent-package",level:3},{value:"Modify Zabbix Agent Configuration",id:"modify-zabbix-agent-configuration",level:3},{value:"Restart Zabbix Agent",id:"restart-zabbix-agent",level:3},{value:"Adding New host in Zabbix server",id:"adding-new-host-in-zabbix-server",level:3},{value:"Adding Encryption for Remote Hosts",id:"adding-encryption-for-remote-hosts",level:2},{value:"Zabbix User Management",id:"zabbix-user-management",level:2},{value:"Adding Permissions",id:"adding-permissions",level:3},{value:"Zabbix Agent 2",id:"zabbix-agent-2",level:2},{value:"Install from Repository",id:"install-from-repository",level:3},{value:"CentOS8",id:"centos8",level:4},{value:"Modify Zabbix Agent Configuration",id:"modify-zabbix-agent-configuration-1",level:4},{value:"Restart Zabbix Agent",id:"restart-zabbix-agent-1",level:4},{value:"Install from Docker",id:"install-from-docker",level:3},{value:"Environment Variables",id:"environment-variables",level:4},{value:"Allowed Volumes",id:"allowed-volumes",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Shenzhen, China",src:i(306452).A+"",width:"1500",height:"653"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#adding-new-hosts",children:"Adding New Hosts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#option1-zabbix-agent-container",children:"Option1 Zabbix Agent Container"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#option2-zabbix-agent-package",children:"Option2 Zabbix Agent Package"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#modify-zabbix-agent-configuration",children:"Modify Zabbix Agent Configuration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#restart-zabbix-agent",children:"Restart Zabbix Agent"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#adding-new-host-in-zabbix-server",children:"Adding New host in Zabbix server"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#adding-encryption-for-remote-hosts",children:"Adding Encryption for Remote Hosts"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#zabbix-user-management",children:"Zabbix User Management"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#adding-permissions",children:"Adding Permissions"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#zabbix-agent-2",children:"Zabbix Agent 2"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#install-from-repository",children:"Install from Repository"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#centos8",children:"CentOS8"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#modify-zabbix-agent-configuration-1",children:"Modify Zabbix Agent Configuration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#restart-zabbix-agent-1",children:"Restart Zabbix Agent"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#install-from-docker",children:"Install from Docker"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#environment-variables",children:"Environment Variables"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#allowed-volumes",children:"Allowed Volumes"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"adding-new-hosts",children:"Adding New Hosts"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Updates"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See Update below for ",(0,s.jsx)(n.a,{href:"#zabbix-agent-2",children:"Zabbix Agent 2"})]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"#centos8",children:"Installation on CentOS8"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"option1-zabbix-agent-container",children:"Option1 Zabbix Agent Container"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Zabbix agent is not available (for 3m)\r\nFor passive only agents, host availability is used with 3m as time threshold\r\nGet value from agent failed: cannot connect to [[127.0.0.1]:10050]: [111] Connection refused\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zabbix Configuration",src:i(150361).A+"",width:"1039",height:"557"})}),"\n",(0,s.jsxs)(n.p,{children:["Information about configured hosts in Zabbix is available in Configuration \u2192 Hosts. There is already one pre-defined host, called ",(0,s.jsx)(n.code,{children:"Zabbix server"}),", but we want to learn adding another. To add a new host, click on Create host. This will present us with a host configuration form."]}),"\n",(0,s.jsxs)(n.p,{children:["All hosts that you want to monitor have to have the [Zabbix Agent] installed. I will use the ",(0,s.jsx)(n.a,{href:"https://hub.docker.com/r/zabbix/zabbix-agent/",children:"official Docker image"})," to do that on my host machine:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker run --name some-zabbix-agent -e ZBX_HOSTNAME="some-hostname" -e ZBX_SERVER_HOST="some-zabbix-server" -d zabbix/zabbix-agent:tag\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Where some-zabbix-agent is the name you want to assign to your container, some-hostname is the hostname, it is Hostname parameter in Zabbix agent configuration file, some-zabbix-server is IP or DNS name of Zabbix server or proxy and tag is the tag specifying the version you want. See the list above for relevant tags, or look at the ",(0,s.jsx)(n.a,{href:"https://hub.docker.com/r/zabbix/zabbix-agent/tags/",children:"full list of tags"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker run -p 10050:10050 -d --privileged --name ubuntuAsus-zabbix-agent -e ZBX_HOSTNAME="ubuntuAsus" -e ZBX_SERVER_HOST="192.168.2.110" zabbix/zabbix-agent:latest\n'})}),"\n",(0,s.jsx)(n.h3,{id:"option2-zabbix-agent-package",children:"Option2 Zabbix Agent Package"}),"\n",(0,s.jsx)(n.p,{children:"Run the below command to install Zabbix Agent on your host."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install Zabbix Agent DEB based system # #\r\nsudo apt-get install zabbix-agent\n"})}),"\n",(0,s.jsx)(n.h3,{id:"modify-zabbix-agent-configuration",children:"Modify Zabbix Agent Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.code,{children:"zabbix_agentd.conf"})," file and make below necessary changes (Add your Zabbix Server IP and add Zabbix Agent hostname) and save + Exit."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /etc/zabbix/zabbix_agentd.conf\r\nServer=192.168.2.110\r\nServerActive=192.168.2.110\r\nHostname=ubuntuMaster\n"})}),"\n",(0,s.jsx)(n.h3,{id:"restart-zabbix-agent",children:"Restart Zabbix Agent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# For Systemd Systeme #\r\nsystemctl restart zabbix-agent.service\n"})}),"\n",(0,s.jsx)(n.h3,{id:"adding-new-host-in-zabbix-server",children:"Adding New host in Zabbix server"}),"\n",(0,s.jsx)(n.p,{children:"Login to Zabbix Server web interface."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 1"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Go to Configuration Main menu"}),"\n",(0,s.jsx)(n.li,{children:"Click Hosts Sub menu"}),"\n",(0,s.jsx)(n.li,{children:"Then, Create Host button"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 2"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Enter your Original Host Name"}),"\n",(0,s.jsx)(n.li,{children:"Enter visible name which you want to show the host"}),"\n",(0,s.jsx)(n.li,{children:"Add Linux Servers group"}),"\n",(0,s.jsx)(n.li,{children:"Add Zabbix Server IP"}),"\n",(0,s.jsx)(n.li,{children:"Tick Enabled Check box to monitor the host"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zabbix Configuration",src:i(602178).A+"",width:"1217",height:"563"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Click Templates"}),"\n",(0,s.jsx)(n.li,{children:"Click Select to add new template"}),"\n",(0,s.jsxs)(n.li,{children:["Choose ",(0,s.jsx)(n.code,{children:"Template App Docker"})," (A list of all available templates can be found under ",(0,s.jsx)(n.strong,{children:"Configuration/Templates"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Add button to add the Template to new hosts"}),"\n",(0,s.jsx)(n.li,{children:"Click Update to complete the process"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zabbix Configuration",src:i(823307).A+"",width:"1049",height:"357"})}),"\n",(0,s.jsx)(n.h2,{id:"adding-encryption-for-remote-hosts",children:"Adding Encryption for Remote Hosts"}),"\n",(0,s.jsx)(n.p,{children:"For encryption we have an option to use PSK-based encryption. The secret should be minimum a 128-bit (16-byte PSK, entered as 32 hexadecimal digits) up to 2048-bit (256-byte PSK, entered as 512 hexadecimal digits). You can generate a 256 bit PSK secret on your server with openssl using the command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir /opt/zabbix\r\ncd /opt/zabbix\r\nopenssl rand -hex 32 > agent_tls.psk\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Now we have to add a user called ",(0,s.jsx)(n.code,{children:"zabbix"})," and assign this file to him - so we don't run into permission error once we mount it into the Zabbix Agent container:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"useradd -r -s /bin/false zabbix\r\nchown zabbix:zabbix agent_tls.psk\n"})}),"\n",(0,s.jsx)(n.p,{children:"We now have to restart the Zabbix Agent container with the following arguments:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -p 10050:10050 -d \\\r\n  --privileged \\\r\n  --restart=unless-stopped \\\r\n  --name wiki-zabbix-agent \\\r\n  -v /opt/zabbix:/var/lib/zabbix/enc \\\r\n  -e ZBX_HOSTNAME=wiki \\\r\n  -e ZBX_SERVER_HOST=78.46.152.197 \\\r\n  -e ZBX_TLSCONNECT=psk \\\r\n  -e ZBX_TLSACCEPT=psk \\\r\n  -e ZBX_TLSPSKIDENTITY=wiki_server \\\r\n  -e ZBX_TLSPSKFILE=./agent_tls.psk \\\r\n  zabbix/zabbix-agent:latest\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"})," that the path for the TLS PSK File mounts into ",(0,s.jsx)(n.code,{children:"/var/lib/zabbix/enc"}),". To point to our PSK file we have to set the variable to ",(0,s.jsx)(n.code,{children:"ZBX_TLSPSKFILE=./agent_tls.psk"})," and ",(0,s.jsx)(n.strong,{children:"NOT"})," ",(0,s.jsx)(n.code,{children:"ZBX_TLSPSKFILE=/var/lib/zabbix/enc/agent_tls.psk"}),"!"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Our Zabbix Server will now loose it's connection:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'active check configuration update from [zabbix_server:10051] started to fail (TCP successful, cannot establish TLS to [[zabbix_server]:10051]: SSL_connect() set result code to SSL_ERROR_SSL: file ssl/record/rec_layer_s3.c line 1543: error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure: SSL alert number 40: TLS read fatal alert "handshake failure")\r\n   101:20200819:142514.648 failed to accept an incoming connection: from zabbix_server: unencrypted connections are not allowed\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Copy your generated pre-shared key ",(0,s.jsx)(n.code,{children:"cat /opt/zabbix/agent_tls.psk"})," and the TLS Identity you set above ",(0,s.jsx)(n.code,{children:"ZBX_TLSPSKIDENTITY"})," into the host configuration in Zabbix Dashboard:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zabbix Configuration",src:i(777396).A+"",width:"878",height:"351"})}),"\n",(0,s.jsx)(n.p,{children:"The connection should now show up as encrypted a short while afterwards:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zabbix Configuration",src:i(998525).A+"",width:"1200",height:"339"})}),"\n",(0,s.jsx)(n.h2,{id:"zabbix-user-management",children:"Zabbix User Management"}),"\n",(0,s.jsxs)(n.p,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Administration"})," \u2192 ",(0,s.jsx)(n.strong,{children:"Users"})," and click on ",(0,s.jsx)(n.strong,{children:"Create user"}),". In the new user form, make sure to add your user to one of the existing user groups, for example ",(0,s.jsx)(n.code,{children:"Zabbix administrators"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Adding a Zabbix User",src:i(957286).A+"",width:"846",height:"647"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, new users have no media (notification delivery methods) defined for them. To create one, go to the ",(0,s.jsx)(n.strong,{children:"Media"})," tab and click on ",(0,s.jsx)(n.strong,{children:"Add"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Adding a Zabbix User",src:i(996303).A+"",width:"785",height:"431"})}),"\n",(0,s.jsx)(n.h3,{id:"adding-permissions",children:"Adding Permissions"}),"\n",(0,s.jsxs)(n.p,{children:["By default, a new user has no permissions to access hosts. To grant the user rights, click on the group of the user in the ",(0,s.jsx)(n.strong,{children:"User Groups"})," administration menu (in this case - ",(0,s.jsx)(n.code,{children:"Zabbix administrators"}),"). In the group properties form, go to the Permissions tab."]}),"\n",(0,s.jsxs)(n.p,{children:["In this pop-up, mark the checkbox next to ",(0,s.jsx)(n.strong,{children:"Linux servers"}),", then click Select. Linux servers should be displayed in the selection field. Click the ",(0,s.jsx)(n.strong,{children:"Read"})," button to set permission level and then ",(0,s.jsx)(n.strong,{children:"Add"})," to add the group to the list of permissions. In the user group properties form, click ",(0,s.jsx)(n.strong,{children:"Update"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Adding a Zabbix User",src:i(228824).A+"",width:"1058",height:"355"})}),"\n",(0,s.jsx)(n.h2,{id:"zabbix-agent-2",children:"Zabbix Agent 2"}),"\n",(0,s.jsx)(n.p,{children:"Zabbix Agent2 is a drop-in replacement for an old Zabbix agent. Then new agent provides very wide functionality and possibilities to develop plugins for extended monitoring. Agent2 is written in Go language and supports custom plugins that you can write as per your needs and tasks."}),"\n",(0,s.jsx)(n.h3,{id:"install-from-repository",children:"Install from Repository"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Debian Buster"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.0/debian/pool/main/z/zabbix-release/zabbix-release_5.0-1+buster_all.deb\r\ndpkg -i zabbix-release_5.0-1+buster_all.deb\r\napt update\r\napt install zabbix-agent2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Ubuntu Xenial"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_5.0-1%2Bxenial_all.deb\r\ndpkg -i zabbix-release_5.0-1+xenial_all.deb\r\napt update\r\napt install zabbix-agent\r\n\r\n\r\n/etc/zabbix/zabbix_agentd.conf\r\n/var/log/zabbix/zabbix_agentd.log\r\nsystemctl restart zabbix-agent.service\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Debian Jessie"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.0/debian/pool/main/z/zabbix-release/zabbix-release_5.0-1%2Bjessie_all.deb\r\ndpkg -i zabbix-release_5.0-1+jessie_all.deb\r\napt update\r\napt install zabbix-agent\r\n\r\n\r\nnano /etc/zabbix/zabbix_agentd.conf\r\ncat /var/log/zabbix/zabbix_agentd.log\r\nsystemctl restart zabbix-agent.service\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Ubuntu Bionic"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_5.0-1%2Bbionic_all.deb\r\ndpkg -i zabbix-release_5.0-1+bionic_all.deb\r\napt update\r\napt install zabbix-agent2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Debian Stretch"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.0/debian/pool/main/z/zabbix-release/zabbix-release_5.0-1%2Bstretch_all.deb\r\ndpkg -i zabbix-release_5.0-1+stretch_all.deb\r\napt update\r\napt install zabbix-agent2\n"})}),"\n",(0,s.jsx)(n.h4,{id:"centos8",children:"CentOS8"}),"\n",(0,s.jsxs)(n.p,{children:["Pick the ",(0,s.jsx)(n.a,{href:"https://repo.zabbix.com/zabbix/5.4/rhel/8/x86_64/",children:"newest package and install it"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dnf install  https://repo.zabbix.com/zabbix/5.4/rhel/8/x86_64/zabbix-agent-5.4.7-1.el8.x86_64.rpm\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": It seems that Zabbix has dropped support for CentOS - I was not able to find the Agent v2 anymore."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"After installing yum repository packages in our system. Use the following command to install the Zabbix agent on your CentOS 8 or RHEL 8 systems using the package management tool. Note that the configuration file is the following - the rest of the configuration is identical to Debian:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /etc/zabbix/zabbix_agentd.conf\n"})}),"\n",(0,s.jsx)(n.p,{children:"After configuration run the service with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl enable zabbix-agent --now\r\nsystemctl status zabbix-agent\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"ERROR"}),": ",(0,s.jsx)(n.em,{children:"zabbix-agent.service: Can't open PID file /run/zabbix/zabbix_agentd.pid (yet?) after start: No su..."})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://support.zabbix.com/browse/ZBX-9867",children:"Solution"}),":"]}),"\n",(0,s.jsxs)(n.p,{children:["Edit ",(0,s.jsx)(n.code,{children:"/usr/lib/tmpfiles.d/zabbix-agent.conf"})," and change:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"d /run/zabbix 0755 zabbix zabbix - -\n"})}),"\n",(0,s.jsx)(n.p,{children:"to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"d /var/run/zabbix 0755 zabbix zabbix - -\n"})}),"\n",(0,s.jsx)(n.h4,{id:"modify-zabbix-agent-configuration-1",children:"Modify Zabbix Agent Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir /opt/zabbix\r\ncd /opt/zabbix\r\nopenssl rand -hex 32 > agent_tls.psk\r\ncat agent_tls.psk\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Open ",(0,s.jsx)(n.code,{children:"zabbix_agent2.conf"})," file and make below necessary changes (Add your Zabbix Server IP and add Zabbix Agent hostname) and save + Exit."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /etc/zabbix/zabbix_agent2.conf\n"})}),"\n",(0,s.jsx)(n.h4,{id:"restart-zabbix-agent-1",children:"Restart Zabbix Agent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# For Systemd Systems #\r\nsystemctl restart zabbix-agent2.service\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"iptables -I INPUT -p tcp -m multiport --destination-port 18015:10051 -j ACCEPT\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"du -sh *\r\nfind / -printf '%s %p\\n'| sort -nr | head -10\r\nfind . -type f -exec sh -c '>\"{}\"' \\;\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"iptables -L\r\n\r\n-A INPUT -p tcp -m tcp --dport 10050 -j ACCEPT\r\n-A OUTPUT -p tcp -m tcp --dport 10051 -j ACCEPT\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cat /var/log/zabbix/zabbix_agent2.log\n"})}),"\n",(0,s.jsx)(n.h3,{id:"install-from-docker",children:"Install from Docker"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker pull zabbix/zabbix-agent2:latest\r\n\r\ndocker run --name some-zabbix-agent --link some-zabbix-server:zabbix-server -v /dev/sdc:/dev/sdc -d zabbix/zabbix-agent2:latest\n"})}),"\n",(0,s.jsx)(n.h4,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.p,{children:"When you start the zabbix-agent2 image, you can adjust the configuration of the Zabbix agent 2 by passing one or more environment variables on the docker run command line."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_HOSTNAME"})}),(0,s.jsx)(n.td,{children:"This variable is unique, case sensitive hostname. By default, value is hostname of the container. It is Hostname parameter in zabbix_agent2.conf."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_SERVER_HOST"})}),(0,s.jsx)(n.td,{children:"This variable is IP or DNS name of Zabbix server or Zabbix proxy. By default, value is zabbix-server. It is Server parameter in zabbix_agent2.conf. It is allowed to specify Zabbix server or Zabbix proxy port number using ZBX_SERVER_PORT variable. It make sense in case of non-default port for active checks."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_PASSIVE_ALLOW"})}),(0,s.jsx)(n.td,{children:"This variable is boolean (true or false) and enables or disables feature of passive checks. By default, value is true."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_PASSIVESERVERS"})}),(0,s.jsx)(n.td,{children:"The variable is comma separated list of allowed Zabbix server or proxy hosts for connections to Zabbix agent 2 container."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_ACTIVE_ALLOW"})}),(0,s.jsx)(n.td,{children:"This variable is boolean (true or false) and enables or disables feature of active checks. By default, value is true."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_ACTIVESERVERS"})}),(0,s.jsx)(n.td,{children:"The variable is comma separated list of allowed Zabbix server or proxy hosts for connections to Zabbix agent 2 container. You may specify port of Zabbix server or Zabbix proxy in such syntax: zabbix-server:10061,zabbix-proxy:10072."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_TIMEOUT"})}),(0,s.jsx)(n.td,{children:"The variable is used to specify timeout for processing checks. By default, value is 3."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ZBX_DEBUGLEVEL"})}),(0,s.jsx)(n.td,{children:"The variable is used to specify debug level. By default, value is 3. It is DebugLevel parameter in zabbix_agent2.conf. Allowed values are listed below:"})]})]})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0"})," - basic information about starting and stopping of Zabbix processes;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1"})," - critical information"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"2"})," - error information"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"3"})," - warnings"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"4"})," - for debugging (produces lots of information)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"5"})," - extended debugging (produces even more information)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Additionally the image allows to specify many other environment variables listed below:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ZBX_ENABLEPERSISTENTBUFFER=false"})," # Available since 5.0.0"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ZBX_PERSISTENTBUFFERPERIOD=1h"})," # Available since 5.0.0"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_ENABLESTATUSPORT="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_SOURCEIP="})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ZBX_ENABLEREMOTECOMMANDS=0"})," # Deprecated since 5.0.0"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_LOGREMOTECOMMANDS=0"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_STARTAGENTS=3"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_HOSTNAMEITEM=system.hostname"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_METADATA="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_METADATAITEM="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_REFRESHACTIVECHECKS=120"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_BUFFERSEND=5"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_BUFFERSIZE=100"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_MAXLINESPERSECOND=20"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_LISTENIP="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_UNSAFEUSERPARAMETERS=0"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSCONNECT=unencrypted"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSACCEPT=unencrypted"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSCAFILE="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"BX_TLSCRLFILE="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSSERVERCERTISSUER="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSSERVERCERTSUBJECT="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSCERTFILE="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSKEYFILE="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSPSKIDENTITY="})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"ZBX_TLSPSKFILE="})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ZBX_DENYKEY=system.run[*]"})," # Available since 5.0.0"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ZBX_ALLOWKEY="})," # Available since 5.0.0"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Default values of these variables are specified after equal sign."}),"\n",(0,s.jsxs)(n.p,{children:["The allowed variables are identical of parameters in official ",(0,s.jsx)(n.code,{children:"zabbix_agent2.conf"})," configuration file. For example, ",(0,s.jsx)(n.code,{children:"ZBX_REFRESHACTIVECHECKS = RefreshActiveChecks"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"allowed-volumes",children:"Allowed Volumes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/etc/zabbix/zabbix_agentd.d"})}),(0,s.jsx)(n.td,{children:"The volume allows include *.conf files and extend Zabbix agent 2 using UserParameter feature."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/var/lib/zabbix/enc"})}),(0,s.jsxs)(n.td,{children:["The volume is used to store TLS related files. These file names are specified using ",(0,s.jsx)(n.code,{children:"ZBX_TLSCAFILE"}),", ",(0,s.jsx)(n.code,{children:"ZBX_TLSCRLFILE"}),", ",(0,s.jsx)(n.code,{children:"ZBX_TLSKEY_FILE"})," and ",(0,s.jsx)(n.code,{children:"ZBX_TLSPSKFILE"})," variables."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/var/lib/zabbix/buffer"})}),(0,s.jsxs)(n.td,{children:["The volume is used to store the file, where Zabbix Agent2 should keep SQLite database. To enable the feature specify ",(0,s.jsx)(n.code,{children:"ZBX_ENABLEPERSISTENTBUFFER=true"}),". Available since 5.0.0."]})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -p 10050:10050 \\\r\n--privileged \\\r\n--restart=unless-stopped \\\r\n--name zabbix-agent2 \\\r\n-v /opt/zabbix-wd:/var/lib/zabbix/enc \\\r\n-e ZBX_HOSTNAME=salt-minion \\\r\n-e ZBX_SERVER_HOST=192.168.2.110 \\\r\n-e ZBX_SERVER_PORT=10051 \\\r\n-e ZBX_TLSCONNECT=psk \\\r\n-e ZBX_TLSACCEPT=psk \\\r\n-e ZBX_TLSPSKIDENTITY=salt-minion \\\r\n-e ZBX_TLSPSKFILE=agent_tls.psk \\\r\nzabbix/zabbix-agent2:latest\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl rand -hex 32 > /opt/zabbix-wd/agent_tls.psk\n"})})]})}function b(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},150361:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_01-8972e54777beb5182599244263557a91.png"},602178:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_02-c1a307e059a85e3d24fb095ba19b09bd.png"},823307:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_03-c9ee49f11a78eb6922c2dcc10d9244f9.png"},777396:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_04-daa22bd11f004ca8a98806a77c6647b2.png"},998525:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_05-fb284dbacd369f25cabbefb10e93b179.png"},957286:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_06-465fecb2292f42b993611f2013a77a44.png"},996303:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_07-21eef1cf8e7ed38b694ffd0d1c40a761.png"},228824:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Zabbix_Conf_08-01fb084be6cb62b25789e63da1fa1f0f.png"},306452:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-ee2a6f2c560d84d2a71115e2315a01c2.jpg"},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var s=i(296540);const a={},r=s.createContext(a);function t(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);