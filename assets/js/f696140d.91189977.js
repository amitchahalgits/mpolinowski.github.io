"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[76764],{320781:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>b,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var i=r(785893),t=r(603905);const a={sidebar_position:8050,slug:"2022-01-14",title:"Zabbix v6 Docker Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Docker"]},o=void 0,s={id:"DevOps/Zabbix/2022-01-14--zabbix-docker-monitor/index",title:"Zabbix v6 Docker Monitor",description:"Guangzhou, China",source:"@site/docs/DevOps/Zabbix/2022-01-14--zabbix-docker-monitor/index.md",sourceDirName:"DevOps/Zabbix/2022-01-14--zabbix-docker-monitor",slug:"/DevOps/Zabbix/2022-01-14--zabbix-docker-monitor/2022-01-14",permalink:"/docs/DevOps/Zabbix/2022-01-14--zabbix-docker-monitor/2022-01-14",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Zabbix/2022-01-14--zabbix-docker-monitor/index.md",tags:[{label:"Zabbix",permalink:"/docs/tags/zabbix"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:8050,frontMatter:{sidebar_position:8050,slug:"2022-01-14",title:"Zabbix v6 Docker Monitor",authors:"mpolinowski",tags:["Zabbix","Linux","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Zabbix HTTPS Certificate Monitor",permalink:"/docs/DevOps/Zabbix/2022-01-14--zabbix-http-cert-monitor/2022-01-14"},next:{title:"Zabbix v6 Apache 2 Monitor",permalink:"/docs/DevOps/Zabbix/2022-01-14--zabbix-apache2-monitor/2022-01-14"}},l={},c=[{value:"Install Agent 2",id:"install-agent-2",level:2},{value:"Error: Configuration file not loaded",id:"error-configuration-file-not-loaded",level:2},{value:"Solution",id:"solution",level:3},{value:"Docker Plugin",id:"docker-plugin",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Guangzhou, China",src:r(119657).Z+"",width:"1500",height:"467"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#install-agent-2",children:"Install Agent 2"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#error-configuration-file-not-loaded",children:"Error: Configuration file not loaded"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#solution",children:"Solution"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#docker-plugin",children:"Docker Plugin"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"install-agent-2",children:"Install Agent 2"}),"\n",(0,i.jsx)(n.p,{children:"Remove Agent v1 (if present) and install version 2:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wget https://repo.zabbix.com/zabbix/5.5/debian/pool/main/z/zabbix-release/zabbix-release_5.5-1+debian11_all.deb\r\ndpkg -i zabbix-release_5.5-1+debian11_all.deb\r\napt update && apt install zabbix-agent2\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/DevOps/Zabbix/2020-07-16--zabbix-agent/2020-07-16",children:"Configure the agent according to your server setup"}),". And in addition to that un-comment the following line in ",(0,i.jsx)(n.em,{children:"/etc/zabbix/zabbix_agent2.conf"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:"### Option: Plugins.Docker.Endpoint\r\n#       Docker API endpoint.\r\n#\r\n# Mandatory: no\r\n# Default: unix:///var/run/docker.sock\r\nPlugins.Docker.Endpoint=unix:///var/run/docker.sock\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-configuration-file-not-loaded",children:"Error: Configuration file not loaded"}),"\n",(0,i.jsxs)(n.p,{children:["After starting ",(0,i.jsx)(n.code,{children:"systemctl enable zabbix-agent2 --now"})," the agent is still using the default config and trying to connect to localhost instead of my Zabbix Master:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat /var/log/zabbix/zabbix_agent2.log\r\n\r\n2021/11/11 09:54:39.261862 Zabbix Agent2 hostname: [Zabbix server]\r\n2021/11/11 09:54:40.264710 [101] active check configuration update from [127.0.0.1:10051 Zabbix server] started to fail (dial tcp :0->127.0.0.1:10051: connect: connection refused)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,i.jsxs)(n.p,{children:["The service file points to ",(0,i.jsx)(n.code,{children:"PIDFile=/run/zabbix/zabbix_agent2.pid"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"/usr/lib/systemd/system/zabbix-agent2.service"})," / ",(0,i.jsx)(n.em,{children:"/lib/systemd/system/zabbix-agent2.service"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'[Unit]\r\nDescription=Zabbix Agent 2\r\nAfter=syslog.target\r\nAfter=network.target\r\n\r\n[Service]\r\nEnvironment="CONFFILE=/etc/zabbix/zabbix_agent2.conf"\r\nEnvironmentFile=-/etc/default/zabbix-agent2\r\nType=simple\r\nRestart=on-failure\r\nPIDFile=/run/zabbix/zabbix_agent2.pid\r\nKillMode=control-group\r\nExecStart=/usr/sbin/zabbix_agent2 -c $CONFFILE\r\nExecStop=/bin/sh -c \'[ -n "$1" ] && kill -s TERM "$1"\' -- "$MAINPID"\r\nRestartSec=10s\r\nUser=zabbix\r\nGroup=zabbix\r\n\r\n[Install]\r\nWantedBy=multi-user.target\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["I just encountered another issue on a different server - here the variable inside the service file was written ",(0,i.jsx)(n.code,{children:"PidFile"})," instead of ",(0,i.jsx)(n.code,{children:"PIDFile"})," and this lead to the same issue..."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["But the Agent conf should says ",(0,i.jsx)(n.em,{children:"PidFile=/var/run/zabbix/zabbix_agent2.pid"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"/etc/zabbix/zabbix_agent2.conf"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# This is a configuration file for Zabbix agent 2 (Unix)\r\n# To get more information about Zabbix, visit http://www.zabbix.com\r\n\r\n############ GENERAL PARAMETERS #################\r\n\r\n### Option: PidFile\r\n#       Name of PID file.\r\n#\r\n# Mandatory: no\r\n# Default:\r\n# PidFile=/tmp/zabbix_agent2.pid\r\n\r\nPidFile=/var/run/zabbix/zabbix_agent2.pid\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"/usr/lib/tmpfiles.d/zabbix-agent2.conf"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"d /var/run/zabbix 0755 zabbix zabbix - -\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Change the service file to path to ",(0,i.jsx)(n.code,{children:"/var/run/zabbix/zabbix_agent2.pid"})," and reload the daemon:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl daemon-reload\r\nsystemctl restart zabbix-agent2\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker-plugin",children:"Docker Plugin"}),"\n",(0,i.jsx)(n.p,{children:"Add the docker group to the Zabbix user and restart the agent to apply the new user group:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"usermod -a -G docker zabbix\r\nsystemctl restart zabbix-agent2\n"})}),"\n",(0,i.jsx)(n.p,{children:"Add the Docker Template from the Zabbix Server UI:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Zabbix Docker Monitor",src:r(734814).Z+"",width:"1047",height:"266"})}),"\n",(0,i.jsx)(n.p,{children:"And shortly afterwards you should start seeing Docker Data coming in:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Zabbix Docker Monitor",src:r(11805).Z+"",width:"1218",height:"697"})}),"\n",(0,i.jsx)(n.p,{children:"Available triggers:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Zabbix Docker Monitor",src:r(619032).Z+"",width:"1241",height:"259"})})]})}function b(e={}){const{wrapper:n}={...(0,t.ah)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},603905:(e,n,r)=>{r.d(n,{ah:()=>c});var i=r(667294);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,i,t=function(e,n){if(null==e)return{};var r,i,t={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var l=i.createContext({}),c=function(e){var n=i.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},b=i.forwardRef((function(e,n){var r=e.components,t=e.mdxType,a=e.originalType,l=e.parentName,b=s(e,["components","mdxType","originalType","parentName"]),x=c(r),h=t,u=x["".concat(l,".").concat(h)]||x[h]||d[h]||a;return r?i.createElement(u,o(o({ref:n},b),{},{components:r})):i.createElement(u,o({ref:n},b))}));b.displayName="MDXCreateElement"},734814:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Zabbix_Docker_Monitor_01-9af5376cdd8c37a776bcea8654f682d8.png"},11805:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Zabbix_Docker_Monitor_02-24bbdd08df1bdbd453d360a4c3f6b4da.png"},619032:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/Zabbix_Docker_Monitor_03-0f85e3274bb8985fe83dc391e11e8242.png"},119657:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-539dc0d90c8fd4caf3d5cd5162b8ded5.jpg"}}]);