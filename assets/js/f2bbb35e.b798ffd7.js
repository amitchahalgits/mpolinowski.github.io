"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[6964],{637112:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>o,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var n=r(474848),i=r(28453);const t={sidebar_position:7070,slug:"2022-02-04",title:"Elasticsearch & Kibana v8 Search Cheat Sheet",authors:"mpolinowski",tags:["LINUX","Elasticsearch"]},d=void 0,c={id:"DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/index",title:"Elasticsearch & Kibana v8 Search Cheat Sheet",description:"Shenzhen, China",source:"@site/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/index.md",sourceDirName:"DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries",slug:"/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/2022-02-04",permalink:"/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/2022-02-04",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Elasticsearch",permalink:"/docs/tags/elasticsearch"}],version:"current",sidebarPosition:7070,frontMatter:{sidebar_position:7070,slug:"2022-02-04",title:"Elasticsearch & Kibana v8 Search Cheat Sheet",authors:"mpolinowski",tags:["LINUX","Elasticsearch"]},sidebar:"tutorialSidebar",previous:{title:"Elasticsearch & Kibana v8 Index Management",permalink:"/docs/DevOps/Elasticsearch/2022-02-05--kibana-v8-index-management/2022-02-05"},next:{title:"Elasticsearch v8, Filebeat (Docker) and NGINX",permalink:"/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03"}},a={},l=[{value:"Kibana Query Language (KQL)",id:"kibana-query-language-kql",level:2},{value:"Lucene Query Language",id:"lucene-query-language",level:2}];function h(e){const s={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Shenzhen, China",src:r(259494).A+"",width:"1500",height:"403"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"#kibana-query-language-kql",children:"Kibana Query Language (KQL)"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"#lucene-query-language",children:"Lucene Query Language"})}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"kibana-query-language-kql",children:"Kibana Query Language (KQL)"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Task"}),(0,n.jsx)(s.th,{children:"Query"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Find NGINX error log entries"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"event.dataset:*error"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for IP1 or IP2 using Free Text Search"}),(0,n.jsx)(s.td,{children:"`event.dataset : nginx.error  and (46.231.239.5"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Find entries that don't specify a user agent"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"NOT user_agent.name : *"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Find HTTP Status Codes that are not successful*"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"http.response.status_code > 299"})})]})]})]}),"\n",(0,n.jsxs)(s.p,{children:["* ",(0,n.jsx)(s.em,{children:"HTTP Response Codes"})]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Informational responses: ",(0,n.jsx)(s.strong,{children:"100"})," \u2013 ",(0,n.jsx)(s.strong,{children:"199"})]}),"\n",(0,n.jsxs)(s.li,{children:["Successful responses: ",(0,n.jsx)(s.strong,{children:"200"})," \u2013 ",(0,n.jsx)(s.strong,{children:"299"})]}),"\n",(0,n.jsxs)(s.li,{children:["Redirection messages: ",(0,n.jsx)(s.strong,{children:"300"})," \u2013 ",(0,n.jsx)(s.strong,{children:"399"})]}),"\n",(0,n.jsxs)(s.li,{children:["Client error responses: ",(0,n.jsx)(s.strong,{children:"400"})," \u2013 ",(0,n.jsx)(s.strong,{children:"499"})]}),"\n",(0,n.jsxs)(s.li,{children:["Server error responses: ",(0,n.jsx)(s.strong,{children:"500"})," \u2013 ",(0,n.jsx)(s.strong,{children:"599"})]}),"\n"]}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Elastic Kibana v8",src:r(239226).A+"",width:"1361",height:"557"})}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Task"}),(0,n.jsx)(s.th,{children:"Query"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Get all NGINX connections that have an HTTP status code between 500 and 599 and originate in a specific region"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.geo.country_iso_code: RU and http.response.status_code >= 500"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Get all NGINX connections that originated from one of two locations"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.geo.country_iso_code: RU or source.geo.country_iso_code: CN"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Check ",(0,n.jsx)(s.a,{href:"/docs/DevOps/Zabbix/2022-01-14--zabbix-nginx-monitor/2022-01-14",children:"Zabbix-Agent Health Check"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.ip : 127.0.0.1 and traefik.access.user_agent.original : Zabbix 6.0.0beta2"})})]})]})]}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Elastic Kibana v8",src:r(169393).A+"",width:"1372",height:"539"})}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Task"}),(0,n.jsx)(s.th,{children:"Query"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Search for a source by IP address"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.ip : 118.184.177.30"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Expand the IP range using CIDR notation"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.ip : 118.184.177.0/24"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Expand the IP range using CIDR notation"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.ip : 118.184.0.0/16"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Expand the IP range using CIDR notation"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"source.ip : 118.0.0.0/8"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Search for IPv6 ranges"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:'source.ip : "fe80::/64"'})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Searching for nested values"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"data:{point1 > 100 and point2: 1}"})})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"lucene-query-language",children:"Lucene Query Language"}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["Deactivate ",(0,n.jsx)(s.strong,{children:"KQL"})," in the Kibana Discover tab to activate the ",(0,n.jsx)(s.strong,{children:"Lucene Query Syntax"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Task"}),(0,n.jsx)(s.th,{children:"Query"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for IP1 or IP2 using Free Text Search"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"61.231.239.5 45.201.198.232"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for IP1 or IP2 using Free Text Search"}),(0,n.jsx)(s.td,{children:"`61.231.239.5"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for an IP and a specific URL"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"45.201.198.232 AND \\/dr\\/update_magento.php"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for an IP and a specific URL"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:'45.201.198.232 && "/dr/update_magento.php"'})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Return results for an IP and a specific URL"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"+45.201.198.232 +\\/dr\\/update_magento.php"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Remove all health check requests from results"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:'agent.name : ticketsystem NOT traefik.access.user_agent.original : "Zabbix 6.0.0"'})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Has a specific IP accessed without an error"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"+45.201.198.232 -error"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Has a specific IP accessed without success"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"45.201.198.232 NOT success"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Has a specific IP accessed without success"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"45.201.198.232 !success"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Use grouped queries"}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"(user_agent.version: <2.20 AND event.category: web) AND (agent.type: filebeat !agent.version: 7.9.0)"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Proximity Search"})," distance threshold when terms are separated"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:'"forbidden 5.9.61.232" ~2'})})]})]})]}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"Elastic Kibana v8",src:r(271528).A+"",width:"1331",height:"458"})}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsx)("br",{}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Task"}),(0,n.jsx)(s.th,{children:"Query"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Wildcards"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"agent.ephemeral_id:b59445f4-*"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Inclusive ",(0,n.jsx)(s.strong,{children:"Range Queries"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"user_agent.version:[1.0 TO 1.1]"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Exclusive ",(0,n.jsx)(s.strong,{children:"Range Queries"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"http.response.status_code:{299 TO 500}"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Mixed ",(0,n.jsx)(s.strong,{children:"Range Queries"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"{1.0 TO 1.1]"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Wildcards"})," with ",(0,n.jsx)(s.strong,{children:"Range Queries"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"destination.port:[80 TO *]"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Check if field ",(0,n.jsx)(s.strong,{children:"Exists"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"_exists_ : agent.hostname"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Check if field not ",(0,n.jsx)(s.strong,{children:"Exists"})]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"NOT _exists_ : agent.hostname"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Fuzzy Searches"})," to get around typos or mal-formatted terms"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"url.path:\\/16-mm-w-o-ir-filter-1523.ht~2"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Fuzzy Searches"})," all sub-versions of an agent"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"agent.version:8.0~2"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:[(0,n.jsx)(s.strong,{children:"Boost"})," term weights"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"destination.port:(9200^9 OR 443)"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:["Use ",(0,n.jsx)(s.strong,{children:"Regex"})," to find all ",(0,n.jsx)(s.em,{children:"single"})," lower case characters and numbers from 0 to 9"]}),(0,n.jsx)(s.td,{children:"/[a-z0-9]/"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:[(0,n.jsx)(s.strong,{children:"Regex"})," for valid IPv4 addresses*"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/(([0-2]*[0-9]+[0-9]+)\\.([0-2]*[0-9]+[0-9]+)\\.([0-2]*[0-9]+[0-9]+)\\.([0-2]*[0-9]+[0-9]+))/"})})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:[(0,n.jsx)(s.strong,{children:"Regex"})," for valid, private IPv4 addresses"]}),(0,n.jsx)(s.td,{children:"`/(^10.)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsxs)(s.td,{children:[(0,n.jsx)(s.strong,{children:"Regex"})," to find all versions between 7 and 8"]}),(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"agent.version:/[7-8]\\.[0-9]\\.[0-9]/"})})]})]})]}),"\n",(0,n.jsxs)(s.p,{children:["* ",(0,n.jsxs)(s.em,{children:["The expressions above are not displayed correctly - check ",(0,n.jsx)(s.a,{href:"https://regexlib.com/REDetails.aspx?regexp_id=321",children:"regexlib.com"})," for Regex. Replace leading ",(0,n.jsx)(s.code,{children:"^"})," and trailing ",(0,n.jsx)(s.code,{children:"$"})," with ",(0,n.jsx)(s.code,{children:"/"})]})]})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},239226:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/Elasticsearch8_Kibana_01-814c789d7a9e228c99d02b682a63a465.png"},169393:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/Elasticsearch8_Kibana_02-6109d47e96a02b82bb13156f7cf36087.png"},271528:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/Elasticsearch8_Kibana_03-fbe1fdc58e617cbd2aa554da2e635370.png"},259494:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-94d62ec3ff079da54fce88aad4901707.jpg"},28453:(e,s,r)=>{r.d(s,{R:()=>d,x:()=>c});var n=r(296540);const i={},t=n.createContext(i);function d(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);