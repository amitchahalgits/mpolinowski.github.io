"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[74161],{716229:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var s=t(474848),a=t(28453);const r={sidebar_position:9930,slug:"2022-03-16",title:"Install Gitlab with Docker-Compose (Debian Bullseye)",authors:"mpolinowski",tags:["LINUX"]},i=void 0,l={id:"DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost/index",title:"Install Gitlab with Docker-Compose (Debian Bullseye)",description:"Shenzhen, China",source:"@site/docs/DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost/index.mdx",sourceDirName:"DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost",slug:"/DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost/2022-03-16",permalink:"/docs/DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost/2022-03-16",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/GitOps/2022-03-16--gitlab-docker-compose-on-localhost/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:9930,frontMatter:{sidebar_position:9930,slug:"2022-03-16",title:"Install Gitlab with Docker-Compose (Debian Bullseye)",authors:"mpolinowski",tags:["LINUX"]},sidebar:"tutorialSidebar",previous:{title:"Go Gitlab CI Pipeline",permalink:"/docs/DevOps/GitOps/2022-11-10-go-gitlab-ci-pipeline/2022-11-10"},next:{title:"Gatsby Build Gitlab CI Pipeline",permalink:"/docs/DevOps/GitOps/2021-02-25-gatsby-build-gitlab-pipeline/2021-02-25"}},o={},c=[{value:"Setup",id:"setup",level:2},{value:"Docker-Compose",id:"docker-compose",level:2},{value:"Generate SSL and DHAPARAM Certificates",id:"generate-ssl-and-dhaparam-certificates",level:2},{value:"Run the Container",id:"run-the-container",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Shenzhen, China",src:t(730581).A+"",width:"1500",height:"567"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#setup",children:"Setup"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#docker-compose",children:"Docker-Compose"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#generate-ssl-and-dhaparam-certificates",children:"Generate SSL and DHAPARAM Certificates"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#run-the-container",children:"Run the Container"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsxs)(n.p,{children:["Create the ",(0,s.jsx)(n.code,{children:"docker-compose"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p /opt/gitlab/{config/ssl,logs,data} && cd /opt/gitlab\r\nnano .env\n"})}),"\n",(0,s.jsxs)(n.p,{children:['Define the environment variable "GITLAB_HOME": ',(0,s.jsx)(n.code,{children:"export GITLAB_HOME=/opt/gitlab"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"docker-compose",children:"Docker-Compose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano docker-compose.yml\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yml",children:"version: '3.6'\r\nservices:\r\n  web:\r\n    image: 'gitlab/gitlab-ce:latest'\r\n    container_name: gitlab-ce\r\n    restart: unless-stopped\r\n    hostname: 'gitlab.example.com'\r\n    environment:\r\n      GITLAB_OMNIBUS_CONFIG: |\r\n        # Add any other gitlab.rb configuration here, each on its own line\r\n        external_url 'https://gitlab.example.com:8443'\r\n        gitlab_rails['gitlab_shell_ssh_port'] = 2222\r\n        nginx['redirect_http_to_https'] = true\r\n        nginx['ssl_certificate'] = \"/etc/gitlab/ssl/fullchain.pem\"\r\n        nginx['ssl_certificate_key'] = \"/etc/gitlab/ssl/privkey.pem\"\r\n        nginx['ssl_dhparam'] = \"/etc/gitlab/ssl/dhparams.pem\"\r\n    ports:\r\n      - '8080:80'\r\n      - '8443:443'\r\n      - '2222:22'\r\n    volumes:\r\n    - '${GITLAB_HOME}/config:/etc/gitlab'\r\n    - '${GITLAB_HOME}/logs:/var/log/gitlab'\r\n    - '${GITLAB_HOME}/data:/var/opt/gitlab'\r\n    - '${GITLAB_HOME}/config/ssl:/etc/gitlab/ssl'\r\n    shm_size: '256m'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"generate-ssl-and-dhaparam-certificates",children:"Generate SSL and DHAPARAM Certificates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"apt install certbot\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"certbot certonly --rsa-key-size 2048 \\\r\n  --standalone \\\r\n  --agree-tos \\\r\n  --no-eff-email \\\r\n  --email user@example.email \\\r\n  -d gitlab.example.com\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The Now copy the certificates ",(0,s.jsx)(n.strong,{children:"fullchain.pem"})," and ",(0,s.jsx)(n.strong,{children:"privkey.pem"})," will be generated in ",(0,s.jsx)(n.code,{children:"/etc/letsencrypt/live/gitlab.example.com"})," and needs to be linked into the ",(0,s.jsx)(n.code,{children:"/opt/gitlab/config/ssl"})," directory:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cp /etc/letsencrypt/live/gitlab.example.com/fullchain.pem /opt/gitlab/config/ssl/fullchain.pem\r\ncp /etc/letsencrypt/live/gitlab.example.com/privkey.pem /opt/gitlab/config/ssl/privkey.pem\n"})}),"\n",(0,s.jsx)(n.p,{children:"Next, generate the DHPARAM certificate:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl dhparam -out /opt/gitlab/config/ssl/dhparams.pem 2048\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tree /opt/gitlab\r\n      \r\n/opt/gitlab\r\n\u251c\u2500\u2500 config\r\n\u2502   \u2514\u2500\u2500 ssl\r\n\u2502       \u251c\u2500\u2500 dhparams.pem\r\n\u2502       \u251c\u2500\u2500 fullchain.pem\r\n\u2502       \u2514\u2500\u2500 privkey.pem\r\n\u251c\u2500\u2500 data\r\n\u251c\u2500\u2500 docker-compose.yml\r\n\u251c\u2500\u2500 logs\n"})}),"\n",(0,s.jsx)(n.h2,{id:"run-the-container",children:"Run the Container"}),"\n",(0,s.jsx)(n.p,{children:"Make sure that the HTTP/S and SSH Port is open:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ufw allow 8080,8443,2222/tcp\n"})}),"\n",(0,s.jsx)(n.p,{children:"Start the Gitlab-CE and Gitlab-Runner Container with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\r\n\r\ndocker-compose ps\r\nName          Command           State        Ports                                     \r\n----------------------------------------------------------------------------------------------------------\r\ngitlab-ce   /assets/wrapper   Up (unhealthy)   0.0.0.0:2222->22/tcp,:::2222->22/tcp, 0.0.0.0:8443->443/tcp,:::8443->443/tcp, 0.0.0.0:80->80/tcp,:::80->80/tcp \n"})}),"\n",(0,s.jsxs)(n.p,{children:["Visit ",(0,s.jsx)(n.code,{children:"https://gitlab.example.com:8443"})," and you will get the GitLab reset password page. Type your new password for the default user ",(0,s.jsx)(n.strong,{children:"root"})," and click the ",(0,s.jsx)(n.em,{children:"Change your password"})," button."]}),"\n",(0,s.jsx)(n.p,{children:"Run Gitlab CLI commands inside the container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker exec -it gitlab-ce gitlab-ctl status\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Edit the ",(0,s.jsx)(n.code,{children:"gitlab.rb"})," configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nano /opt/gitlab/config/gitlab.rb\n"})}),"\n",(0,s.jsx)(n.p,{children:"And restart the container to enable the changes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker restart gitlab-ce\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},730581:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-983e9af3d84f5fb9ebad02646e63767d.jpg"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var s=t(296540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);