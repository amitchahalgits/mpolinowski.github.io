"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[92651],{4203:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>h});var t=n(474848),a=n(28453);const i={sidebar_position:8050,slug:"2018-11-30",title:"Home Assistant and MQTT",authors:"mpolinowski",tags:["IoT","Smarthome"]},r=void 0,o={id:"Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian/index",title:"Home Assistant and MQTT",description:"Harbin, China",source:"@site/docs/Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian/index.mdx",sourceDirName:"Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian",slug:"/Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian/2018-11-30",permalink:"/docs/Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian/2018-11-30",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Home_Automation/2018-11-30--home-assistant-on-debian/index.mdx",tags:[{label:"IoT",permalink:"/docs/tags/io-t"},{label:"Smarthome",permalink:"/docs/tags/smarthome"}],version:"current",sidebarPosition:8050,frontMatter:{sidebar_position:8050,slug:"2018-11-30",title:"Home Assistant and MQTT",authors:"mpolinowski",tags:["IoT","Smarthome"]},sidebar:"tutorialSidebar",previous:{title:"MQTT Camera AI Enhanced Security",permalink:"/docs/Automation_and_Robotics/Home_Automation/2019-09-23--mqtt-camera-ai-video-security/2019-09-23"},next:{title:"Node-RED and MQTT",permalink:"/docs/Automation_and_Robotics/Home_Automation/2018-11-29--node-red-and-mqtt/2018-11-29"}},d={},h=[{value:"Installation of Home Assistant on a Debian Stretch Server",id:"installation-of-home-assistant-on-a-debian-stretch-server",level:2},{value:"Installation of dependencies:",id:"installation-of-dependencies",level:3},{value:"Create a user and group",id:"create-a-user-and-group",level:3},{value:"Install Home Assistant",id:"install-home-assistant",level:3},{value:"Run Home Assistant as a Service",id:"run-home-assistant-as-a-service",level:3},{value:"Configuring Home Assistant",id:"configuring-home-assistant",level:2},{value:"Adding the MQTT Broker",id:"adding-the-mqtt-broker",level:3},{value:"The Home Assistant Lovelace UI",id:"the-home-assistant-lovelace-ui",level:2},{value:"Adding your camera&#39;s Live Video",id:"adding-your-cameras-live-video",level:3},{value:"Using Home Assistant as Alarmserver for your INSTAR Camera",id:"using-home-assistant-as-alarmserver-for-your-instar-camera",level:3}];function c(e){const s={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Harbin, China",src:n(38824).A+"",width:"1500",height:"340"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#installation-of-home-assistant-on-a-debian-stretch-server",children:"Installation of Home Assistant on a Debian Stretch Server"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#installation-of-dependencies",children:"Installation of dependencies:"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#create-a-user-and-group",children:"Create a user and group"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#install-home-assistant",children:"Install Home Assistant"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#run-home-assistant-as-a-service",children:"Run Home Assistant as a Service"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#configuring-home-assistant",children:"Configuring Home Assistant"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#adding-the-mqtt-broker",children:"Adding the MQTT Broker"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#the-home-assistant-lovelace-ui",children:"The Home Assistant Lovelace UI"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#adding-your-cameras-live-video",children:"Adding your camera's Live Video"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#using-home-assistant-as-alarmserver-for-your-instar-camera",children:"Using Home Assistant as Alarmserver for your INSTAR Camera"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)("div",{class:"primarybox",children:[(0,t.jsx)("h3",{children:"INSTAR MQTT Broker"}),(0,t.jsx)("p",{children:"The MQTT Interface enables you to access all camera functions through the native MQTT support from the Home Assistant Lovelace UI!"})]}),"\n",(0,t.jsx)(s.h2,{id:"installation-of-home-assistant-on-a-debian-stretch-server",children:"Installation of Home Assistant on a Debian Stretch Server"}),"\n",(0,t.jsx)(s.h3,{id:"installation-of-dependencies",children:"Installation of dependencies:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo apt update\r\nsudo apt install python3-dev python3-pip python3-venv\r\nsudo pip3 install --upgrade virtualenv\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(808860).A+"",width:"730",height:"136"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"create-a-user-and-group",children:"Create a user and group"}),"\n",(0,t.jsx)(s.p,{children:"Give the user access to serial lines (zwave, insteon, etc):"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo adduser --system homeassistant\r\nsudo addgroup homeassistant\r\nsudo adduser homeassistant dialout\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(66967).A+"",width:"730",height:"187"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Create a directory to install HA in and set its ownership and permissions."}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo mkdir /opt/homeassistant\r\nsudo chown homeassistant:homeassistant /opt/homeassistant\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(121390).A+"",width:"730",height:"56"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Change to the homeassistant user to do the installs."}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo su -s /bin/bash homeassistant\n"})}),"\n",(0,t.jsx)(s.h3,{id:"install-home-assistant",children:"Install Home Assistant"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Install a virtual env to sandbox the Home Assistant software and dependencies and activate it so further installs are done here."}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd /opt/homeassistant\r\npython3 -m venv /opt/homeassistant\r\nsource bin/activate\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(39105).A+"",width:"730",height:"48"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsx)(s.li,{children:"Install HA from pip. You might get some pip install errors that do not cause an issue later on:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pip3 install --upgrade homeassistant\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(817976).A+"",width:"730",height:"463"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["Open another terminal and login with your default (sudo enabled) user and open the Home Assistant port ",(0,t.jsx)(s.code,{children:"8123"})," in your Firewall:"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo firewall-cmd --permanent --zone=public --add-port=8123/tcp\r\nsudo firewall-cmd --reload\r\nsudo firewall-cmd --list-all\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(163731).A+"",width:"730",height:"301"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:"Then switch back to the homeassistant user."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"To keep all the config and log files in the same directory (rather than having them in /home/homassistant) we can run Home Assistant with the following command:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"mkdir config\r\n./bin/hass -c /opt/homeassistant/config --log-file /opt/homeassistant/hass.log\n"})}),"\n",(0,t.jsx)(s.p,{children:"Home Assistant should install a few things and make a default config file (let it run for a little while - it takes a bit on the first start up). Hit ctrl-c to stop it. The config directory now contains a bunch of sample config files for you to edit."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(8522).A+"",width:"730",height:"93"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"5",children:["\n",(0,t.jsxs)(s.li,{children:["You can now access Home Assistants web interface by opening the following URL (exchange the IP address ",(0,t.jsx)(s.strong,{children:"192.168.2.111"})," with the IP of your Linux Server) inside your webbrowser ",(0,t.jsx)(s.code,{children:"http://192.168.2.111:8123/"}),":"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(785117).A+"",width:"730",height:"480"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsx)(s.li,{children:"Type in your preferred login credentials and click to create the account:"}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(868436).A+"",width:"730",height:"427"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"7",children:["\n",(0,t.jsx)(s.li,{children:"And login to the Home Assistant web interface using your credentials:"}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(97210).A+"",width:"730",height:"444"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.ol,{start:"8",children:["\n",(0,t.jsx)(s.li,{children:"Hit ctrl-c to stop Home Assistants. The config directory now contains a bunch of sample config files for you to edit."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"run-home-assistant-as-a-service",children:"Run Home Assistant as a Service"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Assuming it works, exit the homeassistant user, change to the ",(0,t.jsx)(s.code,{children:"/etc/systemd/system/"})," directory and create a service to start Home Assistant automatically."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"exit\r\ncd /etc/systemd/system/\r\nsudo nano homeassistant.service\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:["Create the following ",(0,t.jsx)(s.code,{children:"systemd init"})," file:"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(687043).A+"",width:"730",height:"189"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[Unit]\r\nDescription=Home Assistant\r\nAfter=network.target mosquitto.service\r\n\r\n[Service]\r\nType=simple\r\nUser=homeassistant\r\nExecStart=/opt/homeassistant/bin/hass -c /opt/homeassistant/config --log-file /opt/homeassistant/hass.log\r\n\r\n[Install]\r\nWantedBy=multi-user.target\n"})}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsxs)(s.li,{children:["Exit the homeassistant user, copy the service file to the system, and ",(0,t.jsx)(s.code,{children:"update systemd"})," to run the service."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo systemctl --system daemon-reload\r\nsudo systemctl enable homeassistant\r\nsudo systemctl start homeassistant\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"4",children:["\n",(0,t.jsx)(s.li,{children:"If something goes wrong with the start command, check the logs:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo systemctl status homeassistant\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(825064).A+"",width:"730",height:"345"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Finally, to make it easier to edit config files and try out code changes, give your regular user write permissions in the ",(0,t.jsx)(s.code,{children:"homeassistant directory"}),". For this we need to assign both our regular user - in my case this is the ",(0,t.jsx)(s.code,{children:"nodeadmin"})," - and the homeassistant user to the ",(0,t.jsx)(s.code,{children:"homeassistant group"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo groupadd homeassistant\r\nsudo usermod -a -G homeassistant nodeadmin\r\nsudo usermod -a -G homeassistant homeassistant\n"})}),"\n",(0,t.jsx)(s.p,{children:"Make sure that both users are inside the created group:"}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(757105).A+"",width:"730",height:"78"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo chgrp -R homeassistant /opt/homeassistant\r\nsudo chmod -R g+w /opt/homeassistant/\n"})}),"\n",(0,t.jsx)(s.h2,{id:"configuring-home-assistant",children:"Configuring Home Assistant"}),"\n",(0,t.jsxs)(s.p,{children:["We set up Home Assistant to be installed in ",(0,t.jsx)(s.code,{children:"/opt/homeassistant"}),". The configuration file can be found in the ",(0,t.jsx)(s.code,{children:"config"})," subfolder. Let's open up the file to take a look at it:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"sudo nano /opt/homeassistant/config/configuration.yaml\n"})}),"\n",(0,t.jsx)(s.h3,{id:"adding-the-mqtt-broker",children:"Adding the MQTT Broker"}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(228894).A+"",width:"730",height:"190"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:"The first thing we should do, is adding our Mosquitto server (192.168.2.111) as MQTT broker. We can do this by adding the following lines at the end of the document:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"# MQTT Communication\r\n\r\nmqtt:\r\n  broker: 192.168.2.111\r\n  port: 1883\r\n  user: debian\r\n  password: mysecretpassword\n"})}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsxs)(s.p,{children:["To verify that we did not mess up the configuration we can go to the ",(0,t.jsx)(s.strong,{children:"Configuration Tab"})," in Home Assistant:"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(404679).A+"",width:"730",height:"382"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Open the ",(0,t.jsx)(s.strong,{children:"General"})," section:"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(637644).A+"",width:"730",height:"471"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Click on ",(0,t.jsx)(s.strong,{children:"Check Config"})," and - ",(0,t.jsx)(s.strong,{children:"when it passes"})," - click on ",(0,t.jsx)(s.strong,{children:"Restart Server"}),":"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(549269).A+"",width:"730",height:"792"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"the-home-assistant-lovelace-ui",children:"The Home Assistant Lovelace UI"}),"\n",(0,t.jsxs)(s.p,{children:["Now we can start with adding components to the Home Assistant UI - called ",(0,t.jsx)(s.strong,{children:"Lovelace"}),". Note that the INSTAR MQTT Broker is only included in ",(0,t.jsx)(s.em,{children:"INSTAR Full HD cameras"}),". If you are using a HD (720p) or VGA camera you can still use MQTT to connect your camera."]}),"\n",(0,t.jsx)(s.h3,{id:"adding-your-cameras-live-video",children:"Adding your camera's Live Video"}),"\n",(0,t.jsxs)(s.p,{children:["Home Assistant comes with a ",(0,t.jsx)(s.strong,{children:"Camera Module"})," that we can use to add our camera's Live Video. Lets start by accessing the ",(0,t.jsx)(s.code,{children:"configuration.yaml"}),". When you followed the steps above you will find this file in ",(0,t.jsx)(s.code,{children:"/opt/homeassistant/config/configuration.yaml"}),". Open the configuration file and add the line ",(0,t.jsx)(s.code,{children:"/home/pi/.homeassistant/configuration.yaml"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"camera: !include cameras.yaml\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Now create the ",(0,t.jsx)(s.code,{children:"cameras.yaml"})," file next to the configuration file and add the following lines:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"- platform: generic\r\n  name: 'IN-8015FHD'\r\n  still_image_url: http://192.168.2.165/tmpfs/snap.jpg\r\n  stream_source: 'rtsp://192.168.2.165:554/11'\r\n  verify_ssl: false\r\n  authentication: 'basic'\r\n  username: 'admin'\r\n  password: 'instar'\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In case you need to restrict the bandwidth this live stream is requiring, use ",(0,t.jsx)(s.code,{children:"auto.jpg"})," or ",(0,t.jsx)(s.code,{children:"auto2.jpg"})," instead of ",(0,t.jsx)(s.code,{children:"snap.jpg"})," in the ",(0,t.jsx)(s.strong,{children:"still_image_url"})," above. Also the RTSP ",(0,t.jsx)(s.strong,{children:"stream_source"})," can use a smaller live stream by replacing the ",(0,t.jsx)(s.code,{children:"/11"})," with a ",(0,t.jsx)(s.code,{children:"/12"})," or ",(0,t.jsx)(s.code,{children:"/13"}),". Alternatively, you can access your camera's MJPEG stream with the following configuration:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"- platform: mjpeg\r\n  name: 'IN-9010FHD'\r\n  mjpeg_url: http://192.168.2.117/mjpegstream.cgi?-chn=11\r\n  verify_ssl: false\r\n  authentication: 'basic'\r\n  username: 'admin'\r\n  password: 'instar'\n"})}),"\n",(0,t.jsxs)(s.p,{children:["And again, to reduce the bandwidth requirements of this live stream use ",(0,t.jsx)(s.code,{children:"chn=12"})," or ",(0,t.jsx)(s.code,{children:"chn=13"})," instead of ",(0,t.jsx)(s.code,{children:"chn=11"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["This will add a local INSTAR HD or Full HD camera with the IP address ",(0,t.jsx)(s.code,{children:"192.168.2.165"})," on the default HTTP Port ",(0,t.jsx)(s.code,{children:"80"})," and with the default RTSP Port 554. The camera login is ",(0,t.jsx)(s.code,{children:"admin/instar"})," in this example - but note: you do not need to use the Administrator account to access the live video."]}),"\n",(0,t.jsxs)(s.p,{children:["Now reload Home Assistant to be able to see the changes you just made. Once the UI is back up, click on ",(0,t.jsx)(s.strong,{children:"Configure UI"})," in the top right:"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(20114).A+"",width:"867",height:"260"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["You might want to add a new Tab for your camera by clicking on the small ",(0,t.jsx)(s.strong,{children:"+"})," icon next to your existing tabs. Then click on the big ",(0,t.jsx)(s.strong,{children:"+ Button"})," to add a new card."]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(341659).A+"",width:"869",height:"259"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Here we have to add a new Entity and select the camera that we just added - in the case above this was ",(0,t.jsx)(s.code,{children:"camera.in_8015fhd"}),":"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(368011).A+"",width:"872",height:"280"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(146882).A+"",width:"870",height:"763"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:"Save your setting and quit the UI configuration mode. You should see a small tile with a snapshot from your camera. Click on it to be directed to the live video:"}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(695065).A+"",width:"868",height:"688"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"using-home-assistant-as-alarmserver-for-your-instar-camera",children:"Using Home Assistant as Alarmserver for your INSTAR Camera"}),"\n",(0,t.jsx)(s.p,{children:"All INSTAR Full HD cameras have a function to send a POST request to a HTTP Webhook when an alarm is triggered (HD cameras currently only support GET requests that are not supported by Home Assistant - though you will be able to use Node-RED to receive a GET request from your HD camera and trigger a POST request to Home Assistant)."}),"\n",(0,t.jsx)(s.p,{children:"When such a post request is received by Home Assistant such an event can be used as a trigger for your automation to control your INSTAR Full HD camera."}),"\n",(0,t.jsxs)(s.p,{children:["To set up a Webhook that can be used by your camera first open the Lovelace UI and go to ",(0,t.jsx)(s.strong,{children:"Configuration"})," and open the ",(0,t.jsx)(s.strong,{children:"Automation"})," tab:"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(614512).A+"",width:"918",height:"705"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Click on the ",(0,t.jsx)(s.strong,{children:"+"})," icon to add a new automation and select ",(0,t.jsx)(s.strong,{children:"Webhook"})," as the automation trigger - the name you choose here for the Webhook will be used to name the resulting URL e.g. ",(0,t.jsx)(s.code,{children:"mqtt_test"})," (better don't use spaces or special characters):"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(541007).A+"",width:"914",height:"636"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Now we need to define an action that we want to trigger. For this we are going to use a ",(0,t.jsx)(s.strong,{children:"MQTT Publish"})," service we created in the. This service requires a MQTT topic (",(0,t.jsx)(s.em,{children:"Target"}),") and a MQTT message payload (",(0,t.jsx)(s.em,{children:"Message"}),") to be passed down:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\r\n  "message": "{\\"val\\":\\"1\\"}",\r\n  "target": "instar/000389888811/features/ptz/preset"\r\n}\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(501990).A+"",width:"918",height:"806"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Here we choose the ",(0,t.jsx)(s.code,{children:"features/ptz/preset"})," MQTT Topic and send the payload value ",(0,t.jsx)(s.code,{children:"1"})," which will tell the camera with the MAC address ",(0,t.jsx)(s.code,{children:"000389888811"})," to move to ",(0,t.jsx)(s.strong,{children:"Preset Position 2"})," (numbering of those positions starts at ",(0,t.jsx)(s.code,{children:"0"}),")."]}),"\n",(0,t.jsxs)(s.p,{children:["When you hit ",(0,t.jsx)(s.strong,{children:"Save"})," this automation will be saved inside the ",(0,t.jsx)(s.code,{children:"automations.yaml"})," file inside the Home Assistant directory:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"- id: '1571301476710'\r\n  alias: TEST MQTT Webhook\r\n  trigger:\r\n  - platform: webhook\r\n    webhook_id: mqtt_test\r\n  condition: []\r\n  action:\r\n  - data:\r\n      message: '{\"val\":\"1\"}'\r\n      target: instar/000389888811/features/ptz/preset\r\n    service: script.send_mqtt_command\n"})}),"\n",(0,t.jsxs)(s.p,{children:["You could test triggering the above automation by sending a ",(0,t.jsx)(s.strong,{children:"POST HTTP Request"})," to"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:"http://your-home-assistant:8123/api/webhook/mqtt_test\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(543229).A+"",width:"935",height:"687"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.p,{children:["Sending the command ",(0,t.jsx)(s.code,{children:'curl -d "" http://192.168.2.43:8123/api/webhook/mqtt_test'})," triggers the automation and sends the camera into the second preset position."]}),"\n",(0,t.jsxs)(s.p,{children:["Now that we know that our automation is working and the Webhook is set up, we can configure our camera to contact Home Assistant when an Alarm is triggered by the camera internal detection systems. Please open the Alarmserver configuration inside your camera's web user interface and add the Home Assistant Webhook to the following form. You have to activate the POST Request and add a dummy request parameter - in the screenshot below we added ",(0,t.jsx)(s.code,{children:"homeassistant=alarm"}),". But this parameter can be chosen freely:"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(322100).A+"",width:"766",height:"489"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Home Assistant with your INSTAR IP Camera",src:n(464371).A+"",width:"766",height:"208"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.p,{children:"Now, every time an alert is triggered our camera will contact it's Alarmserver - the Home Assistant installation - and start the automation."})]})}function l(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},808860:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_01-ae033b62ac2f4f90a92216dc6364b0c8.png"},66967:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_02-92586656817c8b708fe080b2ba9e4e09.png"},121390:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_03-635242340cc89a51a9a63061fa708944.png"},39105:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_04-7034c42e50e0413f194a9d33b3bc6202.png"},817976:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_05-8b92bff1969f1fa3846da4d9300f296a.png"},163731:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_06-949facacd433b55e0184aef8e0f4b515.png"},8522:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_07-67146e8e1a0b6b51d215af926505bc07.png"},785117:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_08-2410d57a45c6f8adddcd8143d343412c.png"},868436:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_09-78e2436511d836a6ef85eafefb9d7547.png"},97210:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_10-a7d352fcef1edc33bfd4f82b0f3f04e6.png"},687043:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_11-6e3ebee78b61e099aac73a4dd91b8b13.png"},825064:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_12-b6521a21c887917ec25dcbb81a8a38d3.png"},757105:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_13-cf154c06d829d0a6b16aa8683bd12c33.png"},228894:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_14-8ea097d83f77c791b2f7d4f75ee6290b.png"},404679:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_15-169c35b429453429ce59d04f5d164bce.png"},637644:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_16-4be71fb0cf8afd664968af36f325b695.png"},549269:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_17-e81decf43b4549aa20258586de6398d5.png"},20114:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_18-560fc184d467fb40471ea8c8ccd7cbcd.png"},341659:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_19-e9a9d5d8c1c8718bc05f26c01c7133bf.png"},368011:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_20-6bd4df401938d3ffc6dce101f9ae7f9c.png"},146882:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_21-6864516604f7dda5c6c0b76970283a8f.png"},695065:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_22-3c70ab30d117126b58ab6b92ab3352d0.png"},614512:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_23-c8cc603dc0221495b968ae9bf95d75b6.png"},541007:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_24-d3c021a379f3b4f796f3b237fb4e5ed8.png"},501990:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_25-a879ba61d074747b563f94ce8fdaf982.png"},543229:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_26-c9775198637b6d38d2169ab360923e64.png"},322100:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_27-001b43e53614632c47d3867dbb945c4e.png"},464371:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/HomeAssistant_28-151d4ffa3529fec5d3fa133525264af1.png"},38824:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/photo-kt456d_645dhfh6dgjkhg4_d-c3a3f24fb7e47a009036ea5b619329d1.jpg"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(296540);const a={},i=t.createContext(a);function r(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);