"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[48387],{536336:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});var i=r(785893),a=r(603905);const t={sidebar_position:5e3,slug:"2022-11-27",title:"Deep Docker on Arch",authors:"mpolinowski",tags:["Python","Machine Learning","Docker"],description:"The NVIDIA Container Toolkit run GPU accelerated Docker containers"},o=void 0,s={id:"IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning/index",title:"Deep Docker on Arch",description:"The NVIDIA Container Toolkit run GPU accelerated Docker containers",source:"@site/docs/IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning/index.md",sourceDirName:"IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning",slug:"/IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning/2022-11-27",permalink:"/docs/IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning/2022-11-27",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/ML/2022-11-27-containerized-deep-learning/index.md",tags:[{label:"Python",permalink:"/docs/tags/python"},{label:"Machine Learning",permalink:"/docs/tags/machine-learning"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:5e3,frontMatter:{sidebar_position:5e3,slug:"2022-11-27",title:"Deep Docker on Arch",authors:"mpolinowski",tags:["Python","Machine Learning","Docker"],description:"The NVIDIA Container Toolkit run GPU accelerated Docker containers"},sidebar:"tutorialSidebar",previous:{title:"Breast Histopathology Image Segmentation Part 1",permalink:"/docs/IoT-and-Machine-Learning/ML/2022-12-10-tf-breast-cancer-classification-part1/2022-12-10"},next:{title:"Face Restoration with GFPGAN",permalink:"/docs/IoT-and-Machine-Learning/ML/2022-04-04-pytorch-face-restoration/2022-04-04"}},c={},l=[{value:"Preparations",id:"preparations",level:2},{value:"Installation in Arch Linux",id:"installation-in-arch-linux",level:3},{value:"YAY",id:"yay",level:4},{value:"Manually",id:"manually",level:4},{value:"Testing",id:"testing",level:3},{value:"Docker Images",id:"docker-images",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Guangzhou, China",src:r(23443).Z+"",width:"1500",height:"383"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#preparations",children:"Preparations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#installation-in-arch-linux",children:"Installation in Arch Linux"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#yay",children:"YAY"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#manually",children:"Manually"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#testing",children:"Testing"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#docker-images",children:"Docker Images"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://github.com/NVIDIA/nvidia-docker",children:"NVIDIA Container Toolkit"})," allows users to build and run GPU accelerated Docker containers. The toolkit includes a container runtime library and utilities to automatically configure containers to leverage NVIDIA GPUs."]}),"\n",(0,i.jsx)(n.h2,{id:"preparations",children:"Preparations"}),"\n",(0,i.jsxs)(n.p,{children:["Make sure you have installed the ",(0,i.jsx)(n.a,{href:"https://docs.nvidia.com/datacenter/tesla/tesla-installation-notes/index.html",children:"NVIDIA driver"})," and Docker engine for your Linux distribution. Note that you do not need to install the CUDA Toolkit on the host system."]}),"\n",(0,i.jsxs)(n.p,{children:["Starting from Docker version 19.03, NVIDIA GPUs are natively supported as Docker devices. ",(0,i.jsx)(n.a,{href:"https://github.com/NVIDIA/nvidia-docker",children:"NVIDIA Container Toolkit"})," is the recommended way of running containers that leverage NVIDIA GPUs."]}),"\n",(0,i.jsx)(n.h3,{id:"installation-in-arch-linux",children:"Installation in Arch Linux"}),"\n",(0,i.jsxs)(n.p,{children:["Install the ",(0,i.jsx)(n.a,{href:"https://aur.archlinux.org/packages/nvidia-container-toolkit/",children:"nvidia-container-toolkit"})," package. Next, restart docker. You can now run containers that make use of NVIDIA GPUs using the ",(0,i.jsx)(n.code,{children:"--gpus"})," option."]}),"\n",(0,i.jsx)(n.h4,{id:"yay",children:"YAY"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yay install nvidia-container-toolkit\n"})}),"\n",(0,i.jsx)(n.p,{children:"And restart Docker:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,i.jsx)(n.h4,{id:"manually",children:"Manually"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wget https://aur.archlinux.org/cgit/aur.git/snapshot/nvidia-container-toolkit.tar.gz\ntar -xf nvidia-container-toolkit.tar.gz && cd nvidia-container-toolkit/\nmakepkg\nsudo pacman -U nvidia-container-toolkit-1.11.0-1-x86_64.pkg.tar.zst\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Missing dependencies: -> libnvidia-container-tools>=1.9.0"})," ",(0,i.jsx)(n.a,{href:"https://aur.archlinux.org/packages/libnvidia-container-tools",children:"AUR"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wget https://aur.archlinux.org/cgit/aur.git/snapshot/libnvidia-container.tar.gz\ntar -xf libnvidia-container.tar.gz && cd libnvidia-container/\nmakepkg\nsudo pacman -U libnvidia-container-1.11.0-1-x86_64.pkg.tar.zst\nsudo pacman -U libnvidia-container-tools-1.11.0-1-x86_64.pkg.tar.zst\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"Missing dependencies: -> bmake, -> rpcsvc-proto"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo pacman -S bmake rpcsvc-proto \n"})}),"\n",(0,i.jsxs)(n.p,{children:["You might also need to re-enable c-groups in ",(0,i.jsx)(n.code,{children:"/etc/nvidia-container-runtime/config.toml"})," by ensuring ",(0,i.jsx)(n.code,{children:"no-cgroups"})," is not set to true. And restart Docker:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,i.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"At this point, a working setup can be tested by running a base CUDA container:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --rm --gpus all nvidia/cuda:11.6.2-base-ubuntu20.04 nvidia-smi\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Status: Downloaded newer image for nvidia/cuda:11.6.2-base-ubuntu20.04\nSun Nov 27 12:32:07 2022       \n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 520.56.06    Driver Version: 520.56.06    CUDA Version: 11.8     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|                               |                      |               MIG M. |\n|===============================+======================+======================|\n|   0  NVIDIA GeForce ...  Off  | 00000000:01:00.0  On |                  N/A |\n|  0%   53C    P8    10W / 130W |    922MiB /  6144MiB |      4%      Default |\n|                               |                      |                  N/A |\n+-------------------------------+----------------------+----------------------+\n                                                                               \n+-----------------------------------------------------------------------------+\n| Processes:                                                                  |\n|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n|        ID   ID                                                   Usage      |\n|=============================================================================|\n+-----------------------------------------------------------------------------+\n"})}),"\n",(0,i.jsx)(n.p,{children:":thumbsup:"}),"\n",(0,i.jsx)(n.h2,{id:"docker-images",children:"Docker Images"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker pull tensorflow/tensorflow:latest-gpu\ndocker pull pytorch/pytorch:1.13.0-cuda11.6-cudnn8-runtime\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Continued here:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/IoT-and-Machine-Learning/AIOps/2023-01-01-tf-model-server/2023-01-01",children:"Tensorflow Docker Model Server"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/IoT-and-Machine-Learning/AIOps/2023-08-19-tensorflow-serving-api/2023-08-19",children:"Tensorflow Serving API"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.ah)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},603905:(e,n,r)=>{r.d(n,{ah:()=>l});var i=r(667294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,i,a=function(e,n){if(null==e)return{};var r,i,a={},t=Object.keys(e);for(i=0;i<t.length;i++)r=t[i],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(i=0;i<t.length;i++)r=t[i],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=i.createContext({}),l=function(e){var n=i.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},h=i.forwardRef((function(e,n){var r=e.components,a=e.mdxType,t=e.originalType,c=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),u=l(r),p=a,g=u["".concat(c,".").concat(p)]||u[p]||d[p]||t;return r?i.createElement(g,o(o({ref:n},h),{},{components:r})):i.createElement(g,o({ref:n},h))}));h.displayName="MDXCreateElement"},23443:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-918471126c0472aad97358a725e1a399.jpg"}}]);