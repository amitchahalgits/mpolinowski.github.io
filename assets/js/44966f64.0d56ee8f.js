"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[66086],{331849:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var i=r(785893),s=r(603905);const t={sidebar_position:5040,slug:"2022-01-27",title:"Bind9 Server Configuration",authors:"mpolinowski",tags:["LINUX"]},o=void 0,c={id:"DevOps/Provisioning/2022-01-27--bind9-configuration/index",title:"Bind9 Server Configuration",description:"Shenzhen, China",source:"@site/docs/DevOps/Provisioning/2022-01-27--bind9-configuration/index.md",sourceDirName:"DevOps/Provisioning/2022-01-27--bind9-configuration",slug:"/DevOps/Provisioning/2022-01-27--bind9-configuration/2022-01-27",permalink:"/docs/DevOps/Provisioning/2022-01-27--bind9-configuration/2022-01-27",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2022-01-27--bind9-configuration/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:5040,frontMatter:{sidebar_position:5040,slug:"2022-01-27",title:"Bind9 Server Configuration",authors:"mpolinowski",tags:["LINUX"]},sidebar:"tutorialSidebar",previous:{title:"Provision OSticket with Docker",permalink:"/docs/DevOps/Provisioning/2022-10-16--os-ticket-docker/2022-10-16"},next:{title:"DNS Over TLS Using BIND And Nginx",permalink:"/docs/DevOps/Provisioning/2022-01-26--dns-over-TLS-docker/2022-01-26"}},d={},a=[{value:"Example Setup",id:"example-setup",level:2},{value:"Bind9 Configure",id:"bind9-configure",level:2},{value:"Primary DNS Server",id:"primary-dns-server",level:3},{value:"named.conf",id:"namedconf",level:4},{value:"named.conf.options",id:"namedconfoptions",level:4},{value:"named.conf.local",id:"namedconflocal",level:4}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Shenzhen, China",src:r(357738).Z+"",width:"1500",height:"671"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#example-setup",children:"Example Setup"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#bind9-configure",children:"Bind9 Configure"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#primary-dns-server",children:"Primary DNS Server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#namedconf",children:"named.conf"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#namedconfoptions",children:"named.conf.options"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#namedconflocal",children:"named.conf.local"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-setup",children:"Example Setup"}),"\n",(0,i.jsxs)(n.p,{children:["I have 2 servers called ",(0,i.jsx)(n.strong,{children:"service1"})," and ",(0,i.jsx)(n.strong,{children:"service2"})," - the servers are:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["located in the ",(0,i.jsx)(n.code,{children:"dc1"})," datacenter"]}),"\n",(0,i.jsxs)(n.li,{children:["on a ",(0,i.jsx)(n.code,{children:"172.24.0.0/16"})," subnet"]}),"\n",(0,i.jsxs)(n.li,{children:["run services that belong to a web application on ",(0,i.jsx)(n.code,{children:"instar.com"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The naming scheme used to refer to this private subnet or zone is ",(0,i.jsx)(n.code,{children:"dc1.instar.com"}),". The servers should be reachable under the private ",(0,i.jsx)(n.strong,{children:"Fully-Qualified Domain Names"})," (",(0,i.jsx)(n.em,{children:"FQDN"}),") ",(0,i.jsx)(n.code,{children:"service1.dc1.instar.com"})," and ",(0,i.jsx)(n.code,{children:"service2.dc1.instar.com"}),", respectively:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Host"}),(0,i.jsx)(n.th,{children:"Role"}),(0,i.jsx)(n.th,{children:"Private FQDN"}),(0,i.jsx)(n.th,{children:"Private IP Address"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"service1"}),(0,i.jsx)(n.td,{children:"First web service"}),(0,i.jsx)(n.td,{children:"service1.dc1.instar.com"}),(0,i.jsx)(n.td,{children:"172.24.0.2"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"service2"}),(0,i.jsx)(n.td,{children:"Second web service"}),(0,i.jsx)(n.td,{children:"service2.dc1.instar.com"}),(0,i.jsx)(n.td,{children:"172.24.0.3"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["I want to set up a primary DNS server, ",(0,i.jsx)(n.code,{children:"ns1"})," and a secondary DNS server ",(0,i.jsx)(n.code,{children:"ns2"}),", which will serve as a backup:"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Host"}),(0,i.jsx)(n.th,{children:"Role"}),(0,i.jsx)(n.th,{children:"Private FQDN"}),(0,i.jsx)(n.th,{children:"Private IP Address"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ns1"}),(0,i.jsx)(n.td,{children:"Primary DNS Server"}),(0,i.jsx)(n.td,{children:"ns1.nyc3.example.com"}),(0,i.jsx)(n.td,{children:"172.24.0.15"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ns2"}),(0,i.jsx)(n.td,{children:"Secondary DNS Server"}),(0,i.jsx)(n.td,{children:"ns2.nyc3.example.com"}),(0,i.jsx)(n.td,{children:"172.24.0.16"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"bind9-configure",children:"Bind9 Configure"}),"\n",(0,i.jsxs)(n.p,{children:["I am going to run this entire setup ",(0,i.jsx)(n.a,{href:"/docs/DevOps/Provisioning/2022-01-25--installing-bind9-docker/2022-01-25",children:"in Docker"}),". But before I can start the Bind9 Docker container I first need to create the configuration files on my Debian host system:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p /opt/dns/{ns1,ns2}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"primary-dns-server",children:"Primary DNS Server"}),"\n",(0,i.jsxs)(n.p,{children:["BIND\u2019s configuration consists of multiple files, which are included from the main configuration file, ",(0,i.jsx)(n.code,{children:"/etc/bind/named.conf"}),":"]}),"\n",(0,i.jsx)(n.h4,{id:"namedconf",children:"named.conf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'// This is the primary configuration file for the BIND DNS server named.\r\n//\r\n// Please read /usr/share/doc/bind9/README.Debian.gz for information on the \r\n// structure of BIND configuration files in Debian, *BEFORE* you customize \r\n// this configuration file.\r\n//\r\n// If you are just adding zones, please do that in /etc/bind/named.conf.local\r\n\r\ninclude "/etc/bind/named.conf.options";\r\ninclude "/etc/bind/named.conf.local";\r\ninclude "/etc/bind/named.conf.default-zones";\n'})}),"\n",(0,i.jsx)(n.h4,{id:"namedconfoptions",children:"named.conf.options"}),"\n",(0,i.jsxs)(n.p,{children:["I will start with configuring the ",(0,i.jsx)(n.code,{children:"named.conf.options"})," file. Above the existing block of options, I create a new ACL block called ",(0,i.jsx)(n.code,{children:"trusted"}),". This is where I can define a list of clients that I will allow recursive DNS queries from:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano /opt/dns/ns1/named.conf.options  # /etc/bind/named.conf.options\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'acl "trusted" {\r\n        172.24.0.15; # ns1\r\n        172.24.0.16; # ns2\r\n        172.24.0.2;  # host1\r\n        172.24.0.3;  # host2\r\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Now I can edit the options block below and add the private IP address of ",(0,i.jsx)(n.code,{children:"ns1"})," to the ",(0,i.jsx)(n.code,{children:"listen-on"})," ",(0,i.jsx)(n.strong,{children:"port 53"})," directive for IPv4. Below those entries, change the allow-transfer directive to from ",(0,i.jsx)(n.code,{children:"none"})," to the ",(0,i.jsx)(n.code,{children:"ns2"})," private IP address ",(0,i.jsx)(n.code,{children:"172.24.0.16"}),". Also, change allow-query directive from ",(0,i.jsx)(n.code,{children:"localhost"})," to ",(0,i.jsx)(n.code,{children:"trusted"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'options {\r\n    directory "/var/cache/bind";\r\n\r\n    recursion yes;\r\n    listen-on port 53 { 127.0.0.1; 172.24.0.15; };\r\n    #listen-on-v6 port 53 { ::1; };\r\n\r\n    allow-transfer { 172.24.0.16; }; # disable zone transfers by default\r\n\r\n    allow-query { trusted; };  # allows queries from "trusted" clients\r\n\r\n    forwarders {\r\n            8.8.8.8;\r\n            4.4.4.4;\r\n    };\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The above configuration specifies that only the trusted servers will be able to query your DNS server."}),"\n",(0,i.jsx)(n.h4,{id:"namedconflocal",children:"named.conf.local"}),"\n",(0,i.jsxs)(n.p,{children:["Next, I will configure the ",(0,i.jsx)(n.code,{children:"/etc/bind/named.local"})," file, to specify the forward and reverse zones."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nano /opt/dns/ns1/named.conf.local  # /etc/bind/named.conf.local\n"})}),"\n",(0,i.jsxs)(n.p,{children:["First, the ",(0,i.jsx)(n.strong,{children:"Forward Zone"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'zone "dc1.instar.com" {\r\n    type master;\r\n    file "/etc/named/zones/db.dc1.instar.com"; # zone file path\r\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:["And the ",(0,i.jsx)(n.strong,{children:"Reverse Zone"})," (note that the reverse zone name starts with ",(0,i.jsx)(n.code,{children:"24.172"})," which is the octet reversal of ",(0,i.jsx)(n.code,{children:"172.24"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-conf",children:'zone "24.172.in-addr.arpa" {\r\n    type master;\r\n    file "/etc/named/zones/db.172.24";  # 172.24.0.0/16 subnet\r\n    };\n'})}),"\n",(0,i.jsx)(n.p,{children:"If your servers span multiple private subnets but are in the same datacenter, be sure to specify an additional zone and zone file for each subnet."})]})}function h(e={}){const{wrapper:n}={...(0,s.ah)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},603905:(e,n,r)=>{r.d(n,{ah:()=>a});var i=r(667294);function s(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){s(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,i,s=function(e,n){if(null==e)return{};var r,i,s={},t=Object.keys(e);for(i=0;i<t.length;i++)r=t[i],n.indexOf(r)>=0||(s[r]=e[r]);return s}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(i=0;i<t.length;i++)r=t[i],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var d=i.createContext({}),a=function(e){var n=i.useContext(d),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},l={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},h=i.forwardRef((function(e,n){var r=e.components,s=e.mdxType,t=e.originalType,d=e.parentName,h=c(e,["components","mdxType","originalType","parentName"]),u=a(r),f=s,p=u["".concat(d,".").concat(f)]||u[f]||l[f]||t;return r?i.createElement(p,o(o({ref:n},h),{},{components:r})):i.createElement(p,o({ref:n},h))}));h.displayName="MDXCreateElement"},357738:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-bac99ee9472bf0354e396ff811a46d92.jpg"}}]);