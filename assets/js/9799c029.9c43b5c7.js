"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[72837],{227084:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>d,toc:()=>i});var n=t(785893),s=t(603905);const l={sidebar_position:6e3,slug:"2022-09-28",title:"NTS-Service and Authenticated Time Synchronization",authors:"mpolinowski",tags:["LINUX","Security"],description:"Building a client for a time service which uses IETF RFC 8915 called \u201cNetwork Time Security\u201c (NTS)."},c=void 0,d={id:"DevOps/Linux/2022-09-28--nts-client-setup/index",title:"NTS-Service and Authenticated Time Synchronization",description:"Building a client for a time service which uses IETF RFC 8915 called \u201cNetwork Time Security\u201c (NTS).",source:"@site/docs/DevOps/Linux/2022-09-28--nts-client-setup/index.md",sourceDirName:"DevOps/Linux/2022-09-28--nts-client-setup",slug:"/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28",permalink:"/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Linux/2022-09-28--nts-client-setup/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Security",permalink:"/docs/tags/security"}],version:"current",sidebarPosition:6e3,frontMatter:{sidebar_position:6e3,slug:"2022-09-28",title:"NTS-Service and Authenticated Time Synchronization",authors:"mpolinowski",tags:["LINUX","Security"],description:"Building a client for a time service which uses IETF RFC 8915 called \u201cNetwork Time Security\u201c (NTS)."},sidebar:"tutorialSidebar",previous:{title:"Build a Chrony NTS Client from Source",permalink:"/docs/DevOps/Linux/2022-09-29--build-an-chrony-nts-client-from-source/2022-09-29"},next:{title:"Secure Timeserver - NTP with NTS with Docker",permalink:"/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21"}},a={},i=[{value:"Chrony Client",id:"chrony-client",level:2},{value:"Installing Chrony",id:"installing-chrony",level:3},{value:"Configure NTS",id:"configure-nts",level:3},{value:"Verify that NTS is working on Chrony",id:"verify-that-nts-is-working-on-chrony",level:3},{value:"NTPsec Client",id:"ntpsec-client",level:2},{value:"Installing NTPsec",id:"installing-ntpsec",level:3},{value:"Configure NTS",id:"configure-nts-1",level:3},{value:"Verify that NTS is working on NTPsec",id:"verify-that-nts-is-working-on-ntpsec",level:3},{value:"Authentication Keys",id:"authentication-keys",level:2},{value:"Chrony Server Configuration",id:"chrony-server-configuration",level:3},{value:"Chrony Client Configuration",id:"chrony-client-configuration",level:3},{value:"NTPSec Client Configuration (failed)",id:"ntpsec-client-configuration-failed",level:3},{value:"Complete ntpd Client Log",id:"complete-ntpd-client-log",level:3}];function o(e){const r={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.ah)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"TST, Hong Kong",src:t(934636).Z+"",width:"1500",height:"517"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"#chrony-client",children:"Chrony Client"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#installing-chrony",children:"Installing Chrony"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#configure-nts",children:"Configure NTS"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#verify-that-nts-is-working-on-chrony",children:"Verify that NTS is working on Chrony"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"#ntpsec-client",children:"NTPsec Client"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#installing-ntpsec",children:"Installing NTPsec"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#configure-nts-1",children:"Configure NTS"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#verify-that-nts-is-working-on-ntpsec",children:"Verify that NTS is working on NTPsec"})}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.a,{href:"#authentication-keys",children:"Authentication Keys"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#chrony-server-configuration",children:"Chrony Server Configuration"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#chrony-client-configuration",children:"Chrony Client Configuration"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#ntpsec-client-configuration-failed",children:"NTPSec Client Configuration (failed)"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"#complete-ntpd-client-log",children:"Complete ntpd Client Log"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["I did ",(0,n.jsx)(r.a,{href:"/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21",children:"setup a Chrony NTP/NTS Server"})," and ",(0,n.jsx)(r.a,{href:"/docs/DevOps/Hashicorp/2022-09-22--nomad-nts-timeserver/2022-09-22",children:"deployed it using Nomad"}),". Now I need a client to connect to it using NTS. Here I have the option to either use Chrony or NTPSec."]}),"\n",(0,n.jsx)(r.h2,{id:"chrony-client",children:"Chrony Client"}),"\n",(0,n.jsx)(r.p,{children:"By default Chrony is not installed on Debian but it can be installed using Aptitude."}),"\n",(0,n.jsx)(r.h3,{id:"installing-chrony",children:"Installing Chrony"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"apt install chrony\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Note"}),": If you have another NTP client running on your system it will be deactivated once you install Chrony (e.g. ",(0,n.jsx)(r.code,{children:"systemd-timesyncd"})," or ",(0,n.jsx)(r.code,{children:"ntpsec"}),")."]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Verify Chrony works as an NTP client:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chronyc sources\r\n\r\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \r\n===============================================================================\r\n^* server1a.meinberg.de          2   6    37     3   -558us[ -446us] +/-   24ms\r\n^+ lucy.thehomeofanime.de        2   6    37     3   +729us[ +842us] +/-   31ms\r\n^+ 2a01:4f8:241:56c6:1::123      2   6    37     3   -417us[ -304us] +/-   40ms\r\n^+ ns1.idfnet.net                2   6    37     2   -303us[ -303us] +/-   39ms\n"})}),"\n",(0,n.jsx)(r.h3,{id:"configure-nts",children:"Configure NTS"}),"\n",(0,n.jsxs)(r.p,{children:["Edit the configuration file ",(0,n.jsx)(r.code,{children:"/etc/chrony/chrony.conf"})," and replace the existing NTP servers with your personal NTS server. First comment out any lines starting with one of the words ",(0,n.jsx)(r.code,{children:"pool"}),", ",(0,n.jsx)(r.code,{children:"server"}),", ",(0,n.jsx)(r.code,{children:"source"})," or ",(0,n.jsx)(r.code,{children:"sourcedir"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# Use Debian vendor zone.\r\n# pool 2.debian.pool.ntp.org iburst\r\n\r\n# Use time sources from DHCP.\r\n# sourcedir /run/chrony-dhcp\r\n\r\n# Use NTP sources found in /etc/chrony/sources.d.\r\n# sourcedir /etc/chrony/sources.d\n"})}),"\n",(0,n.jsxs)(r.p,{children:["You can enable these sources later, but comment them out for the moment since it will make it easier to see if the NTS servers are working. Then add your personal NTS server. Note that the configuration line should contain ",(0,n.jsx)(r.code,{children:"nts"})," which says that it uses the NTS protocol:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"server my.nts-server.com nts iburst\n"})}),"\n",(0,n.jsx)(r.p,{children:"Save the file and restart the Chrony service by running this command:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"systemctl restart chrony\n"})}),"\n",(0,n.jsx)(r.h3,{id:"verify-that-nts-is-working-on-chrony",children:"Verify that NTS is working on Chrony"}),"\n",(0,n.jsx)(r.p,{children:"Now verify that NTS is working with Chrony - first we can check the service status. It will show you the latest log output containing the source server:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"systemctl status chronyd    \r\n\u25cf chrony.service - chrony, an NTP client/server\r\n     Loaded: loaded (/lib/systemd/system/chrony.service; enabled; vendor preset: enabled)\r\n     Active: active (running) since Fri 2022-09-30 11:03:44 UTC; 11s ago\r\n       Docs: man:chronyd(8)\r\n             man:chronyc(1)\r\n             man:chrony.conf(5)\r\n    Process: 996854 ExecStart=/usr/sbin/chronyd $DAEMON_OPTS (code=exited, status=0/SUCCESS)\r\n   Main PID: 996856 (chronyd)\r\n      Tasks: 2 (limit: 2275)\r\n     Memory: 3.1M\r\n        CPU: 44ms\r\n     CGroup: /system.slice/chrony.service\r\n             \u251c\u2500996856 /usr/sbin/chronyd -F 1\r\n             \u2514\u2500996857 /usr/sbin/chronyd -F 1\r\n\r\nSep 30 11:03:44 chrony systemd[1]: Starting chrony, an NTP client/server...\r\nSep 30 11:03:44 chrony chronyd[996856]: chronyd version 4.0 starting (+CMDMON +NTP +REFCLOCK +RTC +PRIVDROP +SCFILTER +SI>\r\nSep 30 11:03:44 chrony chronyd[996856]: Frequency -40.688 +/- 0.247 ppm read from /var/lib/chrony/chrony.drift\r\nSep 30 11:03:44 chrony chronyd[996856]: Using right/UTC timezone to obtain leap second data\r\nSep 30 11:03:44 chrony chronyd[996856]: Loaded seccomp filter\r\nSep 30 11:03:44 chrony systemd[1]: Started chrony, an NTP client/server.\r\nSep 30 11:03:49 chrony chronyd[996856]: Selected source my.server.ip (my.nts-server.com)\r\nSep 30 11:03:49 chrony chronyd[996856]: System clock TAI offset set to 37 seconds\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Or just check the output from ",(0,n.jsx)(r.code,{children:"chronyc"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chronyc sources\r\n\r\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \r\n===============================================================================\r\n^* static.my.server.ip.in.reverse.cli>     2   6    17    23   +351us[ +592us] +/- 6891us\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["A leading ",(0,n.jsx)(r.code,{children:"^"})," means its a server, ",(0,n.jsx)(r.code,{children:"="})," means peer, and ",(0,n.jsx)(r.code,{children:"#"})," means local clock. The second column is what tells you if the server is being used. the ",(0,n.jsx)(r.code,{children:"+"})," tells you that the source is being used. A ",(0,n.jsx)(r.code,{children:"*"})," indicates the current best source which is being used, and a ",(0,n.jsx)(r.code,{children:"-"})," means its a good source, but is not currently selected. Source state ",(0,n.jsx)(r.code,{children:"~"})," means that the time is too variable."]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chronyc tracking\r\n\r\nReference ID    : 9F459319 (static.my.server.ip.in.reverse.clients.your-server.com)\r\nStratum         : 3\r\nRef time (UTC)  : Sat Oct 01 10:36:30 2022\r\nSystem time     : 0.000158212 seconds fast of NTP time\r\nLast offset     : -0.272258192 seconds\r\nRMS offset      : 0.129027337 seconds\r\nFrequency       : 310.921 ppm fast\r\nResidual freq   : -1410.939 ppm\r\nSkew            : 122.050 ppm\r\nRoot delay      : 0.014122445 seconds\r\nRoot dispersion : 0.208602116 seconds\r\nUpdate interval : 64.7 seconds\r\nLeap status     : Normal\n"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Reference ID is the value indicates the name and ID of the NTP server to which the system\u2019s time is currently synchronized."}),"\n",(0,n.jsx)(r.li,{children:"Stratum specifies the number of hops in servers level to the NTP hierarchy."}),"\n",(0,n.jsx)(r.li,{children:"Ref time is the time per UTC when the last measurement from the reference source was processed."}),"\n",(0,n.jsx)(r.li,{children:"System time denotes the amount of delay in a systems clock from a synchronized server."}),"\n",(0,n.jsx)(r.li,{children:"Last offset is the estimated time offset since the last clock update."}),"\n",(0,n.jsx)(r.li,{children:"RMS Offset denotes the long-term average of the time offset"}),"\n",(0,n.jsx)(r.li,{children:"Frequency is the value the servers clock would be off if chronyd was not correcting it. This value is measured in ppm (parts per million)"}),"\n",(0,n.jsx)(r.li,{children:"Residual freq indicates the measurement of difference in between the next-level Stratum source and the current frequency being used."}),"\n",(0,n.jsx)(r.li,{children:"Skew is the estimate variance of error in the frequency measured in parts per million"}),"\n",(0,n.jsx)(r.li,{children:"Root delay is the total time of delay within the network path to the higher level stratum computer from which the local server is being synced."}),"\n",(0,n.jsx)(r.li,{children:"Root dispersion is part of the equation that calculates the value derived from the root delay and root dispersion as reported by the tracking command"}),"\n",(0,n.jsx)(r.li,{children:"Update interval is the distance between the previous two clock updates."}),"\n",(0,n.jsxs)(r.li,{children:["Leap status is the value which can have one of the following settings","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"normal"}),"\n",(0,n.jsx)(r.li,{children:"insert second"}),"\n",(0,n.jsx)(r.li,{children:"delete second"}),"\n",(0,n.jsx)(r.li,{children:"not synchronized."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["For service tracking add an alias to your ",(0,n.jsx)(r.code,{children:".bashrc"})," like ",(0,n.jsx)(r.code,{children:"alias showtime='chronyc sourcestats; chronyc -n sources; chronyc -n tracking'"})]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"ntpsec-client",children:"NTPsec Client"}),"\n",(0,n.jsxs)(r.p,{children:["The NTS version of ",(0,n.jsx)(r.code,{children:"ntpd"})," ",(0,n.jsx)(r.strong,{children:"NTPSec"})," is not installed on Debian but it can be installed using Aptitude."]}),"\n",(0,n.jsx)(r.h3,{id:"installing-ntpsec",children:"Installing NTPsec"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"apt install ntpsec\n"})}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Note"}),": If you have another NTP client running on your system it will be deactivated once you install NTPsec (e.g. ",(0,n.jsx)(r.code,{children:"systemd-timesyncd"})," or ",(0,n.jsx)(r.code,{children:"chrony"}),")."]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"Verify NTPsec works as an NTP client:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ntpq -p\r\n\r\n     remote                                   refid      st t when poll reach   delay   offset   jitter\r\n=======================================================================================================\r\n 0.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001\r\n 1.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001\r\n 2.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001\r\n 3.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001\n"})}),"\n",(0,n.jsx)(r.h3,{id:"configure-nts-1",children:"Configure NTS"}),"\n",(0,n.jsxs)(r.p,{children:["Edit the configuration file ",(0,n.jsx)(r.code,{children:"/etc/ntpsec/ntp.conf"})," and replace the existing NTP servers with your own NTS servers. First comment out any lines starting with one of the words ",(0,n.jsx)(r.code,{children:"pool"})," or ",(0,n.jsx)(r.code,{children:"server"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# Public NTP servers supporting Network Time Security:\r\n# server time.cloudflare.com nts\r\n\r\n# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will\r\n# pick a different set every time it starts up.  Please consider joining the\r\n# pool: <https://www.pool.ntp.org/join.html>\r\n# pool 0.debian.pool.ntp.org iburst\r\n# pool 1.debian.pool.ntp.org iburst\r\n# pool 2.debian.pool.ntp.org iburst\r\n# pool 3.debian.pool.ntp.org iburst\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Then add your own NTS server. Note that the configuration line should contain ",(0,n.jsx)(r.code,{children:"nts"})," which says that it uses the NTS protocol:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"server my.nts-server.com nts iburst\n"})}),"\n",(0,n.jsx)(r.p,{children:"Save the file and restart the Chrony service by running this command:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"systemctl restart ntpsec\n"})}),"\n",(0,n.jsx)(r.h3,{id:"verify-that-nts-is-working-on-ntpsec",children:"Verify that NTS is working on NTPsec"}),"\n",(0,n.jsx)(r.p,{children:"The service comes up now using my server:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"systemctl status ntpsec\r\n\r\n\u25cf ntpsec.service - Network Time Service\r\n     Loaded: loaded (/lib/systemd/system/ntpsec.service; enabled; vendor preset: enabled)\r\n     Active: active (running) since Fri 2022-09-30 13:26:59 CEST; 11s ago\r\n       Docs: man:ntpd(8)\r\n    Process: 1516451 ExecStart=/usr/libexec/ntpsec/ntp-systemd-wrapper (code=exited, status=0/SUCCESS)\r\n   Main PID: 1516454 (ntpd)\r\n      Tasks: 1 (limit: 2276)\r\n     Memory: 9.4M\r\n        CPU: 36ms\r\n     CGroup: /system.slice/ntpsec.service\r\n             \u2514\u25001516454 /usr/sbin/ntpd -p /run/ntpd.pid -c /etc/ntpsec/ntp.conf -g -N -u ntpsec:ntpsec\r\n\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate subject name: /CN=my.nts-server.com\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate issuer name: /C=US/O=Lets Encrypt/CN=R3\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate is valid.\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: Good ALPN from my.nts-server.com\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: read 848 bytes\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: Got 8 cookies, length 100, aead=15.\r\nSep 30 13:27:00 Nomad ntpd[1516454]: NTSc: NTS-KE req to my.nts-server.com took 0.088 sec, OK\r\nSep 30 13:27:00 Nomad ntpd[1516454]: DNS: dns_check: processing my.nts-server.com, 1, 21901\r\nSep 30 13:27:00 Nomad ntpd[1516454]: DNS: Server taking: my.server.ip\r\nSep 30 13:27:00 Nomad ntpd[1516454]: DNS: dns_take_status: my.nts-server.com=>good, 0\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Check the output from ",(0,n.jsx)(r.code,{children:"ntpq"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ntpq -p \r\n     remote                                             refid      st t when poll reach   delay   offset   jitter\r\n=================================================================================================================\r\n+static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 8   17   64   17   4.3198  -5.5261  14.3994\n"})}),"\n",(0,n.jsx)(r.h2,{id:"authentication-keys",children:"Authentication Keys"}),"\n",(0,n.jsx)(r.h3,{id:"chrony-server-configuration",children:"Chrony Server Configuration"}),"\n",(0,n.jsxs)(r.p,{children:["When I set up the ",(0,n.jsx)(r.a,{href:"/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21",children:"Chrony NTP/NTS Server"})," I did not consider client authentication. So currently every device with a NTS client can use the server. To limit access to our server we can create a ",(0,n.jsx)(r.em,{children:"pre-shared authentication key"})," that we then have to add to our server as well as too all clients we want to connect. Both ",(0,n.jsx)(r.strong,{children:"Chrony"})," and ",(0,n.jsx)(r.strong,{children:"NTPSec"})," offer a keygen client that we can use to create our pre-shared key. I am going to generate the key using Chrony. To a ",(0,n.jsx)(r.em,{children:"512-bit SHA1"})," key with the key number of ",(0,n.jsx)(r.code,{children:"666"})," run the following command (inside your Chrony Server container or on your Chrony client):"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chronyc keygen 666 SHA1 512\n"})}),"\n",(0,n.jsxs)(r.p,{children:["This will output a secure hash that we will have to copy into a file ",(0,n.jsx)(r.code,{children:"assets/chrony.keys"})," in the ",(0,n.jsx)(r.a,{href:"https://github.com/mpolinowski/docker-ntp",children:"Chrony repository"}),":"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA\n"})}),"\n",(0,n.jsxs)(r.p,{children:["I can add this to my ",(0,n.jsx)(r.a,{href:"https://github.com/mpolinowski/docker-ntp/blob/main/Dockerfile",children:"Chrony Dockerfile"})," to copy the keyfile into the Chrony container:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yml",children:"# add chrony keys generated with `chronyc keygen 666 SHA1 512`\r\nCOPY assets/chrony.keys /opt/chrony.keys\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Now I have to modify the ",(0,n.jsx)(r.a,{href:"https://github.com/mpolinowski/docker-ntp/blob/main/assets/startup.sh",children:"start-up script"})," I am using inside the container to generate the Chrony configuration file and add the ",(0,n.jsx)(r.code,{children:"keyfile"})," location:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:'{\r\n  echo\r\n  echo "driftfile /var/lib/chrony/chrony.drift"\r\n  echo "makestep 0.1 3"\r\n  echo "rtcsync"\r\n  echo\r\n  echo "ntsserverkey /opt/letsencrypt/live/my.server.com/privkey.pem"\r\n  echo "ntsservercert /opt/letsencrypt/live/my.server.com/fullchain.pem"\r\n  echo "keyfile /opt/chrony.keys"\r\n  echo "ntsprocesses 3"\r\n  echo "maxntsconnections 512"\r\n  echo "ntsdumpdir /var/lib/chrony"\r\n  echo\r\n  echo "allow all"\r\n} >> ${CHRONY_CONF_FILE}\n'})}),"\n",(0,n.jsxs)(r.p,{children:["Now I can ",(0,n.jsx)(r.a,{href:"https://github.com/mpolinowski/docker-ntp#from-a-local-command-line",children:"rebuild"})," my container and ",(0,n.jsx)(r.a,{href:"/docs/DevOps/Hashicorp/2022-09-24--nomad-nginx-ingress/2022-09-24",children:"re-deploy it using Nomad"}),"."]}),"\n",(0,n.jsx)(r.p,{children:"Now my clients should no longer be able to use the timeserver they are configured to use:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# BEFORE\r\nntpq -p\r\n     remote                                   refid      st t when poll reach   delay   offset   jitter\r\n=======================================================================================================\r\n+static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 5  202   64  370   3.9457  10.4121 287.4892\r\n# AFTER\r\nntpq -p\r\n     remote                                   refid      st t when poll reach   delay   offset   jitter\r\n=======================================================================================================\r\n static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 0  585   64    0   0.0000   0.0000 298.1516\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"# BEFORE\r\nchronyc sources\r\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \r\n===============================================================================\r\n^* static.my.server.ip.in.reverse.cli>     2   6    17    23   +351us[ +592us] +/- 6891us\r\n# AFTER\r\nchronyc sources\r\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \r\n===============================================================================\r\n^? static.my.server.ip.in.reverse.cli>     0   8     0     -     +0ns[   +0ns] +/-    0ns\n"})}),"\n",(0,n.jsx)(r.p,{children:"Now let's fix that problem :)"}),"\n",(0,n.jsx)(r.h3,{id:"chrony-client-configuration",children:"Chrony Client Configuration"}),"\n",(0,n.jsx)(r.p,{children:"To add the keyfile to our Chrony client we first have to add it's location to the configuration file:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"nano /etc/chrony/chrony.conf\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"keyfile /etc/chrony/chrony.keys\n"})}),"\n",(0,n.jsxs)(r.p,{children:["And then create the ",(0,n.jsx)(r.code,{children:"chrony.keys"})," file in the specified location:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA\n"})}),"\n",(0,n.jsx)(r.p,{children:"And make sure that the file is readable:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chmod u=rw,g=r,o=r /etc/chrony/chrony.keys\n"})}),"\n",(0,n.jsx)(r.p,{children:"Restart the service:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"service chrony restart\n"})}),"\n",(0,n.jsx)(r.p,{children:"And we are back at working conditions:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chronyc sources\r\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \r\n===============================================================================\r\n^* static.my.server.ip.in.reverse.cli>     3   6    17    49  -1866us[  -38ms] +/- 3505us\n"})}),"\n",(0,n.jsx)(r.h3,{id:"ntpsec-client-configuration-failed",children:"NTPSec Client Configuration (failed)"}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Update"})," the NTPSec client runs well with a Chrony server as long as I don't add the key authentication. I will just stick with a Chrony Server/Client combo. THere don't seem to be any issues."]}),"\n"]}),"\n",(0,n.jsxs)(r.p,{children:["For the NTPSec client we have to create the keyfile in ",(0,n.jsx)(r.code,{children:"/var/lib/ntpsec/nts-keys/ntp.keys"})," and add the same content as with the ",(0,n.jsx)(r.code,{children:"chrony.keys"})," file before. And point out the location in the configuration file - which is a little bit more verbose here. You additionally have to select the key number which I set to be ",(0,n.jsx)(r.code,{children:"666"})," above and also assign the key to the server you want it to be uses with..."]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Update"})," as son as I added the Chrony key I could no longer connect to my server... I then ran the NTPSec included key generator ",(0,n.jsx)(r.code,{children:"ntpkeygen"})," which generates a list of keys."]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Update Update"})," adding the AES key was not necessary after all I just had to remove the ",(0,n.jsx)(r.code,{children:"HEX:"})," in front of the Chrony key and it was accepted. So, just keep the Chrony key ~"]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"cat ntp.keys\r\n\r\n# Sat Oct  1 14:43:23 2022\r\n 1 AES g&$cpQDr:_eLspU|\r\n \r\n ...\r\n\r\n 19 AES a09a2bf2f05a42f16372dbb7fc419782\r\n 20 AES 552b05b5536833d5a89ec83767f268c6\n"})}),"\n",(0,n.jsxs)(r.p,{children:["So I updated ",(0,n.jsx)(r.code,{children:"nano /var/lib/ntpsec/nts-keys/ntp.keys"})," to include one of those keys:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"19 AES a09a2bf2f05a42f16372dbb7fc419782\r\n666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA\n"})}),"\n",(0,n.jsxs)(r.p,{children:["And also added them to the ",(0,n.jsx)(r.code,{children:"chrony.keys"})," file of my Chrony server."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"chmod u=rw,g=r,o=r /var/lib/ntpsec/nts-keys/ntp.keys\r\nnano /etc/ntpsec/ntp.conf\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"keys /var/lib/ntpsec/nts-keys/ntp.keys\r\ntrustedkey 19\r\ncontrolkey 19\r\nrequestkey 19\r\n\r\n...\r\n\r\nserver my.server.com nts iburst key 19\n"})}),"\n",(0,n.jsx)(r.p,{children:"But I am still not getting a connection:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ntpq -p\r\n\r\n     remote                                   refid      st t when poll reach   delay   offset   jitter\r\n=======================================================================================================\r\n static.my.server.com.clients.your-serve .NTS.           16 7    -   64    0   0.0000   0.0000   0.0001\n"})}),"\n",(0,n.jsx)(r.p,{children:"The client request are send but the server does not seem to reply:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"ntpq -c nts\r\n\r\nNTS client sends:            7\r\nNTS client recvs good:       0\r\nNTS client recvs w error:    0\r\nNTS server recvs good:       0\r\nNTS server recvs w error:    0\r\nNTS server sends:            0\r\nNTS make cookies:            0\r\nNTS decode cookies:          0\r\nNTS decode cookies old:      0\r\nNTS decode cookies too old:  0\r\nNTS decode cookies error:    0\r\nNTS KE probes good:          1\r\nNTS KE probes_bad:           0\r\nNTS KE serves good:          0\r\nNTS KE serves_bad:           0\n"})}),"\n",(0,n.jsx)(r.p,{children:"Let's start the client manually and see what is going on:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"service ntpsec stop\r\n/usr/sbin/ntpd -n -d\n"})}),"\n",(0,n.jsxs)(r.p,{children:["First of all I can see that the Chrony key is ",(0,n.jsx)(r.a,{href:"https://github.com/ntpsec/ntpsec/blob/master/libntp/authreadkeys.c",children:"not accepted"})," - but NTPSec seems to add the additional AES key:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"2022-10-02T09:03:39 ntpd[19852]: Found 1 trusted keys.\r\n2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys\r\n2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: key 666 truncated to 64 bytes\r\n2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: invalid hex digit for key 666\r\n2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: added 1 keys\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Interesting so the key ",(0,n.jsx)(r.code,{children:"666"})," contains illegal characters. Let's remove the ",(0,n.jsx)(r.code,{children:"HEX:"})," that Chrony sets in front of the key and see what happens when I switch the NTPSec configuration back from using key 19 to key 666:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"19 AES a09a2bf2f05a42f16372dbb7fc419782\r\n666 SHA1 41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA\n"})}),"\n",(0,n.jsx)(r.p,{children:"Excellent, NTPSec accepts both keys and is now using the original Chrony key as trusted:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"2022-10-02T09:12:35 ntpd[20300]: Found 1 trusted keys.\r\n2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys\r\n2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: key 666 truncated to 64 bytes\r\n2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: digest for key 666, SHA512 will be truncated.\r\n2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: added 2 keys\n"})}),"\n",(0,n.jsxs)(r.p,{children:["But scrolling down the ",(0,n.jsx)(r.a,{href:"#complete-ntpd-log",children:"ntpd Log"})," there are only a lot of:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"select() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\n"})}),"\n",(0,n.jsx)(r.p,{children:"Which is where I reached the realm darkness, full of terrors. Where not even the Lord of Light may help you to chase away the shadows..."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"NTS-Service and Authenticated Time Synchronization",src:t(306723).Z+"",width:"1019",height:"420"})}),"\n",(0,n.jsx)(r.h3,{id:"complete-ntpd-client-log",children:"Complete ntpd Client Log"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"/usr/sbin/ntpd -n -d \r\n\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: ntpd ntpsec-1.2.0 2021-06-17T05:15:04Z: Starting\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: Command line: /usr/sbin/ntpd -n -d\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: precision = 0.088 usec (-23)\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: successfully locked into RAM\r\n2022-10-02T09:14:00 ntpd[20412]: CONFIG: readconfig: parsing file: /etc/ntpsec/ntp.conf\r\n2022-10-02T09:14:00 ntpd[20412]: CONFIG: requestkey is a no-op because ntpdc has been removed.\r\nFinished Parsing!!\r\n2022-10-02T09:14:00 ntpd[20412]: Found 1 trusted keys.\r\n2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys\r\n2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: key 666 truncated to 64 bytes\r\n2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: digest for key 666, SHA512 will be truncated.\r\n2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: added 2 keys\r\n2022-10-02T09:14:00 ntpd[20412]: CONFIG: restrict nopeer ignored\r\nrestrict: op 1 addr 0.0.0.0 mask 0.0.0.0 mflags 00000000 flags 000004e0\r\nrestrict: op 1 addr :: mask :: mflags 00000000 flags 000004e0\r\nrestrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00000000 flags 00000000\r\nrestrict: op 1 addr ::1 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00000000 flags 00000000\r\n2022-10-02T09:14:00 ntpd[20412]: CLOCK: leapsecond file ('/usr/share/zoneinfo/leap-seconds.list'): good hash signature\r\n2022-10-02T09:14:00 ntpd[20412]: CLOCK: leapsecond file ('/usr/share/zoneinfo/leap-seconds.list'): loaded, expire=2022-12-28T00:00Z last=2017-01-01T00:00Z ofs=37\r\nevent at 0 0.0.0.0 c01e 0e TAI 37 leap 2017-01-01T00:00Z expires 2022-12-28T00:00Z\r\nmove_fd: estimated max descriptors: 1024, initial socket boundary: 16\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: Using SO_TIMESTAMPNS\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listen and drop on 0 v6wildcard [::]:123\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listen and drop on 1 v4wildcard 0.0.0.0:123\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 2 lo 127.0.0.1:123\r\nrestrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00003000 flags 00000001\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 3 eth0 my.client-ip:123\r\nrestrict: op 1 addr my.client-ip mask 255.255.255.255 mflags 00003000 flags 00000001\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 4 lo [::1]:123\r\n2022-10-02T09:14:00 ntpd[20412]: IO: Listening on routing socket on fd #23 for interface updates\r\npeer_clear: at 0 next 1 associd 17767 refid NTS\r\nevent at 0 my.ntp-server.com c011 81 mobilize assoc 17767\r\nnewpeer: <null>->0.0.0.0 mode 3 vers 4 poll 6 10 flags 0x21901 0x1 mode 0 key 0000029a\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: MRU 10922 entries, 13 hash bits, 65536 bytes\r\nevent at 0 0.0.0.0 c01d 0d kern kernel time sync enabled\r\nevent at 0 0.0.0.0 c012 02 freq_set kernel 0.000000 PPM\r\nevent at 0 0.0.0.0 c016 06 restart\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: Built with OpenSSL 1.1.1k  25 Mar 2021, 101010bf\r\n2022-10-02T09:14:00 ntpd[20412]: INIT: Running with OpenSSL 1.1.1n  15 Mar 2022, 101010ef\r\n2022-10-02T09:14:00 ntpd[20412]: NTSc: Using system default root certificates.\r\n2022-10-02T09:14:00 ntpd[20412]: statistics directory /var/log/ntpsec/ does not exist or is unwriteable, error No such file or directory\r\nselect() returned -1: Interrupted system call\r\n2022-10-02T09:14:01 ntpd[20412]: DNS: dns_probe: my.ntp-server.com, cast_flags:1, flags:21901\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: DNS lookup of my.ntp-server.com took 0.016 sec\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: connecting to my.ntp-server.com:4460 => my.server-ip:4460\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: set cert host: my.ntp-server.com\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: Using TLSv1.3, TLS_AES_256_GCM_SHA384 (256)\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate subject name: /CN=my.ntp-server.com\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate issuer name: /C=US/O=Lets Encrypt/CN=R3\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate is valid.\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: Good ALPN from my.ntp-server.com\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: read 848 bytes\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: Got 8 cookies, length 100, aead=15.\r\n2022-10-02T09:14:01 ntpd[20412]: NTSc: NTS-KE req to my.ntp-server.com took 0.087 sec, OK\r\nselect() returned -1: Interrupted system call\r\n2022-10-02T09:14:01 ntpd[20412]: DNS: dns_check: processing my.ntp-server.com, 1, 21901\r\n2022-10-02T09:14:01 ntpd[20412]: DNS: Server taking: my.server-ip\r\ntransmit: at 1 my.client-ip->my.server-ip mode 3 keyid 0000029a len 228\r\n2022-10-02T09:14:01 ntpd[20412]: DNS: dns_take_status: my.ntp-server.com=>good, 0\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\ntransmit: at 66 my.client-ip->my.server-ip mode 3 keyid 0000029a len 332\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\ntransmit: at 133 my.client-ip->my.server-ip mode 3 keyid 0000029a len 436\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\ntransmit: at 199 my.client-ip->my.server-ip mode 3 keyid 0000029a len 540\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\ntransmit: at 266 my.client-ip->my.server-ip mode 3 keyid 0000029a len 644\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\nselect() returned -1: Interrupted system call\r\n^Cselect() returned -1: Interrupted system call\r\n2022-10-02T09:19:00 ntpd[20412]: ERR: ntpd exiting on signal 2 (Interrupt)\r\nevent at 299 my.server-ip c012 82 demobilize assoc 17767\r\n2022-10-02T09:19:00 ntpd[20412]: PROTO: my.server-ip unlink local addr my.client-ip -> <null>\r\nevent at 299 0.0.0.0 c01d 0d kern kernel time sync disabled\n"})})]})}function u(e={}){const{wrapper:r}={...(0,s.ah)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},603905:(e,r,t)=>{t.d(r,{ah:()=>i});var n=t(667294);function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){s(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function d(e,r){if(null==e)return{};var t,n,s=function(e,r){if(null==e)return{};var t,n,s={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(s[t]=e[t]);return s}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var a=n.createContext({}),i=function(e){var r=n.useContext(a),t=r;return e&&(t="function"==typeof e?e(r):c(c({},r),e)),t},o={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},u=n.forwardRef((function(e,r){var t=e.components,s=e.mdxType,l=e.originalType,a=e.parentName,u=d(e,["components","mdxType","originalType","parentName"]),p=i(t),h=s,y=p["".concat(a,".").concat(h)]||p[h]||o[h]||l;return t?n.createElement(y,c(c({ref:r},u),{},{components:t})):n.createElement(y,c({ref:r},u))}));u.displayName="MDXCreateElement"},306723:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/nts-client-setup_01-eb3c03a7e8019dd766cd2fc490aa228c.png"},934636:(e,r,t)=>{t.d(r,{Z:()=>n});const n=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-ec671595d585b88a85b017a7908fb619.jpg"}}]);