"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[48077],{951687:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var t=n(785893),i=n(603905);const o={sidebar_position:6010,slug:"2021-10-12",title:"Setting up Wordpress with Traefik v2",authors:"mpolinowski",tags:["Traefik","Linux","Docker"]},a=void 0,s={id:"DevOps/Provisioning/2021-10-12--traefik-third-attempt/index",title:"Setting up Wordpress with Traefik v2",description:"Central, Hong Kong",source:"@site/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/index.md",sourceDirName:"DevOps/Provisioning/2021-10-12--traefik-third-attempt",slug:"/DevOps/Provisioning/2021-10-12--traefik-third-attempt/2021-10-12",permalink:"/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/2021-10-12",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2021-10-12--traefik-third-attempt/index.md",tags:[{label:"Traefik",permalink:"/docs/tags/traefik"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:6010,frontMatter:{sidebar_position:6010,slug:"2021-10-12",title:"Setting up Wordpress with Traefik v2",authors:"mpolinowski",tags:["Traefik","Linux","Docker"]},sidebar:"tutorialSidebar",previous:{title:"Matrix Secure Messaging",permalink:"/docs/DevOps/Provisioning/2021-10-25--matrix-secure-messaging/2021-10-25"},next:{title:"Traefik v2 Webproxy Configuration - 2nd Attempt",permalink:"/docs/DevOps/Provisioning/2021-10-12--traefik-second-attempt/2021-10-12"}},l={},c=[{value:"Preparation",id:"preparation",level:2},{value:"Folders and Files",id:"folders-and-files",level:3},{value:"Proxy Network",id:"proxy-network",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Dynamic Configuration",id:"dynamic-configuration",level:3}];function d(e){const r={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.ah)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{alt:"Central, Hong Kong",src:n(811661).Z+"",width:"1500",height:"473"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"This guide is incomplete... Traefik, atm unfortunately, does not match my workflow. I am running into a lot of issues with the official documentation as well as the countless tutorials out there. I will put this project on hold until I figured it out."}),"\n"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"#preparation",children:"Preparation"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#folders-and-files",children:"Folders and Files"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#proxy-network",children:"Proxy Network"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"#configuration",children:"Configuration"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#docker-compose",children:"Docker Compose"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"#dynamic-configuration",children:"Dynamic Configuration"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"preparation",children:"Preparation"}),"\n",(0,t.jsx)(r.h3,{id:"folders-and-files",children:"Folders and Files"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"mkdir -p /opt/traefik/{letsencrypt,config,db,wp}\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"touch /opt/traefik/traefik.log\n"})}),"\n",(0,t.jsx)(r.h3,{id:"proxy-network",children:"Proxy Network"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"docker network create --gateway 192.168.144.1 --subnet 192.168.144.0/24 traefik_proxy\n"})}),"\n",(0,t.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://gist.github.com/Mau5Machine",children:"Configuration Files by @Mau5Machine"})}),"\n",(0,t.jsx)(r.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:"/opt/traefik/docker-compose.yml"})}),"\n",(0,t.jsxs)(r.p,{children:["Instead of using a YML or TOML file and file provider to link it, we will add all ",(0,t.jsx)(r.strong,{children:"Static Configuration"})," directly to the Docker Compose file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yml",children:'version: "3.3"\r\n\r\nservices:\r\n  ################################################\r\n  ####        Traefik Proxy Setup           #####\r\n  ###############################################\r\n  traefik:\r\n    image: traefik:v2.5\r\n    restart: always\r\n    container_name: traefik\r\n    ports:\r\n      - "80:80" # <== http\r\n      - "8080:8080" # <== :8080 is where the dashboard runs on\r\n      - "443:443" # <== https\r\n    command:\r\n    #### These are the CLI commands that will configure Traefik and tell it how to work! ####\r\n      ## API Settings - https://docs.traefik.io/operations/api/, endpoints - https://docs.traefik.io/operations/api/#endpoints ##\r\n      - --api.insecure=true # <== Enabling insecure api, NOT RECOMMENDED FOR PRODUCTION\r\n      - --api.dashboard=true # <== Enabling the dashboard to view services, middlewares, routers, etc...\r\n      - --api.debug=true # <== Enabling additional endpoints for debugging and profiling\r\n      ## Log Settings (options: ERROR, DEBUG, PANIC, FATAL, WARN, INFO) - https://docs.traefik.io/observability/logs/ ##\r\n      - --log.level=DEBUG # <== Setting the level of the logs from traefik\r\n      ## Provider Settings - https://docs.traefik.io/providers/docker/#provider-configuration ##\r\n      - --providers.docker=true # <== Enabling docker as the provider for traefik\r\n      - --providers.docker.exposedbydefault=false # <== Don\'t expose every container to traefik, only expose enabled ones\r\n      - --providers.file.filename=/dynamic.yaml # <== Referring to a dynamic configuration file\r\n      - --providers.docker.network=web # <== Operate on the docker network named web\r\n      ## Entrypoints Settings - https://docs.traefik.io/routing/entrypoints/#configuration ##\r\n      - --entrypoints.web.address=:80 # <== Defining an entrypoint for port :80 named web\r\n      - --entrypoints.web-secured.address=:443 # <== Defining an entrypoint for https on port :443 named web-secured\r\n      ## Certificate Settings (Let\'s Encrypt) -  https://docs.traefik.io/https/acme/#configuration-examples ##\r\n      - --certificatesresolvers.mytlschallenge.acme.tlschallenge=true # <== Enable TLS-ALPN-01 to generate and renew ACME certs\r\n      - --certificatesresolvers.mytlschallenge.acme.email=mpolinowski@gmail.com # <== Setting email for certs\r\n      - --certificatesresolvers.mytlschallenge.acme.storage=/letsencrypt/acme.json # <== Defining acme file to store cert information\r\n    volumes:\r\n      - /opt/traefik/letsencrypt:/letsencrypt # <== Volume for certs (TLS)\r\n      - /var/run/docker.sock:/var/run/docker.sock # <== Volume for docker admin\r\n      - /opt/traefik/config/dynamic.yml:/dynamic.yml # <== Volume for dynamic conf file, **ref: line 27\r\n    networks:\r\n      - web # <== Placing traefik on the network named web, to access containers on this network\r\n    labels:\r\n    #### Labels define the behaviour and rules of the traefik proxy for this container ####\r\n      - "traefik.enable=true" # <== Enable traefik on itself to view dashboard and assign subdomain to view it\r\n      - "traefik.http.routers.api.rule=Host(`monitor.example.com`)" # <== Setting the domain for the dashboard\r\n      - "traefik.http.routers.api.service=api@internal" # <== Enabling the api to be a service to access\r\n\r\n  ################################################\r\n  ####         Site Setup Container         #####\r\n  ##############################################\r\n  wordpress: # <== we aren\'t going to open :80 here because traefik is going to serve this on entrypoint \'web\'\r\n  ## :80 is already exposed from within the container ##\r\n    image: wordpress\r\n    restart: always\r\n    container_name: wp\r\n    environment:\r\n      WORDPRESS_DB_HOST: db\r\n      WORDPRESS_DB_USER: exampleuser\r\n      WORDPRESS_DB_PASSWORD: examplepass\r\n      WORDPRESS_DB_NAME: exampledb\r\n    volumes:\r\n      - /opt/traefik/wp:/var/www/html\r\n    networks:\r\n      - web\r\n      - backend\r\n    labels:\r\n      #### Labels define the behavior and rules of the traefik proxy for this container ####\r\n      - "traefik.enable=true" # <== Enable traefik to proxy this container\r\n      - "traefik.http.routers.traefik-web.rule=Host(`example.com`)" # <== Your Domain Name goes here for the http rule\r\n      - "traefik.http.routers.traefik-web.entrypoints=web" # <== Defining the entrypoint for http, **ref: line 30\r\n      - "traefik.http.routers.traefik-web.middlewares=redirect@file" # <== This is a middleware to redirect to https\r\n      - "traefik.http.routers.traefik-secured.rule=Host(`example.com`)" # <== Your Domain Name for the https rule\r\n      - "traefik.http.routers.traefik-secured.entrypoints=web-secured" # <== Defining entrypoint for https, **ref: line 31\r\n      - "traefik.http.routers.traefik-secured.tls.certresolver=mytlschallenge" # <== Defining certsresolvers for https\r\n\r\n ################################################\r\n ####     DB Container not on traefik      #####\r\n ##############################################\r\n  db:\r\n    image: mysql:5.7\r\n    restart: always\r\n    environment:\r\n      MYSQL_DATABASE: exampledb\r\n      MYSQL_USER: exampleuser\r\n      MYSQL_PASSWORD: examplepass\r\n      MYSQL_RANDOM_ROOT_PASSWORD: \'1\'\r\n    volumes:\r\n      - /opt/traefik/db:/var/lib/mysql\r\n    networks:\r\n      - backend\r\n\r\nnetworks:\r\n  web:\r\n    external: true\r\n  backend:\r\n    external: false\r\n\r\n volumes:\r\n  wordpress:\r\n    external: true\r\n  db:\r\n    external: true\n'})}),"\n",(0,t.jsx)(r.h3,{id:"dynamic-configuration",children:"Dynamic Configuration"}),"\n",(0,t.jsx)(r.p,{children:"We used the file provider above to point to our dynamic configuration:"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:"/opt/traefik/config/dynamic.yml"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yml",children:"## Setting up the middleware for redirect to https ##\r\nhttp:\r\n  middlewares:\r\n    redirect:\r\n      redirectScheme:\r\n        scheme: https\n"})})]})}function p(e={}){const{wrapper:r}={...(0,i.ah)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},603905:(e,r,n)=>{n.d(r,{ah:()=>c});var t=n(667294);function i(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function a(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){i(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function s(e,r){if(null==e)return{};var n,t,i=function(e,r){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(i[n]=e[n]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=t.createContext({}),c=function(e){var r=t.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):a(a({},r),e)),n},d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},p=t.forwardRef((function(e,r){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),f=c(n),h=i,u=f["".concat(l,".").concat(h)]||f[h]||d[h]||o;return n?t.createElement(u,a(a({ref:r},p),{},{components:n})):t.createElement(u,a({ref:r},p))}));p.displayName="MDXCreateElement"},811661:(e,r,n)=>{n.d(r,{Z:()=>t});const t=n.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-4118b3ab0d3d411170645e7e387ce566.jpg"}}]);