"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[58797],{387969:(e,i,o)=>{o.r(i),o.d(i,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>n,metadata:()=>r,toc:()=>d});var s=o(474848),a=o(28453);const n={sidebar_position:9998,slug:"2023-11-26",title:"ROS2 Gazebo Robot Simulation",authors:"mpolinowski",tags:["Robotics","Simulation","ROS","Gazebo"],description:"Launch a Simulation with Gazebo and ROS2"},t=void 0,r={id:"Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation/index",title:"ROS2 Gazebo Robot Simulation",description:"Launch a Simulation with Gazebo and ROS2",source:"@site/docs/Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation/index.md",sourceDirName:"Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation",slug:"/Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation/2023-11-26",permalink:"/docs/Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation/2023-11-26",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-gazebo-simulation/index.md",tags:[{label:"Robotics",permalink:"/docs/tags/robotics"},{label:"Simulation",permalink:"/docs/tags/simulation"},{label:"ROS",permalink:"/docs/tags/ros"},{label:"Gazebo",permalink:"/docs/tags/gazebo"}],version:"current",sidebarPosition:9998,frontMatter:{sidebar_position:9998,slug:"2023-11-26",title:"ROS2 Gazebo Robot Simulation",authors:"mpolinowski",tags:["Robotics","Simulation","ROS","Gazebo"],description:"Launch a Simulation with Gazebo and ROS2"},sidebar:"tutorialSidebar",previous:{title:"ROS2 Webots Robot Simulation",permalink:"/docs/Automation_and_Robotics/Robotics_Simulation/2023-11-26--ros2-webots/2023-11-26"},next:{title:"ROS2 Graph Concepts",permalink:"/docs/Automation_and_Robotics/Robotics_Simulation/2023-11-24--ros2-graph/2023-11-24"}},l={},d=[{value:"Launch the Gazebo Simulation",id:"launch-the-gazebo-simulation",level:2},{value:"Configure ROS2",id:"configure-ros2",level:2},{value:"Publish an Topic Update",id:"publish-an-topic-update",level:4},{value:"Use the teleop_twist_keyboard Package",id:"use-the-teleop_twist_keyboard-package",level:4},{value:"Visualizing Lidar Data in ROS2",id:"visualizing-lidar-data-in-ros2",level:2}];function c(e){const i={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"TST, Hongkong",src:o(934575).A+"",width:"1500",height:"620"})}),"\n",(0,s.jsxs)(i.blockquote,{children:["\n",(0,s.jsxs)(i.p,{children:["Excerpt from ",(0,s.jsx)(i.a,{href:"https://docs.ros.org/en/iron/index.html",children:"ROS 2 Documentation (IRON)"}),": The Robot Operating System (ROS) is a set of software libraries and tools for building robot applications. From drivers and state-of-the-art algorithms to powerful developer tools, ROS has the open source tools you need for your next robotics project."]}),"\n"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#launch-the-gazebo-simulation",children:"Launch the Gazebo Simulation"})}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"#configure-ros2",children:"Configure ROS2"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#publish-an-topic-update",children:"Publish an Topic Update"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#use-the-teleop_twist_keyboard-package",children:"Use the teleop_twist_keyboard Package"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#visualizing-lidar-data-in-ros2",children:"Visualizing Lidar Data in ROS2"})}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"launch-the-gazebo-simulation",children:"Launch the Gazebo Simulation"}),"\n",(0,s.jsxs)(i.p,{children:["Use one of the worlds defined in the ",(0,s.jsx)(i.a,{href:"https://gazebosim.org/docs",children:"Gazebo"})," examples called ",(0,s.jsx)(i.a,{href:"https://github.com/gazebosim/gz-sim/blob/main/examples/worlds/visualize_lidar.sdf",children:"visualize_lidar.sdf"})," to simulate a simple diff drive robot:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"ign gazebo -v 4 -r visualize_lidar.sdf\n"})}),"\n",(0,s.jsx)(i.p,{children:"This command will automatically download all dependencies and start the Gazebo UI:"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"ROS2 Gazebo Robot Simulation",src:o(367741).A+"",width:"1851",height:"1012"})}),"\n",(0,s.jsx)(i.p,{children:"When the simulation is running you can check the topics provided by Gazebo with the ign command line tool:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"ign list -l\n\n/clock\n/gazebo/resource_paths\n/gui/camera/pose\n/gui/record_video/stats\n/model/vehicle_blue/odometry\n/model/vehicle_blue/tf\n/stats\n/world/visualize_lidar_world/clock\n/world/visualize_lidar_world/dynamic_pose/info\n/world/visualize_lidar_world/pose/info\n/world/visualize_lidar_world/scene/deletion\n/world/visualize_lidar_world/scene/info\n/world/visualize_lidar_world/state\n/world/visualize_lidar_world/stats\n"})}),"\n",(0,s.jsx)(i.h2,{id:"configure-ros2",children:"Configure ROS2"}),"\n",(0,s.jsxs)(i.p,{children:["To be able to communicate our simulation with ROS 2 you need to use a package called ",(0,s.jsx)(i.a,{href:"https://github.com/gazebosim/ros_gz/tree/ros2/ros_gz_bridge",children:"ros_gz_bridge"}),". This package provides a network bridge which enables the exchange of messages between ROS 2 and Gazebo Transport:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo apt install ros-iron-ros-ign-bridge\n"})}),"\n",(0,s.jsxs)(i.p,{children:["At this point you are ready to launch a bridge from ROS to Gazebo. In particular you are going to create a bridge for the topic ",(0,s.jsx)(i.code,{children:"/model/vehicle_blue/cmd_vel"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge /model/vehicle_blue/cmd_vel@geometry_msgs/msg/Twist]ignition.msgs.Twist\n"})}),"\n",(0,s.jsx)(i.p,{children:"Once the bridge is running the robot is able to follow your motor commands. There are two options:"}),"\n",(0,s.jsx)(i.h4,{id:"publish-an-topic-update",children:"Publish an Topic Update"}),"\n",(0,s.jsxs)(i.p,{children:["Send a command to the topic using ",(0,s.jsx)(i.code,{children:"ros2 topic pub"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'ros2 topic pub /model/vehicle_blue/cmd_vel geometry_msgs/Twist "linear: { x: 0.1 }"\n'})}),"\n",(0,s.jsx)(i.p,{children:"This will make the blue robot start to translate forward:"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"ROS2 Gazebo Robot Simulation",src:o(589840).A+"",width:"1851",height:"1012"})}),"\n",(0,s.jsx)(i.p,{children:"Use the following command to drive the robot back to the starting position:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'ros2 topic pub /model/vehicle_blue/cmd_vel geometry_msgs/Twist "linear: { x: -0.1 }"\n'})}),"\n",(0,s.jsx)(i.h4,{id:"use-the-teleop_twist_keyboard-package",children:"Use the teleop_twist_keyboard Package"}),"\n",(0,s.jsxs)(i.p,{children:["The ",(0,s.jsx)(i.code,{children:"teleop_twist_keyboard"})," node takes keypresses from the keyboard and publishes them as Twist messages. You can install it typing:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"sudo apt install ros-iron-teleop-twist-keyboard\n"})}),"\n",(0,s.jsxs)(i.p,{children:["The default topic where ",(0,s.jsx)(i.code,{children:"teleop_twist_keyboard"})," is publishing Twist messages is ",(0,s.jsx)(i.code,{children:"/cmd_vel"})," but you can remap this topic to make use of the topic used in the bridge:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -r /cmd_vel:=/model/vehicle_blue/cmd_vel\n\n\nThis node takes keypresses from the keyboard and publishes them\nas Twist messages. It works best with a US keyboard layout.\n---------------------------\nMoving around:\n   u    i    o\n   j    k    l\n   m    ,    .\n\nFor Holonomic mode (strafing), hold down the shift key:\n---------------------------\n   U    I    O\n   J    K    L\n   M    <    >\n\nt : up (+z)\nb : down (-z)\n\nanything else : stop\n\nq/z : increase/decrease max speeds by 10%\nw/x : increase/decrease only linear speed by 10%\ne/c : increase/decrease only angular speed by 10%\n\nCTRL-C to quit\n\ncurrently:      speed 0.5       turn 1.0\n"})}),"\n",(0,s.jsx)(i.h2,{id:"visualizing-lidar-data-in-ros2",children:"Visualizing Lidar Data in ROS2"}),"\n",(0,s.jsxs)(i.p,{children:["The diff drive robot has a lidar. To send the data generated by Gazebo to ROS2, you need to launch another bridge. In the case the data from the lidar is provided in the Gazebo Transport topic ",(0,s.jsx)(i.code,{children:"/lidar2"}),", which you are going to remap in the bridge. This topic will be available under the topic ",(0,s.jsx)(i.code,{children:"/lidar_scan"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge /lidar2@sensor_msgs/msg/LaserScan[ignition.msgs.LaserScan --ros-args -r /lidar2:=/laser_scan\n"})}),"\n",(0,s.jsx)(i.p,{children:"To visualize the data from the lidar in ROS2 you can use Rviz2:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:"rviz2\n"})}),"\n",(0,s.jsxs)(i.p,{children:["Here you need to Set the fixed frame to ",(0,s.jsx)(i.code,{children:"vehicle_blue/lidar_link/gpu_lidar"})," and click the ",(0,s.jsx)(i.strong,{children:"Add"})," button to add the ",(0,s.jsx)(i.strong,{children:"LaserScan"})," to visualize the lidar:"]}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"ROS2 Gazebo Robot Simulation",src:o(512051).A+"",width:"1703",height:"882"})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.img,{alt:"ROS2 Gazebo Robot Simulation",src:o(287662).A+"",width:"1842",height:"1001"})})]})}function h(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},367741:(e,i,o)=>{o.d(i,{A:()=>s});const s=o.p+"assets/images/ROS2_Gazebo_Sim_01-1b3b2e17288cf484861c96d07d4924f5.webp"},589840:(e,i,o)=>{o.d(i,{A:()=>s});const s=o.p+"assets/images/ROS2_Gazebo_Sim_02-a1b49a255eb154fd726afb65cc30c559.webp"},512051:(e,i,o)=>{o.d(i,{A:()=>s});const s=o.p+"assets/images/ROS2_Gazebo_Sim_03-a84ff9a65cac51f450f00b3c98aaf11f.webp"},287662:(e,i,o)=>{o.d(i,{A:()=>s});const s=o.p+"assets/images/ROS2_Gazebo_Sim_04-d6e0c8d18f04f031c261b464d4095bba.webp"},934575:(e,i,o)=>{o.d(i,{A:()=>s});const s=o.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-252551beac0b36b4ba53ccd380897f8e.jpg"},28453:(e,i,o)=>{o.d(i,{R:()=>t,x:()=>r});var s=o(296540);const a={},n=s.createContext(a);function t(e){const i=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(n.Provider,{value:i},e.children)}}}]);