"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[30349],{854990:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=r(474848),t=r(28453);const i={sidebar_position:7020,slug:"2021-09-02",title:"Installing OpenWRT on a Raspberry Pi 4",authors:"mpolinowski",tags:["Linux"]},o=void 0,a={id:"DevOps/Linux/2021-09-02--openwrt-raspberry-pi/index",title:"Installing OpenWRT on a Raspberry Pi 4",description:"Shenzhen, China",source:"@site/docs/DevOps/Linux/2021-09-02--openwrt-raspberry-pi/index.md",sourceDirName:"DevOps/Linux/2021-09-02--openwrt-raspberry-pi",slug:"/DevOps/Linux/2021-09-02--openwrt-raspberry-pi/2021-09-02",permalink:"/docs/DevOps/Linux/2021-09-02--openwrt-raspberry-pi/2021-09-02",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Linux/2021-09-02--openwrt-raspberry-pi/index.md",tags:[{label:"Linux",permalink:"/docs/tags/linux"}],version:"current",sidebarPosition:7020,frontMatter:{sidebar_position:7020,slug:"2021-09-02",title:"Installing OpenWRT on a Raspberry Pi 4",authors:"mpolinowski",tags:["Linux"]},sidebar:"tutorialSidebar",previous:{title:"Editor from Hell",permalink:"/docs/DevOps/Linux/2021-10-09--editor-from-hell/2021-10-09"},next:{title:"Installing Kali LINUX on a Raspberry Pi 3",permalink:"/docs/DevOps/Linux/2021-09-01--kali-linux-raspberry-pi/2021-09-01"}},d={},c=[{value:"Downloading the Image",id:"downloading-the-image",level:2},{value:"How to flash OpenWrt to MicroSD card",id:"how-to-flash-openwrt-to-microsd-card",level:3},{value:"Connect to OpenWRT",id:"connect-to-openwrt",level:2},{value:"Adding WiFi Clients",id:"adding-wifi-clients",level:2},{value:"WPA CLI",id:"wpa-cli",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Shenzhen, China",src:r(549468).A+"",width:"1500",height:"498"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#downloading-the-image",children:"Downloading the Image"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#how-to-flash-openwrt-to-microsd-card",children:"How to flash OpenWrt to MicroSD card"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#connect-to-openwrt",children:"Connect to OpenWRT"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#adding-wifi-clients",children:"Adding WiFi Clients"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#wpa-cli",children:"WPA CLI"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"downloading-the-image",children:"Downloading the Image"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://openwrt.org/toh/raspberry_pi_foundation/raspberry_pi",children:"OpenWRT"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Model"}),(0,s.jsx)(n.th,{children:"Version"}),(0,s.jsx)(n.th,{children:"Current Release"}),(0,s.jsx)(n.th,{children:"Firmware OpenWrt Install"}),(0,s.jsx)(n.th,{children:"Firmware OpenWrt Upgrade"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Raspberry Pi 4"}),(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"21.02.0"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"http://downloads.openwrt.org/releases/21.02.0/targets/bcm27xx/bcm2711/openwrt-21.02.0-bcm27xx-bcm2711-rpi-4-squashfs-factory.img.gz",children:"Link"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"http://downloads.openwrt.org/releases/21.02.0/targets/bcm27xx/bcm2711/openwrt-21.02.0-bcm27xx-bcm2711-rpi-4-squashfs-sysupgrade.img.gz",children:"Link"})})]})})]}),"\n",(0,s.jsxs)(n.p,{children:["Direct Download Link: ",(0,s.jsx)(n.a,{href:"http://downloads.openwrt.org/releases/21.02.0/targets/bcm27xx/bcm2711/openwrt-21.02.0-bcm27xx-bcm2711-rpi-4-squashfs-factory.img.gz",children:"openwrt-21.02.0-bcm27xx-bcm2711-rpi-4-squashfs-factory"})]}),"\n",(0,s.jsx)(n.h3,{id:"how-to-flash-openwrt-to-microsd-card",children:"How to flash OpenWrt to MicroSD card"}),"\n",(0,s.jsx)(n.p,{children:"On a Linux desktop and Windows desktop:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Unpack the ",(0,s.jsx)(n.code,{children:"img"})," file"]}),"\n",(0,s.jsx)(n.li,{children:"Insert your MicroSD"}),"\n",(0,s.jsxs)(n.li,{children:["Use BalenaEtcher software to write the img file to your MicroSD card's. [",(0,s.jsx)(n.a,{href:"https://www.balena.io/etcher/",children:"https://www.balena.io/etcher/"}),"]"]}),"\n",(0,s.jsx)(n.li,{children:"Insert the MicroSD into your Pi4B and plug in the power"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"connect-to-openwrt",children:"Connect to OpenWRT"}),"\n",(0,s.jsxs)(n.p,{children:["Connect your PC to your Raspberry Pi via an Ethernet cable and change your network settings to an address inside ",(0,s.jsx)(n.code,{children:"192.168.1.*"})," - e.g. on Windows:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenWRT",src:r(295693).A+"",width:"757",height:"438"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"Default IP"})," of your OpenWRT server is ",(0,s.jsx)(n.code,{children:"192.168.1.1"})," - connect to it with your SSH client ",(0,s.jsx)(n.code,{children:"ssh root@192.168.1.1"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'BusyBox v1.33.1 (2021-08-31 22:20:08 UTC) built-in shell (ash)\r\n\r\n  _______                     ________        __\r\n |       |.-----.-----.-----.|  |  |  |.----.|  |_\r\n |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|\r\n |_______||   __|_____|__|__||________||__|  |____|\r\n          |__| W I R E L E S S   F R E E D O M\r\n -----------------------------------------------------\r\n OpenWrt 21.02.0, r16279-5cc0535800\r\n -----------------------------------------------------\r\n=== WARNING! =====================================\r\nThere is no root password defined on this device!\r\nUse the "passwd" command to set up a new password\r\nin order to prevent unauthorized SSH logins.\r\n--------------------------------------------------\r\nroot@OpenWrt:~#\n'})}),"\n",(0,s.jsx)(n.p,{children:"And the WebUI is also available under this address:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenWRT",src:r(414070).A+"",width:"1083",height:"507"})}),"\n",(0,s.jsx)(n.p,{children:"Now we can change the login and assign a static IP address inside our own Network IP address space:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"passwd root\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"uci set network.lan.ipaddr=192.168.2.245\r\nuci commit\r\n/etc/init.d/network restart\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Unplug the LAN cable, switch your PC back to it's original IP and connect both to your router. The OpenWRT WebUI should now be available on the Ip address you set above e.g. ",(0,s.jsx)(n.code,{children:"192.168.2.245"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenWRT",src:r(30249).A+"",width:"893",height:"601"})}),"\n",(0,s.jsxs)(n.p,{children:["I noticed that OpenWRT started giving out DHCP leases - You can disable this in the Interfaces/LAN settings ",(0,s.jsx)(n.code,{children:"Ignore interface: Disable DHCP for this interface."}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenWRT",src:r(10399).A+"",width:"896",height:"460"})}),"\n",(0,s.jsx)(n.p,{children:"And setting everything to disabled in the DHCP/IPv6 Settings:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenWRT",src:r(59072).A+"",width:"898",height:"459"})}),"\n",(0,s.jsxs)(n.p,{children:["In the top menu go to System \u2192 Startup, and disable ",(0,s.jsx)(n.code,{children:"firewall"}),", ",(0,s.jsx)(n.code,{children:"dnsmasq"})," and ",(0,s.jsx)(n.code,{children:"odhcpd"})," in the list of startup scripts. It should be noted that even though they are disabled, flashing a new image to the device will re-enable them. Click the Save and Apply button. Hard-Restart your router if you're not able to connect anymore."]}),"\n",(0,s.jsx)(n.h2,{id:"adding-wifi-clients",children:"Adding WiFi Clients"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cfg",children:'cat /etc/wpa_supplicant.conf\r\n\r\nctrl_interface=/var/run/wpa_supplicant\r\nupdate_config=1\r\nap_scan=1\r\nautoscan=periodic:10\r\ndisable_scan_offload=1\r\nnetwork={\r\n        ssid="OpenWrt"\r\n        psk="astrongpassword"\r\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wpa_supplicant -B -iwlan0 -c/etc/wpa_supplicant.conf -Dnl80211\n"})}),"\n",(0,s.jsx)(n.h3,{id:"wpa-cli",children:"WPA CLI"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"wpa_cli reconfigure"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"wpa_cli reassociate"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'wpa_cli\r\n\r\nwpa_cli v2.9\r\nCopyright (c) 2004-2019, Jouni Malinen <j@w1.fi> and contributors\r\n\r\nThis software may be distributed under the terms of the BSD license.\r\nSee README for more details.\r\n\r\n\r\nSelected interface \'wlan0\'\r\n\r\nInteractive mode\r\n\r\n> add_network\r\n1\r\n> set_network 0 ssid "OpenWrt"\r\nOK\r\n> set_network 0 psk "astrongpassword"\r\nOK\r\n> set_network 0 ieee80211w 2\r\nOK\r\n> set_network 0 key_mgmt SAE\r\nOK\r\n> enable_network 0\r\nOK\r\n> reconnect\r\nOK\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"set_network 0 key_mgmt WPA-PSK-SHA256"})," for mixed WPA2/WPA3 mode"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},295693:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/OpenWRT_01-ea25bf836ad89d50a0b925d00286b4c4.png"},414070:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/OpenWRT_02-b891f266624e1698400628117c46c52f.png"},10399:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/OpenWRT_03-c77e23b29bc6fc429e4f0336d7a083eb.png"},59072:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/OpenWRT_04-64e6a9099d9fd80398e66c810742efca.png"},30249:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/OpenWRT_05-00ab73438520143a81e150a829b377d2.png"},549468:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-1986d4f02c36ed8f7ba43a46a86eb22d.jpg"},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(296540);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);