"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[90040],{853141:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>r,contentTitle:()=>d,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>a});var n=t(474848),i=t(28453);const s={sidebar_position:7010,slug:"2022-07-15",title:"Node-RED - MQTT Homie Convention",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras."},d=void 0,c={id:"Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index",title:"Node-RED - MQTT Homie Convention",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras.",source:"@site/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index.md",sourceDirName:"Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie",slug:"/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/2022-07-15",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/2022-07-15",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index.md",tags:[{label:"IoT",permalink:"/docs/tags/io-t"}],version:"current",sidebarPosition:7010,frontMatter:{sidebar_position:7010,slug:"2022-07-15",title:"Node-RED - MQTT Homie Convention",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras."},sidebar:"tutorialSidebar",previous:{title:"OpenHab - MQTT Homie Convention",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-16-openhab-mqtt-homie/2022-07-16"},next:{title:"Home Assistant - MQTT Auto-Discovery :: Configuration",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-10-home-assistant-mqtt-autodiscovery-part-i/2022-07-10"}},r={},a=[{value:"Communication according to the MQTT HOMIE Convention",id:"communication-according-to-the-mqtt-homie-convention",level:2},{value:"Set-up the Homie Nodes",id:"set-up-the-homie-nodes",level:3},{value:"Homie Node",id:"homie-node",level:4},{value:"Device Node",id:"device-node",level:4},{value:"State Node",id:"state-node",level:4}];function h(e){const o={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Abashiri, Japan",src:t(167803).A+"",width:"1500",height:"594"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.a,{href:"#communication-according-to-the-mqtt-homie-convention",children:"Communication according to the MQTT HOMIE Convention"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.a,{href:"#set-up-the-homie-nodes",children:"Set-up the Homie Nodes"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#homie-node",children:"Homie Node"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#device-node",children:"Device Node"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#state-node",children:"State Node"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"communication-according-to-the-mqtt-homie-convention",children:"Communication according to the MQTT HOMIE Convention"}),"\n",(0,n.jsx)(o.p,{children:"The Homie convention defines a standardized way of how IoT devices and services announce themselves and their data on the MQTT broker. It is thereby a crucial aspect on top of the MQTT protocol for automatic discovery, configuration and usage of devices and services."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:["Details of the homie convention are available here ",(0,n.jsx)(o.a,{href:"https://homieiot.github.io/",children:"Homie IoT"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["I want to use Node-RED to explore how to configure devices using the ",(0,n.jsx)(o.strong,{children:"Homie Convention"})," with the goal of adding this feature to INSTAR MQTT cameras."]}),"\n",(0,n.jsx)(o.h3,{id:"set-up-the-homie-nodes",children:"Set-up the Homie Nodes"}),"\n",(0,n.jsxs)(o.p,{children:["Start by installing ",(0,n.jsx)(o.a,{href:"https://flows.nodered.org/node/node-red-contrib-homie-convention",children:"node-red-contrib-homie-convention"}),":"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(852852).A+"",width:"1086",height:"328"})}),"\n",(0,n.jsxs)(o.p,{children:["Let's register a ",(0,n.jsx)(o.strong,{children:"Homie Device"})," with our MQTT broker using the MQTT Explorer:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"homie/TestDevices/$homie \u2192 4.0.0\nhomie/TestDevices/$name \u2192 This is a Test\nhomie/TestDevices/$state \u2192 ready\nhomie/TestDevices/$extensions \u2192 ''\nhomie/TestDevices/$nodes \u2192 my_thermostat\n\nhomie/TestDevices/my_thermostat/$name \u2192 My thermostat\nhomie/TestDevices/my_thermostat/$properties \u2192 temperature\n\nhomie/TestDevices/my_thermostat/temperature \u2192 22 \nhomie/TestDevices/my_thermostat/temperature/$name \u2192 Temperature\nhomie/TestDevices/my_thermostat/temperature/$unit \u2192 \xb0C\nhomie/TestDevices/my_thermostat/temperature/$datatype \u2192 integer\nhomie/TestDevices/my_thermostat/temperature/$settable \u2192 true\n"})}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(588111).A+"",width:"1020",height:"684"})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:["It is important to add the ",(0,n.jsx)(o.strong,{children:"retain"})," flag to all topics. Otherwise the device will not be picked up by the Homie service!"]}),"\n"]}),"\n",(0,n.jsx)(o.h4,{id:"homie-node",children:"Homie Node"}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Configuration"}),":"]}),"\n",(0,n.jsxs)(o.p,{children:["First use a ",(0,n.jsx)(o.strong,{children:"homie Node"})," to add your MQTT broker:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(549094).A+"",width:"1032",height:"624"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Name"})," : specify a name"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Broker"})," : Select the mqtt broker where your device is sending messages to."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Basic Configuration"})," (see ",(0,n.jsx)(o.a,{href:"https://homieiot.github.io/specification/#",children:"7.2.1 Node Attributes"}),"):"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Node Id"})," : Unique ID of this homie node"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"$name"})," : Human readable name of this homie node"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"$type"})," : Type of this homie node"]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(742169).A+"",width:"1032",height:"605"})}),"\n",(0,n.jsx)(o.h4,{id:"device-node",children:"Device Node"}),"\n",(0,n.jsxs)(o.p,{children:["Now we are ready to add our ",(0,n.jsx)(o.em,{children:"Test Device"})," by adding a device Node. Your device should be selectable from the drop-down menu:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(145264).A+"",width:"1051",height:"756"})}),"\n",(0,n.jsx)(o.h4,{id:"state-node",children:"State Node"}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.strong,{children:"State Node"})," emits a topic update when the ",(0,n.jsx)(o.code,{children:"$state"})," topic (or any other status information) of a Homie device changes:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(898763).A+"",width:"1049",height:"756"})}),"\n",(0,n.jsxs)(o.p,{children:["The message you receive from this node contains the topic that you have to use to either subscribe to device channel or add a ",(0,n.jsx)(o.strong,{children:"MQTT-Out Node"})," to update it's value - ",(0,n.jsx)(o.strong,{children:"Note"})," that you have to prefix this topic with ",(0,n.jsx)(o.em,{children:"homie/"}),", e.g. ",(0,n.jsx)(o.code,{children:"homie/TestDevices/my_thermostat/temperature"}),":"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(677634).A+"",width:"1036",height:"604"})}),"\n",(0,n.jsxs)(o.p,{children:["You can now inject a number on ",(0,n.jsx)(o.code,{children:"msg.payload"})," to the MQTT node and see that the state node will register the change and emit the state update:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(824581).A+"",width:"843",height:"521"})})]})}function m(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},852852:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_01-f71250d538fcec4784f7bd13041a40b0.png"},588111:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_02-aa32c5803e61cfeba67ff51caf0a36ad.png"},549094:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_03-cf947318838c83318b323b0f0a73d4f6.png"},742169:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_04-5374ca51594ba9582ae67ebd5d4cc712.png"},145264:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_05-ffed06c144b392f6fdf430a5b6cb925f.png"},898763:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_06-06541135dd4ce9e2be95c3534e70311e.png"},677634:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_07-8bf75b6ab824e3b785c28517e274638e.png"},824581:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_08-6458d110d6e15d379b98f46f16588227.png"},167803:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-877ed54046c637e78f96cc6a07569d43.jpg"},28453:(e,o,t)=>{t.d(o,{R:()=>d,x:()=>c});var n=t(296540);const i={},s=n.createContext(i);function d(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);