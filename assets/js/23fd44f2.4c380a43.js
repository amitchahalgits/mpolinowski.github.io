"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[95112],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=a,h=m["".concat(c,".").concat(u)]||m[u]||p[u]||o;return n?r.createElement(h,i(i({ref:t},d),{},{components:n})):r.createElement(h,i({ref:t},d))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},98985:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(87462),a=(n(67294),n(3905));const o={sidebar_position:6050,slug:"2023-07-25",title:"EMQX MQTT Broker with Docker",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"EMQX is an open-source (opens new window), highly scalable, and feature-rich MQTT broker designed for IoT and real-time messaging applications."},i=void 0,s={unversionedId:"IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/index",id:"IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/index",title:"EMQX MQTT Broker with Docker",description:"EMQX is an open-source (opens new window), highly scalable, and feature-rich MQTT broker designed for IoT and real-time messaging applications.",source:"@site/docs/IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/index.md",sourceDirName:"IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker",slug:"/IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/2023-07-25",permalink:"/docs/IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/2023-07-25",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/IoT-and-Machine-Learning/MQTT/2023-07-25-emqx-mqtt-broker-docker/index.md",tags:[{label:"IoT",permalink:"/docs/tags/io-t"}],version:"current",sidebarPosition:6050,frontMatter:{sidebar_position:6050,slug:"2023-07-25",title:"EMQX MQTT Broker with Docker",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"EMQX is an open-source (opens new window), highly scalable, and feature-rich MQTT broker designed for IoT and real-time messaging applications."},sidebar:"tutorialSidebar",previous:{title:"MQTT",permalink:"/docs/category/mqtt"},next:{title:"Mosquitto Broker Docker Cross-Compile",permalink:"/docs/IoT-and-Machine-Learning/MQTT/2022-07-24-mosquitto-broker-cross-compilation/2022-07-24"}},c={},l=[{value:"Deploy with Docker",id:"deploy-with-docker",level:2},{value:"User Interface",id:"user-interface",level:3},{value:"User Authentication",id:"user-authentication",level:2},{value:"Authorization",id:"authorization",level:3},{value:"Cluster Deployment with Docker-Compose",id:"cluster-deployment-with-docker-compose",level:2}],d={toc:l};function p(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Guangzhou, China",src:n(29621).Z,width:"2385",height:"962"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#deploy-with-docker"},"Deploy with Docker"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#user-interface"},"User Interface")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#user-authentication"},"User Authentication"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#authorization"},"Authorization")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#cluster-deployment-with-docker-compose"},"Cluster Deployment with Docker-Compose"))),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.emqx.io/docs/en/v5.1/#key-benefits"},"EMQX")," is an open-source (opens new window), highly scalable, and feature-rich MQTT broker designed for IoT and real-time messaging applications. It supports up to 100 million concurrent IoT device connections per cluster while maintaining a throughput of 1 million messages per second and a sub-millisecond latency."),(0,a.kt)("p",null,"EMQX supports various protocols, including MQTT (3.1, 3.1.1, and 5.0), HTTP, QUIC, and WebSocket. It also provides secure bi-directional communication with MQTT over TLS/SSL and various authentication mechanisms, ensuring reliable and efficient communication infrastructure for IoT devices and applications."),(0,a.kt)("h2",{id:"deploy-with-docker"},"Deploy with Docker"),(0,a.kt)("p",null,"Prepare a directory to persist data:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir -p /opt/emqx/data\nsudo chmod -R 777 /opt/emqx\n")),(0,a.kt)("p",null,"Pull the ",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/emqx"},"latest Docker image"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull emqx/emqx:latest\ndocker run -d -v /opt/emqx/data:/opt/emqx/data --name emqx -p 1883:1883 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083  emqx/emqx:latest\n")),(0,a.kt)("h3",{id:"user-interface"},"User Interface"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:18083/"))),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(60631).Z,width:"1065",height:"429"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(35931).Z,width:"1205",height:"672"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(39687).Z,width:"1190",height:"750"})),(0,a.kt)("h2",{id:"user-authentication"},"User Authentication"),(0,a.kt)("p",null,"EMQX supports the simplest and most popular password authentication, which requires the client to provide credentials that can indicate identities, such as username, client ID, and the corresponding password. EMQX will save the client credentials in its built-in database (based on Mnesia) and manages data via REST API and Dashboard."),(0,a.kt)("p",null,"On EMQX Dashboard, click ",(0,a.kt)("strong",{parentName:"p"},"Access Control")," -> ",(0,a.kt)("strong",{parentName:"p"},"Authentication")," on the left navigation tree to enter the Authentication page. Click ",(0,a.kt)("strong",{parentName:"p"},"Create")," at the top right corner, then click to select ",(0,a.kt)("strong",{parentName:"p"},"Password-Based")," as ",(0,a.kt)("strong",{parentName:"p"},"Mechanism"),", and ",(0,a.kt)("strong",{parentName:"p"},"Built-in Database")," as ",(0,a.kt)("strong",{parentName:"p"},"Backend"),", this will lead us to the Configuration tab:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(80257).Z,width:"1292",height:"479"})),(0,a.kt)("p",null,"UserID Type: Specify the fields for client ID authentication; Options: username, clientid\uff08corresponding to the Username or Client Identifier fields in the CONNECT message sent by the MQTT client). I will choose ",(0,a.kt)("inlineCode",{parentName:"p"},"username")," to be able to assign a group username and password to connecting clients - instead of having to handle separate logins for every client ID. Once the database is created click on ",(0,a.kt)("strong",{parentName:"p"},"Users")," to add logins for your MQTT clients:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(80257).Z,width:"1292",height:"479"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(98886).Z,width:"1294",height:"316"})),(0,a.kt)("p",null,"First, I will add my INSTAR MQTT cameras using the ",(0,a.kt)("inlineCode",{parentName:"p"},"cameras")," user and a password that fulfills the password requirements of those cameras:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(345).Z,width:"1291",height:"507"})),(0,a.kt)("h3",{id:"authorization"},"Authorization"),(0,a.kt)("p",null,"Now we need to switch to the ",(0,a.kt)("strong",{parentName:"p"},"Authorization")," page in Dashboard and click on ",(0,a.kt)("strong",{parentName:"p"},"Create Authorization")," based on the ",(0,a.kt)("strong",{parentName:"p"},"Build-in Database"),". Once created click the ",(0,a.kt)("strong",{parentName:"p"},"Permissions")," button in the Actions column of the Built-in Database backend:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(78698).Z,width:"1296",height:"503"})),(0,a.kt)("p",null,"Create an Authorization for the created ",(0,a.kt)("inlineCode",{parentName:"p"},"cameras")," user and add the rights to subscribe and/or publish MQTT topics needed by this client. Since all my MQTT cameras publish to the MQTT prefix ",(0,a.kt)("inlineCode",{parentName:"p"},"cameras")," followed by the MQTT client ID I need a wildcard subscription to ",(0,a.kt)("inlineCode",{parentName:"p"},"cameras/${clientid}/#"),":"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(42699).Z,width:"1084",height:"416"})),(0,a.kt)("p",null,"And connect your clients using the login:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"EMQX MQTT Broker with Docker",src:n(2998).Z,width:"1288",height:"840"})),(0,a.kt)("h2",{id:"cluster-deployment-with-docker-compose"},"Cluster Deployment with Docker-Compose"),(0,a.kt)("p",null,"Besides working with a single EMQX node, EMQX also provides the ",(0,a.kt)("a",{parentName:"p",href:"https://www.emqx.io/docs/en/v5.1/deploy/cluster/introduction.html"},"cluster feature")," for high availability, better scalability, data security, and centralized management, which is why clustering is recommended for larger or mission-critical applications."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"docker-compose.yml")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yml"},'version: \'3\'\n\nservices:\n  emqx1:\n    image: emqx:5.1.0\n    container_name: emqx1\n    environment:\n    - "EMQX_NODE_NAME=emqx@node1.emqx.io"\n    - "EMQX_CLUSTER__DISCOVERY_STRATEGY=static"\n    - "EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]"\n    healthcheck:\n      test: ["CMD", "/opt/emqx/bin/emqx", "ctl", "status"]\n      interval: 5s\n      timeout: 25s\n      retries: 5\n    networks:\n      emqx-bridge:\n        aliases:\n        - node1.emqx.io\n    ports:\n      - 1883:1883\n      - 8083:8083\n      - 8084:8084\n      - 8883:8883\n      - 18083:18083 \n    # volumes:\n    #   - $PWD/emqx1_data:/opt/emqx/data\n\n  emqx2:\n    image: emqx:5.1.0\n    container_name: emqx2\n    environment:\n    - "EMQX_NODE_NAME=emqx@node2.emqx.io"\n    - "EMQX_CLUSTER__DISCOVERY_STRATEGY=static"\n    - "EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]"\n    healthcheck:\n      test: ["CMD", "/opt/emqx/bin/emqx", "ctl", "status"]\n      interval: 5s\n      timeout: 25s\n      retries: 5\n    networks:\n      emqx-bridge:\n        aliases:\n        - node2.emqx.io\n    # volumes:\n    #   - $PWD/emqx2_data:/opt/emqx/data\n\nnetworks:\n  emqx-bridge:\n    driver: bridge\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'docker-compose up -d\ndocker exec -it emqx1 sh -c "emqx ctl cluster status"\n')))}p.isMDXComponent=!0},60631:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_01-32b33e84967d1c0bdb5593a0ced41560.png"},35931:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_02-303e46766d4f2d1d19458b1e80361b7b.png"},39687:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_03-6723b5a5753d3333f7a3361d0607c7c2.png"},80257:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_04-677962228e700e31fe1dac7b3fca15cd.png"},98886:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_05-e69a333770bb78180b93cb53ccf4064f.png"},345:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_06-a6517c6bb4b6d3a7fa4e4d9e59fb8c3a.png"},78698:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_07-cd883de16b289fb78f0da36b90549998.png"},42699:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_08-c01ea31ad9d6a4fedfc47efc0606edbf.png"},2998:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/emqx-mqtt-broker-docker_09-568d334a68e3c02f34355dfbd160d82a.png"},29621:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-4dda98a4eb3b498839926e0b6a5039aa.jpg"}}]);