"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[67399],{337959:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var r=n(785893),t=n(603905);const i={sidebar_position:6990,slug:"2022-10-18",title:"Run Camera.UI with Docker-Compose",authors:"mpolinowski",tags:["IoT","Docker"],description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with."},s=void 0,o={id:"Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker/index",title:"Run Camera.UI with Docker-Compose",description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with.",source:"@site/docs/Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker/index.md",sourceDirName:"Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker",slug:"/Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker/2022-10-18",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker/2022-10-18",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Home_Automation/2022-10-18-camera-ui-docker/index.md",tags:[{label:"IoT",permalink:"/docs/tags/io-t"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:6990,frontMatter:{sidebar_position:6990,slug:"2022-10-18",title:"Run Camera.UI with Docker-Compose",authors:"mpolinowski",tags:["IoT","Docker"],description:"camera.ui is a NVR like PWA to control your RTSP capable cameras with."},sidebar:"tutorialSidebar",previous:{title:"MQTT Auto-Discovery - Use Node-RED to register Smarthome Devices",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-17-node-red-for-mqtt-autodiscovery/2022-07-17"},next:{title:"Convert RTSP to HLS using FFmpeg",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-12-15--rtsp-to-hls-ffmpeg/2022-12-15"}},c={},l=[{value:"Setup",id:"setup",level:2},{value:"Docker-Compose",id:"docker-compose",level:3},{value:"Adding a Camera",id:"adding-a-camera",level:2},{value:"Alarmserver",id:"alarmserver",level:2},{value:"HTTP",id:"http",level:3},{value:"MQTT",id:"mqtt",level:3}];function m(e){const a={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Guangzhou, China",src:n(783838).Z+"",width:"1500",height:"526"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"#setup",children:"Setup"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#docker-compose",children:"Docker-Compose"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#adding-a-camera",children:"Adding a Camera"})}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.a,{href:"#alarmserver",children:"Alarmserver"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#http",children:"HTTP"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"#mqtt",children:"MQTT"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(a.h3,{id:"docker-compose",children:"Docker-Compose"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yml",children:'version: \'3.8\'\n\nservices:\n  camera.ui:\n    container_name: camera.ui\n    image: nexryai/camera.ui:latest\n    ports:\n     - "8081:8081"\n     - "1883:1883"\n     - "7272:7272"\n    volumes:\n      - ./data:/.camera.ui:rw\n    networks:\n      - services\n    restart: unless-stopped\n\nnetworks:\n  services:\n    external: false\n'})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'docker-compose pull\nPulling camera.ui ... done\n\ndocker-compose up\nCreating network "camera-ui-docker_default" with the default driver\nCreating camera.ui ... done\nAttaching to camera.ui\ncamera.ui    | [10/18/2022, 4:54:52 AM] [camera.ui] camera.ui v1.1.17 is listening on port 8081 (http)\n'})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(378185).Z+"",width:"1045",height:"537"})}),"\n",(0,r.jsx)(a.h2,{id:"adding-a-camera",children:"Adding a Camera"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(121616).Z+"",width:"991",height:"884"})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'"cameras": [\n  {\n      "name": "IN-9408 2k+ WQHD",\n      "motionTimeout": 15,\n      "recordOnMovement": null,\n      "prebuffering": null,\n      "videoConfig": {\n        "source": "-i rtsp://admin:instar@192.168.2.120:554/livestream/11",\n        "stillImageSource": "-i http://admin:instar@192.168.2.120/snap.cgi?chn=12",\n        "stimeout": 10,\n        "audio": null,\n        "debug": null,\n        "subSource": "-i rtsp://admin:instar@192.168.2.120:554/livestream/12",\n        "rtspTransport": "tcp",\n        "vcodec": "copy",\n        "acodec": "libfdk_aac"\n      }\n]\n'})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(809442).Z+"",width:"1059",height:"883"})}),"\n",(0,r.jsx)(a.h2,{id:"alarmserver",children:"Alarmserver"}),"\n",(0,r.jsx)(a.h3,{id:"http",children:"HTTP"}),"\n",(0,r.jsx)(a.p,{children:"The HTTP alarmserver can be activated to trigger or reset a movement by a simple call of a link."}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(555351).Z+"",width:"1021",height:"476"})}),"\n",(0,r.jsxs)(a.p,{children:["If the HTTP server is activated, a movement can be triggered by e.g. the following link and our camera name ",(0,r.jsx)(a.code,{children:"IN-9408 2k+ WQHD"}),":"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.a,{href:"http://localhost:7272/motion?IN-9408%202k+%20WQHD",children:"http://localhost:7272/motion?IN-9408%202k+%20WQHD"})}),"\n",(0,r.jsx)(a.p,{children:"And reset via"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.a,{href:"http://localhost:7272/motion/reset?IN-9408%202k+%20WQHD",children:"http://localhost:7272/motion/reset?IN-9408%202k+%20WQHD"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(71524).Z+"",width:"928",height:"191"})}),"\n",(0,r.jsx)(a.p,{children:"But there is an issue with cameras that append a value to their query key:"}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.code,{children:"[camera.ui]  WARNING  IN-9408 2k+ WQHD=1: Camera 'IN-9408 2k+ WQHD=1' not found"})}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(71524).Z+"",width:"928",height:"191"})}),"\n",(0,r.jsx)(a.h3,{id:"mqtt",children:"MQTT"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(955532).Z+"",width:"1122",height:"731"})}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsx)(a.p,{children:"Missing configuration - I cannot add a MQTT broker login:"}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(907205).Z+"",width:"1122",height:"469"})}),"\n",(0,r.jsxs)(a.p,{children:["The missing configuration can be added manually - since we mounted the configuration directory to ",(0,r.jsx)(a.code,{children:"./data"})," all the configuration files can now be found inside this folder next to our ",(0,r.jsx)(a.code,{children:"docker-compose.yml"})," file. Alternatively, just edit the directly inside the container:"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker exec -ti camera.ui nano .camera.ui/config.json\n"})}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(926396).Z+"",width:"896",height:"431"})}),"\n",(0,r.jsx)(a.p,{children:"And while we are in here, we can also add the Camera MQTT alarmserver:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(584767).Z+"",width:"896",height:"426"})}),"\n",(0,r.jsx)(a.p,{children:"After a restart the MQTT broker is now connected:"}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"Run Camera.UI with Docker-Compose",src:n(954171).Z+"",width:"1116",height:"518"})}),"\n",(0,r.jsx)(a.p,{children:"And I can see that the software is now listening for the alarmserver topic of my camera:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'camera.ui    | [10/18/2022, 6:48:47 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:48:52 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:48:52 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\ncamera.ui    | [10/18/2022, 6:49:51 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:52 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:57 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:49:57 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\ncamera.ui    | [10/18/2022, 6:51:31 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:32 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"1"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:37 AM] [camera.ui] MQTT: New message: Topic: cameras/120/status/alarm/triggered - Data: {"val":"0"} - Type: string\ncamera.ui    | [10/18/2022, 6:51:37 AM] [camera.ui]  WARNING  The incoming MQTT message ({"val":"0"}) for the topic (cameras/120/status/alarm/triggered) was not the same as set in config.json ({"val":"1"}). Skip...\n'})}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-json",children:'{\n  "logLevel": "info",\n  "port": 8081,\n  "atHomeSwitch": false,\n  "options": {\n    "videoProcessor": "/usr/lib/node_modules/camera.ui/node_modules/ffmpeg-for-homebridge/ffmpeg"\n  },\n  "ssl": {\n    "active": false\n  },\n  "http": {\n    "active": true,\n    "port": 7272,\n    "localhttp": false\n  },\n  "smtp": {\n    "active": false,\n    "port": 2727,\n    "space_replace": "+"\n  },\n  "ftp": {\n    "active": false,\n    "useFile": false,\n    "port": 5050\n  },\n  "mqtt": {\n    "active": true,\n    "tls": false,\n    "host": "192.168.2.120",\n    "port": 1883,\n    "username": "admin",\n    "password": "instar"\n  },\n  "cameras": [\n    {\n      "name": "IN-9408 2k+ WQHD",\n      "motionTimeout": 15,\n      "recordOnMovement": null,\n      "prebuffering": null,\n      "videoConfig": {\n        "source": "-i rtsp://admin:instar@192.168.2.120:554/livestream/11",\n        "stillImageSource": "-i http://admin:instar@192.168.2.120/snap.cgi?chn=12",\n        "stimeout": 10,\n        "audio": null,\n        "debug": null,\n        "subSource": "-i rtsp://admin:instar@192.168.2.120:554/livestream/12",\n        "rtspTransport": "tcp",\n        "vcodec": "copy",\n        "acodec": "libfdk_aac"\n      },\n      "mqtt": {\n        "motionTopic": "cameras/120/status/alarm/triggered",\n        "motionMessage": "{\\"val\\":\\"1\\"}",\n        "motionResetTopic": "cameras/120/status/alarm/triggered",\n        "motionResetMessage": "{\\"val\\":\\"0\\"}"\n      },\n      "smtp": {\n        "email": "IN-9408 2k+ WQHD"\n      },\n      "videoanalysis": {\n        "active": false\n      },\n      "prebufferLength": 4\n    }\n  ]\n}\n'})})]})}function d(e={}){const{wrapper:a}={...(0,t.ah)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},603905:(e,a,n)=>{n.d(a,{ah:()=>l});var r=n(667294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,r,t=function(e,a){if(null==e)return{};var n,r,t={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var c=r.createContext({}),l=function(e){var a=r.useContext(c),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},m={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},d=r.forwardRef((function(e,a){var n=e.components,t=e.mdxType,i=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=l(n),p=t,h=u["".concat(c,".").concat(p)]||u[p]||m[p]||i;return n?r.createElement(h,s(s({ref:a},d),{},{components:n})):r.createElement(h,s({ref:a},d))}));d.displayName="MDXCreateElement"},378185:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_01-004c93a3721b79549afbf4924564de83.png"},121616:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_02-4e77e9582d4db603810d0c440ecd598b.png"},809442:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_03-cd3ab1ea5aa12a47cd06661ca510255f.png"},555351:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_04-72fadf7bd9081b3e8f80f8828c4606a8.png"},955532:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_05-69b437c07052b3367a20e9eb75a8275f.png"},907205:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_06-6327c2d8c57d1518de5b1d0b85c672d8.png"},926396:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_07-d3296f413e3ab708e7ac0ee2f98e01fe.png"},584767:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_08-49906656e25ac8a00d57ed88a8586e95.png"},954171:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_09-bc04b9037961ad791c02a8acc6519663.png"},71524:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/camera-ui-docker_10-23497c3b4c14ab5c380eda52ca07533f.png"},783838:(e,a,n)=>{n.d(a,{Z:()=>r});const r=n.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-98d71e33f881256303c68773a2ed92ba.jpg"}}]);