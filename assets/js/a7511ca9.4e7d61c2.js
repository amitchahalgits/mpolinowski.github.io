"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[72967],{672625:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var t=o(474848),s=o(28453);const r={sidebar_position:8070,slug:"2019-09-21",title:"Docker Compose install Magento 2",authors:"mpolinowski",tags:["Magento"]},a=void 0,i={id:"Development/Magento/2019-09-21--magento2-docker-install/index",title:"Docker Compose install Magento 2",description:"Victoria Harbour, Hongkong",source:"@site/docs/Development/Magento/2019-09-21--magento2-docker-install/index.md",sourceDirName:"Development/Magento/2019-09-21--magento2-docker-install",slug:"/Development/Magento/2019-09-21--magento2-docker-install/2019-09-21",permalink:"/docs/Development/Magento/2019-09-21--magento2-docker-install/2019-09-21",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Development/Magento/2019-09-21--magento2-docker-install/index.md",tags:[{label:"Magento",permalink:"/docs/tags/magento"}],version:"current",sidebarPosition:8070,frontMatter:{sidebar_position:8070,slug:"2019-09-21",title:"Docker Compose install Magento 2",authors:"mpolinowski",tags:["Magento"]},sidebar:"tutorialSidebar",previous:{title:"Adding Google Analytics to Magento 2",permalink:"/docs/Development/Magento/2019-09-21--magento2-google-analytics/2019-09-21"},next:{title:"Magento 2 UI Components",permalink:"/docs/Development/Magento/2019-09-20--magento2-ui-components/2019-09-20"}},c={},l=[{value:"Docker Compose",id:"docker-compose",level:2},{value:"Editing the Compose File",id:"editing-the-compose-file",level:3},{value:"Magento Source",id:"magento-source",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Victoria Harbour, Hongkong",src:o(964311).A+"",width:"1500",height:"691"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#docker-compose",children:"Docker Compose"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#editing-the-compose-file",children:"Editing the Compose File"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#magento-source",children:"Magento Source"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,t.jsxs)(n.p,{children:["I am using the docker-compose file from ",(0,t.jsx)(n.a,{href:"https://github.com/markshust/docker-magento",children:"@markshust"})," and I am going to choose the manual installation for an existing project. You can use the provided shell script to download the necessary files from Github:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd /opt/docker-magento2\r\ncurl -s https://raw.githubusercontent.com/markshust/docker-magento/master/lib/template | bash\n"})}),"\n",(0,t.jsx)(n.p,{children:"You will end up with the following files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/opt/docker-magento2\r\n\u251c\u2500\u2500 .git\r\n\u251c\u2500\u2500 .gitignore\r\n\u251c\u2500\u2500 .vscode\r\n\u251c\u2500\u2500 bin\r\n\u251c\u2500\u2500 docker-compose.dev.yml\r\n\u251c\u2500\u2500 docker-compose.yml\r\n\u2514\u2500\u2500 env\r\n   \u2514\u2500\u2500 db.env\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"bin"})," folder contains a ",(0,t.jsx)(n.a,{href:"https://github.com/markshust/docker-magento#custom-cli-commands",children:"couple of custom CLI commands"})," and the MySQL user password is set inside the ",(0,t.jsx)(n.code,{children:"db.env"})," file."]}),"\n",(0,t.jsx)(n.h3,{id:"editing-the-compose-file",children:"Editing the Compose File"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'version: "3"\r\n\r\nservices:\r\n  app:\r\n    image: markoshust/magento-nginx:1.18-4\r\n    ports:\r\n      - "80:8000"\r\n      - "443:8443"\r\n    links:\r\n      - db\r\n      - phpfpm\r\n    volumes: &appvolumes\r\n      - ~/.composer:/var/www/.composer:cached\r\n      - appdata:/var/www/html\r\n      - sockdata:/sock\r\n      - ssldata:/etc/nginx/certs\r\n\r\n  phpfpm:\r\n    image: markoshust/magento-php:7.4-fpm-2\r\n    links:\r\n      - db\r\n    volumes: *appvolumes\r\n\r\n  db:\r\n    image: percona:5.7\r\n    command: --max_allowed_packet=64M\r\n    ports:\r\n      - "3306:3306"\r\n    env_file: env/db.env\r\n    volumes:\r\n      - dbdata:/var/lib/mysql\r\n\r\n  redis:\r\n    image: redis:5.0-alpine\r\n\r\n  elasticsearch:\r\n    image: markoshust/magento-elasticsearch:7.6.2-2\r\n    ports:\r\n      - "9200:9200"\r\n      - "9300:9300"\r\n    environment:\r\n      - "discovery.type=single-node"\r\n\r\n  rabbitmq:\r\n    image: rabbitmq:3.7-management-alpine\r\n    ports:\r\n      - "15672:15672"\r\n      - "5672:5672"\r\n    volumes:\r\n      - rabbitmqdata:/var/lib/rabbitmq\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The compose file sets up an NGINX web proxy, a PHP container, a MySQL Database as well as Redis, Elasticsearch and RabbitMQ. Since the Magento source code I inherited requires PHP v7.3 I will change the PHP image to ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/layers/markoshust/magento-php/7.3-fpm/images/sha256-143047e2819b04dbcd84dd46917fce473e87cd271c6e708a4ef7d1dee59a2122?context=explore",children:"markoshust/magento-php:7.3-fpm"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"magento-source",children:"Magento Source"}),"\n",(0,t.jsx)(n.p,{children:"Download the version of Magento you want to use with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bin/download 2.4.1\n"})}),"\n",(0,t.jsx)(n.p,{children:"Create a DNS host entry for the site so you are able to access the frontend through this URL:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo "127.0.0.1 ::1 my.magento.test" | sudo tee -a /etc/hosts\n'})}),"\n",(0,t.jsx)(n.p,{children:"Run the setup installer for Magento:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bin/setup my.magento.test\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You will be asked to login with your ",(0,t.jsx)(n.a,{href:"https://marketplace.magento.com/customer/accessKeys/",children:"Magento Marketplace user credentials"})," - use your public key as username and private key as password"]}),"\n",(0,t.jsxs)(n.p,{children:["Open ",(0,t.jsx)(n.code,{children:"https://my.magento.test"})]})]})}function m(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},964311:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-13c054fff660a07a582f4f91a81c5032.jpg"},28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>i});var t=o(296540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);