"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[674],{621153:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=t(785893),r=t(603905);const o={sidebar_position:1e4,slug:"2020-02-01",title:"Running Gitlab in Podman on CentOS8",authors:"mpolinowski",tags:["LINUX","Docker","Gitlab"]},s=void 0,a={id:"DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8/index",title:"Running Gitlab in Podman on CentOS8",description:"Siem Reap, Cambodia",source:"@site/docs/DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8/index.mdx",sourceDirName:"DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8",slug:"/DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8/2020-02-01",permalink:"/docs/DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8/2020-02-01",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/GitOps/2020-02-01--gitlab-in-podman-on-centos8/index.mdx",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"},{label:"Gitlab",permalink:"/docs/tags/gitlab"}],version:"current",sidebarPosition:1e4,frontMatter:{sidebar_position:1e4,slug:"2020-02-01",title:"Running Gitlab in Podman on CentOS8",authors:"mpolinowski",tags:["LINUX","Docker","Gitlab"]},sidebar:"tutorialSidebar",previous:{title:"Running Gitlab as Docker Registry",permalink:"/docs/DevOps/GitOps/2020-02-02--docker-images-in-gitlab/2020-02-02"},next:{title:"Kubernetes",permalink:"/docs/category/kubernetes"}},l={},c=[{value:"Installation through Podman on CentOS8",id:"installation-through-podman-on-centos8",level:2},{value:"Setting Up Gitlab",id:"setting-up-gitlab",level:2},{value:"Adding your SSH Key",id:"adding-your-ssh-key",level:3},{value:"Testing that everything is set up correctly",id:"testing-that-everything-is-set-up-correctly",level:3},{value:"Uploading your Project",id:"uploading-your-project",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Siem Reap, Cambodia",src:t(475422).Z+"",width:"1500",height:"757"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#installation-through-podman-on-centos8",children:"Installation through Podman on CentOS8"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#setting-up-gitlab",children:"Setting Up Gitlab"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#adding-your-ssh-key",children:"Adding your SSH Key"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#testing-that-everything-is-set-up-correctly",children:"Testing that everything is set up correctly"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#uploading-your-project",children:"Uploading your Project"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation-through-podman-on-centos8",children:"Installation through Podman on CentOS8"}),"\n",(0,i.jsx)(n.p,{children:"Before setting everything else, configure a new enviroment variable $GITLAB_HOME pointing to the folder where the configuration, logs, and data files will reside. Ensure that the folder exists and appropriate permission have been granted:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export GITLAB_HOME=/srv\n"})}),"\n",(0,i.jsx)(n.p,{children:"The GitLab container uses host mounted volumes to store persistent data:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Local location"}),(0,i.jsx)(n.th,{children:"Container location"}),(0,i.jsx)(n.th,{children:"Usage"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$GITLAB_HOME/gitlab/data"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/var/opt/gitlab"})}),(0,i.jsx)(n.td,{children:"For storing application data"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$GITLAB_HOME/gitlab/logs"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/var/log/gitlab"})}),(0,i.jsx)(n.td,{children:"For storing logs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$GITLAB_HOME/gitlab/config"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/etc/gitlab"})}),(0,i.jsx)(n.td,{children:"For storing the GitLab configuration files"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p /srv/gitlab/{data,logs,config}\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can fine tune these directories to meet your requirements. Once you\u2019ve set up the GITLAB_HOME variable, you can run the image:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"podman run --detach \\\r\n  --privileged \\\r\n  --hostname centos8.fritz.box \\\r\n  --publish 443:443 --publish 80:80 --publish 55466:22 \\\r\n  --name gitlab \\\r\n  --restart always \\\r\n  --volume $GITLAB_HOME/gitlab/config:/etc/gitlab \\\r\n  --volume $GITLAB_HOME/gitlab/logs:/var/log/gitlab \\\r\n  --volume $GITLAB_HOME/gitlab/data:/var/opt/gitlab \\\r\n  gitlab/gitlab-ce:latest\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you are on SELinux, then run this instead:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"podman run --detach \\\r\n  --hostname centos8.fritz.box \\\r\n  --publish 443:443 --publish 80:80 --publish 55466:22 \\\r\n  --name gitlab \\\r\n  --restart always \\\r\n  --volume $GITLAB_HOME/gitlab/config:/etc/gitlab:Z \\\r\n  --volume $GITLAB_HOME/gitlab/logs:/var/log/gitlab:Z \\\r\n  --volume $GITLAB_HOME/gitlab/data:/var/opt/gitlab:Z \\\r\n  gitlab/gitlab-ce:latest\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will ensure that the Docker process has enough permissions to create the config files in the mounted volumes. For my test environment ",(0,i.jsx)(n.code,{children:"centos8.fritz.box"})," is a local domain that I use for this server - replace it with your own domain. The ",(0,i.jsx)(n.strong,{children:"SSH Port"})," for the Gitlab container is - in the original documentation - exposed on port ",(0,i.jsx)(n.code,{children:"22"}),". I replaced this by a random port ",(0,i.jsx)(n.code,{children:"55466"})," since I am already using ",(0,i.jsx)(n.code,{children:"22"})," to get into my server."]}),"\n",(0,i.jsx)(n.p,{children:"The initialization process may take a long time. You can track this process with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"podman logs -f gitlab\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After starting a container you can visit ",(0,i.jsx)(n.code,{children:"centos8.fritz.box"}),". It might take a while before the Docker container starts to respond to queries. The very first time you visit GitLab, you will be asked to set up the admin password. After you change it, you can login with username root and the password you set up."]}),"\n",(0,i.jsx)(n.h2,{id:"setting-up-gitlab",children:"Setting Up Gitlab"}),"\n",(0,i.jsxs)(n.p,{children:["On first access you will be asked to add a password for the ",(0,i.jsx)(n.code,{children:"root"})," user:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Running Gitlab in Podman on CentOS8",src:t(303540).Z+"",width:"947",height:"429"})}),"\n",(0,i.jsx)(n.h3,{id:"adding-your-ssh-key",children:"Adding your SSH Key"}),"\n",(0,i.jsxs)(n.p,{children:["You can create and configure an ",(0,i.jsx)(n.strong,{children:"ED25519"})," key with the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh-keygen -t ed25519 -C '<comment>'\n"})}),"\n",(0,i.jsx)(n.p,{children:"The -C flag, with a quoted comment such as an email address, is an optional way to label your SSH keys. You'll see a response similar to:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh-keygen -t ed25519 -C 'm.polinowski@gmail.com'\r\nGenerating public/private ed25519 key pair.\r\nEnter file in which to save the key (C:\\Users\\INSTAR/.ssh/id_ed25519):\r\nEnter passphrase (empty for no passphrase):\r\nEnter same passphrase again:\r\nYour identification has been saved in C:\\Users\\INSTAR/.ssh/id_ed25519.\r\nYour public key has been saved in C:\\Users\\INSTAR/.ssh/id_ed25519.pub.\r\nThe key fingerprint is:\r\nSHA256:shdfhgfhjghjghjdfgj467wudjh m.polinowski@gmail.com\r\nThe key's randomart image is:\r\n+--[ED25519 256]--+\r\n|9-+o+o           |\r\n|+-=.= =          |\r\n|+_.._+ u d *     |\r\n| .Y .            |\r\n+----[SHA256]-----+\n"})}),"\n",(0,i.jsx)(n.p,{children:"Copy your public SSH key to a location that saves information in text format. For Windows you can use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat ~/.ssh/id_ed25519.pub | clip\n"})}),"\n",(0,i.jsx)(n.p,{children:"Select your avatar in the upper right corner, and click Settings. Click SSH Keys. Paste the public key that you copied into the Key text box:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Running Gitlab in Podman on CentOS8",src:t(413627).Z+"",width:"895",height:"473"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"If you manually copied your public SSH key make sure you copied the entire key starting with ssh-ed25519 (or ssh-rsa) and ending with your email address."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"testing-that-everything-is-set-up-correctly",children:"Testing that everything is set up correctly"}),"\n",(0,i.jsxs)(n.p,{children:["To test whether your SSH key was added correctly, run the following command in your terminal (replace centos8.fritz.box with your GitLab's instance domain and port ",(0,i.jsx)(n.code,{children:"55466"})," with the port you have chosen when starting the Gitlab container earlier):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh -p 55466 -T git@centos8.fritz.box\r\nThe authenticity of host '[centos8.fritz.box]:55466 ([192.168.2.111]:55466)' can't be established.\r\nECDSA key fingerprint is SHA256:shdfhgfhjghjghjdfgj467wudjh.\r\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\r\nWarning: Permanently added '[centos8.fritz.box]:55466,[192.168.2.111]:55466' (ECDSA) to the list of known hosts.\n"})}),"\n",(0,i.jsx)(n.h3,{id:"uploading-your-project",children:"Uploading your Project"}),"\n",(0,i.jsxs)(n.p,{children:["Start by creating a project (or cloning one from e.g. Github or Gitlab.com). I created a blank repo with the name ",(0,i.jsx)(n.code,{children:"mui-gatsby-markdown-fr"}),":"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Running Gitlab in Podman on CentOS8",src:t(371273).Z+"",width:"815",height:"710"})}),"\n",(0,i.jsx)(n.p,{children:"You can now clone the empty repository, enter the directory and add some project code. To keep it simple, I am going to use Github Desktop and the HTTP URL (if you want to use SSH remember to use the SSH port that you assigned to your Gitlab container):"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Running Gitlab in Podman on CentOS8",src:t(208816).Z+"",width:"1115",height:"534"})}),"\n",(0,i.jsxs)(n.p,{children:["Copy your code into the created directory, commit und publish it with Github Desktop (you have to login with your Gitlab user ",(0,i.jsx)(n.code,{children:"root"})," + your password)."]}),"\n",(0,i.jsx)(n.p,{children:"It works!"})]})}function h(e={}){const{wrapper:n}={...(0,r.ah)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},603905:(e,n,t)=>{t.d(n,{ah:()=>c});var i=t(667294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),c=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},h=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,h=a(e,["components","mdxType","originalType","parentName"]),p=c(t),g=r,u=p["".concat(l,".").concat(g)]||p[g]||d[g]||o;return t?i.createElement(u,s(s({ref:n},h),{},{components:t})):i.createElement(u,s({ref:n},h))}));h.displayName="MDXCreateElement"},303540:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Gitlab_Podman_CentOS_01-36804a9614ff7189bf7f4fa4e2e60247.png"},413627:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Gitlab_Podman_CentOS_02-db3c57a365cf42246648d6ae57306a43.png"},371273:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Gitlab_Podman_CentOS_03-fe44fb056ee3f68f548688c2ee6435e0.png"},208816:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/Gitlab_Podman_CentOS_04-b440b668ca1eaea52980024c1786fd18.png"},475422:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-9ee0e705058907f79b17ea71944fa884.jpg"}}]);