"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[60631],{95003:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>t});var o=r(474848),i=r(28453);const a={sidebar_position:5e3,slug:"2022-11-07",title:"Deploy a cPhalcon App with Docker",authors:"mpolinowski",tags:["LINUX","Docker"],description:"User Docker to provision a cPhalcon PHP application"},c="Phalcon Framework with Docker",s={id:"DevOps/Provisioning/2022-11-07--cphalcon-docker/index",title:"Deploy a cPhalcon App with Docker",description:"User Docker to provision a cPhalcon PHP application",source:"@site/docs/DevOps/Provisioning/2022-11-07--cphalcon-docker/index.md",sourceDirName:"DevOps/Provisioning/2022-11-07--cphalcon-docker",slug:"/DevOps/Provisioning/2022-11-07--cphalcon-docker/2022-11-07",permalink:"/docs/DevOps/Provisioning/2022-11-07--cphalcon-docker/2022-11-07",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Provisioning/2022-11-07--cphalcon-docker/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Docker",permalink:"/docs/tags/docker"}],version:"current",sidebarPosition:5e3,frontMatter:{sidebar_position:5e3,slug:"2022-11-07",title:"Deploy a cPhalcon App with Docker",authors:"mpolinowski",tags:["LINUX","Docker"],description:"User Docker to provision a cPhalcon PHP application"},sidebar:"tutorialSidebar",previous:{title:"Deploy Mautic with Docker",permalink:"/docs/DevOps/Provisioning/2022-11-16--mautic-docker/2022-11-16"},next:{title:"OSticket REST API Calls",permalink:"/docs/DevOps/Provisioning/2022-10-27--os-ticket-rest-api/2022-10-27"}},l={},t=[{value:"Scaffold your Application",id:"scaffold-your-application",level:2},{value:"Build the Phalcon Container",id:"build-the-phalcon-container",level:2},{value:"Build",id:"build",level:3},{value:"Run the Service",id:"run-the-service",level:2},{value:"Configure the Phalcon App",id:"configure-the-phalcon-app",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Shenzhen, China",src:r(461929).A+"",width:"1500",height:"567"})}),"\n",(0,o.jsx)(n.h1,{id:"phalcon-framework-with-docker",children:"Phalcon Framework with Docker"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Based on ",(0,o.jsx)(n.a,{href:"https://medium.com/@rogsilva/working-with-phalcon-framework-and-docker-fef3fe5b85c8",children:"Working with Phalcon Framework and Docker"})," by ",(0,o.jsx)(n.a,{href:"https://medium.com/@rogsilva",children:"Rog\xe9rio Silva"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#phalcon-framework-with-docker",children:"Phalcon Framework with Docker"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#scaffold-your-application",children:"Scaffold your Application"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#build-the-phalcon-container",children:"Build the Phalcon Container"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#build",children:"Build"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#run-the-service",children:"Run the Service"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#configure-the-phalcon-app",children:"Configure the Phalcon App"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://github.com/mpolinowski/docker-phalcon",children:"Github Repository"})}),"\n",(0,o.jsx)(n.h2,{id:"scaffold-your-application",children:"Scaffold your Application"}),"\n",(0,o.jsx)(n.p,{children:"Link your SQL database to your Phalcon App container using Docker-compose:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:"version: '3'\r\n\r\nservices:\r\n  app:\r\n    container_name: phalcon_app\r\n    build: .\r\n    working_dir: /var/www/html\r\n    volumes:\r\n      - ./html:/var/www/html\r\n    ports:\r\n      - '8080:80'\r\n    expose:\r\n      - '8080'\r\n    depends_on:\r\n      - mysql\r\n    links:\r\n      - mysql\r\n\r\n  mysql:\r\n    container_name: phalcon_db\r\n    image: mariadb:latest\r\n    environment:\r\n      MYSQL_DATABASE: phalcon_app\r\n      MYSQL_ROOT_PASSWORD: root\r\n      SERVICE_TAGS: dev\r\n      SERVICE_NAME: mysql\r\n    ports:\r\n      - '3306:3306'\n"})}),"\n",(0,o.jsx)(n.h2,{id:"build-the-phalcon-container",children:"Build the Phalcon Container"}),"\n",(0,o.jsxs)(n.p,{children:["Using the PHP/NGINX container by ",(0,o.jsx)(n.a,{href:"https://hub.docker.com/r/webdevops/php-nginx",children:"webdevops"})," as base image:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dockerfile",children:"FROM webdevops/php-nginx:7.4\r\n\r\nARG PSR_VERSION=1.2.0\r\nARG PHALCON_VERSION=4.1.3\r\nARG PHALCON_EXT_PATH=php7/64bits\r\n\r\nRUN set -xe && \\\r\n    # Download PSR, see https://github.com/jbboehr/php-psr\r\n    curl -LO https://github.com/jbboehr/php-psr/archive/v${PSR_VERSION}.tar.gz && \\\r\n    tar xzf ${PWD}/v${PSR_VERSION}.tar.gz && \\\r\n    # Download Phalcon\r\n    curl -LO https://github.com/phalcon/cphalcon/archive/v${PHALCON_VERSION}.tar.gz && \\\r\n    tar xzf ${PWD}/v${PHALCON_VERSION}.tar.gz && \\\r\n    docker-php-ext-install -j $(getconf _NPROCESSORS_ONLN) \\\r\n        ${PWD}/php-psr-${PSR_VERSION} \\\r\n        ${PWD}/cphalcon-${PHALCON_VERSION}/build/${PHALCON_EXT_PATH} \\\r\n    && \\\r\n    # Remove all temp files\r\n    rm -r \\\r\n        ${PWD}/v${PSR_VERSION}.tar.gz \\\r\n        ${PWD}/php-psr-${PSR_VERSION} \\\r\n        ${PWD}/v${PHALCON_VERSION}.tar.gz \\\r\n        ${PWD}/cphalcon-${PHALCON_VERSION} \\\r\n    && \\\r\n    php -m\r\n\r\nENV WEB_DOCUMENT_ROOT=/var/www/html/application/public\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["I am using the currently latest version of ",(0,o.jsx)(n.a,{href:"https://github.com/jbboehr/php-psr/tags",children:"php-psr"})," in combination with the last ",(0,o.jsx)(n.a,{href:"https://github.com/phalcon/cphalcon/releases?page=2",children:"cphalcon v4"})," release. I was not yet able to get version 5 to work."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"build",children:"Build"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker pull mariadb:latest\r\ndocker pull webdevops/php-nginx:7.4\r\nmkdir html\r\ndocker-compose build app\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker images\r\n\r\ndocker-phalcon_app                        latest          08a2db66d313   6 seconds ago   1.03GB\r\nwebdevops/php-nginx                       7.4             bf283e850d32   3 days ago      1.02GB\r\nmariadb                                   latest          8dafde72c039   4 days ago      383MB\n"})}),"\n",(0,o.jsx)(n.h2,{id:"run-the-service",children:"Run the Service"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker-compose up -d\r\n\r\nCreating network "docker-phalcon_default" with the default driver\r\nCreating phalcon_db ... done\r\nCreating phalcon_app ... done\n'})}),"\n",(0,o.jsx)(n.h2,{id:"configure-the-phalcon-app",children:"Configure the Phalcon App"}),"\n",(0,o.jsxs)(n.p,{children:["Initialize the application by generating a ",(0,o.jsx)(n.code,{children:"composer.json"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker exec -ti phalcon_app composer init\r\n\r\nThis command will guide you through creating your composer.json config.\r\n\r\nPackage name (<vendor>/<name>) [root/html]: phalcon/app\r\nDescription []: Phalcon App\r\nAuthor [n to skip]: Mike Polinowski\r\nMinimum Stability []: \r\nPackage Type (e.g. library, project, metapackage, composer-plugin) []: \r\nLicense []: MIT\r\n\r\nDefine your dependencies.\r\n\r\nWould you like to define your dependencies (require) interactively [yes]? no\r\nWould you like to define your dev dependencies (require-dev) interactively [yes]? no\r\nAdd PSR-4 autoload mapping? Maps namespace "Phalcon\\App" to the entered relative path. [src/, n to skip]: n\r\n\r\n{\r\n    "name": "phalcon/app",\r\n    "description": "Phalcon App",\r\n    "license": "MIT",\r\n    "authors": [\r\n        {\r\n            "name": "Mike Polinowski"\r\n        }\r\n    ],\r\n    "require": {}\r\n}\r\n\r\nDo you confirm generation [yes]? yes\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Create a default Phalcon project using the ",(0,o.jsx)(n.a,{href:"https://github.com/phalcon/phalcon-devtools",children:"Phalcon Devtools"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker exec -ti phalcon_app composer require --dev phalcon/devtools\r\n\r\nUsing version ^4.2 for phalcon/devtools\r\n./composer.json has been updated\r\nRunning composer update phalcon/devtools\r\nLoading composer repositories with package information\r\nUpdating dependencies\r\nLock file operations: 22 installs, 0 updates, 0 removals\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker exec -ti phalcon_app ./vendor/bin/phalcon project application simple\r\n\r\nPhalcon DevTools (4.2.0)\r\n  Success: Controller \"index\" was successfully created.\r\n  Info: /var/www/html/application/app/controllers/IndexController.php\r\n  Success: Project 'application' was successfully created. \r\n  Info: Please choose a password and username to use Database connection.\r\n  Info: Used default: 'root' without password.\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Phalcon Framework with Docker",src:r(563847).A+"",width:"756",height:"182"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},563847:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/Phalcon_Docker_01-b741468cf83de36bb7b89db1146f02cc.png"},461929:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-983e9af3d84f5fb9ebad02646e63767d.jpg"},28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>s});var o=r(296540);const i={},a=o.createContext(i);function c(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);