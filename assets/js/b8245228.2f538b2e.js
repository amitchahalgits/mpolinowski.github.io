"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[80887],{391784:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var t=r(785893),i=r(603905);const s={sidebar_position:7030,slug:"2023-02-10",title:"Introduction to MeiLi Search with Docker",authors:"mpolinowski",tags:["LINUX","Elasticsearch","Meili"],description:"A lightning-fast search engine that fits effortlessly into your apps, websites, and workflow."},a=void 0,c={id:"DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/index",title:"Introduction to MeiLi Search with Docker",description:"A lightning-fast search engine that fits effortlessly into your apps, websites, and workflow.",source:"@site/docs/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/index.md",sourceDirName:"DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker",slug:"/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/2023-02-10",permalink:"/docs/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/2023-02-10",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Elasticsearch",permalink:"/docs/tags/elasticsearch"},{label:"Meili",permalink:"/docs/tags/meili"}],version:"current",sidebarPosition:7030,frontMatter:{sidebar_position:7030,slug:"2023-02-10",title:"Introduction to MeiLi Search with Docker",authors:"mpolinowski",tags:["LINUX","Elasticsearch","Meili"],description:"A lightning-fast search engine that fits effortlessly into your apps, websites, and workflow."},sidebar:"tutorialSidebar",previous:{title:"Elasticsearch",permalink:"/docs/category/elasticsearch"},next:{title:"Opensearch Rest API",permalink:"/docs/DevOps/Elasticsearch/2022-10-12--opensearch-rest-api/2022-10-12"}},o={},l=[{value:"Setup MeiLi Search with Docker",id:"setup-meili-search-with-docker",level:2},{value:"Add Documents",id:"add-documents",level:2},{value:"Search Documents",id:"search-documents",level:2},{value:"CLI Search Client",id:"cli-search-client",level:2},{value:"Rest API",id:"rest-api",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.ah)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Guangzhou, China",src:r(639732).Z+"",width:"2385",height:"1067"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/mpolinowski/meili-hello",children:"Github Repository"})}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#setup-meili-search-with-docker",children:"Setup MeiLi Search with Docker"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#add-documents",children:"Add Documents"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#search-documents",children:"Search Documents"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#cli-search-client",children:"CLI Search Client"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#rest-api",children:"Rest API"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"See also"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/Development/Javascript/2023-02-12-react-meili-search-starter/2023-02-12",children:"React Frontend Component for MeiLi Search"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/Development/Javascript/2023-02-13-gatsby-meili-search-starter/2023-02-13",children:"Embed MeiLi Search in your Gatsby.js Blog"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/DevOps/Provisioning/2023-02-13--meili-search-gatsby/2023-02-13",children:"Serve your Gatsby.js Blog in a goFiber Container and serve the Application with Compose"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["In ",(0,t.jsx)(n.a,{href:"https://docs.meilisearch.com/learn/cookbooks/docker.html#download-meilisearch-with-docker",children:"this guide"})," you will learn how to use Docker to download and run Meilisearch, configure its behavior, and manage your Meilisearch data."]}),"\n",(0,t.jsx)(n.h2,{id:"setup-meili-search-with-docker",children:"Setup MeiLi Search with Docker"}),"\n",(0,t.jsxs)(n.p,{children:["Use the docker pull command to download the latest ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/r/getmeili/meilisearch",children:"Meilisearch image"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull getmeili/meilisearch:latest\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After completing the previous step, use docker run to launch the Meilisearch image. To persist the data I will create a ",(0,t.jsx)(n.code,{children:"meili"})," directory and mount it into the container:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo mkdir /opt/meili_data\r\nsudo chown myuser:myuser /opt/meili_data\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm \\\r\n  -p 7700:7700 \\\r\n  -v /opt/meili_data:/meili_data \\\r\n  getmeili/meilisearch:latest\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'888b     d888          d8b 888 d8b                                            888\r\n8888b   d8888          Y8P 888 Y8P                                            888\r\n88888b.d88888              888                                                888\r\n888Y88888P888  .d88b.  888 888 888 .d8888b   .d88b.   8888b.  888d888 .d8888b 88888b.\r\n888 Y888P 888 d8P  Y8b 888 888 888 88K      d8P  Y8b     "88b 888P"  d88P"    888 "88b\r\n888  Y8P  888 88888888 888 888 888 "Y8888b. 88888888 .d888888 888    888      888  888\r\n888   "   888 Y8b.     888 888 888      X88 Y8b.     888  888 888    Y88b.    888  888\r\n888       888  "Y8888  888 888 888  88888P\'  "Y8888  "Y888888 888     "Y8888P 888  888\r\n\r\nConfig file path:       "none"\r\nDatabase path:          "./data.ms"\r\nServer listening on:    "http://0.0.0.0:7700"\r\nEnvironment:            "development"\r\nCommit SHA:             "5e12af88e2575a42f53bb3907aea42d7cd4b8b20"\r\nCommit date:            "2023-02-01T11:07:46+00:00"\r\nPackage version:        "1.0.0"\n'})}),"\n",(0,t.jsx)(n.p,{children:"But I am receiving the following warning:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"No master key was found. The server will accept unidentified requests. A master key of at least 16 bytes will be required when switching to a production environment. We generated a new secure master key for you (you can safely use this token):\r\n\r\n>> --master-key RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ <<\r\n\r\nRestart Meilisearch with the argument above to use this new and secure master key.\n"})}),"\n",(0,t.jsx)(n.p,{children:"Ok :)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm \\\r\n  -p 7700:7700 \\\r\n  -v /opt/meili_data:/meili_data \\\r\n  -e MEILI_MASTER_KEY='RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ' \\\r\n  getmeili/meilisearch:latest\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"A master key has been set. Requests to Meilisearch won't be authorized unless you provide an authentication key.\n"})}),"\n",(0,t.jsx)(n.h2,{id:"add-documents",children:"Add Documents"}),"\n",(0,t.jsxs)(n.p,{children:["For this quick start, I will be using a collection of movies - a dataset provided in the ",(0,t.jsx)(n.a,{href:"https://docs.meilisearch.com/movies.json",children:"MeiLi Docs"}),". Move the downloaded file into your working directory. The REST API can be used with cURL:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl \\\r\n  -X POST 'http://localhost:7700/indexes/movies/documents?primaryKey=id' \\\r\n  -H 'Content-Type: application/json' \\\r\n  --data-binary @movies.json\n"})}),"\n",(0,t.jsxs)(n.p,{children:["But let's try using Python for fun - start by installing ",(0,t.jsx)(n.code,{children:"pip3 install meilisearch"}),". The following script will not work though - just as the cURL request above - since we set up authentication:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"import meilisearch\r\nimport json\r\n\r\nclient = meilisearch.Client('http://localhost:7700')\r\n\r\njson_file = open('movies.json')\r\nmovies = json.load(json_file)\r\nclient.index('movies').add_documents(movies)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"Master Key"})," should not be used for regular operations. So we first need to retrieve the ",(0,t.jsx)(n.strong,{children:"API Key"})," from MeiLi Search:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"import meilisearch\r\nimport json\r\n\r\nMASTER_KEY='RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ'\r\n\r\nclient = meilisearch.Client('http://localhost:7700', MASTER_KEY)\r\nprint(client.get_keys())\n"})}),"\n",(0,t.jsx)(n.p,{children:"The response I get here is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{"results": [{"name": "Default Search API Key", "description": "Use it to search from the frontend", "key": "0f96f66dcbc8f4d6e512592ec6e0f9e0b091de34a89147f244a93e3ab0709b7f", "uid": "9690e16c-9941-4dcf-addd-469e514e3226", "actions": ["search"], "indexes": ["*"], "expiresAt": null, "createdAt": "2023-02-10T06:18:07.098683943Z", "updatedAt": "2023-02-10T06:18:07.098683943Z"}, {"name": "Default Admin API Key", "description": "Use it for anything that is not a search operation. Caution! Do not expose it on a public frontend", "key": "992c6bd8233077bc83e537993ca3598aeb0e1113b0f89c0778d9523500aa6df2", "uid": "8e6bf9f2-3500-46b4-a875-76d695ac3ae1", "actions": ["*"], "indexes": ["*"], "expiresAt": null, "createdAt": "2023-02-10T06:18:07.095128284Z", "updatedAt": "2023-02-10T06:18:07.095128284Z"}], "offset": 0, "limit": 20, "total": 2}\n'})}),"\n",(0,t.jsx)(n.p,{children:"So I am receiving two additional keys here beside the master key generated earlier:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Master Key"})}),(0,t.jsx)(n.td,{children:"Used to setup MeiLi Search and generate the API keys below."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Default Search API Key"})}),(0,t.jsx)(n.td,{children:"Use it to search from the frontend."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0f96f66dcbc8f4d6e512592ec6e0f9e0b091de34a89147f244a93e3ab0709b7f"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Default Admin API Key"})}),(0,t.jsx)(n.td,{children:"Use it for anything that is not a search operation. Caution! Do not expose it on a public frontend."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"992c6bd8233077bc83e537993ca3598aeb0e1113b0f89c0778d9523500aa6df2"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"We can extract those two keys with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:'client_auth = meilisearch.Client(\'http://localhost:7700\', MASTER_KEY)\r\napi_keys = client_auth.get_keys()\r\n\r\nSEARCH_KEY = api_keys["results"][0]["key"]\r\nADMIN_KEY = api_keys["results"][1]["key"]\r\n\r\nprint("Search Key:", search_key, "Admin Key:", admin_key)\n'})}),"\n",(0,t.jsx)(n.p,{children:"With the authentication part dealt with, let's add our data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"client_admin = meilisearch.Client('http://localhost:7700', ADMIN_KEY)\r\n\r\njson_file = open('movies.json')\r\nmovies = json.load(json_file)\r\nclient_admin.index('movies').add_documents(movies)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"search-documents",children:"Search Documents"}),"\n",(0,t.jsx)(n.p,{children:"Now with Meilisearch set up, we can start searching with the search API key:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"client_search = meilisearch.Client('http://localhost:7700', SEARCH_KEY)\r\nresults = client_search.index('movies').search('Casablanca')\r\nprint(results)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{"hits": [{"id": 289, "title": "Casablanca", "overview": "In Casablanca, Morocco in December 1941, a cynical American expatriate meets a former lover, with unforeseen complications.", "genres": ["Drama", "Romance"], "poster": "https://image.tmdb.org/t/p/w500/5K7cOHoay2mZusSLezBOY0Qxh8a.jpg", "release_date": -855187200}, {"id": 26940, "title": "A Night in Casablanca", "overview": "The Marx Brothers are employed at a hotel in postwar Casablanca, where a ring of Nazis is trying to recover a cache of stolen treasure.", "genres": ["Comedy"], "poster": "https://image.tmdb.org/t/p/w500/cXMT6KVIXEa9UI8ojEnBBYundrY.jpg", "release_date": -746236800}, {"id": 14208, "title": "The Librarian: Return to King Solomon\'s Mines", "overview": "After retrieving the Crystal Skull in Utah, Flynn Carsen receives a map in the mail with the secret location of King Solomon\'s Mines. When the scroll is stolen, Judson explains the power of the Key of Solomon\'s book and assigns Flynn to retrieve the map. The map is useless without the legend piece to decipher it, which is located in Volubilis near the Roman ruins in Morocco. Flynn heads to Casablanca to the ruins where he is chased by a group of mercenaries leaded by General Samir. They too want to find the location of King Solomon\'s mines. Flynn teams-up with Professor Emily Davenport working in the dig and they escape from General Samir and his men. While traveling to Gedi, they save the local Jomo from death and the trio faces a dangerous journey through the wild Africa.", "genres": ["Fantasy", "Action", "Adventure"], "poster": "https://image.tmdb.org/t/p/w500/jK4BhFw9uNS6BKfAVlxX6Bnkj0J.jpg", "release_date": 1157760000}], "query": "Casablanca", "processingTimeMs": 1, "limit": 20, "offset": 0, "estimatedTotalHits": 3}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cli-search-client",children:"CLI Search Client"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"import meilisearch\r\nimport json\r\n\r\nMASTER_KEY='RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ'\r\n\r\n# get API keys\r\nclient_auth = meilisearch.Client('http://localhost:7700', MASTER_KEY)\r\napi_keys = client_auth.get_keys()\r\n\r\nSEARCH_KEY = api_keys['results'][0]['key']\r\n\r\n# search index\r\nprint(\"INFO :: Welcome to MeiLi Search!\", '\\n')\r\nsearch_query = input(\"INPUT :: Please enter a name of a movie you want to search for: \")\r\nclient_search = meilisearch.Client('http://localhost:7700', SEARCH_KEY)\r\nprint(\"INFO :: MeiLi Search results for:\", search_query, '\\n')\r\nresults = client_search.index('movies').search(search_query)\r\n\r\n\r\nfor result in results['hits']:\r\n  print(result['title'].upper(), '||', result['overview'], '\\n')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rest-api",children:"Rest API"}),"\n",(0,t.jsx)(n.p,{children:"List indices:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl \\\r\n  -X GET 'http://localhost:7700/indexes?limit=3' \\\r\n  -H 'Authorization: Bearer RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ'\n"})}),"\n",(0,t.jsx)(n.p,{children:"Create an index:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl \\\r\n  -X POST 'http://localhost:7700/indexes' \\\r\n  -H 'Authorization: Bearer RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ' \\\r\n  -H 'Content-Type: application/json' \\\r\n  --data-binary '{\r\n    \"uid\": \"my_blog\",\r\n    \"primaryKey\": \"id\"\r\n  }'\n"})}),"\n",(0,t.jsx)(n.p,{children:"Delete an index:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl \\\r\n  -X DELETE 'http://localhost:7700/indexes/movies' \\\r\n  -H 'Authorization: Bearer RhTX1pLPSKSn7KW9yf9u_MNKC0v1YKkmx2Sc6qSwbLQ'\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.ah)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},603905:(e,n,r)=>{r.d(n,{ah:()=>l});var t=r(667294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var o=t.createContext({}),l=function(e){var n=t.useContext(o),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},h={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,s=e.originalType,o=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=l(r),u=i,m=p["".concat(o,".").concat(u)]||p[u]||h[u]||s;return r?t.createElement(m,a(a({ref:n},d),{},{components:r})):t.createElement(m,a({ref:n},d))}));d.displayName="MDXCreateElement"},639732:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-de801851cbff78f66a02197d23ac0ee1.jpg"}}]);