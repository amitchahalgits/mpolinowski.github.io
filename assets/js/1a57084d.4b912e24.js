"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[48825],{54458:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>o});var a=r(474848),t=r(28453);const s={sidebar_position:9020,slug:"2021-03-20",title:"Elasticsearch 7 Refresher",authors:"mpolinowski",tags:["LINUX","Elasticsearch"]},i=void 0,l={id:"DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/index",title:"Elasticsearch 7 Refresher",description:"Hongkong, TST",source:"@site/docs/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/index.md",sourceDirName:"DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher",slug:"/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/2021-03-20",permalink:"/docs/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/2021-03-20",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/index.md",tags:[{label:"LINUX",permalink:"/docs/tags/linux"},{label:"Elasticsearch",permalink:"/docs/tags/elasticsearch"}],version:"current",sidebarPosition:9020,frontMatter:{sidebar_position:9020,slug:"2021-03-20",title:"Elasticsearch 7 Refresher",authors:"mpolinowski",tags:["LINUX","Elasticsearch"]},sidebar:"tutorialSidebar",previous:{title:"Logstash 7 Digesting Webserver Logs",permalink:"/docs/DevOps/Elasticsearch/2021-03-21-logstash-digesting-data/2021-03-21"},next:{title:"Elasticsearch in Docker",permalink:"/docs/DevOps/Elasticsearch/2020-06-01--elasticsearch-docker/2020-06-01"}},c={},o=[{value:"Introduction",id:"introduction",level:2},{value:"Advanced Mappings",id:"advanced-mappings",level:2},{value:"Types and Analyzer",id:"types-and-analyzer",level:3},{value:"Relationships",id:"relationships",level:3},{value:"Delete Documents by Query",id:"delete-documents-by-query",level:2},{value:"A Few More Search Examples",id:"a-few-more-search-examples",level:2},{value:"Simple Search",id:"simple-search",level:3},{value:"Paginate",id:"paginate",level:3},{value:"Weighted Multi-Match",id:"weighted-multi-match",level:3},{value:"Illegal Characters",id:"illegal-characters",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Hongkong, TST",src:r(190662).A+"",width:"1500",height:"641"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#introduction",children:"Introduction"})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#advanced-mappings",children:"Advanced Mappings"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#types-and-analyzer",children:"Types and Analyzer"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#relationships",children:"Relationships"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#delete-documents-by-query",children:"Delete Documents by Query"})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#a-few-more-search-examples",children:"A Few More Search Examples"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#simple-search",children:"Simple Search"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#paginate",children:"Paginate"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#weighted-multi-match",children:"Weighted Multi-Match"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#illegal-characters",children:"Illegal Characters"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"I did not have a chance to work with Elasticsearch a lot these days. I want to dive in to a few online courses and refresh my knowledge. Hoping that I can find something that I can plug in to a work project."}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsxs)(n.p,{children:["Ok, I spun up a ",(0,a.jsx)(n.a,{href:"/docs/DevOps/Elasticsearch/2019-09-08--elasticsearch_7-5_docker/2019-09-08",children:"Docker ELK Stack"})," version ",(0,a.jsx)(n.strong,{children:"7.13.3"}),". I now have to login to Kibana and create a simple mapping with the following content:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n\t"mappings" : {\r\n\t\t"properties" : {\r\n\t\t\t"speaker" : {"type": "keyword" },\r\n\t\t\t"play_name" : {"type": "keyword" },\r\n\t\t\t"line_id" : { "type" : "integer" },\r\n\t\t\t"speech_number" : { "type" : "integer" }\r\n\t\t}\r\n\t}\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"And load it into Elasticsearch:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(42836).A+"",width:"896",height:"337"})}),"\n",(0,a.jsxs)(n.p,{children:["The Data that I am going to work with is ",(0,a.jsx)(n.a,{href:"http://media.sundog-soft.com/es7/shakespeare_7.0.json",children:"available for download here"}),". Just download the file, copy it's content and add it to the index you created - in my case the ",(0,a.jsx)(n.code,{children:"test123"}),":"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(547951).A+"",width:"1095",height:"496"})}),"\n",(0,a.jsxs)(n.p,{children:["The JSON file contains to many entries - either break them up by plays or ",(0,a.jsx)(n.a,{href:"/docs/DevOps/Elasticsearch/2021-03-21-logstash-digesting-data/2021-03-21#use-curl-to-upload-data",children:"check out the CURL way later on"}),"!"]}),"\n",(0,a.jsx)(n.p,{children:"Now I will create an index pattern based on the index I just created:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(482758).A+"",width:"1224",height:"398"})}),"\n",(0,a.jsxs)(n.p,{children:["And can test it with a search query - what play is the quote ",(0,a.jsx)(n.code,{children:"It is the east, and Juliet is the sun."})," from?"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(85177).A+"",width:"1224",height:"786"})}),"\n",(0,a.jsx)(n.h2,{id:"advanced-mappings",children:"Advanced Mappings"}),"\n",(0,a.jsx)(n.h3,{id:"types-and-analyzer",children:"Types and Analyzer"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Type"})," = ",(0,a.jsx)(n.code,{children:"keyword"}),": Value will not be analysed. Only exact matches will be a hit."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Analyzer"})," = ",(0,a.jsx)(n.code,{children:"english"}),": Defining a language analyzer will help you clean up your full text search by removing stop words and reducing words to their root form:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'PUT /television\r\n{\r\n    "mappings": {\r\n        "properties": {\r\n            "id": {\r\n                "type": "integer"\r\n            },\r\n            "year": {\r\n                "type": "date"\r\n            },\r\n            "genre": {\r\n                "type": "keyword"\r\n            },\r\n            "title": {\r\n                "type": "text",\r\n                "analyzer": "english"\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"We can add some data from imdb.com and format it to conform with the mapping above:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'PUT _bulk\r\n{ "create" : { "_index" : "television", "_id" : "band-of-brothers" } }\r\n{ "id": "135569", "title" : "Band of Brothers", "year":2001 , "genre":["Action", "Drama", "History", "War"] }\r\n{ "create" : { "_index" : "television", "_id" : "chernobyl" } }\r\n{ "id": "122886", "title" : "Chernobyl", "year":2019 , "genre":["Drama", "History", "Thriller"] }\r\n{ "create" : { "_index" : "television", "_id" : "firefly" } }\r\n{ "id": "109487", "title" : "Firefly", "year":2002 , "genre":["Sci-Fi", "Adventure", "Drama"] }\r\n{ "create" : { "_index" : "television", "_id" : "battlestar-galactica" } }\r\n{ "id": "58559", "title" : "Battlestar Galactica", "year":2004 , "genre":["Action", "Adventure", "Drama", "Sci-Fi"] }\r\n{ "create" : { "_index" : "television", "_id" : "top-gear" } }\r\n{ "id": "1924", "title" : "Top Gear", "year":2002 , "genre":["Talk Show", "Adventure", "Travel"] }\n'})}),"\n",(0,a.jsx)(n.p,{children:"We can now search for a TV Series in Kibana:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'GET /television/_search\r\n{\r\n  "query": {\r\n    "match": {\r\n      "title": "galactica"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"I am only using a partial title and the wrong case - still I am getting the correct response from Elasticsearch:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "took" : 1,\r\n  "timed_out" : false,\r\n  "_shards" : {\r\n    "total" : 1,\r\n    "successful" : 1,\r\n    "skipped" : 0,\r\n    "failed" : 0\r\n  },\r\n  "hits" : {\r\n    "total" : {\r\n      "value" : 1,\r\n      "relation" : "eq"\r\n    },\r\n    "max_score" : 1.2576691,\r\n    "hits" : [\r\n      {\r\n        "_index" : "television",\r\n        "_type" : "_doc",\r\n        "_id" : "battlestar-galactica",\r\n        "_score" : 1.2576691,\r\n        "_source" : {\r\n          "id" : "58559",\r\n          "title" : "Battlestar Galactica",\r\n          "year" : 2004,\r\n          "genre" : [\r\n            "Action",\r\n            "Adventure",\r\n            "Drama",\r\n            "Sci-Fi"\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["And since we are using the ",(0,a.jsx)(n.strong,{children:"English Analyzer"})," we can even use ",(0,a.jsx)(n.code,{children:"brother"})," instead of ",(0,a.jsx)(n.code,{children:"Brothers"})," and get a correct hit:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'GET /television/_search\r\n{\r\n  "query": {\r\n    "match": {\r\n      "title": "brother"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "took" : 0,\r\n  "timed_out" : false,\r\n  "_shards" : {\r\n    "total" : 1,\r\n    "successful" : 1,\r\n    "skipped" : 0,\r\n    "failed" : 0\r\n  },\r\n  "hits" : {\r\n    "total" : {\r\n      "value" : 1,\r\n      "relation" : "eq"\r\n    },\r\n    "max_score" : 1.2576691,\r\n    "hits" : [\r\n      {\r\n        "_index" : "television",\r\n        "_type" : "_doc",\r\n        "_id" : "band-of-brothers",\r\n        "_score" : 1.2576691,\r\n        "_source" : {\r\n          "id" : "135569",\r\n          "title" : "Band of Brothers",\r\n          "year" : 2001,\r\n          "genre" : [\r\n            "Action",\r\n            "Drama",\r\n            "History",\r\n            "War"\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["But searching for the ",(0,a.jsx)(n.strong,{children:"Genre"})," ",(0,a.jsx)(n.code,{children:"Talk"})," (nor ",(0,a.jsx)(n.code,{children:"talk show"}),") will not get you any hits as we mapped this value as a ",(0,a.jsx)(n.strong,{children:"Keyword"})," that is not going to be analysed - only the entire value ",(0,a.jsx)(n.code,{children:"Talk Show"})," will work:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'GET /television/_search\r\n{\r\n  "query": {\r\n    "match": {\r\n      "genre": "Talk"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "took" : 0,\r\n  "timed_out" : false,\r\n  "_shards" : {\r\n    "total" : 1,\r\n    "successful" : 1,\r\n    "skipped" : 0,\r\n    "failed" : 0\r\n  },\r\n  "hits" : {\r\n    "total" : {\r\n      "value" : 0,\r\n      "relation" : "eq"\r\n    },\r\n    "max_score" : null,\r\n    "hits" : [ ]\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"relationships",children:"Relationships"}),"\n",(0,a.jsxs)(n.p,{children:["Elasticsearch allows us to join documents in a ",(0,a.jsx)(n.strong,{children:"Parent / Child"})," relationship. E.g. joining all episodes of a season into a group:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'PUT /the-expanse\r\n{\r\n    "mappings": {\r\n        "properties": {\r\n            "id": {\r\n                "type": "keyword"\r\n            },\r\n            "air-date": {\r\n                "type": "date"\r\n            },\r\n            "title": {\r\n                "type": "text",\r\n                "analyzer": "english"\r\n            },\r\n            "abstract": {\r\n                "type": "text",\r\n                "analyzer": "english"\r\n            },\r\n            "imdb-rating": {\r\n              "type": "float"\r\n            },\r\n            "filming-season": {\r\n                "type": "join",\r\n                "relations": {"season": "episode"}\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'POST _bulk\r\n{ "create" : { "_index" : "the-expanse", "_id" : "the-expanse", "routing" : 1} }\r\n{ "id": "the-expanse", "filming-season": {"name": "season"}, "title" : "Season 01" }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "dulcinea", "routing" : 1} }\r\n{ "id": "dulcinea", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Dulcinea", "imdb-rating":"7.7", "air-date": "2015-11-23", "abstract":"In the asteroid belt near Saturn, James Holden and the crew of the ice freighter Canterbury, on its way to Ceres Station, investigate a distress call from an unknown derelict ship, the Scopuli." }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "the-big-empty", "routing" : 1} }\r\n{ "id": "the-big-empty", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "The Big Empty", "imdb-rating":"7.7", "air-date": "2015-12-15", "abstract":"Holden and crew are trapped in a badly damaged shuttle. On Ceres, Miller uncovers clues about Julie Mao. On Earth, Chrisjen Avasarala questions a terrorist. " }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "remember-the-cant", "routing" : 1} }\r\n{ "id": "remember-the-cant", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Remember the Cant", "imdb-rating":"8.0", "air-date": "2015-12-16", "abstract":"While Avasarala plays a dangerous game of politics, Holden and his crew are forced to turn on one another while held captive by the Martian Navy." }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "cqb", "routing" : 1} }\r\n{ "id": "cqb", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "CQB", "imdb-rating":"8.7", "air-date": "2015-12-16", "abstract":"Holden and crew are caught in the middle of a desperate battle as mysterious war ships attack and board the Donnager. As Miller continues to investigate Julie Mao, his partner Havelock continues to go missing." }\r\n{ "create" : { "_index" : "the-expanse",  "_id" : "back-to-the-butcher", "routing" : 1} }\r\n{ "id": "back-to-the-butcher", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Back to the Butcher", "imdb-rating":"7.8", "air-date": "2016-01-05", "abstract":"The crew has survived the loss of the Canterbury and the Donnager and are contacted by an unlikely ally. Miller, on Ceres, continues his investigation and his thoughts of a conspiracy grow." }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "rock-bottom", "routing" : 1} }\r\n{ "id": "rock-bottom", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Rock Bottom", "imdb-rating":"8.0", "air-date": "2016-01-12", "abstract":"Holden\'s team makes an uneasy alliance with Fred Johnson while Miller fights for his life against Anderson Dawe\'s thugs." }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "windmills", "routing" : 1} }\r\n{ "id": "windmills", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Windmills", "imdb-rating":"7.9", "air-date": "2016-01-19", "abstract":"Holden and crew realize that they\'re not alone on the Rocinante and find themselves up against a Martian Marine blockade. Miller\'s dark night of the soul, believing all is lost, finds a new reason to keep going. Avasarala visits Holden\'s family in Montana." }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "salvage", "routing" : 1} }\r\n{ "id": "salvage", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Salvage", "imdb-rating":"8.7", "air-date": "2016-01-26", "abstract":"A derelict vessel holds a potentially devastating secret. Holden and his crew cross paths with Miller on Eros. Avasarala receives bad news. " }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "critical-mass", "routing" : 1} }\r\n{ "id": "critical-mass", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Critical Mass", "imdb-rating":"8.7", "air-date": "2016-02-02", "abstract":"A flashback to Julie\'s origin story reveals her trajectory. Holden and Miller finally meet and team up to get to the bottom of the strange emergency situation happening on Eros. As the true horror of the events on Eros is revealed, an ailing Holden and Miller must overcome incredible odds if they hope to live to fight another day. Part 1 of 2" }\r\n{ "create" : { "_index" : "the-expanse", "_id" : "leviathan-wakes", "routing" : 1} }\r\n{ "id": "leviathan-wakes", "filming-season": {"name": "episode", "parent": "the-expanse"}, "title" : "Leviathan Wakes", "imdb-rating":"8.7", "air-date": "2016-02-02", "abstract":"A flashback to Julie\'s origin story reveals her trajectory. Holden and Miller finally meet and team up to get to the bottom of the strange emergency situation happening on Eros. As the true horror of the events on Eros is revealed, an ailing Holden and Miller must overcome incredible odds if they hope to live to fight another day. Part 2 of 2" }\n'})}),"\n",(0,a.jsxs)(n.p,{children:["We can now run a search query that returns to us all the episodes of season one of the TV series ",(0,a.jsx)(n.strong,{children:"The Expanse"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'GET /the-expanse/_search\r\n{\r\n  "query": {\r\n    "has_parent": {\r\n      "parent_type": "season",\r\n  \t  "query": {\r\n  \t\t  "match": {\r\n  \t\t\t  "title": "Season 01"\r\n  \t\t  }\r\n  \t  }\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Find out which ",(0,a.jsx)(n.strong,{children:"Season"})," the ",(0,a.jsx)(n.strong,{children:"Episode"})," ",(0,a.jsx)(n.code,{children:"Leviathan Wakes"})," belonged to:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'GET /the-expanse/_search\r\n{\r\n  "query": {\r\n    "has_child": {\r\n      "type": "episode",\r\n  \t  "query": {\r\n  \t\t  "match": {\r\n  \t\t\t  "title": "Leviathan Wakes"\r\n  \t\t  }\r\n  \t  }\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"delete-documents-by-query",children:"Delete Documents by Query"}),"\n",(0,a.jsx)(n.p,{children:"I just wanted to delete a couple of documents from an index and noticed that you cannot use regular expressions to do so:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"DELETE /wiki_de_prefix_2021_06_07/_doc/yt-*\n"})}),"\n",(0,a.jsx)(n.p,{children:"Instead you have to use a query like"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'GET /wiki_de_prefix_2021_06_07/_search\r\n{\r\n  "query": {\r\n    "match": {\r\n      "tags": "Youtube"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["And instead of directing it to ",(0,a.jsx)(n.code,{children:"_search"})," select ",(0,a.jsx)(n.code,{children:"_delete_by_query"})," to delete all documents that matched to search query:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'POST wiki_de_prefix_2021_06_07/_delete_by_query\r\n{\r\n  "query": { \r\n    "match": {\r\n      "tags": "Youtube"\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"a-few-more-search-examples",children:"A Few More Search Examples"}),"\n",(0,a.jsx)(n.h3,{id:"simple-search",children:"Simple Search"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -XGET 'https://my.domain.com/my_index/_search?q=avm'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"paginate",children:"Paginate"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -XGET 'https://my.domain.com/my_index/_search?q=avm&size=5&from=0'\r\ncurl -XGET 'https://my.domain.com/my_index/_search?q=avm&size=5&from=5'\r\ncurl -XGET 'https://my.domain.com/my_index/_search?q=avm&size=5&from=10'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"weighted-multi-match",children:"Weighted Multi-Match"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -XGET \'https://my.domain.com/my_index/_search?pretty=true\' -H \'Content-Type: application/json\' -d \'{\r\n  "query": {\r\n    "multi_match" : {\r\n      "query": "IN-9020 Full HD Cameras", \r\n      "fields": ["title^8", "tags^10", "abstract^5", "description^3"]\r\n    }\r\n  }\r\n}\'\n'})}),"\n",(0,a.jsx)(n.h3,{id:"illegal-characters",children:"Illegal Characters"}),"\n",(0,a.jsxs)(n.p,{children:["I found out that Elasticsearch does not like it when you use the colon character ",(0,a.jsx)(n.code,{children:":"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -XGET \'https://my.domain.com/my_index/_search?pretty=true&q=FAQ+::+9020+Full+HD\'\r\n\r\n{\r\n  "error" : {\r\n    "root_cause" : [\r\n      {\r\n        "type" : "query_shard_exception",\r\n        "reason" : "Failed to parse query [FAQ :: 9020 Full HD]",\r\n        "index_uuid" : "XwBTMA_jS0G1CaEK7we_3Q",\r\n        "index" : "my_index"\r\n      }\r\n    ],\r\n    "type" : "search_phase_execution_exception",\r\n    "reason" : "all shards failed",\r\n    "phase" : "query",\r\n    "grouped" : true,\r\n    "failed_shards" : [\r\n      {\r\n        "shard" : 0,\r\n        "index" : "my_index",\r\n        "node" : "bFc0o2JrTBqG0zf9Wydh3g",\r\n        "reason" : {\r\n          "type" : "query_shard_exception",\r\n          "reason" : "Failed to parse query [FAQ :: 9020 Full HD]",\r\n          "index_uuid" : "XwBTMA_jS0G1CaEK7we_3Q",\r\n          "index" : "my_index",\r\n          "caused_by" : {\r\n            "type" : "parse_exception",\r\n            "reason" : "Cannot parse \'FAQ :: 9020 Full HD\': Encountered \\" \\":\\" \\": \\"\\" at line 1, column 5.\\nWas expecting one of:\\n    <BAREOPER> ...\\n    \\"(\\" ...\\n    \\"*\\" ...\\n    <QUOTED> ...\\n    <TERM> ...\\n    <PREFIXTERM> ...\\n    <WILDTERM> ...\\n    <REGEXPTERM> ...\\n    \\"[\\" ...\\n    \\"{\\" ...\\n    <NUMBER> ...\\n    ",\r\n            "caused_by" : {\r\n              "type" : "parse_exception",\r\n              "reason" : "Encountered \\" \\":\\" \\": \\"\\" at line 1, column 5.\\nWas expecting one of:\\n    <BAREOPER> ...\\n    \\"(\\" ...\\n    \\"*\\" ...\\n    <QUOTED> ...\\n    <TERM> ...\\n    <PREFIXTERM> ...\\n    <WILDTERM> ...\\n    <REGEXPTERM> ...\\n    \\"[\\" ...\\n    \\"{\\" ...\\n    <NUMBER> ...\\n    "\r\n            }\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  "status" : 400\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"I can see the same in Kibana:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(78928).A+"",width:"1247",height:"334"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:'__Search Error: Expected "(", "{", value, whitespace but ":" found. FAQ :: 9020 Full HD -----^ KQLSyntaxError: Expected "(", "{", value, whitespace but ":" found. FAQ :: 9020 Full HD'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Here I can simply escape the offending characters with a slash:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Elasticsearch 7 Refresher",src:r(992747).A+"",width:"1249",height:"259"})}),"\n",(0,a.jsxs)(n.p,{children:["Transferring this to my ",(0,a.jsx)(n.em,{children:"Curl"})," command I first need to escape:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"FAQ \\:\\: 9020 Full HD\n"})}),"\n",(0,a.jsxs)(n.p,{children:["and then add the ",(0,a.jsx)(n.a,{href:"https://www.freeformatter.com/url-encoder.html",children:"URL Encoding"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"FAQ+%5C%3A%5C%3A+9020+Full+HD\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now it is possible to use URL query params as before:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -XGET 'https://my.domain.com/my_index/_search/_search?pretty=true&q=FAQ+%5C%3A%5C%3A+9020+Full+HD'\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Alternatively"}),", I can use the JSON format in my request to begin with:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'curl -XGET \'https://my.domain.com/my_index/_search/_search?pretty=true\' -H \'Content-Type: application/json\' -d \'{\r\n  "query": {\r\n    "multi_match" : {\r\n      "query": "FAQ :: 9020", \r\n      "fields": ["title^8", "tags^10", "abstract^5", "description^3"]\r\n    }\r\n  }\r\n}\'\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},42836:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_01-bbf3c72c0ad7d8ebdf0d21fcbe64cc9c.png"},547951:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_02-7d01f0c73b1e3f00b0a8d74754b2745b.png"},482758:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_03-274f845de6f6ef162ce85295e4ea9e04.png"},85177:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_04-4a7300729b7e27adfe534805438ee03f.png"},78928:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_05-0083f11be5061b5ed7e028c0803ad58a.png"},992747:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/Elasticsearch7_06-fa3354e740f0468ea86ec8fcfae8a412.png"},190662:(e,n,r)=>{r.d(n,{A:()=>a});const a=r.p+"assets/images/photo-456tdsfggd_67gfh6dgdf4_d-56c87802993aca6118d8d52d3a612a15.jpg"},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var a=r(296540);const t={},s=a.createContext(t);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);