"use strict";(self.webpackChunkmikes_dev_notebook=self.webpackChunkmikes_dev_notebook||[]).push([[70363],{224083:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var n=t(785893),i=t(603905);const s={sidebar_position:7010,slug:"2022-07-15",title:"Node-RED - MQTT Homie Convention",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras."},r=void 0,c={id:"Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index",title:"Node-RED - MQTT Homie Convention",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras.",source:"@site/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index.md",sourceDirName:"Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie",slug:"/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/2022-07-15",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/2022-07-15",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Automation_and_Robotics/Home_Automation/2022-07-15-node-red-mqtt-homie/index.md",tags:[{label:"IoT",permalink:"/docs/tags/io-t"}],version:"current",sidebarPosition:7010,frontMatter:{sidebar_position:7010,slug:"2022-07-15",title:"Node-RED - MQTT Homie Convention",authors:"mpolinowski",tags:["IoT"],image:"https://mpolinowski.github.io/img/search/mqtt.png",description:"I want to use Node-RED to explore how to configure devices using the Homie Convention with the goal of adding this feature to INSTAR MQTT cameras."},sidebar:"tutorialSidebar",previous:{title:"OpenHab - MQTT Homie Convention",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-16-openhab-mqtt-homie/2022-07-16"},next:{title:"Home Assistant - MQTT Auto-Discovery :: Configuration",permalink:"/docs/Automation_and_Robotics/Home_Automation/2022-07-10-home-assistant-mqtt-autodiscovery-part-i/2022-07-10"}},a={},d=[{value:"Communication according to the MQTT HOMIE Convention",id:"communication-according-to-the-mqtt-homie-convention",level:2},{value:"Set-up the Homie Nodes",id:"set-up-the-homie-nodes",level:3},{value:"Homie Node",id:"homie-node",level:4},{value:"Device Node",id:"device-node",level:4},{value:"State Node",id:"state-node",level:4}];function h(e){const o={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.ah)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Abashiri, Japan",src:t(539273).Z+"",width:"1500",height:"594"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.a,{href:"#communication-according-to-the-mqtt-homie-convention",children:"Communication according to the MQTT HOMIE Convention"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.a,{href:"#set-up-the-homie-nodes",children:"Set-up the Homie Nodes"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#homie-node",children:"Homie Node"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#device-node",children:"Device Node"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"#state-node",children:"State Node"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"communication-according-to-the-mqtt-homie-convention",children:"Communication according to the MQTT HOMIE Convention"}),"\n",(0,n.jsx)(o.p,{children:"The Homie convention defines a standardized way of how IoT devices and services announce themselves and their data on the MQTT broker. It is thereby a crucial aspect on top of the MQTT protocol for automatic discovery, configuration and usage of devices and services."}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:["Details of the homie convention are available here ",(0,n.jsx)(o.a,{href:"https://homieiot.github.io/",children:"Homie IoT"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["I want to use Node-RED to explore how to configure devices using the ",(0,n.jsx)(o.strong,{children:"Homie Convention"})," with the goal of adding this feature to INSTAR MQTT cameras."]}),"\n",(0,n.jsx)(o.h3,{id:"set-up-the-homie-nodes",children:"Set-up the Homie Nodes"}),"\n",(0,n.jsxs)(o.p,{children:["Start by installing ",(0,n.jsx)(o.a,{href:"https://flows.nodered.org/node/node-red-contrib-homie-convention",children:"node-red-contrib-homie-convention"}),":"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(108693).Z+"",width:"1086",height:"328"})}),"\n",(0,n.jsxs)(o.p,{children:["Let's register a ",(0,n.jsx)(o.strong,{children:"Homie Device"})," with our MQTT broker using the MQTT Explorer:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"homie/TestDevices/$homie \u2192 4.0.0\nhomie/TestDevices/$name \u2192 This is a Test\nhomie/TestDevices/$state \u2192 ready\nhomie/TestDevices/$extensions \u2192 ''\nhomie/TestDevices/$nodes \u2192 my_thermostat\n\nhomie/TestDevices/my_thermostat/$name \u2192 My thermostat\nhomie/TestDevices/my_thermostat/$properties \u2192 temperature\n\nhomie/TestDevices/my_thermostat/temperature \u2192 22 \nhomie/TestDevices/my_thermostat/temperature/$name \u2192 Temperature\nhomie/TestDevices/my_thermostat/temperature/$unit \u2192 \xb0C\nhomie/TestDevices/my_thermostat/temperature/$datatype \u2192 integer\nhomie/TestDevices/my_thermostat/temperature/$settable \u2192 true\n"})}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(195725).Z+"",width:"1020",height:"684"})}),"\n",(0,n.jsxs)(o.blockquote,{children:["\n",(0,n.jsxs)(o.p,{children:["It is important to add the ",(0,n.jsx)(o.strong,{children:"retain"})," flag to all topics. Otherwise the device will not be picked up by the Homie service!"]}),"\n"]}),"\n",(0,n.jsx)(o.h4,{id:"homie-node",children:"Homie Node"}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Configuration"}),":"]}),"\n",(0,n.jsxs)(o.p,{children:["First use a ",(0,n.jsx)(o.strong,{children:"homie Node"})," to add your MQTT broker:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(936599).Z+"",width:"1032",height:"624"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Name"})," : specify a name"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Broker"})," : Select the mqtt broker where your device is sending messages to."]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.strong,{children:"Basic Configuration"})," (see ",(0,n.jsx)(o.a,{href:"https://homieiot.github.io/specification/#",children:"7.2.1 Node Attributes"}),"):"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"Node Id"})," : Unique ID of this homie node"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"$name"})," : Human readable name of this homie node"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"$type"})," : Type of this homie node"]}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(386924).Z+"",width:"1032",height:"605"})}),"\n",(0,n.jsx)(o.h4,{id:"device-node",children:"Device Node"}),"\n",(0,n.jsxs)(o.p,{children:["Now we are ready to add our ",(0,n.jsx)(o.em,{children:"Test Device"})," by adding a device Node. Your device should be selectable from the drop-down menu:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(731441).Z+"",width:"1051",height:"756"})}),"\n",(0,n.jsx)(o.h4,{id:"state-node",children:"State Node"}),"\n",(0,n.jsxs)(o.p,{children:["The ",(0,n.jsx)(o.strong,{children:"State Node"})," emits a topic update when the ",(0,n.jsx)(o.code,{children:"$state"})," topic (or any other status information) of a Homie device changes:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(713766).Z+"",width:"1049",height:"756"})}),"\n",(0,n.jsxs)(o.p,{children:["The message you receive from this node contains the topic that you have to use to either subscribe to device channel or add a ",(0,n.jsx)(o.strong,{children:"MQTT-Out Node"})," to update it's value - ",(0,n.jsx)(o.strong,{children:"Note"})," that you have to prefix this topic with ",(0,n.jsx)(o.em,{children:"homie/"}),", e.g. ",(0,n.jsx)(o.code,{children:"homie/TestDevices/my_thermostat/temperature"}),":"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(401704).Z+"",width:"1036",height:"604"})}),"\n",(0,n.jsxs)(o.p,{children:["You can now inject a number on ",(0,n.jsx)(o.code,{children:"msg.payload"})," to the MQTT node and see that the state node will register the change and emit the state update:"]}),"\n",(0,n.jsx)(o.p,{children:(0,n.jsx)(o.img,{alt:"Node-RED nodes for MQTT communication according to the MQTT HOMIE convention",src:t(363020).Z+"",width:"843",height:"521"})})]})}function m(e={}){const{wrapper:o}={...(0,i.ah)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},603905:(e,o,t)=>{t.d(o,{ah:()=>d});var n=t(667294);function i(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function s(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function r(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?s(Object(t),!0).forEach((function(o){i(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function c(e,o){if(null==e)return{};var t,n,i=function(e,o){if(null==e)return{};var t,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],o.indexOf(t)>=0||(i[t]=e[t]);return i}(e,o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var a=n.createContext({}),d=function(e){var o=n.useContext(a),t=o;return e&&(t="function"==typeof e?e(o):r(r({},o),e)),t},h={inlineCode:"code",wrapper:function(e){var o=e.children;return n.createElement(n.Fragment,{},o)}},m=n.forwardRef((function(e,o){var t=e.components,i=e.mdxType,s=e.originalType,a=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),l=d(t),u=i,p=l["".concat(a,".").concat(u)]||l[u]||h[u]||s;return t?n.createElement(p,r(r({ref:o},m),{},{components:t})):n.createElement(p,r({ref:o},m))}));m.displayName="MDXCreateElement"},108693:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_01-f71250d538fcec4784f7bd13041a40b0.png"},195725:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_02-aa32c5803e61cfeba67ff51caf0a36ad.png"},936599:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_03-cf947318838c83318b323b0f0a73d4f6.png"},386924:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_04-5374ca51594ba9582ae67ebd5d4cc712.png"},731441:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_05-ffed06c144b392f6fdf430a5b6cb925f.png"},713766:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_06-06541135dd4ce9e2be95c3534e70311e.png"},401704:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_07-8bf75b6ab824e3b785c28517e274638e.png"},363020:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/Node-RED-Homie-MQTT-Auto-Discovery_08-6458d110d6e15d379b98f46f16588227.png"},539273:(e,o,t)=>{t.d(o,{Z:()=>n});const n=t.p+"assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-877ed54046c637e78f96cc6a07569d43.jpg"}}]);