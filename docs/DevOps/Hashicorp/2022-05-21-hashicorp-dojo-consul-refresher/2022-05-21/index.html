<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Hashicorp Dojo Consul Refresher | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hashicorp Dojo Consul Refresher | Mike Polinowski"><meta data-rh="true" name="description" content="Shen Zhen, China"><meta data-rh="true" property="og:description" content="Shen Zhen, China"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.afcb95e1.js" defer="defer"></script>
<script src="/assets/js/main.fb0a52c3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Collapse sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-12-23-opentofu-vs-terraform/2023-12-22">Opentofu vs Hashicorp Terraform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-12-22-hashicorp-terraform-docker-2024/2023-12-22">Hashicorp Terraform - Docker Provider 2024</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-10-22-hashicorp-terraform-docker-2023/2023-10-22">Hashicorp Terraform - Docker Provider 2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-07-hashicorp-vault-ca-certificates/2022-12-07">Hashicorp Vault - Certificate Authority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-05-hashicorp-consul-vault-certificates-part3/2022-12-05">Hashicorp Consul - Vault Cert Management Part 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-05-hashicorp-consul-vault-certificates-part2/2022-12-05">Hashicorp Consul - Vault Cert Management Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-04-hashicorp-consul-vault-certificates-part1/2022-12-04">Hashicorp Consul - Vault Cert Management Part 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-03-hashicorp-vault-installation/2022-12-03">Hashicorp Vault - Installation 2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-24-hashicorp-consul-connect/2022-11-24">Hashicorp Nomad - Working with Consul Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-18-hashicorp-nomad-grav/2022-11-18">Deploy Grav CMS with Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-16-hashicorp-nomad-mautic/2022-11-16">Deploy Mautic with Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-15-hashicorp-nomad-nginx-load-balancing/2022-11-15">Hashicorp Nomad for NGINX Load-balancing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-15-hashicorp-nomad-balanced-nts/2022-11-15">Hashicorp Nomad Secure &amp; Balanced NTS Time Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-12-hashicorp-nomad-certbot-renewal/2022-11-12">Hashicorp Nomad to Renew your TLS Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-11-hashicorp-nomad-for-borg-backups/2022-11-11">Hashicorp Nomad to run periodic backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-25-hashicorp-nomad-for-osticket-part-ii/2022-10-25">Hashicorp Nomad to set up an OSTicket Helpdesk - Part II</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-23-hashicorp-nomad-ports/2022-10-23">Hashicorp Nomad - Working with Ports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-23-hashicorp-consul-connect/2022-10-23">Hashicorp Nomad - Working with Consul Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-22-hashicorp-nomad-sidecar-pattern/2022-10-22">Hashicorp Nomad Sidecar Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-21-hashicorp-nomad-for-osticket-part-i/2022-10-21">Hashicorp Nomad to set up an OSTicket Helpdesk - Part I</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-09-24--nomad-nginx-ingress/2022-09-24">NGINX Ingress with Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-09-22--nomad-nts-timeserver/2022-09-22">Secure Timeserver - Deploying a NTS Server using Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-06-08-hashicorp-waypoint-nomad/2022-06-09">Hashicorp Waypoint with Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-06-07-hashicorp-waypoint-docker/2022-06-07">Hashicorp Waypoint with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-29-hashicorp-nomad-with-nginx-loadbalancer/2022-05-29">Hashicorp Nomad with NGINX Loadbalancer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-28-hashicorp-nomad-for-elastic-part-2/2022-05-28">Hashicorp Nomad to set up an Elasticsearch Cluster Part II</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-27-hashicorp-nomad-for-elastic/2022-05-27">Hashicorp Nomad to set up an Elasticsearch Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-26-hashicorp-nomad-with-gitlab-part-2/2022-05-26">App Deployment with Hashicorp Nomad from Gitlab Part Deux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-25-hashicorp-nomad-with-gitlab/2022-05-25">App Deployment with Hashicorp Nomad from Gitlab</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-24-hashicorp-nomad-with-nginx/2022-05-24">Hashicorp Nomad for NGINX Web Proxies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-22-hashicorp-dojo-nomad-consul-part-2/2022-05-22">Hashicorp Nomad with Consul II - The Reckoning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21">Hashicorp Dojo Consul Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-20-hashicorp-dojo-nomad-consul/2022-05-20">Hashicorp Nomad with Consul Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-19-hashicorp-dojo-nomad-access-control/2022-05-19">Hashicorp Nomad Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-18-hashicorp-dojo-nomad-adding-encryption/2022-05-18">Hashicorp Nomad Adding Encryption to your Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-17-hashicorp-dojo-nomad-deployment/2022-05-17">Hashicorp Nomad Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-16-hashicorp-dojo-nomad-starter/2022-05-16">Hashicorp Nomad Dojo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-15-hashicorp-nomad-refresher/2022-05-15">Hashicorp Nomad Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-10-11--hashicorp-consul-in-production/2021-10-11">Hashicorp Consul in Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-10-10--hashicorp-nomad-in-production/2021-10-10">Hashicorp Nomad in Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/2021-09-07">Hashicorp Terraform - Providers, Variables &amp; Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-09-05--hashicorp-terraform-setup/2021-09-05">Hashicorp Terraform - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-25--hashicorp-vault-logging/2021-08-25">Hashicorp Vault - Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/2021-08-23">Hashicorp Vault - Rest API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-22--hashicorp-vault-policies/2021-08-22">Hashicorp Vault - ACL Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-21--hashicorp-vault-secrets-tokens/2021-08-21">Hashicorp Vault - Secrets &amp; Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-20--hashicorp-vault-setup/2021-08-20">Hashicorp Vault - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-14--hashicorp-consul-tls-encryption/2021-08-14">Hashicorp Consul Refresher - Gossip TLS Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-13--hashicorp-consul-access-control-lists/2021-08-13">Hashicorp Consul Refresher - Access Control Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-12--hashicorp-consul-service-mesh/2021-08-12">Hashicorp Consul Refresher - Service Mesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/2021-08-11">Hashicorp Consul Refresher - Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-10--hashicorp-consul-key-value-store/2021-08-10">Hashicorp Consul Refresher - Key Value Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-09--hashicorp-consul-services/2021-08-09">Hashicorp Consul Refresher - Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-08--hashicorp-nomad-access-control-lists/2021-08-08">Nomad Access Control Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-07--hashicorp-nomad-job-configuration/2021-08-07">Nomad Job Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-06--hashicorp-consul-traefik-loadbalancing/2021-08-06">Hashicorp Consul Refresher - Loadbalancing with Traefik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-06--hashicorp-consul-fabio-loadbalancing/2021-08-06">Hashicorp Consul Refresher - Loadbalancing with Fabio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05">Hashicorp Consul Refresher - Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-04--hashicorp-nomad-job-specifications/2021-08-04">Hashicorp Nomad Refresher - Job Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-03--hashicorp-nomad-jobs/2021-08-03">Hashicorp Nomad Refresher - Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-02--hashicorp-nomad-security/2021-08-02">Hashicorp Nomad Refresher - Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-01--hashicorp-nomad-refresher/2021-08-01">Hashicorp Nomad Refresher - Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-26--hashicorp-packer-provisioner/2020-10-26">HashiCorp Packer Provisioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-25--hashicorp-packer-and-virtualbox-autoinstall/2020-10-25">HashiCorp Packer with Virtualbox (Autoinstall)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-24--hashicorp-packer-and-virtualbox-preseed/2020-10-24">HashiCorp Packer with Virtualbox (Preseed)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-23--hashicorp-packer-machine-image/2020-10-23">HashiCorp Packer Machine Images Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-19--consul-deployment-guide/2020-08-19">Consul Deployment Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-18--consul-service-mesh/2020-08-18">Consul Service Mesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-18--consul-mock-datacenter/2020-08-19">Joining Consul Clients</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-17--installing-consul-ubuntu/2020-08-17">Installing HashiCorp Consul on Ubuntu Server 20.04</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-16--nomad-cluster/2020-08-16">Nomad Server Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-15--installing-nomad-ubuntu/2020-08-15">Installing HashiCorp Nomad on Ubuntu Server 20.04</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/hashicorp"><span itemprop="name">Hashicorp</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hashicorp Dojo Consul Refresher</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hashicorp Dojo Consul Refresher</h1></header><p><img alt="Shen Zhen, China" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-aebdfbdab26722eba0393921cc85bc26.jpg" width="1500" height="661"></p>
<ul>
<li><a href="#install-consul">Install Consul</a></li>
<li><a href="#security">Security</a>
<ul>
<li><a href="#generate-the-gossip-encryption-key">Generate the gossip encryption key</a></li>
<li><a href="#generate-tls-certificates-for-rpc-encryption">Generate TLS certificates for RPC encryption</a></li>
</ul>
</li>
<li><a href="#configure-consul-agents">Configure Consul agents</a>
<ul>
<li><a href="#general-defaults">General defaults</a></li>
<li><a href="#tls-encryption">TLS encryption</a></li>
<li><a href="#datacenter-auto-join">Datacenter auto-join</a></li>
<li><a href="#enable-consul-acls">Enable Consul ACLs</a></li>
<li><a href="#performance-stanza">Performance stanza</a></li>
</ul>
</li>
<li><a href="#master-configuration">Master Configuration</a>
<ul>
<li><a href="#consul-service-mesh">Consul Service Mesh</a></li>
</ul>
</li>
<li><a href="#start-the-consul-service">Start the Consul Service</a></li>
<li><a href="#accessing-the-ui">Accessing the UI</a></li>
<li><a href="#bootstrap-the-acl-system">Bootstrap the ACL System</a></li>
<li><a href="#consul-environment-variables">Consul Environment Variables</a></li>
<li><a href="#create-a-node-policy">Create a Node Policy</a></li>
<li><a href="#configuring-nomad-for-consul-only-master-node">Configuring Nomad for Consul (Only Master Node)</a></li>
<li><a href="#accessing-the-ui-tls">Accessing the UI (TLS)</a></li>
<li><a href="#complete-configuration">Complete Configuration</a>
<ul>
<li><a href="#master-node">Master Node</a></li>
<li><a href="#minion-node">Minion Node</a></li>
</ul>
</li>
</ul>
<h2 id="install-consul">Install Consul</h2>
<p>The first thing you need to do in order to use Consul is install it:</p>
<pre><code class="language-bash">curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;
apt update &amp;&amp; apt install consul &amp;&amp; consul -v
</code></pre>
<blockquote>
<p>ERROR <code>command not found: apt-add-repository</code> -&gt; <code>apt install software-properties-common</code></p>
</blockquote>
<p>This will add both a default configuration file <code>/etc/consul.d/consul.hcl</code> and a SystemD service file <code>/usr/lib/systemd/system/consul.service</code>.</p>
<h2 id="security">Security</h2>
<p>All commands in this section can be completed on any system with the Consul binary installed. The outputs and artifacts from these commands should be archived in a secure location for future reference.</p>
<h3 id="generate-the-gossip-encryption-key">Generate the gossip encryption key</h3>
<p>Gossip is encrypted with a symmetric key, since gossip between nodes is done over UDP. All agents must have the same encryption key:</p>
<pre><code class="language-bash">consul keygen
qDOPBEr+/oUVeOFQOnVypxwDaHzLrD+lvjo5vCEBbZ0=
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: You will need to add the newly generated key to the encrypt option in the server configuration on all Consul agents. Save your key in a safe location. You will need to reference the key throughout the installation.</p>
</blockquote>
<h3 id="generate-tls-certificates-for-rpc-encryption">Generate TLS certificates for RPC encryption</h3>
<p>Consul can use TLS to verify the authenticity of masters and minions. To enable TLS, Consul requires that all agents have certificates signed by a single Certificate Authority (CA).</p>
<pre><code class="language-bash">mkdir /etc/consul.d/tls &amp;&amp; cd /etc/consul.d/tls
consul tls ca create
</code></pre>
<p>Next create a set of certificates, one for each Consul agent. You will need to select a name for your primary datacenter now, so that the certificates are named properly, as well as a domain for your Consul datacenter.</p>
<pre><code class="language-bash">consul tls cert create -server -dc consul -domain consul
</code></pre>
<p>A federated Consul environment requires the server certificate to include the names of all Consul datacenters that are within the federated environment. The <code>-additional-dnsname</code> flag allows you to provide an additional DNS names:</p>
<pre><code class="language-bash">consul tls cert create -server -dc consul -domain consul -additional-dnsname=&quot;*.consul&quot;
</code></pre>
<pre><code class="language-bash">chown consul:consul ./*
chmod 640 ./*
</code></pre>
<p>The directory will now contain the following files:</p>
<pre><code class="language-bash">ls -la /etc/consul.d/tls
-rw-r----- 1 consul consul consul-agent-ca-key.pem
-rw-r----- 1 consul consul consul-agent-ca.pem
-rw-r----- 1 consul consul consul-server-consul-0-key.pem
-rw-r----- 1 consul consul consul-server-consul-0.pem
</code></pre>
<blockquote>
<p>The <strong>Consul minions agents</strong> will only need the the CA certificate, <code>consul-agent-ca.pem</code>, to enable mTLS. Copy this file to <code>/etc/consul.d/tls</code> on all minions.</p>
</blockquote>
<p>The recommended approach is leverage the auto encryption mechanism provided by Consul that automatically generates client certificates using the Consul connect service mesh CA without the need for an operator to manually generate certificates for each client.</p>
<h2 id="configure-consul-agents">Configure Consul agents</h2>
<p>Consul server agents typically require a superset of <a href="https://www.consul.io/docs/agent/options.html">configuration</a> required by Consul client agents. You will specify common configuration used by all Consul agents in <code>/etc/consul.d/consul.hcl</code> and server specific configuration in <code>/etc/consul.d/server.hcl</code>.</p>
<p>The APT installation already provided the default <code>consul.hcl</code> let&#x27;s add the <code>server.hcl</code> and apply the correct permissions to all files:</p>
<pre><code class="language-bash">cd /etc/consul.d
touch server.hcl
chown consul:consul ./*
chmod 640 ./*
</code></pre>
<h3 id="general-defaults">General defaults</h3>
<p>The <code>consul.hcl</code> contains only the path to the <code>data_dir</code> that was automatically created in <code>/opt/consul</code> during the installation. We can now add the name of our datacenter <code>consul</code> and the gossip encryption key:</p>
<pre><code class="language-js">datacenter = &quot;consul&quot;
data_dir = &quot;/opt/consul&quot;
encrypt = &quot;qDOPBEr+/oUVeOFQOnVypxwDaHzLrD+lvjo5vCEBbZ0=&quot;
</code></pre>
<h3 id="tls-encryption">TLS encryption</h3>
<p>For the TLS configuration we need to add - for the <strong>Master Node</strong>:</p>
<pre><code class="language-js">tls {
  defaults {
    ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
    cert_file = &quot;/etc/consul.d/tls/consul-server-consul-0.pem&quot;
    key_file = &quot;/etc/consul.d/tls/consul-server-consul-0-key.pem&quot;
    verify_incoming = true
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = true
  }
}
</code></pre>
<p>And for the <strong>Minions</strong>:</p>
<pre><code class="language-js"># TLS configuration

tls {
  defaults {
    ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
  }
  internal_rpc {
    verify_server_hostname = true
  }
}

auto_encrypt {
    tls = true
 }
</code></pre>
<h3 id="datacenter-auto-join">Datacenter auto-join</h3>
<p>The retry_join parameter allows you to configure all Consul agents to automatically form a datacenter using a common Consul server accessed via DNS address or IP address. This removes the need to manually join the Consul datacenter nodes together.</p>
<blockquote>
<p><strong>WARNING</strong>: The <code>join</code> or <code>retry_join</code> is a required parameter for the systemd process to complete successfully and send its notify signal on LAN join.</p>
</blockquote>
<p>Replace the <code>retry_join</code> parameter value with the correct Master DNS address, IP address, Loopback address for your environment:</p>
<pre><code class="language-js">retry_join = [&quot;&lt;One of Consul master public IPs&gt;&quot;]
</code></pre>
<h3 id="enable-consul-acls">Enable Consul ACLs</h3>
<p>Consul uses <a href="https://learn.hashicorp.com/tutorials/consul/access-control-setup-production">Access Control Lists (ACLs)</a> to secure the UI, API, CLI, and Consul catalog including service and agent registration. When securing your datacenter you should configure the ACLs first.</p>
<p>Add the ACL configuration to the consul.hcl configuration file and choose a default policy of <code>allow</code> (allow all traffic unless explicitly denied) or <code>deny</code> (deny all traffic unless explicitly allowed).</p>
<pre><code class="language-js">acl {
  enabled = true
  default_policy = &quot;allow&quot;
  enable_token_persistence = true
}
</code></pre>
<h3 id="performance-stanza">Performance stanza</h3>
<p>The performance stanza allows tuning the performance of different subsystems in Consul:</p>
<pre><code class="language-js">performance {
  raft_multiplier = 1
}
</code></pre>
<p>For more information on Raft tuning and the <a href="https://www.consul.io/docs/install/performance.html">raft_multiplier</a> setting, check the server performance documentation.</p>
<h2 id="master-configuration">Master Configuration</h2>
<p>The master specific configuration will be placed in <code>/etc/consul.d/server.hcl</code>. On my master node I will enable the web user interface and select the agent as server:</p>
<pre><code class="language-bash">ui_config{
  enabled = true
}

auto_encrypt {
  allow_tls = true
}

server = true
bootstrap_expect=1
</code></pre>
<p>Consul agent should bind to all addresses on the local machine and will advertise the private IPv4 address to the rest of the datacenter.</p>
<pre><code class="language-js">bind_addr = &quot;&lt;One of Consul master public IPs&gt;&quot;
</code></pre>
<p>When the value for <code>client_addr</code> is undefined, it defaults to <code>127.0.0.1</code>, allowing only loopback connections. Optionally, you can specify a bind IP address in your Consul <code>server.hcl</code> configuration file. I will leave it at loopback for now, as I don&#x27;t want to expose the Consul HTTP user interface:</p>
<pre><code class="language-js">client_addr = &quot;127.0.0.1&quot;
</code></pre>
<h3 id="consul-service-mesh">Consul Service Mesh</h3>
<p>Consul service mesh provides service-to-service connection authorization and encryption using mutual Transport Layer Security (TLS). Applications can use sidecar proxies in a service mesh configuration to establish TLS connections for inbound and outbound connections without being aware of Consul service mesh.</p>
<p>Consul service mesh uses the registered service identity (rather than IP addresses) to enforce access control with intentions.</p>
<pre><code class="language-js">connect {
  enabled = true
}

addresses {
  grpc = &quot;&lt;One of Consul master public IPs&gt;&quot;
}

ports {
  grpc  = 8502
  dns = 8600
  http = 8500
  https = 8501
  serf_lan = 8301
  serf_wan = 8302
  server = 8300
}
</code></pre>
<ul>
<li><a href="https://www.consul.io/docs/agent/options#connect_enabled">connect.enabled</a> - Controls whether Connect features are enabled on this agent. Should be enabled on all servers in the cluster in order for Connect to function properly.</li>
<li><a href="https://www.consul.io/docs/agent/options#grpc">addresses.grpc</a> - The address that Consul will bind gRPC API to. Defaults to client_addr but it might be sensitive to have it on localhost/127.0.0.1 for security reasons.</li>
<li><a href="https://www.consul.io/docs/agent/options#grpc_port">ports.grpc</a> - The gRPC API port. We recommend using 8502 for grpc by convention as some tooling will work automatically with this. Currently gRPC is only used to expose Envoy xDS API to Envoy proxies.</li>
</ul>
<h2 id="start-the-consul-service">Start the Consul Service</h2>
<p>First verify your configuration on all hosts:</p>
<pre><code class="language-bash">consul validate /etc/consul.d/
</code></pre>
<p>Installing Consul through the package manager also added a SystemD service file for us in <code>/lib/systemd/system/consul.service</code>:</p>
<pre><code class="language-conf">[Unit]
Description=&quot;HashiCorp Consul - A service mesh solution&quot;
Documentation=https://www.consul.io/
Requires=network-online.target
After=network-online.target
ConditionFileNotEmpty=/etc/consul.d/consul.hcl

[Service]
EnvironmentFile=/etc/consul.d/consul.env
User=consul
Group=consul
ExecStart=/usr/bin/consul agent -config-dir=/etc/consul.d/
ExecReload=/bin/kill --signal HUP $MAINPID
KillMode=process
KillSignal=SIGTERM
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
</code></pre>
<p>Before using this file I will execute Consul manually - this way I will see potential error messages during the start up:</p>
<pre><code class="language-bash">/usr/bin/consul agent -config-dir=/etc/consul.d/

==&gt; Starting Consul agent...
           Version: &#x27;1.12.2&#x27;
           Node ID: &#x27;nodeid&#x27;
         Node name: &#x27;Nomad&#x27;
        Datacenter: &#x27;consul&#x27; (Segment: &#x27;&lt;all&gt;&#x27;)
            Server: true (Bootstrap: true)
       Client Addr: [masterip] (HTTP: 8500, HTTPS: -1, gRPC: 8502, DNS: 8600)
      Cluster Addr: masterip (LAN: 8301, WAN: 8302)
           Encrypt: Gossip: true, TLS-Outgoing: true, TLS-Incoming: true, Auto-Encrypt-TLS: true
</code></pre>
<p>The process is starting without any error messages. But now that I see the log I realize that I did not open any ports yet. Consul requires up to 6 different ports to work properly, some on TCP, UDP, or both protocols:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Use</td><td>Default Ports</td></tr><tr><td>DNS:</td><td>The DNS server (TCP and UDP)	<code>8600</code></td></tr><tr><td>HTTP:</td><td>The HTTP API (TCP Only)	<code>8500</code></td></tr><tr><td>HTTPS:</td><td>The HTTPs API	disabled (<code>8501</code>)*</td></tr><tr><td>gRPC:</td><td>The gRPC API	disabled (<code>8502</code>)*</td></tr><tr><td>LAN Serf:</td><td>The Serf LAN port (TCP and UDP)	<code>8301</code></td></tr><tr><td>Wan Serf:</td><td>The Serf WAN port (TCP and UDP)	<code>8302</code></td></tr><tr><td>server:</td><td>Server RPC address (TCP Only)	<code>8300</code></td></tr><tr><td>Sidecar Proxy Min:</td><td>Inclusive min port number to use for automatically assigned sidecar service registrations.	<code>21000</code></td></tr><tr><td>Sidecar Proxy Max:</td><td>Inclusive max port number to use for automatically assigned sidecar service registrations.	<code>21255</code></td></tr></tbody></table>
<p>For HTTPS and gRPC the ports specified in the table are recommendations. All ports can be set inside <a href="https://www.consul.io/docs/agent/config/config-files#ports">Agent Config</a>. But let&#x27;s open the defaults for now:</p>
<pre><code class="language-bash">ufw allow 8301,8302,8300,8502/tcp
ufw allow 8301,8302,8502/udp
ufw reload &amp;&amp; ufw status
</code></pre>
<p>And run the Consul service:</p>
<pre><code class="language-bash">systemctl enable consul
service consul start
</code></pre>
<p><strong>ERROR</strong> Message:</p>
<pre><code class="language-bash">service consul status                                                                                   
● consul.service - &quot;HashiCorp Consul - A service mesh solution&quot;
     Loaded: loaded (/lib/systemd/system/consul.service; enabled; vendor preset: enabled)
     Active: failed (Result: exit-code) since Fri 2022-06-17 06:29:54 CEST; 4s ago
       Docs: https://www.consul.io/
    Process: 325302 ExecStart=/usr/bin/consul agent -config-dir=/etc/consul.d/ (code=exited, status=1/FAILUR&gt;
   Main PID: 325302 (code=exited, status=1/FAILURE)
        CPU: 93ms

Jun 17 06:29:54 Nomad systemd[1]: consul.service: Main process exited, code=exited, status=1/FAILURE
Jun 17 06:29:54 Nomad systemd[1]: consul.service: Failed with result &#x27;exit-code&#x27;.
Jun 17 06:29:54 Nomad systemd[1]: consul.service: Scheduled restart job, restart counter is at 5.
Jun 17 06:29:54 Nomad systemd[1]: Stopped &quot;HashiCorp Consul - A service mesh solution&quot;.
Jun 17 06:29:54 Nomad systemd[1]: consul.service: Start request repeated too quickly.
Jun 17 06:29:54 Nomad systemd[1]: consul.service: Failed with result &#x27;exit-code&#x27;.
Jun 17 06:29:54 Nomad systemd[1]: Failed to start &quot;HashiCorp Consul - A service mesh solution&quot;.
</code></pre>
<pre><code class="language-bash">journalctl -xe -u consul

The job identifier is 73920.
consul[325302]: ==&gt; Failed to load cert/key pair: open /etc/consul.d/tls/consul-server-consul-0.pem: permission denied
systemd[1]: consul.service: Main process exited, code=exited, status=1/FAILURE
Subject: Unit process exited
</code></pre>
<p>Ok that is strange - I tested to read the file using the consul user. Even when I run <code>chmod 777</code> on it I am still unable to access it:</p>
<pre><code class="language-bash">su consul -s /bin/bash -c &quot;cat /etc/consul.d/tls/consul-server-consul-0.pem&quot;                            
cat: /etc/consul.d/tls/consul-server-consul-0.pem: Permission denied
</code></pre>
<p>This was an issue with the folder permission - I had to raise it to:</p>
<pre><code class="language-bash">chmod 744 /etc/consul.d/tls
</code></pre>
<p>Now it worked!</p>
<h2 id="accessing-the-ui">Accessing the UI</h2>
<p>Just as I did with the Nomad web user interface I can now tunnel the Consul HTTP Port (default <code>8500</code>) to the localhost of my local machine:</p>
<pre><code class="language-bash">ssh -L 8181:localhost:8500 root@[Consul Master public IP] -p [SSH Port]
</code></pre>
<p>And access the interface on <code>http://localhost:8181</code>:</p>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_01-8d7a14d0c8459e7725f2bc8c10e86887.png" width="1180" height="388"></p>
<p>Nomad automatically added my Nomad service and my first active Minion server was also added successfully. But after a while I started getting failing health checks:</p>
<blockquote>
<p><strong>Failing serf check</strong>: This node has a failing serf node check. The health statuses shown on this page are the statuses as they were known before the node became unreachable.</p>
</blockquote>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_02-21eab4118bed1dbbc3d18feff3a04a8b.png" width="1170" height="616"></p>
<p><strong>SOLVED</strong>: I was missing the <code>auto_encrypt</code> key in my client configuration. Now everything seems to work - here is the entire configuration -&gt; <a href="#complete-configuration">see final configuration files</a>.</p>
<h2 id="bootstrap-the-acl-system">Bootstrap the ACL System</h2>
<p>Working from one agent generate the Consul bootstrap token, which has unrestricted privileges:</p>
<pre><code class="language-bash">consul acl bootstrap
</code></pre>
<p>This will return the Consul bootstrap token. You will need the SecretID for all subsequent Consul API requests (including CLI and UI). Ensure that you save the SecretID.</p>
<h2 id="consul-environment-variables">Consul Environment Variables</h2>
<p>Just as with Nomad we now need to use the TLS certificates and ACL tokens when we want to use the Consul CLI. So let&#x27;s add them to our environment, e.g. in <code>~/.zshrc</code>:</p>
<pre><code class="language-bash">export CONSUL_CACERT=/etc/consul.d/tls/consul-agent-ca.pem
export CONSUL_CLIENT_CERT=/etc/consul.d/tls/consul-server-consul-0.pem
export CONSUL_CLIENT_KEY=/etc/consul.d/tls/consul-server-consul-0-key.pem
export CONSUL_HTTP_TOKEN=&quot;&lt;Token SecretID from previous step&gt;&quot;
export CONSUL_MGMT_TOKEN=&quot;&lt;Token SecretID from previous step&gt;&quot;
</code></pre>
<p>Try running a CLI Command on the master Node:</p>
<pre><code class="language-bash">consul members                                                                                          
Node           Address           Status  Type    Build   Protocol  DC    
Nomad          &lt;Master IP:8301&gt;  alive   server  1.12.2  2         consul
kundensysteme  &lt;Minion IP:8301&gt;  alive   client  1.12.2  2         consul
</code></pre>
<h2 id="create-a-node-policy">Create a Node Policy</h2>
<p>Create a node policy file <code>node-policy.hcl</code> with write access for nodes related actions and read access for service related actions:</p>
<pre><code class="language-js">agent_prefix &quot;&quot; {
  policy = &quot;write&quot;
}
node_prefix &quot;&quot; {
  policy = &quot;write&quot;
}
service_prefix &quot;&quot; {
  policy = &quot;read&quot;
}
session_prefix &quot;&quot; {
  policy = &quot;read&quot;
}
</code></pre>
<p>Generate the Consul node ACL policy with the newly created policy file:</p>
<pre><code class="language-bash">consul acl policy create \
  -token=${CONSUL_MGMT_TOKEN} \
  -name node-policy \
  -rules @node-policy.hcl
</code></pre>
<p>Create the node token with the newly created policy:</p>
<pre><code class="language-bash">consul acl token create \
  -token=${CONSUL_MGMT_TOKEN} \
  -description &quot;node token&quot; \
  -policy-name node-policy
</code></pre>
<p>On <strong>ALL</strong> Consul Servers add the node token:</p>
<pre><code class="language-bash">consul acl set-agent-token \
  -token=&quot;&lt;Management Token SecretID&gt;&quot; \
  agent &quot;&lt;Node Token SecretID&gt;&quot;
</code></pre>
<p>To increase security for <a href="https://learn.hashicorp.com/tutorials/consul/deployment-guide">your datacenter</a>, we we will complete the <a href="https://learn.hashicorp.com/tutorials/consul/access-control-setup-production">Secure Consul with Access Control Lists (ACLs)</a> in the next step.</p>
<h2 id="configuring-nomad-for-consul-only-master-node">Configuring Nomad for Consul (Only Master Node)</h2>
<p>After the installation I checked the Consul log and found that there was an error message coming in every 30s:</p>
<pre><code class="language-bash">consul[351769]: 2022-06-18T13:42:31.136+0200 [ERROR] agent.http: Request error: method=PUT url=/v1/agent/service/register from=127.0.0.1:59386 error=&quot;Bad request: Invalid service address&quot;
consul[351769]: 2022-06-18T13:43:01.142+0200 [ERROR] agent.http: Request error: method=PUT url=/v1/agent/service/register from=127.0.0.1:59386 error=&quot;Bad request: Invalid service address&quot;
consul[351769]: 2022-06-18T13:43:31.160+0200 [ERROR] agent.http: Request error: method=PUT url=/v1/agent/service/register from=127.0.0.1:59386 error=&quot;Bad request: Invalid service address&quot;
consul[351769]: 2022-06-18T13:44:01.166+0200 [ERROR] agent.http: Request error: method=PUT url=/v1/agent/service/register from=127.0.0.1:59386 error=&quot;Bad request: Invalid service address&quot;
</code></pre>
<p>I assumed that this must be the local Nomad service trying to connect and missing the ACL token. There is a <a href="https://www.nomadproject.io/docs/configuration/consul">Consul block</a> in the Nomad configuration file:</p>
<pre><code class="language-js">consul {
  address = &quot;127.0.0.1:8500&quot;
  grpc_address = &quot;127.0.0.1:8502&quot;
  ssl = true
  ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
  cert_file = &quot;/etc/consul.d/tls/consul-server-consul-0.pem&quot;
  key_file = &quot;/etc/consul.d/tls/consul-server-consul-0-key.pem&quot;
  verify_ssl = true
  token = &quot;&quot;
  client_service_name = &quot;nomad-client&quot;
  server_service_name = &quot;nomad&quot;
  auto_advertise      = true
  server_auto_join    = true
  client_auto_join    = true
}
</code></pre>
<p>To prevent getting permission errors when trying to read the cert files we need to expand the read rights on those consul certificates. Starting the service back up - seems is in order now. Nomad and Consul are running and the error messages disappeared.</p>
<h2 id="accessing-the-ui-tls">Accessing the UI (TLS)</h2>
<p>I was running into the issue that now with TLS encryption enabled and cert verification enforced I was unable to access the Consul UI. Since I keep my HTTP/HTTPS ports closed I will change the Consul Server configuration (only on the master node that supplies my UI) to skip the verification step for HTTPS:</p>
<pre><code class="language-js"># TLS configuration
tls {
  defaults {
    ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
    cert_file = &quot;/etc/consul.d/tls/consul-server-consul-0.pem&quot;
    key_file = &quot;/etc/consul.d/tls/consul-server-consul-0-key.pem&quot;
    verify_incoming = true
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = true
  }
  https {
    verify_incoming = false
  }
}
</code></pre>
<p>Now I only need to forward the HTTPS port (default <code>8501</code>) to my machine and am able to access the UI again on <code>https://localhost:8181</code>:</p>
<pre><code class="language-bash">ssh -L 8181:localhost:8501 root@[Consul Master public IP] -p [SSH Port]
</code></pre>
<h2 id="complete-configuration">Complete Configuration</h2>
<h3 id="master-node">Master Node</h3>
<p><em>consul.hcl</em></p>
<pre><code class="language-js"># datacenter
datacenter = &quot;consul&quot;

# data_dir
data_dir = &quot;/opt/consul&quot;

# bootstrap_expect
bootstrap_expect=1

# encrypt
encrypt = &quot;[Gossip Encryption Key]&quot;

# retry_join
retry_join = [&quot;[My Master Address]&quot;]
 
# TLS configuration
tls {
  defaults {
    ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
    cert_file = &quot;/etc/consul.d/tls/consul-server-consul-0.pem&quot;
    key_file = &quot;/etc/consul.d/tls/consul-server-consul-0-key.pem&quot;
    verify_incoming = true
    verify_outgoing = true
  }
  internal_rpc {
    verify_server_hostname = true
  }
  https {
    verify_incoming = false
  }
}

# ACL configuration
acl {
  enabled = true
  default_policy = &quot;allow&quot;
  enable_token_persistence = true
}

# Performance
performance {
  raft_multiplier = 1
}
</code></pre>
<p><em>server.hcl</em></p>
<pre><code class="language-js"># client_addr
client_addr = &quot;127.0.0.1&quot;

# ui
ui_config{
  enabled = true
}

auto_encrypt {
  allow_tls = true
}

# server
server = true

# Bind addr
bind_addr = &quot;[My Master Address]&quot;

# Service mesh
# connect {
#   enabled = true
# }

# addresses {
#   grpc = &quot;[My Master Address]&quot;
# }

ports {
  grpc  = 8502
  dns = -1
  http = -1
  https = 8501
  serf_lan = 8301
  serf_wan = 8302
  server = 8300
}
</code></pre>
<h3 id="minion-node">Minion Node</h3>
<p><em>consul.hcl</em></p>
<pre><code class="language-js"># datacenter
datacenter = &quot;consul&quot;

# data_dir
data_dir = &quot;/opt/consul&quot;

# client_addr
client_addr = &quot;127.0.0.1&quot;


# server
server = false
bind_addr = &quot;[My Minion Address]&quot;
ports {
  grpc  = 8502
  dns = 8600
  http = 8500
  https = 8501
  serf_lan = 8301
  serf_wan = 8302
  server = 8300
}

# encrypt
encrypt = &quot;[Gossip Encryption Key]&quot;

# retry_join
retry_join = [&quot;[My Master Address]&quot;]

 
# TLS configuration
tls {
  defaults {
    ca_file = &quot;/etc/consul.d/tls/consul-agent-ca.pem&quot;
    # cert_file = &quot;/etc/consul.d/tls/consul-server-consul-0.pem&quot;
    # key_file = &quot;/etc/consul.d/tls/consul-server-consul-0-key.pem&quot;
  }
  internal_rpc {
    verify_server_hostname = true
  }
}
auto_encrypt {
    tls = true
 }

# ACL configuration
acl {
  enabled = true
  default_policy = &quot;allow&quot;
  enable_token_persistence = true
}

# Performance
performance {
  raft_multiplier = 1
}
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/consul">Consul</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Hashicorp/2022-05-22-hashicorp-dojo-nomad-consul-part-2/2022-05-22"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hashicorp Nomad with Consul II - The Reckoning</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Hashicorp/2022-05-20-hashicorp-dojo-nomad-consul/2022-05-20"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hashicorp Nomad with Consul Service Discovery</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-consul" class="table-of-contents__link toc-highlight">Install Consul</a></li><li><a href="#security" class="table-of-contents__link toc-highlight">Security</a><ul><li><a href="#generate-the-gossip-encryption-key" class="table-of-contents__link toc-highlight">Generate the gossip encryption key</a></li><li><a href="#generate-tls-certificates-for-rpc-encryption" class="table-of-contents__link toc-highlight">Generate TLS certificates for RPC encryption</a></li></ul></li><li><a href="#configure-consul-agents" class="table-of-contents__link toc-highlight">Configure Consul agents</a><ul><li><a href="#general-defaults" class="table-of-contents__link toc-highlight">General defaults</a></li><li><a href="#tls-encryption" class="table-of-contents__link toc-highlight">TLS encryption</a></li><li><a href="#datacenter-auto-join" class="table-of-contents__link toc-highlight">Datacenter auto-join</a></li><li><a href="#enable-consul-acls" class="table-of-contents__link toc-highlight">Enable Consul ACLs</a></li><li><a href="#performance-stanza" class="table-of-contents__link toc-highlight">Performance stanza</a></li></ul></li><li><a href="#master-configuration" class="table-of-contents__link toc-highlight">Master Configuration</a><ul><li><a href="#consul-service-mesh" class="table-of-contents__link toc-highlight">Consul Service Mesh</a></li></ul></li><li><a href="#start-the-consul-service" class="table-of-contents__link toc-highlight">Start the Consul Service</a></li><li><a href="#accessing-the-ui" class="table-of-contents__link toc-highlight">Accessing the UI</a></li><li><a href="#bootstrap-the-acl-system" class="table-of-contents__link toc-highlight">Bootstrap the ACL System</a></li><li><a href="#consul-environment-variables" class="table-of-contents__link toc-highlight">Consul Environment Variables</a></li><li><a href="#create-a-node-policy" class="table-of-contents__link toc-highlight">Create a Node Policy</a></li><li><a href="#configuring-nomad-for-consul-only-master-node" class="table-of-contents__link toc-highlight">Configuring Nomad for Consul (Only Master Node)</a></li><li><a href="#accessing-the-ui-tls" class="table-of-contents__link toc-highlight">Accessing the UI (TLS)</a></li><li><a href="#complete-configuration" class="table-of-contents__link toc-highlight">Complete Configuration</a><ul><li><a href="#master-node" class="table-of-contents__link toc-highlight">Master Node</a></li><li><a href="#minion-node" class="table-of-contents__link toc-highlight">Minion Node</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>