<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Hashicorp Consul Refresher - Service Discovery | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hashicorp Consul Refresher - Service Discovery | Mike Polinowski"><meta data-rh="true" name="description" content="Cheung Chau, Hongkong"><meta data-rh="true" property="og:description" content="Cheung Chau, Hongkong"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.37984c46.js" defer="defer"></script>
<script src="/assets/js/main.b3107e46.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Collapse sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-12-23-opentofu-vs-terraform/2023-12-22">Opentofu vs Hashicorp Terraform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-12-22-hashicorp-terraform-docker-2024/2023-12-22">Hashicorp Terraform - Docker Provider 2024</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2023-10-22-hashicorp-terraform-docker-2023/2023-10-22">Hashicorp Terraform - Docker Provider 2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-07-hashicorp-vault-ca-certificates/2022-12-07">Hashicorp Vault - Certificate Authority</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-05-hashicorp-consul-vault-certificates-part3/2022-12-05">Hashicorp Consul - Vault Cert Management Part 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-05-hashicorp-consul-vault-certificates-part2/2022-12-05">Hashicorp Consul - Vault Cert Management Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-04-hashicorp-consul-vault-certificates-part1/2022-12-04">Hashicorp Consul - Vault Cert Management Part 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-12-03-hashicorp-vault-installation/2022-12-03">Hashicorp Vault - Installation 2023</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-24-hashicorp-consul-connect/2022-11-24">Hashicorp Nomad - Working with Consul Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-18-hashicorp-nomad-grav/2022-11-18">Deploy Grav CMS with Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-16-hashicorp-nomad-mautic/2022-11-16">Deploy Mautic with Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-15-hashicorp-nomad-nginx-load-balancing/2022-11-15">Hashicorp Nomad for NGINX Load-balancing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-15-hashicorp-nomad-balanced-nts/2022-11-15">Hashicorp Nomad Secure &amp; Balanced NTS Time Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-12-hashicorp-nomad-certbot-renewal/2022-11-12">Hashicorp Nomad to Renew your TLS Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-11-11-hashicorp-nomad-for-borg-backups/2022-11-11">Hashicorp Nomad to run periodic backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-25-hashicorp-nomad-for-osticket-part-ii/2022-10-25">Hashicorp Nomad to set up an OSTicket Helpdesk - Part II</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-23-hashicorp-nomad-ports/2022-10-23">Hashicorp Nomad - Working with Ports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-23-hashicorp-consul-connect/2022-10-23">Hashicorp Nomad - Working with Consul Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-22-hashicorp-nomad-sidecar-pattern/2022-10-22">Hashicorp Nomad Sidecar Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-10-21-hashicorp-nomad-for-osticket-part-i/2022-10-21">Hashicorp Nomad to set up an OSTicket Helpdesk - Part I</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-09-24--nomad-nginx-ingress/2022-09-24">NGINX Ingress with Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-09-22--nomad-nts-timeserver/2022-09-22">Secure Timeserver - Deploying a NTS Server using Hashicorp Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-06-08-hashicorp-waypoint-nomad/2022-06-09">Hashicorp Waypoint with Nomad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-06-07-hashicorp-waypoint-docker/2022-06-07">Hashicorp Waypoint with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-29-hashicorp-nomad-with-nginx-loadbalancer/2022-05-29">Hashicorp Nomad with NGINX Loadbalancer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-28-hashicorp-nomad-for-elastic-part-2/2022-05-28">Hashicorp Nomad to set up an Elasticsearch Cluster Part II</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-27-hashicorp-nomad-for-elastic/2022-05-27">Hashicorp Nomad to set up an Elasticsearch Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-26-hashicorp-nomad-with-gitlab-part-2/2022-05-26">App Deployment with Hashicorp Nomad from Gitlab Part Deux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-25-hashicorp-nomad-with-gitlab/2022-05-25">App Deployment with Hashicorp Nomad from Gitlab</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-24-hashicorp-nomad-with-nginx/2022-05-24">Hashicorp Nomad for NGINX Web Proxies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-22-hashicorp-dojo-nomad-consul-part-2/2022-05-22">Hashicorp Nomad with Consul II - The Reckoning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-21-hashicorp-dojo-consul-refresher/2022-05-21">Hashicorp Dojo Consul Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-20-hashicorp-dojo-nomad-consul/2022-05-20">Hashicorp Nomad with Consul Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-19-hashicorp-dojo-nomad-access-control/2022-05-19">Hashicorp Nomad Access Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-18-hashicorp-dojo-nomad-adding-encryption/2022-05-18">Hashicorp Nomad Adding Encryption to your Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-17-hashicorp-dojo-nomad-deployment/2022-05-17">Hashicorp Nomad Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-16-hashicorp-dojo-nomad-starter/2022-05-16">Hashicorp Nomad Dojo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2022-05-15-hashicorp-nomad-refresher/2022-05-15">Hashicorp Nomad Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-10-11--hashicorp-consul-in-production/2021-10-11">Hashicorp Consul in Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-10-10--hashicorp-nomad-in-production/2021-10-10">Hashicorp Nomad in Production</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-09-06--hashicorp-terraform-providers-variables-attributes/2021-09-07">Hashicorp Terraform - Providers, Variables &amp; Attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-09-05--hashicorp-terraform-setup/2021-09-05">Hashicorp Terraform - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-25--hashicorp-vault-logging/2021-08-25">Hashicorp Vault - Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-23--hashicorp-vault-rest-api/2021-08-23">Hashicorp Vault - Rest API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-22--hashicorp-vault-policies/2021-08-22">Hashicorp Vault - ACL Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-21--hashicorp-vault-secrets-tokens/2021-08-21">Hashicorp Vault - Secrets &amp; Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-20--hashicorp-vault-setup/2021-08-20">Hashicorp Vault - Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-14--hashicorp-consul-tls-encryption/2021-08-14">Hashicorp Consul Refresher - Gossip TLS Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-13--hashicorp-consul-access-control-lists/2021-08-13">Hashicorp Consul Refresher - Access Control Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-12--hashicorp-consul-service-mesh/2021-08-12">Hashicorp Consul Refresher - Service Mesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-11--hashicorp-consul-backups/2021-08-11">Hashicorp Consul Refresher - Backups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-10--hashicorp-consul-key-value-store/2021-08-10">Hashicorp Consul Refresher - Key Value Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-09--hashicorp-consul-services/2021-08-09">Hashicorp Consul Refresher - Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-08--hashicorp-nomad-access-control-lists/2021-08-08">Nomad Access Control Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-07--hashicorp-nomad-job-configuration/2021-08-07">Nomad Job Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-06--hashicorp-consul-traefik-loadbalancing/2021-08-06">Hashicorp Consul Refresher - Loadbalancing with Traefik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-06--hashicorp-consul-fabio-loadbalancing/2021-08-06">Hashicorp Consul Refresher - Loadbalancing with Fabio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/2021-08-05">Hashicorp Consul Refresher - Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-04--hashicorp-nomad-job-specifications/2021-08-04">Hashicorp Nomad Refresher - Job Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-03--hashicorp-nomad-jobs/2021-08-03">Hashicorp Nomad Refresher - Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-02--hashicorp-nomad-security/2021-08-02">Hashicorp Nomad Refresher - Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2021-08-01--hashicorp-nomad-refresher/2021-08-01">Hashicorp Nomad Refresher - Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-26--hashicorp-packer-provisioner/2020-10-26">HashiCorp Packer Provisioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-25--hashicorp-packer-and-virtualbox-autoinstall/2020-10-25">HashiCorp Packer with Virtualbox (Autoinstall)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-24--hashicorp-packer-and-virtualbox-preseed/2020-10-24">HashiCorp Packer with Virtualbox (Preseed)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-10-23--hashicorp-packer-machine-image/2020-10-23">HashiCorp Packer Machine Images Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-19--consul-deployment-guide/2020-08-19">Consul Deployment Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-18--consul-service-mesh/2020-08-18">Consul Service Mesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-18--consul-mock-datacenter/2020-08-19">Joining Consul Clients</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-17--installing-consul-ubuntu/2020-08-17">Installing HashiCorp Consul on Ubuntu Server 20.04</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-16--nomad-cluster/2020-08-16">Nomad Server Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Hashicorp/2020-08-15--installing-nomad-ubuntu/2020-08-15">Installing HashiCorp Nomad on Ubuntu Server 20.04</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/hashicorp"><span itemprop="name">Hashicorp</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hashicorp Consul Refresher - Service Discovery</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hashicorp Consul Refresher - Service Discovery</h1></header><p><img alt="Cheung Chau, Hongkong" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-825ad0c1979a3b8d8834b2806be1b28e.jpg" width="1500" height="386"></p>
<blockquote>
<p>This article is a bit messy... a lot of things changed since the <code>0.x</code> releases of Consul and I ran into a few bumps on the way. A lot of things learnt, errors and solution documented. But I will have to write up a clean version of this to have a step-by-step guide for future reference.</p>
</blockquote>
<ul>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#debian11">Debian11</a></li>
<li><a href="#rhel8">RHEL8</a>
<ul>
<li><a href="#consul-commandline-autocompletion">Consul Commandline Autocompletion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#test-running">Test-Running</a></li>
<li><a href="#service-configuration">Service Configuration</a></li>
<li><a href="#run-consul-as-a-service">Run Consul as a Service</a>
<ul>
<li><a href="#needed-ports">Needed Ports</a></li>
</ul>
</li>
<li><a href="#service-configuration-1">Service Configuration</a>
<ul>
<li><a href="#problems">Problems</a></li>
</ul>
</li>
<li><a href="#registering-a-service-in-nomad">Registering a Service in Nomad</a></li>
<li><a href="#default-consul-configuration">Default Consul Configuration</a></li>
<li><a href="#consul-service-error-message">Consul Service Error Message</a></li>
</ul>
<p>Nomad schedules workloads of various types across a cluster of generic hosts. Because of this, placement is not known in advance and you will need to use service discovery to connect tasks to other services deployed across your cluster. Nomad integrates with Consul to provide service discovery and monitoring.</p>
<p><a href="https://www.consul.io/">Consul</a> allows services to easily register themselves in a central catalog when they start up. When an application or service needs to communicate with another component, the central catalog can be queried using either an API or DNS interface to provide the required addresses.</p>
<h2 id="installation">Installation</h2>
<h3 id="debian11">Debian11</h3>
<pre><code class="language-bash">curl -fsSL https://apt.releases.hashicorp.com/gpg | apt-key add -
apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;
apt-get update &amp;&amp; apt-get install consul
</code></pre>
<h3 id="rhel8">RHEL8</h3>
<pre><code class="language-bash">sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
sudo yum -y install consul
</code></pre>
<h4 id="consul-commandline-autocompletion">Consul Commandline Autocompletion</h4>
<pre><code class="language-bash">consul -autocomplete-install
complete -C /usr/bin/consul consul
</code></pre>
<h2 id="test-running">Test-Running</h2>
<p>You can start the Consul Agent with <a href="https://www.consul.io/docs/agent/options#command-line-options">configuration flags</a>:</p>
<pre><code class="language-bash">consul agent -datacenter=instaryun -data-dir=/opt/consul -bind &#x27;{{ GetInterfaceIP &quot;enp2s0&quot; }}&#x27;
</code></pre>
<p>To get started I will execute the service in DEV mode on my master:</p>
<pre><code class="language-bash">consul agent -dev -datacenter=instaryun -data-dir=/opt/consul -bind &#x27;{{ GetInterfaceIP &quot;enp3s0&quot; }}&#x27;
</code></pre>
<p>The Consul server GUI will be available on Port <code>8500</code> and I can tunnel it through SSH with:</p>
<pre><code class="language-bash">ssh myuser@192.168.2.110 -L8500:localhost:8500
</code></pre>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_01-7fe7c1a0275a1539d314e6887332c91b.png" width="1140" height="459"></p>
<h2 id="service-configuration">Service Configuration</h2>
<p>Again - just like with Nomad - I discovered that the default config is missing on Debian11, while it is located in <code>/etc/consul.d/</code> on RHEL8. I will list the default <code>consul.hcl</code> config at <a href="#default-consul-configuration">end of this article</a>.</p>
<p>We can use this configuration file - instead of adding all variables to the <code>consul agent</code> command:</p>
<pre><code class="language-bash">/usr/bin/consul agent -config-file=/etc/consul.d/consul.hcl

/usr/bin/consul agent -config-dir=/etc/consul.d
</code></pre>
<p>We can now <a href="https://www.consul.io/docs/agent/options">add the our configuration</a> to <a href="#default-consul-configuration">/etc/consul.d/consul.hcl</a>:</p>
<pre><code class="language-yml">node_name = &quot;consul-master&quot;
datacenter = &quot;instaryun&quot;
data_dir = &quot;/opt/consul&quot;
# allow all clients
client_addr = &quot;0.0.0.0&quot;
# enable the ui
ui_config{
  enabled = true
}
# make this instance the master server
server = true
# add your servers IP
bind_addr = &quot;192.168.2.110&quot;
advertise_addr = &quot;192.168.2.110&quot;
# For testing I only have 1 - later 5 master servers are recommended
bootstrap_expect=1
# I only have 1 other client server. Set it to allow constant retries because it is not yet configured
retry_join = [&quot;192.168.2.111&quot;]
enable_syslog = true
log_level = &quot;INFO&quot;
# https://www.consul.io/docs/agent/options#performance
performance{
  raft_multiplier = 1
}
</code></pre>
<p>You can test run the configuration file - see if it is throwing us any errors:</p>
<pre><code class="language-bash">/usr/bin/consul agent -config-file=/etc/consul.d/consul.hcl
</code></pre>
<p>Or run the Test command:</p>
<pre><code class="language-bash">consul validate /etc/consul.d/consul.hcl

BootstrapExpect is set to 1; this is the same as Bootstrap mode.
bootstrap = true: do not enable unless necessary
Configuration is valid!
</code></pre>
<h2 id="run-consul-as-a-service">Run Consul as a Service</h2>
<h3 id="needed-ports">Needed Ports</h3>
<p>Consul uses 3 ports:</p>
<ol>
<li><code>8500</code> - Consul UI</li>
<li><code>8301</code> / <code>8300</code> - LAN Gossip</li>
<li><code>8600</code> - DNS</li>
</ol>
<p>I will open those ports in my firewall (except the UI):</p>
<p><strong>FirewallD</strong></p>
<pre><code class="language-bash">sudo firewall-cmd --permanent --zone=public --add-port={8300/tcp,8301/tcp,8600/tcp}
sudo firewall-cmd --reload

sudo firewall-cmd --zone=public --list-ports
</code></pre>
<p><strong>ufw</strong></p>
<pre><code class="language-bash">ufw allow 8301,8600/tcp
ufw reload

ufw status verbose
</code></pre>
<blockquote>
<p>The documentation I found said that the Gossip port is <code>3001</code>. But when I started Consul up the first time it tried to connect through port <code>3000</code> and the cluster join failed. But the next day Consul started using <code>3001</code> ¯\<em>(ツ)</em>/¯</p>
</blockquote>
<pre><code class="language-bash">agent.client: RPC failed to server: method=KVS.List server=192.168.2.110:8300 error=&quot;rpc error getting client: failed to get conn: dial tcp 192.168.2.111:0-&gt;192.168.2.110:8300: connect: no route to host&quot;
</code></pre>
<blockquote>
<p><strong>Update</strong>: See above - happened again. It seems that you need both port <code>8300</code> and <code>8301</code>.</p>
</blockquote>
<h2 id="service-configuration-1">Service Configuration</h2>
<p>Create the <a href="https://learn.hashicorp.com/tutorials/consul/deployment-guide#configure-systemd">SystemD Service file</a> in <code>/etc/systemd/system/consul.service</code>:</p>
<pre><code class="language-cfg">[Unit]
Description=&quot;HashiCorp Consul&quot;
Documentation=https://www.consul.io/
Requires=network-online.target
After=network-online.target
ConditionFileNotEmpty=/etc/consul.d/consul.hcl

[Service]
Type=notify
User=consul
Group=consul
ExecStart=/usr/bin/consul agent -config-dir=/etc/consul.d/
ExecReload=/bin/kill --signal HUP $MAINPID
KillMode=process
KillSignal=SIGTERM
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
</code></pre>
<pre><code class="language-bash">sudo systemctl daemon-reload
sudo service consul start
</code></pre>
<h3 id="problems">Problems</h3>
<p>In the beginning I ran into a permission error:</p>
<pre><code class="language-bash">Aug 31 14:03:44 nomad-master consul[54505]: ==&gt; failed to setup node ID: open /opt/consul/node-id: permission denied
Aug 31 14:03:44 nomad-master systemd[1]: consul.service: Main process exited, code=exited, status=1/FAILURE
Aug 31 14:03:44 nomad-master systemd[1]: consul.service: Failed with result &#x27;exit-code&#x27;.
</code></pre>
<p>As a dirty fix I changed the entire data directory to <code>777</code> /The <a href="https://learn.hashicorp.com/tutorials/consul/deployment-guide#install-consul">deployment guide</a> creates an extra user for consul - I will go this route in the next test run.</p>
<pre><code class="language-bash">chmod -R 777 /opt/consul
</code></pre>
<p>Now the service started but is failing because the Consul minion, that I did not configure yet, is not connecting - <a href="#consul-service-error-message">see Error Log</a>.</p>
<p>So now I added the identical <strong>Service file</strong> to my Debian11 minion and added the following <strong>Configuration</strong> <code>/etc/consul.d/consul.hcl</code>:</p>
<pre><code class="language-yml">node_name = &quot;consul-minion&quot;
datacenter = &quot;instaryun&quot;
data_dir = &quot;/opt/consul&quot;
# allow all clients
client_addr = &quot;0.0.0.0&quot;
# disable the ui
ui = false
# make this instance the master server
server = false
# add your servers IP
bind_addr = &quot;192.168.2.111&quot;
advertise_addr = &quot;192.168.2.111&quot;
retry_join = [&quot;192.168.2.110&quot;]
enable_syslog = true
log_level = &quot;INFO&quot;
# https://www.consul.io/docs/agent/options#performance
performance{
  raft_multiplier = 1
}
</code></pre>
<p>Note that I set <code>server</code> to false, removed the <code>bootstap</code> variable and had to rewrite the <code>ui</code> variable - the latter might be because I am using version <code>Consul v1.8.7</code> while I am on <code>Consul v1.10.2</code> on my master server.</p>
<p>As an alternative to <code>retry_join</code> I can also manually join this client into an existing cluster with the join command (or leave):</p>
<pre><code class="language-bash">consul join [IP address or domain of one of your Consul servers]
consul leave
</code></pre>
<p><strong>This time both services started successfully!</strong> And the UI shows me that both nodes successfully joined the Consul cluster:</p>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_03-c51dfacf36a0d58ee288f98d07553eb0.png" width="1137" height="388"></p>
<p><strong>Note</strong>: The node name is taken from the server hostname instead of the Consul configuration file - hence I am having a <strong>Nomad Master</strong> instead of the <strong>consul-master</strong> I defined. To change your servers hostname run the following commands and restart the Consul service:</p>
<pre><code class="language-bash">hostname

hostnamectl set-hostname consul-master

hostname

service consul restart
</code></pre>
<p>Now Consul displays the correct node name:</p>
<pre><code class="language-bash">consul operator raft list-peers

Node           ID                                    Address             State   Voter  RaftProtocol
consul-master  d561f8d4-9606-8c9c-40d4-a5350857801e  192.168.2.110:8300  leader  true   3
</code></pre>
<pre><code class="language-bash">consul members

Node           Address             Status  Type    Build   Protocol  DC         Segment
consul-master  192.168.2.110:8301  alive   server  1.10.2  2         instaryun  &lt;all&gt;
consul-minion  192.168.2.111:8301  alive   client  1.8.7   2         instaryun  &lt;default&gt;
</code></pre>
<h2 id="registering-a-service-in-nomad">Registering a Service in Nomad</h2>
<p>There are <a href="https://learn.hashicorp.com/consul/getting-started/services">multiple ways to register a service in Consul</a>. Fortunately Nomad has a first class integration that makes it very simple to add a service stanza to a job file to perform this registration for us. To register our Nomad deployed <a href="/docs/DevOps/Hashicorp/2021-08-04--hashicorp-nomad-job-specifications/2021-08-04">http-echo application</a>, we simply add a <a href="https://www.nomadproject.io/docs/job-specification/service">service block</a> to the Nomad job file:</p>
<pre><code class="language-json">service {
  name = &quot;http-echo&quot;
  port = &quot;heartbeat&quot;

  tags = [
    &quot;heartbeat&quot;,
    &quot;urlprefix-/http-echo&quot;,
  ]

  check {
    type     = &quot;http&quot;
    path     = &quot;/health&quot;
    interval = &quot;2s&quot;
    timeout  = &quot;2s&quot;
  }
}
</code></pre>
<p>The <a href="/docs/DevOps/Hashicorp/2021-08-04--hashicorp-nomad-job-specifications/2021-08-04">http-echo job file</a> now looks like:</p>
<pre><code class="language-bash">cat ~/nomad_jobs/http_echo_gui.nomad
</code></pre>
<pre><code class="language-json">job &quot;http-echo-gui&quot; {
  datacenters = [&quot;instaryun&quot;]

  group &quot;echo&quot; {

    network {
        port &quot;heartbeat&quot; {
            static = 8080
            }
    }

    count = 1
    task &quot;server&quot; {
      driver = &quot;docker&quot;
      config {
        image = &quot;hashicorp/http-echo:latest&quot;
        ports = [&quot;heartbeat&quot;]
        args  = [
          &quot;-listen&quot;, &quot;:${NOMAD_PORT_heartbeat}&quot;,
          &quot;-text&quot;, &quot;${attr.os.name}: server running on ${NOMAD_IP_heartbeat} with port ${NOMAD_PORT_heartbeat}&quot;,
        ]
      }
      service {
        name = &quot;http-echo&quot;
        port = &quot;heartbeat&quot;

        tags = [
          &quot;heartbeat&quot;,
          &quot;urlprefix-/http-echo&quot;,
        ]

        check {
          type     = &quot;http&quot;
          path     = &quot;/health&quot;
          interval = &quot;2s&quot;
          timeout  = &quot;2s&quot;
        }
      }
    }
  }
}
</code></pre>
<p>And can be directly updated from the Nomad GUI:</p>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_02-027e6c68c37b63220b83614d41c2c957.png" width="1135" height="865"></p>
<p>First click on <strong>Plan</strong> and then <strong>Run</strong> to schedule the job. Once the task is running, check in Consul if the service <code>http-echo</code> registered itself:</p>
<pre><code class="language-bash">consul catalog services

consul
http-echo
nomad
nomad-client
</code></pre>
<p>In the Consul UI I can see that the healthcheck URL is working:</p>
<p><img alt="Hashicorp Consul" src="/assets/images/Hashicorp_Consul_04-e0e29a4ab71c214b38e276b952bf9272.png" width="1307" height="695"></p>
<p>You can also test it from your browser with by visiting the URL listed by Consul <code>http://192.168.2.111:8080/health</code>:</p>
<pre><code class="language-json">{ &quot;status&quot;: &quot;ok&quot; }
</code></pre>
<h2 id="default-consul-configuration">Default Consul Configuration</h2>
<p>From the default package manager installation of <em>Consul v1.10.2</em> on RHEL8 in <code>/etc/consul.d/consul.hcl</code>:</p>
<pre><code class="language-json"># Full configuration options can be found at https://www.consul.io/docs/agent/options.html

# datacenter
# This flag controls the datacenter in which the agent is running. If not provided,
# it defaults to &quot;dc1&quot;. Consul has first-class support for multiple datacenters, but
# it relies on proper configuration. Nodes in the same datacenter should be on a
# single LAN.
#datacenter = &quot;my-dc-1&quot;

# data_dir
# This flag provides a data directory for the agent to store state. This is required
# for all agents. The directory should be durable across reboots. This is especially
# critical for agents that are running in server mode as they must be able to persist
# cluster state. Additionally, the directory must support the use of filesystem
# locking, meaning some types of mounted folders (e.g. VirtualBox shared folders) may
# not be suitable.
data_dir = &quot;/opt/consul&quot;

# client_addr
# The address to which Consul will bind client interfaces, including the HTTP and DNS
# servers. By default, this is &quot;127.0.0.1&quot;, allowing only loopback connections. In
# Consul 1.0 and later this can be set to a space-separated list of addresses to bind
# to, or a go-sockaddr template that can potentially resolve to multiple addresses.
#client_addr = &quot;0.0.0.0&quot;

# ui
# Enables the built-in web UI server and the required HTTP routes. This eliminates
# the need to maintain the Consul web UI files separately from the binary.
# Version 1.10 deprecated ui=true in favor of ui_config.enabled=true
#ui_config{
#  enabled = true
#}

# server
# This flag is used to control if an agent is in server or client mode. When provided,
# an agent will act as a Consul server. Each Consul cluster must have at least one
# server and ideally no more than 5 per datacenter. All servers participate in the Raft
# consensus algorithm to ensure that transactions occur in a consistent, linearizable
# manner. Transactions modify cluster state, which is maintained on all server nodes to
# ensure availability in the case of node failure. Server nodes also participate in a
# WAN gossip pool with server nodes in other datacenters. Servers act as gateways to
# other datacenters and forward traffic as appropriate.
#server = true

# Bind addr
# You may use IPv4 or IPv6 but if you have multiple interfaces you must be explicit.
#bind_addr = &quot;[::]&quot; # Listen on all IPv6
#bind_addr = &quot;0.0.0.0&quot; # Listen on all IPv4
#
# Advertise addr - if you want to point clients to a different address than bind or LB.
#advertise_addr = &quot;127.0.0.1&quot;

# Enterprise License
# As of 1.10, Enterprise requires a license_path and does not have a short trial.
#license_path = &quot;/etc/consul.d/consul.hclic&quot;

# bootstrap_expect
# This flag provides the number of expected servers in the datacenter. Either this value
# should not be provided or the value must agree with other servers in the cluster. When
# provided, Consul waits until the specified number of servers are available and then
# bootstraps the cluster. This allows an initial leader to be elected automatically.
# This cannot be used in conjunction with the legacy -bootstrap flag. This flag requires
# -server mode.
#bootstrap_expect=3

# encrypt
# Specifies the secret key to use for encryption of Consul network traffic. This key must
# be 32-bytes that are Base64-encoded. The easiest way to create an encryption key is to
# use consul keygen. All nodes within a cluster must share the same encryption key to
# communicate. The provided key is automatically persisted to the data directory and loaded
# automatically whenever the agent is restarted. This means that to encrypt Consul&#x27;s gossip
# protocol, this option only needs to be provided once on each agent&#x27;s initial startup
# sequence. If it is provided after Consul has been initialized with an encryption key,
# then the provided key is ignored and a warning will be displayed.
#encrypt = &quot;...&quot;

# retry_join
# Similar to -join but allows retrying a join until it is successful. Once it joins
# successfully to a member in a list of members it will never attempt to join again.
# Agents will then solely maintain their membership via gossip. This is useful for
# cases where you know the address will eventually be available. This option can be
# specified multiple times to specify multiple agents to join. The value can contain
# IPv4, IPv6, or DNS addresses. In Consul 1.1.0 and later this can be set to a go-sockaddr
# template. If Consul is running on the non-default Serf LAN port, this must be specified
# as well. IPv6 must use the &quot;bracketed&quot; syntax. If multiple values are given, they are
# tried and retried in the order listed until the first succeeds. Here are some examples:
#retry_join = [&quot;consul.domain.internal&quot;]
#retry_join = [&quot;10.0.4.67&quot;]
#retry_join = [&quot;[::1]:8301&quot;]
#retry_join = [&quot;consul.domain.internal&quot;, &quot;10.0.4.67&quot;]
# Cloud Auto-join examples:
# More details - https://www.consul.io/docs/agent/cloud-auto-join
#retry_join = [&quot;provider=aws tag_key=... tag_value=...&quot;]
#retry_join = [&quot;provider=azure tag_name=... tag_value=... tenant_id=... client_id=... subscription_id=... secret_access_key=...&quot;]
#retry_join = [&quot;provider=gce project_name=... tag_value=...&quot;]
</code></pre>
<h2 id="consul-service-error-message">Consul Service Error Message</h2>
<p><em>see <a href="#problems">Problems</a></em></p>
<pre><code class="language-bash">Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: DEPRECATED Backwards compatibil&gt;Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Retry join is supported for the&gt;Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Joining cluster...: cluster=LAN
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: (LAN) joining: lan_addresses=[1&gt;Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: started state syncer
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Consul agent running!
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_&gt;Aug 31 14:12:08 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connec&gt;Aug 31 14:12:08 nomad-master consul[60088]: &quot;
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: Join cluster failed, will retry&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.118+0800 [WARN]  agent.server.raft: heartbeat timeout r&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.118+0800 [INFO]  agent.server.raft: entering candidate &gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server.raft: election won: tally&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server.raft: entering leader sta&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server: cluster leadership acqui&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server: New leader elected: payl&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.151+0800 [INFO]  agent.leader: started routine: routine&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.151+0800 [INFO]  agent.leader: started routine: routine&gt;Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.367+0800 [INFO]  agent: Synced node info
Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.213+0800 [INFO]  agent: (LAN) joining: lan_addresses=[1&gt;Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.214+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_&gt;Aug 31 14:12:38 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connec&gt;Aug 31 14:12:38 nomad-master consul[60088]: &quot;
Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.214+0800 [WARN]  agent: Join cluster failed, will retry&gt;Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [INFO]  agent: (LAN) joining: lan_addresses=[1&gt;Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_&gt;Aug 31 14:13:08 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connec&gt;Aug 31 14:13:08 nomad-master consul[60088]: &quot;
Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [WARN]  agent: Join cluster failed, will retry&gt;lines 3908-3936/3936 (END)
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: DEPRECATED Backwards compatibility with pre-1.9 metrics enabled. These metrics will be removed in a future version of Consul. Set `telemetry { disable_compat_1.9 = true }` to disable them.
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Retry join is supported for the following discovery methods: cluster=LAN discovery_methods=&quot;aliyun aws azure digitalocean gce k8s linode mdns os packet scaleway softlayer tencentcloud triton vsphere&quot;
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Joining cluster...: cluster=LAN
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: (LAN) joining: lan_addresses=[192.168.2.111]
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: started state syncer
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [INFO]  agent: Consul agent running!
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_nodes=0 error=&quot;1 error occurred:
Aug 31 14:12:08 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connect: connection refused
Aug 31 14:12:08 nomad-master consul[60088]: &quot;
Aug 31 14:12:08 nomad-master consul[60088]: 2021-08-31T14:12:08.212+0800 [WARN]  agent: Join cluster failed, will retry: cluster=LAN retry_interval=30s error=&lt;nil&gt;
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.118+0800 [WARN]  agent.server.raft: heartbeat timeout reached, starting election: last-leader=
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.118+0800 [INFO]  agent.server.raft: entering candidate state: node=&quot;Node at 192.168.2.110:8300 [Candidate]&quot; term=5
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server.raft: election won: tally=1
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server.raft: entering leader state: leader=&quot;Node at 192.168.2.110:8300 [Leader]&quot;
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server: cluster leadership acquired
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.136+0800 [INFO]  agent.server: New leader elected: payload=nomad-master
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.151+0800 [INFO]  agent.leader: started routine: routine=&quot;federation state anti-entropy&quot;
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.151+0800 [INFO]  agent.leader: started routine: routine=&quot;federation state pruning&quot;
Aug 31 14:12:15 nomad-master consul[60088]: 2021-08-31T14:12:15.367+0800 [INFO]  agent: Synced node info
Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.213+0800 [INFO]  agent: (LAN) joining: lan_addresses=[192.168.2.111]
Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.214+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_nodes=0 error=&quot;1 error occurred:
Aug 31 14:12:38 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connect: connection refused
Aug 31 14:12:38 nomad-master consul[60088]: &quot;
Aug 31 14:12:38 nomad-master consul[60088]: 2021-08-31T14:12:38.214+0800 [WARN]  agent: Join cluster failed, will retry: cluster=LAN retry_interval=30s error=&lt;nil&gt;
Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [INFO]  agent: (LAN) joining: lan_addresses=[192.168.2.111]
Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [WARN]  agent: (LAN) couldn&#x27;t join: number_of_nodes=0 error=&quot;1 error occurred:
Aug 31 14:13:08 nomad-master consul[60088]:         * Failed to join 192.168.2.111: dial tcp 192.168.2.111:8301: connect: connection refused
Aug 31 14:13:08 nomad-master consul[60088]: &quot;
Aug 31 14:13:08 nomad-master consul[60088]: 2021-08-31T14:13:08.214+0800 [WARN]  agent: Join cluster failed, will retry: cluster=LAN retry_interval=30s error=&lt;nil&gt;
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/consul">Consul</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">Linux</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Hashicorp/2021-08-05--hashicorp-consul-service-discovery/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Hashicorp/2021-08-06--hashicorp-consul-fabio-loadbalancing/2021-08-06"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hashicorp Consul Refresher - Loadbalancing with Fabio</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Hashicorp/2021-08-04--hashicorp-nomad-job-specifications/2021-08-04"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hashicorp Nomad Refresher - Job Specifications</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href="#debian11" class="table-of-contents__link toc-highlight">Debian11</a></li><li><a href="#rhel8" class="table-of-contents__link toc-highlight">RHEL8</a></li></ul></li><li><a href="#test-running" class="table-of-contents__link toc-highlight">Test-Running</a></li><li><a href="#service-configuration" class="table-of-contents__link toc-highlight">Service Configuration</a></li><li><a href="#run-consul-as-a-service" class="table-of-contents__link toc-highlight">Run Consul as a Service</a><ul><li><a href="#needed-ports" class="table-of-contents__link toc-highlight">Needed Ports</a></li></ul></li><li><a href="#service-configuration-1" class="table-of-contents__link toc-highlight">Service Configuration</a><ul><li><a href="#problems" class="table-of-contents__link toc-highlight">Problems</a></li></ul></li><li><a href="#registering-a-service-in-nomad" class="table-of-contents__link toc-highlight">Registering a Service in Nomad</a></li><li><a href="#default-consul-configuration" class="table-of-contents__link toc-highlight">Default Consul Configuration</a></li><li><a href="#consul-service-error-message" class="table-of-contents__link toc-highlight">Consul Service Error Message</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>