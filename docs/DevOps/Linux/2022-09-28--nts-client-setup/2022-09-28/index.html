<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Linux/2022-09-28--nts-client-setup/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">NTS-Service and Authenticated Time Synchronization | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NTS-Service and Authenticated Time Synchronization | Mike Polinowski"><meta data-rh="true" name="description" content="Building a client for a time service which uses IETF RFC 8915 called “Network Time Security“ (NTS)."><meta data-rh="true" property="og:description" content="Building a client for a time service which uses IETF RFC 8915 called “Network Time Security“ (NTS)."><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.ab71403f.js" defer="defer"></script>
<script src="/assets/js/main.88c0252d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Collapse sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2024-01-08--vsftp-ubuntu/2024-01-08">vsftp on Ubuntu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2023-10-28--lunarvim/2023-10-28">From NeoVim to LunarVim</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2023-03-29--installing-the-elgato-streamdeck/2023-03-29">Elgato Streamdeck on Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2023-02-03--installing-docker-raspberry-pi/2023-02-03">ARM Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-11-09--docker-borg-backupserver/2022-11-09">Resistance is futile - Borg with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-11-04--check-filesystem/2022-11-04">Check the Filesystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-09-29--build-an-chrony-nts-client-from-source/2022-09-29">Build a Chrony NTS Client from Source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Linux/2022-09-28--nts-client-setup/2022-09-28">NTS-Service and Authenticated Time Synchronization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21">Secure Timeserver - NTP with NTS with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-03-10--nmap-network-scanner/2022-03-10">nmap Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-03-09--fing-cli-network-scanner/2022-03-09">Fing CLI Network Scanner on Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-03-08--arch-kde-fritz-vpn/2022-03-08">Using the AVM Fritzbox VPN on Manjaro (KDE)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2022-03-07--ffmpeg-cheat-sheet/2022-03-07">FFMPEG Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-26--install-davinci-resolve-on-arch/2021-10-26">Install Davinci Resolve on Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-24--arch-linux-install-mesen/2021-10-24">Install Mesen in Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-24--arch-linux-install-docker/2021-10-24">Install Docker in Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-23--arch-linux-install-packages/2021-10-23">Install Packages in Arch Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-09--the-friendly-editor/2021-10-09">The friendly Editor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-10-09--editor-from-hell/2021-10-09">Editor from Hell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-09-02--openwrt-raspberry-pi/2021-09-02">Installing OpenWRT on a Raspberry Pi 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-09-01--kali-linux-raspberry-pi/2021-09-01">Installing Kali LINUX on a Raspberry Pi 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-04-14-using-deb-files-on-rhel8/2021-04-14">Installing Deb Packages on RHEL8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-04-13-installing-kvm-on-red-hat-enterprise-linux/2021-04-13">Setting up KVM on RedHat Enterprise Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-04-12-gnome3-cheat-sheet/2021-04-12">Gnome3 Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-04-11-installing-free-red-hat-enterprise-linux/2021-04-11">Installing Free Red Hat Enterprise Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2021-03-15-debian-upgrade-bullseye/2021-03-15">Debian Upgrade to Bullseye</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2020-10-20--activating-root-login-ubuntu-20-10/2020-10-20">Activating Root Login on Ubuntu 20.10</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2020-10-13--smarttools-centos/2020-10-13">HDD Smart Tools for LINUX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2020-01-07--centos8-firewalld/2020-01-05">Installing FirewallD on CentOS 8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2020-01-05--centos8-cockpit/2020-01-05">CentOS 8 Cockpit Web Console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-12-03--podman-ftp-server-container/2019-12-03">Podman FTP Server Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-09-26--kali-docker-windows/2019-09-26">Kali Linux with Docker for Windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-09-25--podman-cheat-sheet/2019-09-25">Podman Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-09-22--zsh-on-ubuntu20/2019-09-22">Installing Oh-My-Zsh on Ubuntu 20.04</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-09-22--zsh-on-centos8/2019-09-22">Installing Oh-My-Zsh on CentOS8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-09-22--centos8-network-config/2019-09-22">CentOS 8 Network Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-06-17--working-with-tmux/2019-06-17">Working with TMUX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-06-14--download-and-save-docker-image/2019-06-14">Downloading Docker Images for Offline Use</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-06-07--installing-docker-on-centos8/2019-06-07">Setting up Docker on CentOS 8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-13--centos-administration/2019-01-13">Centos Administration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-12--centos-network-configuration/2019-01-12">Centos Network Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-11--ubuntu-server-app-armour/2019-01-11">Ubuntu Server Cannot Stop Docker Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-11--ubuntu-network-configuration/2019-01-11">Ubuntu Network Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-11--root-access-ubuntu-server/2019-01-11">Ubuntu Server Root SSH Remote Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2019-01-11--debian-change-ssh-port-hostname/2019-01-11">Debian SSH Port and Hostname</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Linux/2018-10-27--red-hat-certified-engineer-rhce/2018-10-27">Red Hat Certified Engineer (RHCE) Exam</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux"><span itemprop="name">Linux</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NTS-Service and Authenticated Time Synchronization</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>NTS-Service and Authenticated Time Synchronization</h1></header><p><img alt="TST, Hong Kong" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-ec671595d585b88a85b017a7908fb619.jpg" width="1500" height="517"></p>
<ul>
<li><a href="#chrony-client">Chrony Client</a>
<ul>
<li><a href="#installing-chrony">Installing Chrony</a></li>
<li><a href="#configure-nts">Configure NTS</a></li>
<li><a href="#verify-that-nts-is-working-on-chrony">Verify that NTS is working on Chrony</a></li>
</ul>
</li>
<li><a href="#ntpsec-client">NTPsec Client</a>
<ul>
<li><a href="#installing-ntpsec">Installing NTPsec</a></li>
<li><a href="#configure-nts-1">Configure NTS</a></li>
<li><a href="#verify-that-nts-is-working-on-ntpsec">Verify that NTS is working on NTPsec</a></li>
</ul>
</li>
<li><a href="#authentication-keys">Authentication Keys</a>
<ul>
<li><a href="#chrony-server-configuration">Chrony Server Configuration</a></li>
<li><a href="#chrony-client-configuration">Chrony Client Configuration</a></li>
<li><a href="#ntpsec-client-configuration-failed">NTPSec Client Configuration (failed)</a></li>
<li><a href="#complete-ntpd-client-log">Complete ntpd Client Log</a></li>
</ul>
</li>
</ul>
<p>I did <a href="/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21">setup a Chrony NTP/NTS Server</a> and <a href="/docs/DevOps/Hashicorp/2022-09-22--nomad-nts-timeserver/2022-09-22">deployed it using Nomad</a>. Now I need a client to connect to it using NTS. Here I have the option to either use Chrony or NTPSec.</p>
<h2 id="chrony-client">Chrony Client</h2>
<p>By default Chrony is not installed on Debian but it can be installed using Aptitude.</p>
<h3 id="installing-chrony">Installing Chrony</h3>
<pre><code class="language-bash">apt install chrony
</code></pre>
<blockquote>
<p><strong>Note</strong>: If you have another NTP client running on your system it will be deactivated once you install Chrony (e.g. <code>systemd-timesyncd</code> or <code>ntpsec</code>).</p>
</blockquote>
<p>Verify Chrony works as an NTP client:</p>
<pre><code class="language-bash">chronyc sources

MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^* server1a.meinberg.de          2   6    37     3   -558us[ -446us] +/-   24ms
^+ lucy.thehomeofanime.de        2   6    37     3   +729us[ +842us] +/-   31ms
^+ 2a01:4f8:241:56c6:1::123      2   6    37     3   -417us[ -304us] +/-   40ms
^+ ns1.idfnet.net                2   6    37     2   -303us[ -303us] +/-   39ms
</code></pre>
<h3 id="configure-nts">Configure NTS</h3>
<p>Edit the configuration file <code>/etc/chrony/chrony.conf</code> and replace the existing NTP servers with your personal NTS server. First comment out any lines starting with one of the words <code>pool</code>, <code>server</code>, <code>source</code> or <code>sourcedir</code>:</p>
<pre><code class="language-bash"># Use Debian vendor zone.
# pool 2.debian.pool.ntp.org iburst

# Use time sources from DHCP.
# sourcedir /run/chrony-dhcp

# Use NTP sources found in /etc/chrony/sources.d.
# sourcedir /etc/chrony/sources.d
</code></pre>
<p>You can enable these sources later, but comment them out for the moment since it will make it easier to see if the NTS servers are working. Then add your personal NTS server. Note that the configuration line should contain <code>nts</code> which says that it uses the NTS protocol:</p>
<pre><code class="language-bash">server my.nts-server.com nts iburst
</code></pre>
<p>Save the file and restart the Chrony service by running this command:</p>
<pre><code class="language-bash">systemctl restart chrony
</code></pre>
<h3 id="verify-that-nts-is-working-on-chrony">Verify that NTS is working on Chrony</h3>
<p>Now verify that NTS is working with Chrony - first we can check the service status. It will show you the latest log output containing the source server:</p>
<pre><code class="language-bash">systemctl status chronyd    
● chrony.service - chrony, an NTP client/server
     Loaded: loaded (/lib/systemd/system/chrony.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2022-09-30 11:03:44 UTC; 11s ago
       Docs: man:chronyd(8)
             man:chronyc(1)
             man:chrony.conf(5)
    Process: 996854 ExecStart=/usr/sbin/chronyd $DAEMON_OPTS (code=exited, status=0/SUCCESS)
   Main PID: 996856 (chronyd)
      Tasks: 2 (limit: 2275)
     Memory: 3.1M
        CPU: 44ms
     CGroup: /system.slice/chrony.service
             ├─996856 /usr/sbin/chronyd -F 1
             └─996857 /usr/sbin/chronyd -F 1

Sep 30 11:03:44 chrony systemd[1]: Starting chrony, an NTP client/server...
Sep 30 11:03:44 chrony chronyd[996856]: chronyd version 4.0 starting (+CMDMON +NTP +REFCLOCK +RTC +PRIVDROP +SCFILTER +SI&gt;
Sep 30 11:03:44 chrony chronyd[996856]: Frequency -40.688 +/- 0.247 ppm read from /var/lib/chrony/chrony.drift
Sep 30 11:03:44 chrony chronyd[996856]: Using right/UTC timezone to obtain leap second data
Sep 30 11:03:44 chrony chronyd[996856]: Loaded seccomp filter
Sep 30 11:03:44 chrony systemd[1]: Started chrony, an NTP client/server.
Sep 30 11:03:49 chrony chronyd[996856]: Selected source my.server.ip (my.nts-server.com)
Sep 30 11:03:49 chrony chronyd[996856]: System clock TAI offset set to 37 seconds
</code></pre>
<p>Or just check the output from <code>chronyc</code>:</p>
<pre><code class="language-bash">chronyc sources

MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^* static.my.server.ip.in.reverse.cli&gt;     2   6    17    23   +351us[ +592us] +/- 6891us
</code></pre>
<blockquote>
<p>A leading <code>^</code> means its a server, <code>=</code> means peer, and <code>#</code> means local clock. The second column is what tells you if the server is being used. the <code>+</code> tells you that the source is being used. A <code>*</code> indicates the current best source which is being used, and a <code>-</code> means its a good source, but is not currently selected. Source state <code>~</code> means that the time is too variable.</p>
</blockquote>
<pre><code class="language-bash">chronyc tracking

Reference ID    : 9F459319 (static.my.server.ip.in.reverse.clients.your-server.com)
Stratum         : 3
Ref time (UTC)  : Sat Oct 01 10:36:30 2022
System time     : 0.000158212 seconds fast of NTP time
Last offset     : -0.272258192 seconds
RMS offset      : 0.129027337 seconds
Frequency       : 310.921 ppm fast
Residual freq   : -1410.939 ppm
Skew            : 122.050 ppm
Root delay      : 0.014122445 seconds
Root dispersion : 0.208602116 seconds
Update interval : 64.7 seconds
Leap status     : Normal
</code></pre>
<ul>
<li>Reference ID is the value indicates the name and ID of the NTP server to which the system’s time is currently synchronized.</li>
<li>Stratum specifies the number of hops in servers level to the NTP hierarchy.</li>
<li>Ref time is the time per UTC when the last measurement from the reference source was processed.</li>
<li>System time denotes the amount of delay in a systems clock from a synchronized server.</li>
<li>Last offset is the estimated time offset since the last clock update.</li>
<li>RMS Offset denotes the long-term average of the time offset</li>
<li>Frequency is the value the servers clock would be off if chronyd was not correcting it. This value is measured in ppm (parts per million)</li>
<li>Residual freq indicates the measurement of difference in between the next-level Stratum source and the current frequency being used.</li>
<li>Skew is the estimate variance of error in the frequency measured in parts per million</li>
<li>Root delay is the total time of delay within the network path to the higher level stratum computer from which the local server is being synced.</li>
<li>Root dispersion is part of the equation that calculates the value derived from the root delay and root dispersion as reported by the tracking command</li>
<li>Update interval is the distance between the previous two clock updates.</li>
<li>Leap status is the value which can have one of the following settings<!-- -->
<ul>
<li>normal</li>
<li>insert second</li>
<li>delete second</li>
<li>not synchronized.</li>
</ul>
</li>
</ul>
<blockquote>
<p>For service tracking add an alias to your <code>.bashrc</code> like <code>alias showtime=&#x27;chronyc sourcestats; chronyc -n sources; chronyc -n tracking&#x27;</code></p>
</blockquote>
<h2 id="ntpsec-client">NTPsec Client</h2>
<p>The NTS version of <code>ntpd</code> <strong>NTPSec</strong> is not installed on Debian but it can be installed using Aptitude.</p>
<h3 id="installing-ntpsec">Installing NTPsec</h3>
<pre><code class="language-bash">apt install ntpsec
</code></pre>
<blockquote>
<p><strong>Note</strong>: If you have another NTP client running on your system it will be deactivated once you install NTPsec (e.g. <code>systemd-timesyncd</code> or <code>chrony</code>).</p>
</blockquote>
<p>Verify NTPsec works as an NTP client:</p>
<pre><code class="language-bash">ntpq -p

     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
 0.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001
 1.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001
 2.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001
 3.debian.pool.ntp.org                   .POOL.          16 p    -  256    0   0.0000   0.0000   0.0001
</code></pre>
<h3 id="configure-nts-1">Configure NTS</h3>
<p>Edit the configuration file <code>/etc/ntpsec/ntp.conf</code> and replace the existing NTP servers with your own NTS servers. First comment out any lines starting with one of the words <code>pool</code> or <code>server</code>:</p>
<pre><code class="language-bash"># Public NTP servers supporting Network Time Security:
# server time.cloudflare.com nts

# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &lt;https://www.pool.ntp.org/join.html&gt;
# pool 0.debian.pool.ntp.org iburst
# pool 1.debian.pool.ntp.org iburst
# pool 2.debian.pool.ntp.org iburst
# pool 3.debian.pool.ntp.org iburst
</code></pre>
<p>Then add your own NTS server. Note that the configuration line should contain <code>nts</code> which says that it uses the NTS protocol:</p>
<pre><code class="language-bash">server my.nts-server.com nts iburst
</code></pre>
<p>Save the file and restart the Chrony service by running this command:</p>
<pre><code class="language-bash">systemctl restart ntpsec
</code></pre>
<h3 id="verify-that-nts-is-working-on-ntpsec">Verify that NTS is working on NTPsec</h3>
<p>The service comes up now using my server:</p>
<pre><code class="language-bash">systemctl status ntpsec

● ntpsec.service - Network Time Service
     Loaded: loaded (/lib/systemd/system/ntpsec.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2022-09-30 13:26:59 CEST; 11s ago
       Docs: man:ntpd(8)
    Process: 1516451 ExecStart=/usr/libexec/ntpsec/ntp-systemd-wrapper (code=exited, status=0/SUCCESS)
   Main PID: 1516454 (ntpd)
      Tasks: 1 (limit: 2276)
     Memory: 9.4M
        CPU: 36ms
     CGroup: /system.slice/ntpsec.service
             └─1516454 /usr/sbin/ntpd -p /run/ntpd.pid -c /etc/ntpsec/ntp.conf -g -N -u ntpsec:ntpsec

Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate subject name: /CN=my.nts-server.com
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate issuer name: /C=US/O=Lets Encrypt/CN=R3
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: certificate is valid.
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: Good ALPN from my.nts-server.com
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: read 848 bytes
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: Got 8 cookies, length 100, aead=15.
Sep 30 13:27:00 Nomad ntpd[1516454]: NTSc: NTS-KE req to my.nts-server.com took 0.088 sec, OK
Sep 30 13:27:00 Nomad ntpd[1516454]: DNS: dns_check: processing my.nts-server.com, 1, 21901
Sep 30 13:27:00 Nomad ntpd[1516454]: DNS: Server taking: my.server.ip
Sep 30 13:27:00 Nomad ntpd[1516454]: DNS: dns_take_status: my.nts-server.com=&gt;good, 0
</code></pre>
<p>Check the output from <code>ntpq</code>:</p>
<pre><code class="language-bash">ntpq -p 
     remote                                             refid      st t when poll reach   delay   offset   jitter
=================================================================================================================
+static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 8   17   64   17   4.3198  -5.5261  14.3994
</code></pre>
<h2 id="authentication-keys">Authentication Keys</h2>
<h3 id="chrony-server-configuration">Chrony Server Configuration</h3>
<p>When I set up the <a href="/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21">Chrony NTP/NTS Server</a> I did not consider client authentication. So currently every device with a NTS client can use the server. To limit access to our server we can create a <em>pre-shared authentication key</em> that we then have to add to our server as well as too all clients we want to connect. Both <strong>Chrony</strong> and <strong>NTPSec</strong> offer a keygen client that we can use to create our pre-shared key. I am going to generate the key using Chrony. To a <em>512-bit SHA1</em> key with the key number of <code>666</code> run the following command (inside your Chrony Server container or on your Chrony client):</p>
<pre><code class="language-bash">chronyc keygen 666 SHA1 512
</code></pre>
<p>This will output a secure hash that we will have to copy into a file <code>assets/chrony.keys</code> in the <a href="https://github.com/mpolinowski/docker-ntp">Chrony repository</a>:</p>
<pre><code class="language-bash">666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA
</code></pre>
<p>I can add this to my <a href="https://github.com/mpolinowski/docker-ntp/blob/main/Dockerfile">Chrony Dockerfile</a> to copy the keyfile into the Chrony container:</p>
<pre><code class="language-yml"># add chrony keys generated with `chronyc keygen 666 SHA1 512`
COPY assets/chrony.keys /opt/chrony.keys
</code></pre>
<p>Now I have to modify the <a href="https://github.com/mpolinowski/docker-ntp/blob/main/assets/startup.sh">start-up script</a> I am using inside the container to generate the Chrony configuration file and add the <code>keyfile</code> location:</p>
<pre><code class="language-sh">{
  echo
  echo &quot;driftfile /var/lib/chrony/chrony.drift&quot;
  echo &quot;makestep 0.1 3&quot;
  echo &quot;rtcsync&quot;
  echo
  echo &quot;ntsserverkey /opt/letsencrypt/live/my.server.com/privkey.pem&quot;
  echo &quot;ntsservercert /opt/letsencrypt/live/my.server.com/fullchain.pem&quot;
  echo &quot;keyfile /opt/chrony.keys&quot;
  echo &quot;ntsprocesses 3&quot;
  echo &quot;maxntsconnections 512&quot;
  echo &quot;ntsdumpdir /var/lib/chrony&quot;
  echo
  echo &quot;allow all&quot;
} &gt;&gt; ${CHRONY_CONF_FILE}
</code></pre>
<p>Now I can <a href="https://github.com/mpolinowski/docker-ntp#from-a-local-command-line">rebuild</a> my container and <a href="/docs/DevOps/Hashicorp/2022-09-24--nomad-nginx-ingress/2022-09-24">re-deploy it using Nomad</a>.</p>
<p>Now my clients should no longer be able to use the timeserver they are configured to use:</p>
<pre><code class="language-bash"># BEFORE
ntpq -p
     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
+static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 5  202   64  370   3.9457  10.4121 287.4892
# AFTER
ntpq -p
     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
 static.my.server.ip.in.reverse.clients.your-serve 216.239.35.0     2 0  585   64    0   0.0000   0.0000 298.1516
</code></pre>
<pre><code class="language-bash"># BEFORE
chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^* static.my.server.ip.in.reverse.cli&gt;     2   6    17    23   +351us[ +592us] +/- 6891us
# AFTER
chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^? static.my.server.ip.in.reverse.cli&gt;     0   8     0     -     +0ns[   +0ns] +/-    0ns
</code></pre>
<p>Now let&#x27;s fix that problem :)</p>
<h3 id="chrony-client-configuration">Chrony Client Configuration</h3>
<p>To add the keyfile to our Chrony client we first have to add it&#x27;s location to the configuration file:</p>
<pre><code class="language-bash">nano /etc/chrony/chrony.conf
</code></pre>
<pre><code class="language-bash">keyfile /etc/chrony/chrony.keys
</code></pre>
<p>And then create the <code>chrony.keys</code> file in the specified location:</p>
<pre><code class="language-bash">666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA
</code></pre>
<p>And make sure that the file is readable:</p>
<pre><code class="language-bash">chmod u=rw,g=r,o=r /etc/chrony/chrony.keys
</code></pre>
<p>Restart the service:</p>
<pre><code class="language-bash">service chrony restart
</code></pre>
<p>And we are back at working conditions:</p>
<pre><code class="language-bash">chronyc sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^* static.my.server.ip.in.reverse.cli&gt;     3   6    17    49  -1866us[  -38ms] +/- 3505us
</code></pre>
<h3 id="ntpsec-client-configuration-failed">NTPSec Client Configuration (failed)</h3>
<blockquote>
<p><strong>Update</strong> the NTPSec client runs well with a Chrony server as long as I don&#x27;t add the key authentication. I will just stick with a Chrony Server/Client combo. THere don&#x27;t seem to be any issues.</p>
</blockquote>
<p>For the NTPSec client we have to create the keyfile in <code>/var/lib/ntpsec/nts-keys/ntp.keys</code> and add the same content as with the <code>chrony.keys</code> file before. And point out the location in the configuration file - which is a little bit more verbose here. You additionally have to select the key number which I set to be <code>666</code> above and also assign the key to the server you want it to be uses with...</p>
<blockquote>
<p><strong>Update</strong> as son as I added the Chrony key I could no longer connect to my server... I then ran the NTPSec included key generator <code>ntpkeygen</code> which generates a list of keys.</p>
</blockquote>
<blockquote>
<p><strong>Update Update</strong> adding the AES key was not necessary after all I just had to remove the <code>HEX:</code> in front of the Chrony key and it was accepted. So, just keep the Chrony key ~</p>
</blockquote>
<pre><code class="language-bash">cat ntp.keys

# Sat Oct  1 14:43:23 2022
 1 AES g&amp;$cpQDr:_eLspU|
 
 ...

 19 AES a09a2bf2f05a42f16372dbb7fc419782
 20 AES 552b05b5536833d5a89ec83767f268c6
</code></pre>
<p>So I updated <code>nano /var/lib/ntpsec/nts-keys/ntp.keys</code> to include one of those keys:</p>
<pre><code class="language-bash">19 AES a09a2bf2f05a42f16372dbb7fc419782
666 SHA1 HEX:41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA
</code></pre>
<p>And also added them to the <code>chrony.keys</code> file of my Chrony server.</p>
<pre><code class="language-bash">chmod u=rw,g=r,o=r /var/lib/ntpsec/nts-keys/ntp.keys
nano /etc/ntpsec/ntp.conf
</code></pre>
<pre><code class="language-bash">keys /var/lib/ntpsec/nts-keys/ntp.keys
trustedkey 19
controlkey 19
requestkey 19

...

server my.server.com nts iburst key 19
</code></pre>
<p>But I am still not getting a connection:</p>
<pre><code class="language-bash">ntpq -p

     remote                                   refid      st t when poll reach   delay   offset   jitter
=======================================================================================================
 static.my.server.com.clients.your-serve .NTS.           16 7    -   64    0   0.0000   0.0000   0.0001
</code></pre>
<p>The client request are send but the server does not seem to reply:</p>
<pre><code class="language-bash">ntpq -c nts

NTS client sends:            7
NTS client recvs good:       0
NTS client recvs w error:    0
NTS server recvs good:       0
NTS server recvs w error:    0
NTS server sends:            0
NTS make cookies:            0
NTS decode cookies:          0
NTS decode cookies old:      0
NTS decode cookies too old:  0
NTS decode cookies error:    0
NTS KE probes good:          1
NTS KE probes_bad:           0
NTS KE serves good:          0
NTS KE serves_bad:           0
</code></pre>
<p>Let&#x27;s start the client manually and see what is going on:</p>
<pre><code class="language-bash">service ntpsec stop
/usr/sbin/ntpd -n -d
</code></pre>
<p>First of all I can see that the Chrony key is <a href="https://github.com/ntpsec/ntpsec/blob/master/libntp/authreadkeys.c">not accepted</a> - but NTPSec seems to add the additional AES key:</p>
<pre><code class="language-bash">2022-10-02T09:03:39 ntpd[19852]: Found 1 trusted keys.
2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys
2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: key 666 truncated to 64 bytes
2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: invalid hex digit for key 666
2022-10-02T09:03:39 ntpd[19852]: AUTH: authreadkeys: added 1 keys
</code></pre>
<p>Interesting so the key <code>666</code> contains illegal characters. Let&#x27;s remove the <code>HEX:</code> that Chrony sets in front of the key and see what happens when I switch the NTPSec configuration back from using key 19 to key 666:</p>
<pre><code class="language-bash">19 AES a09a2bf2f05a42f16372dbb7fc419782
666 SHA1 41303679BF767668BC4FA98783FABC76526AEA12A5B47A5C3DEE26DD5940F0E831AA6978B995615074BE284238374DF405A30C51D7145151A8B2E20A30D29FFA
</code></pre>
<p>Excellent, NTPSec accepts both keys and is now using the original Chrony key as trusted:</p>
<pre><code class="language-bash">2022-10-02T09:12:35 ntpd[20300]: Found 1 trusted keys.
2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys
2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: key 666 truncated to 64 bytes
2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: digest for key 666, SHA512 will be truncated.
2022-10-02T09:12:35 ntpd[20300]: AUTH: authreadkeys: added 2 keys
</code></pre>
<p>But scrolling down the <a href="#complete-ntpd-log">ntpd Log</a> there are only a lot of:</p>
<pre><code class="language-bash">select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
</code></pre>
<p>Which is where I reached the realm darkness, full of terrors. Where not even the Lord of Light may help you to chase away the shadows...</p>
<p><img alt="NTS-Service and Authenticated Time Synchronization" src="/assets/images/nts-client-setup_01-eb3c03a7e8019dd766cd2fc490aa228c.png" width="1019" height="420"></p>
<h3 id="complete-ntpd-client-log">Complete ntpd Client Log</h3>
<pre><code class="language-bash">/usr/sbin/ntpd -n -d 

2022-10-02T09:14:00 ntpd[20412]: INIT: ntpd ntpsec-1.2.0 2021-06-17T05:15:04Z: Starting
2022-10-02T09:14:00 ntpd[20412]: INIT: Command line: /usr/sbin/ntpd -n -d
2022-10-02T09:14:00 ntpd[20412]: INIT: precision = 0.088 usec (-23)
2022-10-02T09:14:00 ntpd[20412]: INIT: successfully locked into RAM
2022-10-02T09:14:00 ntpd[20412]: CONFIG: readconfig: parsing file: /etc/ntpsec/ntp.conf
2022-10-02T09:14:00 ntpd[20412]: CONFIG: requestkey is a no-op because ntpdc has been removed.
Finished Parsing!!
2022-10-02T09:14:00 ntpd[20412]: Found 1 trusted keys.
2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: reading /var/lib/ntpsec/nts-keys/ntp.keys
2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: key 666 truncated to 64 bytes
2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: digest for key 666, SHA512 will be truncated.
2022-10-02T09:14:00 ntpd[20412]: AUTH: authreadkeys: added 2 keys
2022-10-02T09:14:00 ntpd[20412]: CONFIG: restrict nopeer ignored
restrict: op 1 addr 0.0.0.0 mask 0.0.0.0 mflags 00000000 flags 000004e0
restrict: op 1 addr :: mask :: mflags 00000000 flags 000004e0
restrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00000000 flags 00000000
restrict: op 1 addr ::1 mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff mflags 00000000 flags 00000000
2022-10-02T09:14:00 ntpd[20412]: CLOCK: leapsecond file (&#x27;/usr/share/zoneinfo/leap-seconds.list&#x27;): good hash signature
2022-10-02T09:14:00 ntpd[20412]: CLOCK: leapsecond file (&#x27;/usr/share/zoneinfo/leap-seconds.list&#x27;): loaded, expire=2022-12-28T00:00Z last=2017-01-01T00:00Z ofs=37
event at 0 0.0.0.0 c01e 0e TAI 37 leap 2017-01-01T00:00Z expires 2022-12-28T00:00Z
move_fd: estimated max descriptors: 1024, initial socket boundary: 16
2022-10-02T09:14:00 ntpd[20412]: INIT: Using SO_TIMESTAMPNS
2022-10-02T09:14:00 ntpd[20412]: IO: Listen and drop on 0 v6wildcard [::]:123
2022-10-02T09:14:00 ntpd[20412]: IO: Listen and drop on 1 v4wildcard 0.0.0.0:123
2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 2 lo 127.0.0.1:123
restrict: op 1 addr 127.0.0.1 mask 255.255.255.255 mflags 00003000 flags 00000001
2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 3 eth0 my.client-ip:123
restrict: op 1 addr my.client-ip mask 255.255.255.255 mflags 00003000 flags 00000001
2022-10-02T09:14:00 ntpd[20412]: IO: Listen normally on 4 lo [::1]:123
2022-10-02T09:14:00 ntpd[20412]: IO: Listening on routing socket on fd #23 for interface updates
peer_clear: at 0 next 1 associd 17767 refid NTS
event at 0 my.ntp-server.com c011 81 mobilize assoc 17767
newpeer: &lt;null&gt;-&gt;0.0.0.0 mode 3 vers 4 poll 6 10 flags 0x21901 0x1 mode 0 key 0000029a
2022-10-02T09:14:00 ntpd[20412]: INIT: MRU 10922 entries, 13 hash bits, 65536 bytes
event at 0 0.0.0.0 c01d 0d kern kernel time sync enabled
event at 0 0.0.0.0 c012 02 freq_set kernel 0.000000 PPM
event at 0 0.0.0.0 c016 06 restart
2022-10-02T09:14:00 ntpd[20412]: INIT: Built with OpenSSL 1.1.1k  25 Mar 2021, 101010bf
2022-10-02T09:14:00 ntpd[20412]: INIT: Running with OpenSSL 1.1.1n  15 Mar 2022, 101010ef
2022-10-02T09:14:00 ntpd[20412]: NTSc: Using system default root certificates.
2022-10-02T09:14:00 ntpd[20412]: statistics directory /var/log/ntpsec/ does not exist or is unwriteable, error No such file or directory
select() returned -1: Interrupted system call
2022-10-02T09:14:01 ntpd[20412]: DNS: dns_probe: my.ntp-server.com, cast_flags:1, flags:21901
2022-10-02T09:14:01 ntpd[20412]: NTSc: DNS lookup of my.ntp-server.com took 0.016 sec
2022-10-02T09:14:01 ntpd[20412]: NTSc: connecting to my.ntp-server.com:4460 =&gt; my.server-ip:4460
2022-10-02T09:14:01 ntpd[20412]: NTSc: set cert host: my.ntp-server.com
2022-10-02T09:14:01 ntpd[20412]: NTSc: Using TLSv1.3, TLS_AES_256_GCM_SHA384 (256)
2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate subject name: /CN=my.ntp-server.com
2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate issuer name: /C=US/O=Lets Encrypt/CN=R3
2022-10-02T09:14:01 ntpd[20412]: NTSc: certificate is valid.
2022-10-02T09:14:01 ntpd[20412]: NTSc: Good ALPN from my.ntp-server.com
2022-10-02T09:14:01 ntpd[20412]: NTSc: read 848 bytes
2022-10-02T09:14:01 ntpd[20412]: NTSc: Got 8 cookies, length 100, aead=15.
2022-10-02T09:14:01 ntpd[20412]: NTSc: NTS-KE req to my.ntp-server.com took 0.087 sec, OK
select() returned -1: Interrupted system call
2022-10-02T09:14:01 ntpd[20412]: DNS: dns_check: processing my.ntp-server.com, 1, 21901
2022-10-02T09:14:01 ntpd[20412]: DNS: Server taking: my.server-ip
transmit: at 1 my.client-ip-&gt;my.server-ip mode 3 keyid 0000029a len 228
2022-10-02T09:14:01 ntpd[20412]: DNS: dns_take_status: my.ntp-server.com=&gt;good, 0
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
transmit: at 66 my.client-ip-&gt;my.server-ip mode 3 keyid 0000029a len 332
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
transmit: at 133 my.client-ip-&gt;my.server-ip mode 3 keyid 0000029a len 436
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
transmit: at 199 my.client-ip-&gt;my.server-ip mode 3 keyid 0000029a len 540
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
transmit: at 266 my.client-ip-&gt;my.server-ip mode 3 keyid 0000029a len 644
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
select() returned -1: Interrupted system call
^Cselect() returned -1: Interrupted system call
2022-10-02T09:19:00 ntpd[20412]: ERR: ntpd exiting on signal 2 (Interrupt)
event at 299 my.server-ip c012 82 demobilize assoc 17767
2022-10-02T09:19:00 ntpd[20412]: PROTO: my.server-ip unlink local addr my.client-ip -&gt; &lt;null&gt;
event at 299 0.0.0.0 c01d 0d kern kernel time sync disabled
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/security">Security</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Linux/2022-09-28--nts-client-setup/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Linux/2022-09-29--build-an-chrony-nts-client-from-source/2022-09-29"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Build a Chrony NTS Client from Source</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Linux/2022-09-15--ntp-over-nts-timeserver/2022-09-21"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Secure Timeserver - NTP with NTS with Docker</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chrony-client" class="table-of-contents__link toc-highlight">Chrony Client</a><ul><li><a href="#installing-chrony" class="table-of-contents__link toc-highlight">Installing Chrony</a></li><li><a href="#configure-nts" class="table-of-contents__link toc-highlight">Configure NTS</a></li><li><a href="#verify-that-nts-is-working-on-chrony" class="table-of-contents__link toc-highlight">Verify that NTS is working on Chrony</a></li></ul></li><li><a href="#ntpsec-client" class="table-of-contents__link toc-highlight">NTPsec Client</a><ul><li><a href="#installing-ntpsec" class="table-of-contents__link toc-highlight">Installing NTPsec</a></li><li><a href="#configure-nts-1" class="table-of-contents__link toc-highlight">Configure NTS</a></li><li><a href="#verify-that-nts-is-working-on-ntpsec" class="table-of-contents__link toc-highlight">Verify that NTS is working on NTPsec</a></li></ul></li><li><a href="#authentication-keys" class="table-of-contents__link toc-highlight">Authentication Keys</a><ul><li><a href="#chrony-server-configuration" class="table-of-contents__link toc-highlight">Chrony Server Configuration</a></li><li><a href="#chrony-client-configuration" class="table-of-contents__link toc-highlight">Chrony Client Configuration</a></li><li><a href="#ntpsec-client-configuration-failed" class="table-of-contents__link toc-highlight">NTPSec Client Configuration (failed)</a></li><li><a href="#complete-ntpd-client-log" class="table-of-contents__link toc-highlight">Complete ntpd Client Log</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>