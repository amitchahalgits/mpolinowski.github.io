<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/NGINX/2017-12-24--nginx-node-security/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">NGINX, Node.js &amp; Security | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/NGINX/2017-12-24--nginx-node-security/2017-12-24"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NGINX, Node.js &amp; Security | Mike Polinowski"><meta data-rh="true" name="description" content="Sydney, Australia"><meta data-rh="true" property="og:description" content="Sydney, Australia"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/NGINX/2017-12-24--nginx-node-security/2017-12-24"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/NGINX/2017-12-24--nginx-node-security/2017-12-24" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/NGINX/2017-12-24--nginx-node-security/2017-12-24" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.37984c46.js" defer="defer"></script>
<script src="/assets/js/main.b3107e46.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Collapse sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2023-06-13-nginx-docker-ingress/2023-06-13">NGINX HTTP/2 Docker Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2022-12-08-nginx-websocket-proxy/2022-12-08">NGINX Websocket Proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2022-11-17-nginx-udp-tcp-load-balancing/2022-11-17">NGINX TCP/UDP Load Balancing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2021-02-23-nginx-agent-redirect/2021-02-23">NGINX Redirect based on User Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2021-07-29--certbot-nginx-autorenewal/2021-07-29">Setting up Certbot Auto-renewal for NGINX (Maintenance Mode)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2021-02-22-nginx-docker-ingress/2021-02-22">NGINX Docker Ingress for your Gatsby Build</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2020-08-30--nginx-docker-multihost/2020-08-30">NGINX Docker Multihost</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2020-08-28--nginx-docker-certbot/2020-08-27">NGINX Docker with Certbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2020-08-27--nginx-docker-ssl-certs-self-signed/2020-08-27">NGINX Docker with SSL Encryption (Self-signed)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2020-08-26--nginx-docker-setup/2020-08-26">NGINX Docker Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2020-07-29--securing-apache-and-nginx/2020-07-29">Securing Webservers - Apache and NGINX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2019-11-08--nginx-rtmp-website/2019-11-08">Adding an OBS Stream to your Website</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2019-11-07--nginx-rtmp-streaming-container/2019-11-07">Building an RTMP Streaming Server with Podman</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2019-02-05--nginx-ingress-cert-manager/2019-02-05">NGINX Ingress with Cert-Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/NGINX/2017-12-24--nginx-node-security/2017-12-24">NGINX, Node.js &amp; Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/NGINX/2017-10-01--using-nginx-as-proxy-for-your-nodejs-apps/2017-10-01">Using NGINX as proxy for your nodejs apps</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/nginx"><span itemprop="name">NGINX</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NGINX, Node.js &amp; Security</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><img alt="Sydney, Australia" src="/assets/images/photo-34139903180_fd0c397abc_o-e310c4f5ef105421603a97c4f9ce3f5c.png" width="1500" height="764"></p>
<h1 id="using-nginx-as-proxy-for-your-nodejs-apps">Using NGINX as proxy for your nodejs apps</h1>
<p><strong>We want to set up NGINX with http/2 to serve multiple node apps and an instance of Elasticsearch on a single centOS server</strong></p>
<ul>
<li><a href="#using-nginx-as-proxy-for-your-nodejs-apps">Using NGINX as proxy for your nodejs apps</a>
<ul>
<li><a href="#1-useful-links">1 Useful links</a></li>
<li><a href="#2-install-nginx-and-adjust-the-firewall">2 Install Nginx and Adjust the Firewall</a></li>
<li><a href="#3-firewalld">3 FirewallD</a></li>
<li><a href="#4-create-a-login">4 Create a login</a></li>
<li><a href="#5-nginxconf">5 nginx.conf</a></li>
<li><a href="#6-virtualconf">6 virtual.conf</a></li>
<li><a href="#7-godaddy-certs">7 GoDaddy Certs</a>
<ul>
<li><a href="#generate-a-csr-and-private-key">Generate a CSR and Private Key</a></li>
<li><a href="#download-your-key-from-godaddy">Download your key from GoDaddy</a></li>
<li><a href="#install-certificate-on-web-server">Install Certificate On Web Server</a></li>
</ul>
</li>
<li><a href="#8-letsencrypt-and-certbot">8 LetsEncrypt and Certbot</a>
<ul>
<li><a href="#install-certbot-on-centos-7">Install Certbot on CentOS 7</a></li>
<li><a href="#run-certbot">Run Certbot</a></li>
<li><a href="#setting-up-auto-renewal">Setting Up Auto Renewal</a>
<ul>
<li><a href="#systemd">Systemd</a></li>
<li><a href="#crond">Cron.d</a></li>
</ul>
</li>
<li><a href="#tls-sni-01-challenge-deactivated">TLS-SNI-01 challenge Deactivated</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1-useful-links">1 Useful links</h2>
<hr>
<ul>
<li><a href="https://kyup.com/tutorials/set-http-authentication-nginx/">Apache2-Utils</a></li>
<li><a href="https://www.ssllabs.com/ssltest/">SSL Labs</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-16-04">Set up NGINX with http/2</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-centos-7/">Create a self-signed Certificate</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7">How To Secure Nginx with Let&#x27;s Encrypt on CentOS 7</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">Installing Elasticsearch</a></li>
<li><a href="https://www.elastic.co/guide/en/kibana/current/install.html">Installing Kibana</a></li>
<li><a href="https://www.elastic.co/downloads/x-pack">Installing X-Pack</a></li>
</ul>
<h2 id="2-install-nginx-and-adjust-the-firewall">2 Install Nginx and Adjust the Firewall</h2>
<hr>
<ul>
<li><strong>Step One</strong> — Nginx is not available in CentOS&#x27;s default repositories - but we can install it from the EPEL (extra packages for Enterprise Linux) repository.</li>
</ul>
<pre><code> sudo yum install epel-release
</code></pre>
<ul>
<li><strong>Step Two</strong> — Next, we can install Nginx.</li>
</ul>
<pre><code> sudo yum install nginx
</code></pre>
<ul>
<li><strong>Step Three</strong> — Start the Nginx service and test it inside your browser http://server_domain_name_or_IP/</li>
</ul>
<pre><code> sudo systemctl start nginx
</code></pre>
<ul>
<li><strong>Step Four</strong> — Check that the service is up and running by typing:</li>
</ul>
<pre><code> systemctl status nginx
</code></pre>
<ul>
<li><strong>Step Five</strong> — You will also want to enable Nginx, so it starts when your server boots:</li>
</ul>
<pre><code> sudo systemctl enable nginx
</code></pre>
<h2 id="3-firewalld">3 FirewallD</h2>
<hr>
<ul>
<li><strong>Step One</strong> — Installation</li>
</ul>
<p>Open ports 80 and 443 in <a href="http://www.firewalld.org/">FirewallD</a></p>
<p>To start the service and enable FirewallD on boot:</p>
<pre><code>sudo systemctl start firewalld
sudo systemctl enable firewalld
</code></pre>
<p>To stop and disable it:</p>
<pre><code>sudo systemctl stop firewalld
sudo systemctl disable firewalld
</code></pre>
<p>Check the firewall status. The output should say either running or not running:</p>
<pre><code>sudo firewall-cmd --state
</code></pre>
<p>To view the status of the FirewallD daemon:</p>
<pre><code>sudo systemctl status firewalld
</code></pre>
<p>To reload a FirewallD configuration:</p>
<pre><code>sudo firewall-cmd --reload
</code></pre>
<ul>
<li><strong>Step Two</strong> — Configuration</li>
</ul>
<p>Add the http/s rule to the permanent set and reload FirewallD.</p>
<pre><code>sudo firewall-cmd --zone=public --add-service=https --permanent
sudo firewall-cmd --zone=public --add-service=http --permanent
sudo firewall-cmd --reload
</code></pre>
<p>Allow traffic / block traffic over ports:</p>
<pre><code>sudo firewall-cmd --zone=public --add-port=12345/tcp --permanent
sudo firewall-cmd --zone=public --remove-port=12345/tcp --permanent
</code></pre>
<p>Verify open ports:</p>
<pre><code>firewall-cmd --list-ports
</code></pre>
<p>Check the firewall status:</p>
<pre><code>sudo firewall-cmd --state
</code></pre>
<p>To view the status of the FirewallD daemon:</p>
<pre><code>sudo systemctl status firewalld
</code></pre>
<p>To reload a FirewallD configuration:</p>
<pre><code>sudo firewall-cmd --reload
</code></pre>
<h2 id="4-create-a-login">4 Create a login</h2>
<hr>
<pre><code>sudo htpasswd -c /etc/nginx/.htpasswd USERNAME
New password: xxxxxxxxx
Re-type new password: xxxxxxxxx
</code></pre>
<h2 id="5-nginxconf">5 nginx.conf</h2>
<p>/etc/nginx/nginx.conf</p>
<pre><code class="language-nginx">user nginx;
worker_processes 8;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &#x27;$request&#x27; &#x27;
                      &#x27;$status $body_bytes_sent &#x27;$http_referer&#x27; &#x27;
                      &#x27;&#x27;$http_user_agent&#x27; &#x27;$http_x_forwarded_for&#x27;&#x27;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;
	gzip on;
	gzip_vary on;
	gzip_proxied any;
	gzip_comp_level 6;
	gzip_buffers 16 8k;
	gzip_http_version 1.1;
	gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;
	# include /etc/nginx/sites-enabled/*;

	# Hide nginx version token
	server_tokens off;

	# Configure buffer sizes
	client_body_buffer_size 16k;
	client_header_buffer_size 1k;
	client_max_body_size 8m;
	large_client_header_buffers 4 8k;

}
</code></pre>
<h2 id="6-virtualconf">6 virtual.conf</h2>
<p>/etc/nginx/conf.d/virtual.conf</p>
<p>Set up virtual server instances for our 2 node/express apps, Elasticsearch and Kibana</p>
<pre><code class="language-nginx"># redirect http/80 traffic to https/443 for our node apps
server {
       listen         80;
       listen    [::]:80;
       server_name    example.de example2.de;
       return         301 https://$server_name$request_uri;
}

# point to our first node app that is running on port 8888 and accept calls over https://example.de:443
upstream myApp_en {
	# point to the running node
	server 127.0.0.1:8888;
}

server {
	# users using this port and domain will be directed to the node app defined above
	# listen 80 default_server;
	# listen [::]:80 default_server ipv6only=on;
	listen 443 ssl http2 default_server;
	listen [::]:443 ssl http2 default_server;
	# If you want to run more then one node app, they either have to be assigned different web domains (server_name) or ports!
	server_name example.de;

	# Adding the SSL Certificates
    ssl_prefer_server_ciphers on;
	ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
	ssl_dhparam /etc/nginx/ssl/dhparam.pem;
	ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;
	ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;

	# set the default public directory for your node
	root /opt/myApp_en/build/public;

	# Optimizing Nginx for Best Performance
	ssl_session_cache shared:SSL:5m;
    ssl_session_timeout 1h;

	location / {
    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    	proxy_set_header Host $http_host;
    	proxy_set_header X-NginX-Proxy true;
    	proxy_http_version 1.1;
    	proxy_set_header Upgrade $http_upgrade;
    	proxy_set_header Connection &#x27;upgrade&#x27;;
    	proxy_max_temp_file_size 0;
		proxy_pass http://myApp_en;
    	proxy_redirect off;
    	proxy_read_timeout 240s;
		# Authentication can be activated during development
		# auth_basic &#x27;Username and Password are required&#x27;;
		# the user login has to be generated
		# auth_basic_user_file /etc/nginx/.htpasswd;
	}

	# use NGINX to cache static resources that are requested regularly
	location ~* \.(css|js|jpg|png|ico)$ {
		expires 168h;
	}
}


# point to our second node app that is running on port 8484 and accept calls over https://example2.de:443
upstream myApp_de {
	# point to the second running node
	server 127.0.0.1:8484;
}

server {
	# users using this port and domain will be directed to the second node app
	# listen 80;
	# listen [::]:8080 ipv6only=on;
	listen 443 ssl http2;
	# The IPv6 address is unique - only one app can use the default port 443!
	listen [::]:444 ssl http2;
	server_name example2.de;

	# adding the SSL Certificates
    ssl_prefer_server_ciphers on;
	ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
	ssl_dhparam /etc/nginx/ssl/dhparam.pem;
	ssl_certificate /etc/nginx/ssl/nginx-selfsigned.crt;
	ssl_certificate_key /etc/nginx/ssl/nginx-selfsigned.key;

	# set the default public directory for your second node
	root /opt/myApp_de/build/public;

	# optimizing Nginx for Best Performance
	ssl_session_cache shared:SSL:5m;
    ssl_session_timeout 1h;

	location / {
    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    	proxy_set_header Host $http_host;
    	proxy_set_header X-NginX-Proxy true;
    	proxy_http_version 1.1;
    	proxy_set_header Upgrade $http_upgrade;
    	proxy_set_header Connection &#x27;upgrade&#x27;;
    	proxy_max_temp_file_size 0;
		proxy_pass http://myApp_de;
    	proxy_redirect off;
    	proxy_read_timeout 240s;
		# auth_basic &#x27;Username and Password are required&#x27;;
		# auth_basic_user_file /etc/nginx/.htpasswd;
	}

	# use NGINX to cache static resources that are requested regularly
	location ~* \.(css|js|jpg|png|ico)$ {
		expires 168h;
	}
}


# point to our Elasticsearch database that is running on port 9200 and accept calls over 8080
upstream elasticsearch {
	# point to the second running node
	server 127.0.0.1:9200;
}

server {
	# users using this port will be directed to Elasticsearch
	listen 8080;
	listen [::]:8080 ipv6only=on;
	server_name SERVER_IP_ADDRESS;

	location / {
    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    	proxy_set_header Host $http_host;
    	proxy_set_header X-NginX-Proxy true;
    	proxy_http_version 1.1;
    	proxy_set_header Upgrade $http_upgrade;
    	proxy_set_header Connection &#x27;upgrade&#x27;;
    	proxy_max_temp_file_size 0;
		proxy_pass http://elasticsearch;
    	proxy_redirect off;
    	proxy_read_timeout 240s;
		auth_basic &#x27;Username and Password are required&#x27;;
		auth_basic_user_file /etc/nginx/.htpasswd;
	}

}

# point to our Kibana instance that is running on port 5601 and accept calls over 8181
server {
	# users using this port and will be directed to Elasticsearch/Kibana
	listen 8181;
	listen [::]:8181 ipv6only=on;

	server_name SERVER_IP_ADDRESS;

	auth_basic &#x27;Restricted Access&#x27;;
	auth_basic_user_file /etc/nginx/.htpasswd;

	location / {
    	proxy_pass http://localhost:5601;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &#x27;upgrade&#x27;;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;        
	}

}
</code></pre>
<h2 id="7-godaddy-certs">7 GoDaddy Certs</h2>
<p>When you ordered a wildcard certificate from goDaddy you will receive two files: Your SSL Certificate with a random name (Ex. 93rfs8dhf834hts.crt) and the GoDaddy intermediate certificate bundle (gd_bundle-g2-g1.crt). Lets install them on our server.</p>
<h3 id="generate-a-csr-and-private-key">Generate a CSR and Private Key</h3>
<p>Create a folder to put all our ssl certificates:</p>
<pre><code>mkdir /etc/nginx/ssl
cd /etc/nginx/ssl
</code></pre>
<p>Generate our private key, called example.com.key, and a CSR, called example.com.csr:</p>
<pre><code>openssl req -newkey rsa:2048 -nodes -keyout example.com.key -out example.com.csr
</code></pre>
<p>At this point, you will be prompted for several lines of information that will be included in your certificate request. The most important part is the Common Name field which should match the name that you want to use your certificate with — for example, example.com, <a href="http://www.example.com">www.example.com</a>, or (for a wildcard certificate request) [STAR].example.com.</p>
<h3 id="download-your-key-from-godaddy">Download your key from GoDaddy</h3>
<p>The files you receive will look something like this:</p>
<ul>
<li>93rfs8dhf834hts.crt</li>
<li>gd_bundle-g2-g1.crt</li>
</ul>
<p>Upload both to /etc/nginx/ssl directory and rename the first one to your domain name example.com.cst</p>
<h3 id="install-certificate-on-web-server">Install Certificate On Web Server</h3>
<p>You can use the following command to create a combined file from both GoDaddy files called example.com.chained.crt:</p>
<pre><code>cat example.com.crt gd_bundle-g2-g1.crt &gt; example.com.chained.crt
</code></pre>
<p>And now you should change the access permission to this folder:</p>
<pre><code>cd /etc/nginx
sudo chmod -R 600 ssl/
</code></pre>
<p>To complete the configuration you have to make sure your NGINX config points to the right cert file and to the private key you generated earlier. Add the following lines inside the server block of your NGINX config:</p>
<pre><code class="language-nginx"># adding the SSL Certificates
  ssl_prefer_server_ciphers on;
  ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
	ssl_certificate /etc/nginx/ssl/example.com.chained.crt;
	ssl_certificate_key /etc/nginx/ssl/example.com.key;
</code></pre>
<p>Always test your configuration first:</p>
<pre><code>nginx -t
</code></pre>
<p>and then reload:</p>
<pre><code>service nginx reload
</code></pre>
<h2 id="8-letsencrypt-and-certbot">8 LetsEncrypt and Certbot</h2>
<h3 id="install-certbot-on-centos-7">Install Certbot on CentOS 7</h3>
<p><strong>yum install certbot-nginx</strong></p>
<pre><code>Dependencies Resolved

==============================================================================================
 Package                         Arch             Version                Repository      Size
==============================================================================================
Installing:
 python2-certbot-nginx           noarch           0.14.1-1.el7           epel            52 k
Installing for dependencies:
 pyparsing                       noarch           1.5.6-9.el7            base            94 k

Transaction Summary
==============================================================================================
Install  1 Package (+1 Dependent package)

Complete!
</code></pre>
<h3 id="run-certbot">Run Certbot</h3>
<p><strong>certbot --nginx -d wiki.instar.fr</strong></p>
<pre><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log
Enter email address (used for urgent renewal and security notices) (Enter &#x27;c&#x27; to
cancel):
</code></pre>
<p><strong><a href="mailto:myemail@email.com">myemail@email.com</a></strong></p>
<pre><code>-------------------------------------------------------------------------------
Please read the Terms of Service at
https://letsencrypt.org/documents/LE-SA-v1.1.1-August-1-2016.pdf. You must agree
in order to register with the ACME server at
https://acme-v01.api.letsencrypt.org/directory
-------------------------------------------------------------------------------
</code></pre>
<p><strong>(A)gree/(C)ancel: A</strong></p>
<pre><code>Starting new HTTPS connection (1): supporters.eff.org
Obtaining a new certificate
Performing the following challenges:
tls-sni-01 challenge for wiki.instar.fr
Waiting for verification...
Cleaning up challenges
Deployed Certificate to VirtualHost /etc/nginx/conf.d/virtual.conf for set([&#x27;wiki.instar.fr&#x27;])

Please choose whether HTTPS access is required or optional.
-------------------------------------------------------------------------------
1: Easy - Allow both HTTP and HTTPS access to these sites
2: Secure - Make all requests redirect to secure HTTPS access
-------------------------------------------------------------------------------
Select the appropriate number [1-2] then [enter] (press &#x27;c&#x27; to cancel): 2
The appropriate server block is already redirecting traffic. To enable redirect anyway, uncomment the redirect lines in /etc/nginx/conf.d/virtual.conf.
-------------------------------------------------------------------------------
Congratulations! You have successfully enabled https://wiki.instar.fr
-------------------------------------------------------------------------------
</code></pre>
<pre><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at
   /etc/letsencrypt/live/wiki.instar.fr/fullchain.pem. Your cert will
   expire on 2017-12-13. To obtain a new or tweaked version of this
   certificate in the future, simply run certbot again with the
   &#x27;certonly&#x27; option. To non-interactively renew *all* of your
   certificates, run &#x27;certbot renew&#x27;
 - Your account credentials have been saved in your Certbot
   configuration directory at /etc/letsencrypt. You should make a
   secure backup of this folder now. This configuration directory will
   also contain certificates and private keys obtained by Certbot so
   making regular backups of this folder is ideal.
</code></pre>
<h3 id="setting-up-auto-renewal">Setting Up Auto Renewal</h3>
<h4 id="systemd">Systemd</h4>
<p>Go to <em>/etc/systemd/system/</em> and create the following two files</p>
<p><em>certbot-nginx.service</em></p>
<pre><code>[Unit]
Description=Renew Certbot certificates (nginx)
After=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/bin/certbot-2 renew --deploy-hook &#x27;systemctl reload nginx&#x27;
</code></pre>
<p><em>certbot-nginx.timer</em></p>
<pre><code>[Unit]
Description=Renew Certbot certificate (nginx)

[Timer]
OnCalendar=daily
Persistent=true
RandomizedDelaySec=86400

[Install]
WantedBy=multi-user.target
</code></pre>
<p>Now activate the service</p>
<pre><code>$ systemctl daemon-reload
$ systemctl start certbot-nginx.service  # to run manually
$ systemctl enable --now certbot-nginx.timer  # to use the timer
</code></pre>
<h4 id="crond">Cron.d</h4>
<p>Add Certbot renewal to Cron.d in /etc/cron.d - we want to run it twice daily at 13:22 and 04:17:</p>
<pre><code># Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed

17 4 * * * /usr/bin/certbot-2 renew --quiet
22 13 * * * /usr/bin/certbot-2 renew --quiet
</code></pre>
<h3 id="tls-sni-01-challenge-deactivated">TLS-SNI-01 challenge Deactivated</h3>
<p>If you are receiving the following error when trying to add a certificate to your domain:</p>
<pre><code>Client with the currently selected authenticator does not support any combination of challenges that will satisfy the CA.
</code></pre>
<p>Follow the Instructions given <a href="https://community.letsencrypt.org/t/solution-client-with-the-currently-selected-authenticator-does-not-support-any-combination-of-challenges-that-will-satisfy-the-ca/49983">here</a> and if you’re serving files for that domain out of a directory on that server, you can run the following command:</p>
<pre><code>sudo certbot --authenticator webroot --webroot-path &lt;path to served directory&gt; --installer nginx -d &lt;domain&gt;
</code></pre>
<p>If you’re not serving files out of a directory on the server, you can temporarily stop your server while you obtain the certificate and restart it after Certbot has obtained the certificate. This would look like:</p>
<pre><code>sudo certbot --authenticator standalone --installer nginx -d &lt;domain&gt; --pre-hook &#x27;service nginx stop&#x27; --post-hook &#x27;service nginx start&#x27;
</code></pre>
<p>e.g.</p>
<ol>
<li>Create your virtual server conf - the given config below routes an node/express app running on localhost:7777 with a public directory in /opt/mysite-build/app :</li>
</ol>
<pre><code class="language-nginx">server {
       listen         80;
       listen    [::]:80;
       server_name    my.domain.com;
       return         301 https://$server_name$request_uri;
}

upstream app_test {
	# point to the running node
	server 127.0.0.1:7777;
}

server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;
	server_name my.domain.com;
	
	# set the default public directory for your node
	root /opt/mysite-build/app;
	
	# Optimizing Nginx for Best Performance
	ssl_session_cache shared:SSL:5m;
    ssl_session_timeout 1h;
	
	location / {
    	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    	proxy_set_header Host $http_host;
    	proxy_set_header X-NginX-Proxy true;
    	proxy_http_version 1.1;
    	proxy_set_header Upgrade $http_upgrade;
    	proxy_set_header Connection &#x27;upgrade&#x27;;
    	proxy_max_temp_file_size 0;
		proxy_pass http://wiki2_test;
    	proxy_redirect off;
    	proxy_read_timeout 240s;
	}
	
	# use NGINX to cache static resources that are requested regularly
	location ~* \.(css|js|jpg|png|ico)$ {
		expires 168h;
	}

}
</code></pre>
<p>Test your your site by opening my.domain.com inside your browser - you should be automatically redirected to <a href="https://my.domain.com">https://my.domain.com</a> and be given a certificate warning. Click to proceed anyway to access your site.</p>
<p>Now run:</p>
<pre><code>sudo certbot --authenticator webroot --webroot-path /opt/mysite-build/app --installer nginx -d my.domain.com
</code></pre>
<p>certbot will modify your NGINX config automatically!</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>You can test run the auto renewal with the following command:</p>
<pre><code class="language-bash">certbot renew --dry-run
</code></pre>
<p>This will show you if your certificate would be renewed automatically or not. The latter looks like this:</p>
<p><img alt="Certbot Error" src="/assets/images/certbot_01-34e7d0c63624d63917d4694caa18d8fe.png" width="812" height="206"></p>
<p>Trying to renew or repair the certificate by typing <code>certbot renew</code> and choosing the problematic cert did not solve the problem - for some reason the script could not restart NGINX afterwards and caused the webserver to crash. There is a script to remove the cert:</p>
<pre><code class="language-bash">certbot delete
</code></pre>
<p>But this did not remove the certbot entries inside the NGINX server block - causing the webserver to crash again:</p>
<pre><code class="language-bash">ssl_certificate /etc/letsencrypt/live/wiki.instar.fr/fullchain.pem; # managed by Certbot
ssl_certificate_key /etc/letsencrypt/live/wiki.instar.fr/privkey.pem; # managed by Certbot
</code></pre>
<p>After manually removing them and running certbot again to add a certificate:</p>
<pre><code class="language-bash">certbot --nginx
</code></pre>
<p><img alt="Certbot: Install Certificate" src="/assets/images/certbot_02-6a91f93c3b4f39408f0f33aede187e20.png" width="649" height="249"></p>
<p><img alt="Certbot: Install Certificate" src="/assets/images/certbot_03-da04eda47bac02cc0133d842a5b6cfef.png" width="691" height="292"></p>
<p>...everything seems to be fine now (?)</p>
<p><img alt="Certbot: Install Certificate" src="/assets/images/certbot_04-2e52742c8550e2db1b79aefd0e5bb207.png" width="646" height="178"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/nginx">NGINX</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/NGINX/2017-12-24--nginx-node-security/index.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/NGINX/2019-02-05--nginx-ingress-cert-manager/2019-02-05"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">NGINX Ingress with Cert-Manager</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/NGINX/2017-10-01--using-nginx-as-proxy-for-your-nodejs-apps/2017-10-01"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using NGINX as proxy for your nodejs apps</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-useful-links" class="table-of-contents__link toc-highlight">1 Useful links</a></li><li><a href="#2-install-nginx-and-adjust-the-firewall" class="table-of-contents__link toc-highlight">2 Install Nginx and Adjust the Firewall</a></li><li><a href="#3-firewalld" class="table-of-contents__link toc-highlight">3 FirewallD</a></li><li><a href="#4-create-a-login" class="table-of-contents__link toc-highlight">4 Create a login</a></li><li><a href="#5-nginxconf" class="table-of-contents__link toc-highlight">5 nginx.conf</a></li><li><a href="#6-virtualconf" class="table-of-contents__link toc-highlight">6 virtual.conf</a></li><li><a href="#7-godaddy-certs" class="table-of-contents__link toc-highlight">7 GoDaddy Certs</a><ul><li><a href="#generate-a-csr-and-private-key" class="table-of-contents__link toc-highlight">Generate a CSR and Private Key</a></li><li><a href="#download-your-key-from-godaddy" class="table-of-contents__link toc-highlight">Download your key from GoDaddy</a></li><li><a href="#install-certificate-on-web-server" class="table-of-contents__link toc-highlight">Install Certificate On Web Server</a></li></ul></li><li><a href="#8-letsencrypt-and-certbot" class="table-of-contents__link toc-highlight">8 LetsEncrypt and Certbot</a><ul><li><a href="#install-certbot-on-centos-7" class="table-of-contents__link toc-highlight">Install Certbot on CentOS 7</a></li><li><a href="#run-certbot" class="table-of-contents__link toc-highlight">Run Certbot</a></li><li><a href="#setting-up-auto-renewal" class="table-of-contents__link toc-highlight">Setting Up Auto Renewal</a></li><li><a href="#tls-sni-01-challenge-deactivated" class="table-of-contents__link toc-highlight">TLS-SNI-01 challenge Deactivated</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>