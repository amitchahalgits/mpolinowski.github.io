<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Elasticsearch v8, Filebeat (Docker) and NGINX | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Elasticsearch v8, Filebeat (Docker) and NGINX | Mike Polinowski"><meta data-rh="true" name="description" content="Shenzhen, China"><meta data-rh="true" property="og:description" content="Shenzhen, China"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.37984c46.js" defer="defer"></script>
<script src="/assets/js/main.b3107e46.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Collapse sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2023-02-10--meili-rusty-elastic-docker/2023-02-10">Introduction to MeiLi Search with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-10-12--opensearch-rest-api/2022-10-12">Opensearch Rest API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-10-11--opensearch-docker-compose/2022-10-11">Opensearch &amp; Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-06--elasticsearch-v8-data-ingestion-apache/2022-02-06">Elasticsearch v8, Filebeat (Docker) and Apache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-05--kibana-v8-index-management/2022-02-05">Elasticsearch &amp; Kibana v8 Index Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/2022-02-04">Elasticsearch &amp; Kibana v8 Search Cheat Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/2022-02-03">Elasticsearch v8, Filebeat (Docker) and NGINX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02">Performing an Elasticsearch v8 Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-04-01-elastic-filebeats-for-nginx-logs/2021-04-01">Elastic Filebeat and NGINX Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-31-elastic-filebeats-for-apache-logs/2021-03-31">Elastic Filebeat and Apache Access Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-30-elasticsearch7-and-filebeats/2021-03-30">Elasticsearch 7 and Filebeats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-29-elasticsearch7-data-transformations/2021-03-29">Elasticsearch 7 Data Transformation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-28-elasticsearch7-timeseries/2021-03-28">Elasticsearch 7 Timeseries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-27-elasticsearch7-aggregations/2021-03-27">Elasticsearch 7 Aggregations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-26-elasticsearch7-for-syslog-messages/2021-03-26">Elasticsearch 7 to log Linux System Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-25-elasticsearch7-activate-logging-of-search-queries/2021-03-25">Log all the searches going through Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Log all the searches going through Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-24-logstash-common-grok-pattern/2021-03-24">Logstash 7 and Common Log Pattern</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-23-logstash-working-with-unstructured-data/2021-03-23">Logstash 7 Working with Unstructured Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-22-logstash-working-with-structured-data/2021-03-22">Logstash 7 Working with Structured Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-21-logstash-digesting-data/2021-03-21">Logstash 7 Digesting Webserver Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2021-03-20-elasticsearch-7-refresher/2021-03-20">Elasticsearch 7 Refresher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2020-06-01--elasticsearch-docker/2020-06-01">Elasticsearch in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2019-09-08--elasticsearch_7-5_docker/2019-09-08">Elasticsearch 7 with Docker Compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2018-01-01--securing-elasticsearch-readonlyrest/2018-01-01">Securing Elasticsearch with ReadOnlyREST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-31--securing-elasticsearch-xpack/2017-12-31">Securing Elasticsearch with X-Pack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-26--elasticsearch-kibana/2017-12-16">Elasticsearch and Kibana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-12-05--elasticsearch-react-example/2017-12-05">React Search Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Elasticsearch/2017-10-03--search-engine-setup-and-configuration/2017-10-03">Search Engine Setup and Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Expand sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/elasticsearch"><span itemprop="name">Elasticsearch</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Elasticsearch v8, Filebeat (Docker) and NGINX</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Elasticsearch v8, Filebeat (Docker) and NGINX</h1></header><p><img alt="Shenzhen, China" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-94d62ec3ff079da54fce88aad4901707.jpg" width="1500" height="403"></p>
<ul>
<li><a href="#setting-up-elasticsearch--kibana">Setting Up Elasticsearch &amp; Kibana</a></li>
<li><a href="#setting-up-filebeats">Setting up Filebeats</a>
<ul>
<li><a href="#run-the-filebeat-setup">Run the Filebeat Setup</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#add-kibana-dashboard">Add Kibana Dashboard</a></li>
<li><a href="#enable-and-configure-data-collection-modules">Enable and configure data collection modules</a>
<ul>
<li><a href="#prepare-the-filebeat-container">Prepare the Filebeat Container</a></li>
<li><a href="#check-the-nginx-module">Check the NGINX Module</a></li>
</ul>
</li>
<li><a href="#monitor-nginx-in-docker">Monitor NGINX in Docker</a>
<ul>
<li><a href="#alternative-">Alternative ?</a></li>
</ul>
</li>
<li><a href="#monitor-elasticsearch-in-docker">Monitor Elasticsearch in Docker</a></li>
</ul>
</li>
</ul>
<h2 id="setting-up-elasticsearch--kibana">Setting Up Elasticsearch &amp; Kibana</h2>
<p>I will use the <a href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02">Elasticsearch compose file from here</a>:</p>
<pre><code class="language-yml">version: &#x27;3.8&#x27;

services:
  elasticsearch:
    container_name: elasticsearch
    restart: always
    build:
      context: elasticsearch/
      args:
        ELK_VERSION: $ELK_VERSION
    volumes:
      - type: bind
        source: ./elasticsearch/config/elasticsearch.yml
        target: /usr/share/elasticsearch/config/elasticsearch.yml
        read_only: true
      - type: volume
        source: elasticsearch
        target: /usr/share/elasticsearch/data
    ports:
      - &quot;9200:9200&quot;
      - &quot;9300:9300&quot;
    environment:
      ES_JAVA_OPTS: &#x27;-Xms2g -Xmx2g&#x27;
      ELASTIC_PASSWORD: &#x27;changeme&#x27;
      discovery.type: single-node
    networks:
      elastic:
        ipv4_address: 172.16.239.102
        aliases:
          - elasticsearch

  kibana:
    container_name: kibana
    restart: unless-stopped
    build:
      context: kibana/
      args:
        ELK_VERSION: $ELK_VERSION
    volumes:
      - type: bind
        source: ./kibana/config/kibana.yml
        target: /usr/share/kibana/config/kibana.yml
        read_only: true
    ports:
      - &quot;5601:5601&quot;
    networks:
      elastic:
        ipv4_address: 172.16.239.104
        aliases:
          - kibana
    depends_on:
      - elasticsearch

networks:
  elastic:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: &quot;false&quot;
    ipam:
      driver: default
      config:
        - subnet: 172.16.239.0/24

volumes:
  elasticsearch:
</code></pre>
<p>Start the service with <code>docker-compose up -d</code>. Elasticsearch will start with the following configuration:</p>
<pre><code class="language-yml">---
## Default Elasticsearch configuration from Elasticsearch base image.
## https://github.com/elastic/elasticsearch/blob/master/distribution/docker/src/docker/config/elasticsearch.yml
#
cluster.name: &quot;docker-cluster&quot;
# network.host: _site_
network.host: 0.0.0.0

## X-Pack settings
## see https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-xpack.html
#
# xpack.license.self_generated.type: trial
xpack.license.self_generated.type: basic
xpack.security.enabled: true
xpack.monitoring.collection.enabled: true
xpack.security.authc:
    anonymous:
      username: anonymous_user 
      roles: search_agent
      authz_exception: true 

## CORS
http.cors.enabled : true
http.cors.allow-origin: &quot;*&quot;
http.cors.allow-methods: OPTIONS, HEAD, GET, POST, PUT, DELETE
http.cors.allow-credentials: true
http.cors.allow-headers: X-Requested-With, X-Auth-Token, Content-Type, Content-Length, Authorization, Access-Control-Allow-Headers, Accept
</code></pre>
<h2 id="setting-up-filebeats">Setting up Filebeats</h2>
<p>Start by pulling the a fresh version of Filebeat:</p>
<pre><code class="language-bash">docker pull elastic/filebeat:8.0.0
</code></pre>
<h3 id="run-the-filebeat-setup">Run the Filebeat Setup</h3>
<p>Running Filebeat with the setup command will create the index pattern and load visualizations , dashboards, and machine learning jobs. Run this command:</p>
<blockquote>
<p><strong>Note</strong>: If you set up Elasticsearch according to <a href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02">this guide</a>, you will have a different <code>elastic</code> user password - e.g. <code>ELASTIC_PASSWORD: &#x27;a1hyme+ry1-AltBfpqxY&#x27;</code>.</p>
</blockquote>
<pre><code class="language-bash">docker run \
-E setup.kibana.host=kibana:5601 \
-E output.elasticsearch.hosts=[&quot;elasticsearch:9200&quot;] \
-E output.elasticsearch.username=elastic \
-E output.elasticsearch.password=changeme \
elastic/filebeat:8.0.0
</code></pre>
<p><strong>ERROR</strong>: This step did not work for me. I keep getting the error message <code>no matches found: output.elasticsearch.hosts=[elasticsearch:9200]</code>. I already added the <code>username</code> and <code>password</code> that were missing in the <a href="https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html#_run_the_filebeat_setup">official documentation</a>. Is this step still necessary in version 8 since the new <strong>Datastream</strong> tab is automatically populated with the Filebeat data? I am missing the default Filebeat dashboard though - if there is supposed to be one with that name.</p>
<p><strong>UPDATE</strong>: You can manually activate the Kibana integration once you started the container - see <a href="#add-kibana-dashboard">Add Kibana Dashboard</a>. I don&#x27;t think this step is still necessary:</p>
<p>I will create a folder:</p>
<pre><code class="language-bash">mkdir -p /opt/beats/config/
</code></pre>
<p>and continue working from there.</p>
<h3 id="configuration">Configuration</h3>
<p>When running Filebeat in a container, you need to provide access to Docker’s unix socket in order for the add_docker_metadata processor to work. You can do this by mounting the socket inside the container. For example:</p>
<blockquote>
<p>docker run -v /var/run/docker.sock:/var/run/docker.sock ...</p>
</blockquote>
<p>To avoid privilege issues, you may also need to add --user=root to the docker run flags. Because the user must be part of the docker group in order to access /var/run/docker.sock, root access is required if Filebeat is running as non-root inside the container.</p>
<p>If Docker daemon is restarted the mounted socket will become invalid and metadata will stop working, in these situations there are two options:</p>
<ul>
<li>Restart Filebeat every time Docker is restarted</li>
<li>Mount the entire /var/run directory (instead of just the socket)</li>
</ul>
<pre><code class="language-yml">processors:
  - add_docker_metadata:
      host: &quot;unix:///var/run/docker.sock&quot;
      #match_fields: [&quot;system.process.cgroup.id&quot;]
      #match_pids: [&quot;process.pid&quot;, &quot;process.parent.pid&quot;]
      #match_source: true
      #match_source_index: 4
      #match_short_id: true
      #cleanup_timeout: 60
      #labels.dedot: false
      # To connect to Docker over TLS you must specify a client and CA certificate.
      #ssl:
      #  certificate_authority: &quot;/etc/pki/root/ca.pem&quot;
      #  certificate:           &quot;/etc/pki/client/cert.pem&quot;
      #  key:  
</code></pre>
<p>It has the following settings:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>host</td><td><em>(Optional)</em> Docker socket (UNIX or TCP socket). It uses unix:///var/run/docker.sock by default.</td></tr><tr><td>ssl</td><td><em>(Optional)</em> SSL configuration to use when connecting to the Docker socket.</td></tr><tr><td>match_fields</td><td><em>(Optional)</em> A list of fields to match a container ID, at least one of them should hold a container ID to get the event enriched.</td></tr><tr><td>match_pids</td><td><em>(Optional)</em> A list of fields that contain process IDs. If the process is running in Docker then the  event will be enriched. The default value is [&quot;process.pid&quot;, &quot;process.parent.pid&quot;].</td></tr><tr><td>match_source</td><td><em>(Optional)</em> Match container ID from a log path present in the log.file.path field. Enabled by  default.</td></tr><tr><td>match_short_id</td><td><em>(Optional)</em> Match container short ID from a log path present in the log.file.path field. Disabled  by default. This allows to match directories names that have the first 12 characters of the container ID. For example, /var/log/containers/b7e3460e2b21/*.log.</td></tr><tr><td>match_source_index</td><td><em>(Optional)</em> Index in the source path split by / to look for container ID. It defaults to 4 to  match /var/lib/docker/containers/&lt;container_id&gt;/*.log</td></tr><tr><td>cleanup_timeout</td><td><em>(Optional)</em> Time of inactivity to consider we can clean and forget metadata for a container, 60s  by default.</td></tr><tr><td>labels.dedot</td><td><em>(Optional)</em> Default to be false. If set to true, replace dots in labels with _.</td></tr></tbody></table>
<p>But I think I am just going to use CLI flags to mount the docker socket as volumes. This simplifies the configuration to:</p>
<pre><code class="language-bash">nano /opt/beats/config/filebeat.yml
</code></pre>
<pre><code class="language-yml">filebeat.config:
  modules:
    path: ${path.config}/modules.d/*.yml # enable all modules (nginx, kafka, redis, etc)
    reload.enabled: false

filebeat.autodiscover: # auto-discover tagged docker container
  providers:
    - type: docker
      hints.enabled: true

setup:
  kibana.host: &quot;http://localhost:5601&quot;
  dashboards.enable: true

# processors:
# - add_cloud_metadata: ~ # for AWS, GCO, Azure etc.
# - add_docker_metadata: ~ # add docker metadata (container id, name, image and labels)

output.elasticsearch:
  hosts: &#x27;http://localhost:9200&#x27;
  username: &#x27;elastic&#x27;
  password: &#x27;changeme&#x27;
</code></pre>
<blockquote>
<p><strong>Note</strong>: If you set up Elasticsearch according to <a href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02">this guide</a>, you will have a different <code>elastic</code> user password - e.g. <code>ELASTIC_PASSWORD: &#x27;a1hyme+ry1-AltBfpqxY&#x27;</code>.</p>
</blockquote>
<p>The beat configuration file must belong to the <code>root</code> user and all write permissions for other users must be revoked:</p>
<pre><code class="language-bash">chown root:root /opt/beats/config/filebeat.yml
chmod go-w /opt/beats/config/filebeat.yml
</code></pre>
<p>Now we need to bind the location of docker container directory <code>/var/lib/docker/containers</code> and our docker socket <code>/var/run/docker.sock</code> to the container:</p>
<pre><code class="language-bash">docker run -d \
  --name filebeat \
  --user root \
  --net=host \
  -v /opt/beats/config/filebeat.yml:/usr/share/filebeat/filebeat.yml \
  -v /var/lib/docker/containers:/var/lib/docker/containers:ro \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  elastic/filebeat:8.0.0
</code></pre>
<p>Check if everything started up:</p>
<pre><code class="language-bash">{&quot;log.level&quot;:&quot;info&quot;,&quot;@timestamp&quot;:&quot;2022-02-21T04:46:17.294Z&quot;,&quot;log.origin&quot;:{&quot;file.name&quot;:&quot;instance/beat.go&quot;,&quot;file.line&quot;:332},&quot;message&quot;:&quot;Setup Beat: filebeat; Version: 8.0.0&quot;,&quot;service.name&quot;:&quot;filebeat&quot;,&quot;ecs.version&quot;:&quot;1.6.0&quot;}
{&quot;log.level&quot;:&quot;info&quot;,&quot;@timestamp&quot;:&quot;2022-02-21T04:46:17.295Z&quot;,&quot;log.logger&quot;:&quot;esclientleg&quot;,&quot;log.origin&quot;:{&quot;file.name&quot;:&quot;eslegclient/connection.go&quot;,&quot;file.line&quot;:105},&quot;message&quot;:&quot;elasticsearch url: http://localhost:9200&quot;,&quot;service.name&quot;:&quot;filebeat&quot;,&quot;ecs.version&quot;:&quot;1.6.0&quot;}
{&quot;log.level&quot;:&quot;info&quot;,&quot;@timestamp&quot;:&quot;2022-02-21T04:46:17.296Z&quot;,&quot;log.logger&quot;:&quot;publisher&quot;,&quot;log.origin&quot;:{&quot;file.name&quot;:&quot;pipeline/module.go&quot;,&quot;file.line&quot;:113},&quot;message&quot;:&quot;Beat name: nomad-minion&quot;,&quot;service.name&quot;:&quot;filebeat&quot;,&quot;ecs.version&quot;:&quot;1.6.0&quot;}
{&quot;log.level&quot;:&quot;info&quot;,&quot;@timestamp&quot;:&quot;2022-02-21T04:46:17.298Z&quot;,&quot;log.origin&quot;:{&quot;file.name&quot;:&quot;fileset/modules.go&quot;,&quot;file.line&quot;:103},&quot;message&quot;:&quot;Enabled modules/filesets:  ()&quot;,&quot;service.name&quot;:&quot;filebeat&quot;,&quot;ecs.version&quot;:&quot;1.6.0&quot;}
{&quot;log.level&quot;:&quot;info&quot;,&quot;@timestamp&quot;:&quot;2022-02-21T04:46:17.298Z&quot;,&quot;log.logger&quot;:&quot;monitoring&quot;,&quot;log.origin&quot;:{&quot;file.name&quot;:&quot;log/log.go&quot;,&quot;file.line&quot;:142},&quot;message&quot;:&quot;Starting metrics logging every 30s&quot;,&quot;service.name&quot;:&quot;filebeat&quot;,&quot;ecs.version&quot;:&quot;1.6.0&quot;}
</code></pre>
<h3 id="add-kibana-dashboard">Add Kibana Dashboard</h3>
<p><strong>UPDATE</strong>: You can already setup the dashboards using the Filebeat config with <code>setup.dashboards.enable: true</code> I added this line to the configuration file above!</p>
<p>To load the recommended index template for writing to Elasticsearch and deploy the sample dashboards for visualizing the data in Kibana, use the command that works with your system.</p>
<pre><code class="language-bash">docker exec -ti filebeat /bin/bash


./filebeat setup --dashboards
Loading dashboards (Kibana must be running and reachable)
Loaded dashboards
</code></pre>
<p>The Filebeat <strong>Data View</strong> is now listed in Kibana:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_01-2d57922b0b28d119ec3fc314114b0ba9.png" width="1176" height="595"></p>
<p>I can see results come in in <strong>Discover</strong>:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_02-e825ec315c47136e111506df001123e7.png" width="1432" height="536"></p>
<p>There are also plenty of <code>Filebeat*</code> <strong>Dashboards</strong> loaded. But so far no interesting data to fill them with.</p>
<h3 id="enable-and-configure-data-collection-modules">Enable and configure data collection modules</h3>
<h4 id="prepare-the-filebeat-container">Prepare the Filebeat Container</h4>
<p>Since we are running Filebeat in Docker, of course this log path does not exist. We have to modify the command that we used to start the Docker container to mount our NGINX logs into the container. The NGINX logs might be found in the <code>/var/log/nginx</code> directory - depending on your NGINX configuration. But I just copied a few logs onto my test system <code>/opt/beats/logs</code>:</p>
<pre><code class="language-bash">-v /opt/beats/logs:/var/log/nginx:ro
</code></pre>
<p>And secondly, we need to mount our module configuration file. The template configuration is located inside the Filebeat container under <code>/usr/share/filebeat/modules.d/nginx.yml.disabled</code>:</p>
<pre><code class="language-yml"># Module: nginx
# Docs: https://www.elastic.co/guide/en/beats/filebeat/master/filebeat-module-nginx.html

- module: nginx
  # Access logs
  access:
    enabled: true
    var.paths: [&quot;/var/log/nginx/access.log*&quot;]

  # Error logs
  error:
    enabled: true
    var.paths: [ &quot;/var/log/nginx/error.log*&quot; ]

  # Ingress-nginx controller logs. This is disabled by default. It could be used in Kubernetes environments to parse ingress-nginx logs
  ingress_controller:
    enabled: false

    # Set custom paths for the log files. If left empty,
    # Filebeat will choose the paths depending on your OS.
    #var.paths:
</code></pre>
<p>save this file under <code>nginx.yml</code> next to your <code>filebeat.yml</code> and mount it into the <code>modules.d</code> configuration folder - the complete docker command now looks like this:</p>
<pre><code class="language-bash">docker run -d \
  --name filebeat \
  --user root \
  --net=host \
  --restart unless-stopped \
  -v /opt/beats/config/filebeat.yml:/usr/share/filebeat/filebeat.yml \
  -v /opt/beats/config/nginx.yml:/usr/share/filebeat/modules.d/nginx.yml \
  -v /var/lib/docker/containers:/var/lib/docker/containers:ro \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  -v /opt/beats/logs:/var/log/nginx:ro \
  elastic/filebeat:8.0.0
</code></pre>
<p>Restart the container and verify that the logs and module configuration was actually mounted:</p>
<pre><code class="language-bash">docker exec -ti filebeat /bin/bash

/usr/share/filebeat# ls -la /var/log/nginx/
-rwxrwxrwx 1 root root  9634840 Feb 21 03:47 access.log
-rwxrwxrwx 1 root root    12225 Feb 21 03:47 error.log

ls -la /usr/share/filebeat/modules.d | grep nginx
-rw-r--r-- 1 root root   613 Feb 22 05:54 nginx.yml
-rw-r--r-- 1 root root   788 Feb  3 18:06 nginx.yml.disabled
</code></pre>
<h4 id="check-the-nginx-module">Check the NGINX Module</h4>
<ol>
<li>Verify that the NGINX modules was actually enable. To see a list of available modules, run:</li>
</ol>
<pre><code class="language-bash">docker exec -ti filebeat /bin/bash


/usr/share/filebeat# ./filebeat modules list
Enabled:
nginx

Disabled:
activemq apache auditd aws awsfargate azure barracuda bluecoat cef checkpoint cisco coredns crowdstrike cyberarkpas cylance elasticsearch envoyproxy f5 fortinet gcp google_workspace haproxy ibmmq icinga iis imperva infoblox iptables juniper kafka kibana logstash microsoft misp mongodb mssql mysql mysqlenterprise nats netflow netscout nginx o365 okta oracle osquery panw pensando postgresql proofpoint rabbitmq radware redis santa snort snyk sonicwall sophos squid suricata system threatintel tomcat traefik zeek zookeeper zoom zscaler
</code></pre>
<p>To manually activate or deactivate modules run:</p>
<pre><code class="language-bash">./filebeat modules enable nginx
</code></pre>
<p>To test your configuration file, change to the directory where the Filebeat binary is installed, and run Filebeat in the foreground with the following options specified:</p>
<pre><code class="language-bash">./filebeat test config -e
Config OK
</code></pre>
<p>The documentation I found says that you now should run the setup command to load the available dashboards. I am not sure if this is still necessary since I already did this in the previous step. But running the command returns a <code>Loaded Ingest pipelines</code> - sounds good ~</p>
<pre><code class="language-bash">./filebeat setup -e
Loaded Ingest pipelines
</code></pre>
<p>I can see all the NGINX related data points in <strong>Data Views</strong>:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_03-18b92378e8187a27eeca6ac9c7482024.png" width="1376" height="859"></p>
<p>Switching to the <strong>Discover</strong> I first cannot see anything. But I have to select a time window that matches the date in my logs - by default you only see the last 15 minutes. Drilling in I find my log data from yesterday:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_04-20779b50fa72aa454a06b6e7ff2e15a9.png" width="1383" height="371"></p>
<p>Under <strong>Dashboards</strong> I now open the NGINX Access &amp; Error Log template:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_05-a939bf55798a05e698241c24f6056bd0.png" width="1277" height="524"></p>
<p>And can start analyzing my data:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_06-996a5fb68f34307f07e91bb879dc7065.png" width="1375" height="875"></p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_07-01d3b6eb315bfbf7c839c10b25c83bd9.png" width="2550" height="886"></p>
<h3 id="monitor-nginx-in-docker">Monitor NGINX in Docker</h3>
<p>Configure filebeat to read the StdOut und StdErr stream of your NGINX container:</p>
<pre><code class="language-yml">filebeat.autodiscover:
  providers:
    - type: docker
      hints.enabled: true
      templates:
        - condition.contains:
            docker.container.image: nginx
          config:
            - module: nginx
              access.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stdout&quot;
              error.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stderr&quot;
</code></pre>
<p>Run the Filebeat container inside the same Docker network as your NGINX container:</p>
<pre><code class="language-bash">docker run -d \
  --name filebeat \
  --user root \
  --network mynetwork \
  --restart unless-stopped \
  -v /opt/beats/config/filebeat.yml:/usr/share/filebeat/filebeat.yml \
  -v /var/lib/docker/containers:/var/lib/docker/containers:ro \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  elastic/filebeat:8.0.0
</code></pre>
<p>Since the container is now wrapped inside the virtual Docker network, I am now seeing the <strong>Filebeat Container ID</strong> as <code>host.name</code>. In my case <code>b803b794fcb2</code>:</p>
<pre><code class="language-bash">docker ps
CONTAINER ID   IMAGE
b803b794fcb2   elastic/filebeat:8.0.0
</code></pre>
<p>Which I can use to filter all log entries from this beat:</p>
<pre><code class="language-bash">host.name : &quot;b803b794fcb2&quot;
</code></pre>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_08-ea92dcd7720dddcce30013cd8978a346.png" width="1216" height="556"></p>
<h4 id="alternative-">Alternative ?</h4>
<p><strong>Untested</strong>: Give the filepath to your container logs:</p>
<pre><code class="language-yml"># # =========================== Filebeat autodiscover ============================

filebeat.autodiscover:
  providers:
    - type: docker
      templates:
        - condition:
            contains:
              docker.container.image:&lt;your_label_condition&gt;
          config:
            - type: container
              paths:
                - &quot;/var/lib/docker/containers/${data.docker.container.id}/*.log&quot;
              exclude_lines: [&quot;^\\s+[\\-`(&#x27;.|_]&quot;]  # drop asciiart lines

filebeat.shutdown_timeout: 5s   #optional

# ------------------------------- Console Output -------------------------------
output.console:
  enabled: true
  codec.json:
    pretty: true
    escape_html: false  

logging.metrics.enabled: false
</code></pre>
<h3 id="monitor-elasticsearch-in-docker">Monitor Elasticsearch in Docker</h3>
<p>I can now add my Elasticsearch container to the Filebeat configuration file:</p>
<pre><code class="language-yml">filebeat.autodiscover
  providers:
    - type: docker
      hints.enabled: true
      templates:
        - condition.contains:
            docker.container.image: nginx
          config:
            - module: nginx
              access.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stdout&quot;
              error.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stderr&quot;
        - condition.contains:
            docker.container.image: docker.elastic.co/elasticsearch/elasticsearch
          config:
            - module: elasticsearch
              access.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stdout&quot;
              error.input:
                type: docker
                containers:
                  ids: &quot;${data.docker.container.id}&quot;
                  stream: &quot;stderr&quot;
</code></pre>
<p>Since the Elasticsearch container name is set to <code>elasticsearch</code> I can now filter the Filebeat index with:</p>
<pre><code class="language-bash">host.name : &quot;b803b794fcb2&quot; and container.name : &quot;elasticsearch&quot;
</code></pre>
<p>And see all outgoing search responses:</p>
<p><img alt="Elasticsearch v8 Filebeats" src="/assets/images/Elasticsearch8_Filebeats_09-dd481960c17b095f73627015eac50a53.png" width="1212" height="498"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/elasticsearch">Elasticsearch</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Elasticsearch/2022-02-03--elasticsearch-v8-data-ingestion/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Elasticsearch/2022-02-04--kibana-v8-search-queries/2022-02-04"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Elasticsearch &amp; Kibana v8 Search Cheat Sheet</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Elasticsearch/2022-02-02--elasticsearch-v8-upgrade/2022-02-02"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Performing an Elasticsearch v8 Upgrade</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setting-up-elasticsearch--kibana" class="table-of-contents__link toc-highlight">Setting Up Elasticsearch &amp; Kibana</a></li><li><a href="#setting-up-filebeats" class="table-of-contents__link toc-highlight">Setting up Filebeats</a><ul><li><a href="#run-the-filebeat-setup" class="table-of-contents__link toc-highlight">Run the Filebeat Setup</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#add-kibana-dashboard" class="table-of-contents__link toc-highlight">Add Kibana Dashboard</a></li><li><a href="#enable-and-configure-data-collection-modules" class="table-of-contents__link toc-highlight">Enable and configure data collection modules</a></li><li><a href="#monitor-nginx-in-docker" class="table-of-contents__link toc-highlight">Monitor NGINX in Docker</a></li><li><a href="#monitor-elasticsearch-in-docker" class="table-of-contents__link toc-highlight">Monitor Elasticsearch in Docker</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>