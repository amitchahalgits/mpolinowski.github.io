<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Salt/2020-06-18--salt-execution-order/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Salt Execution Order | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Salt Execution Order | Mike Polinowski"><meta data-rh="true" name="description" content="Guangzhou, China"><meta data-rh="true" property="og:description" content="Guangzhou, China"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.003ec094.js" defer="defer"></script>
<script src="/assets/js/main.0363f805.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Collapse sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-25--salt-orchestration-for-docker-containers/2020-06-25">Salt Orchestration for Docker Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-4-salt-mine/2020-06-23">Saltstack Refresh Course 2: Salt Mines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23">Saltstack Refresh Course 2: Highstate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-2-salt-state/2020-06-23">Saltstack Refresh Course 2: Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-1-setup/2020-06-23">Saltstack Refresh Course 1: Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22">NGINX Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-21--salt-events-and-thirdparty-apps/2020-06-21">Salt Beacons Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-20--salt-reactor-events/2020-06-20">Salt Reactor and System Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-19--salt-mine-orchestrate/2020-06-19">Salt Mine &amp; Orchestrate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18">Salt Execution Order</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-17--salt-pillars-formulas/2020-06-17">Salt Pillars &amp; Formulas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-16--salt-state/2020-06-16">Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-15--salty-devops/2020-06-15">Salty DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-14--install-salt-on-ubuntu-20-04/2020-06-14">Install Salt on Ubuntu Server 20.04</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/salt"><span itemprop="name">Salt</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Salt Execution Order</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Salt Execution Order</h1></header><p><img alt="Guangzhou, China" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-bf63cad7c3e1864ad8175e21a1e31033.jpg" width="1500" height="669"></p>
<ul>
<li><a href="#complex-state-trees">Complex State Trees</a>
<ul>
<li><a href="#execution-order">Execution Order</a></li>
<li><a href="#requisites">Requisites</a></li>
<li><a href="#watch">Watch</a></li>
</ul>
</li>
<li><a href="#conditionals-and-branching">Conditionals and Branching</a>
<ul>
<li><a href="#onchanges">onChanges</a></li>
<li><a href="#onfail">onFail</a></li>
<li><a href="#prereq">prereq</a></li>
</ul>
</li>
</ul>
<h2 id="complex-state-trees">Complex State Trees</h2>
<p>You can combine <code>*.sls</code> files by using import statements or by the use of <strong>Top Files</strong>. We can use this data for example in our Apache landing page (see previous tutorial):</p>
<p><strong>welcome.sls</strong></p>
<pre><code class="language-yaml"># Adding a blank front page

include:
  - apache

{% set name = salt.pillar.get(&#x27;name&#x27;) %}

check_pillar_values:
  test.check_pillar:
    - present:
      - name
    - failhard: True

welcome_page:
  file.managed:
    - name: /var/www/html/index.html
    - contents: |
        &lt;!doctype html&gt;
        &lt;body&gt;
            &lt;h1&gt;{{ name }}.&lt;/h1&gt;
        &lt;/body&gt;
</code></pre>
<p>The include statement on top will add the Apache installation - we can now execute the <code>welcome.sls</code> directly and get the complete Apache setup:</p>
<pre><code class="language-bash">sudo salt ubuntuAsus state.sls apache.welcome
</code></pre>
<p>You can accomplish the same by creating a <code>/srv/salt/top.sls</code> file:</p>
<pre><code class="language-yaml">base:
  &#x27;*&#x27;:
    - apache
    - apache.welcome
</code></pre>
<p>The Apache setup can now be executed by running:</p>
<pre><code class="language-bash">sudo salt &#x27;*&#x27; state.highstate
</code></pre>
<p>The <code>state.highstate</code> command will setup the whole infrastructure as defined inside your top file. If you create multiple top files for different setup use the <a href="https://docs.saltstack.com/en/master/ref/modules/all/salt.modules.state.html">state.top</a> command and specify the file you want to execute:</p>
<pre><code class="language-bash">sudo salt &#x27;*&#x27; state.top prod_top.sls
</code></pre>
<h3 id="execution-order">Execution Order</h3>
<p>Salt&#x27;s YAML render picks up every instruction inside an <code>*.sls</code> file and assigns an order key to them. This makes sure that they are executed in the same order they are written down inside your file. If you need to make sure that one of the instruction is <strong>ALWAYS</strong> either executed <strong>FIRST</strong> or <strong>LAST</strong>, you can specify this inside your file:</p>
<p><strong>init.sls</strong></p>
<pre><code class="language-yaml"># Install vanilla Apache on Debian/RedHat

{% from &#x27;apache/map.sls&#x27; import apache with context %}

install_apache:
  pkg.installed:
   - name: {{ apache.pkg }}
   - order: last

enable_apache:
  service.running:
    - name: {{ apache.srv }}

    # Will be enabled automatically on Debian but has to be enabled manually on RedHat
    - enable: True
    - order: first
</code></pre>
<p>This order stops working reliably once you have include or require statements inside your file.</p>
<h3 id="requisites">Requisites</h3>
<p>Requisites bring explicit ordering to your file execution:</p>
<p><strong>init.sls</strong></p>
<pre><code class="language-yaml"># Install vanilla Apache on Debian/RedHat

{% from &#x27;apache/map.sls&#x27; import apache with context %}

install_apache:
  pkg.installed:
   - name: {{ apache.pkg }}

enable_apache:
  service.running:
    - name: {{ apache.srv }}

    # Will be enabled automatically on Debian but has to be enabled manually on RedHat
    - enable: True
    - require:
      - pkg: install_apache
</code></pre>
<p>The <code>require</code> statement makes sure that Apache is installed before it will attempt to enable the Apache service.</p>
<h3 id="watch">Watch</h3>
<p>The watch module reacts to a specified instruction being executed and then triggers another function. A practical use case is to restart the Apache service once the Apache configuration was modified:</p>
<p><strong>init.sls</strong></p>
<pre><code class="language-yaml"># Install vanilla Apache on Debian/RedHat

{% from &#x27;apache/map.sls&#x27; import apache with context %}

install_apache:
  pkg.installed:
   - name: {{ apache.pkg }}

enable_apache:
  service.running:
    - name: {{ apache.srv }}

    # Will be enabled automatically on Debian but has to be enabled manually on RedHat
    - enable: True
    - watch:
      - file: danger_config
    
danger_config:
  file.managed:
    - name /bar/foo
    - contents: foo
    
</code></pre>
<p>We can also extend the watch service to another SLS file:</p>
<p><strong>mods.sls</strong></p>
<pre><code class="language-yaml">include:
  - apache

extend:
  start_apache:
    service:
      - watch:
        - file: danger_config

{% for conf in [&#x27;status&#x27;, &#x27;info&#x27;] %}

mod_{{ conf }}:
  file.managed:
    - name: /etc/apache2/conf-available/mod_{{ conf }}.conf
    - contents: |
        &lt;Location &#x27;/{{ conf }}&#x27;&gt;
            SetHandler server-{{ conf }}
        &lt;/Location&gt;

  {% if salt.grains.get(&#x27;os_family&#x27;) == &#x27;Debian&#x27; %}
  cmd.run:
    - name: a2enmod {{ conf }} &amp;&amp; a2enconf mod_{{ conf }}
    - creates: /etc/apache2/conf-enabled/mod_{{ conf }}.conf
  {% endif %}

{% endfor %}
</code></pre>
<p>The <code>mods.sls</code> configures Apache - by including the <code>init.sls</code> file we can now execute mods and be certain that Apache will be installed first before the configuration is attempted. We can now define the watch task here instead of the init file.</p>
<p>We can also use the  <code>watch_in</code> statement:</p>
<p><strong>mods.sls</strong></p>
<pre><code class="language-yaml">include:
  - apache

{% for conf in [&#x27;status&#x27;, &#x27;info&#x27;] %}

mod_{{ conf }}:
  file.managed:
    - name: /etc/apache2/conf-available/mod_{{ conf }}.conf
    - contents: |
        &lt;Location &#x27;/{{ conf }}&#x27;&gt;
            SetHandler server-{{ conf }}
        &lt;/Location&gt;
    - watch_in:
      - service: enable_apache

  {% if salt.grains.get(&#x27;os_family&#x27;) == &#x27;Debian&#x27; %}
  cmd.run:
    - name: a2enmod {{ conf }} &amp;&amp; a2enconf mod_{{ conf }}
    - creates: /etc/apache2/conf-enabled/mod_{{ conf }}.conf
    - watch_in:
      - service: enable_apache
  {% endif %}

{% endfor %}
</code></pre>
<p>If <code>mod_status</code> or <code>mod_info</code> should always be changed <strong>BEFORE</strong> Apache is restarted with <code>enable_apache</code>.</p>
<p>You can test the execution order by doing a dry-run:</p>
<pre><code class="language-bash">salt &#x27;*&#x27; state.sls apache.mods test=true

ubuntuAsus:
----------
          ID: install_apache
    Function: pkg.installed
        Name: apache2
      Result: True
     Comment: All specified packages are already installed
     Started: 18:26:02.852277
    Duration: 38.55 ms
     Changes:   
----------
          ID: mod_status
    Function: file.managed
        Name: /etc/apache2/conf-available/mod_status.conf
      Result: None
     Comment: The file /etc/apache2/conf-available/mod_status.conf is set to be changed
              Note: No changes made, actual changes may
              be different due to other states.
     Started: 18:26:02.899635
    Duration: 1.456 ms
     Changes:   
              ----------
              newfile:
                  /etc/apache2/conf-available/mod_status.conf
----------
          ID: mod_info
    Function: file.managed
        Name: /etc/apache2/conf-available/mod_info.conf
      Result: None
     Comment: The file /etc/apache2/conf-available/mod_info.conf is set to be changed
              Note: No changes made, actual changes may
              be different due to other states.
     Started: 18:26:02.901184
    Duration: 1.077 ms
     Changes:   
              ----------
              newfile:
                  /etc/apache2/conf-available/mod_info.conf
----------
          ID: enable_apache
    Function: service.running
        Name: apache2
      Result: None
     Comment: Service is set to be restarted
     Started: 18:26:02.940131
    Duration: 19.022 ms
     Changes:   
----------
          ID: mod_status
    Function: cmd.run
        Name: a2enmod status &amp;&amp; a2enconf mod_status
      Result: None
     Comment: Command &#x27;a2enmod status &amp;&amp; a2enconf mod_status&#x27; would have been executed
     Started: 18:26:02.961747
    Duration: 378.228 ms
     Changes:   
----------
          ID: mod_info
    Function: cmd.run
        Name: a2enmod info &amp;&amp; a2enconf mod_info
      Result: None
     Comment: Command &#x27;a2enmod info &amp;&amp; a2enconf mod_info&#x27; would have been executed
     Started: 18:26:03.340098
    Duration: 4.92 ms
     Changes:   

Summary for ubuntuAsus
------------
Succeeded: 6 (unchanged=5, changed=2)
Failed:    0
------------
Total states run:     6
Total run time: 443.253 ms
</code></pre>
<h2 id="conditionals-and-branching">Conditionals and Branching</h2>
<h3 id="onchanges">onChanges</h3>
<p>We can use <code>onChanges</code> to watch a state and trigger actions when required. For example the Apache modules only need to be (re) enabled if their content changed.</p>
<pre><code class="language-yml">include:
  - apache

{% for conf in [&#x27;status&#x27;, &#x27;info&#x27;] %}

mod_{{ conf }}:
  file.managed:
    - name: /etc/apache2/conf-available/mod_{{ conf }}.conf
    - contents: |
        &lt;Location &quot;/{{ conf }}&quot;&gt;
            SetHandler server-{{ conf }}
        &lt;/Location&gt;
    - watch_in:
      - service: enable_apache

  {% if salt.grains.get(&#x27;os_family&#x27;) == &#x27;Debian&#x27; %}
  cmd.run:
    - name: a2enmod {{ conf }} &amp;&amp; a2enconf mod_{{ conf }}
    - onchanges:
      - file: mod_{{ conf }}
    - watch_in:
      - service: enable_apache
  {% endif %}

{% endfor %}
</code></pre>
<p>You can now re-run the command and the see that the execution was suppressed:</p>
<pre><code class="language-bash">salt ubuntuAsus state.sls apache.mods
</code></pre>
<pre><code class="language-yaml">----------
          ID: mod_status
    Function: cmd.run
        Name: a2enmod status &amp;&amp; a2enconf mod_status
      Result: True
     Comment: State was not run because none of the onchanges reqs changed
     Started: 10:54:17.354494
    Duration: 0.004 ms
     Changes:   
----------
          ID: mod_info
    Function: cmd.run
        Name: a2enmod info &amp;&amp; a2enconf mod_info
      Result: True
     Comment: State was not run because none of the onchanges reqs changed
     Started: 10:54:17.354603
    Duration: 0.002 ms
     Changes:
</code></pre>
<p>You can now change the configuration file (by adding some meaningless white space) and re-run the command:</p>
<pre><code class="language-js">...

&lt;Location &quot;/{{ conf }}&quot;&gt;
    SetHandler server-{{ conf }}

&lt;/Location&gt;

...
</code></pre>
<p>The change will be picked up and the modules will be executed once again:</p>
<pre><code class="language-bash">salt ubuntuAsus state.sls apache.mods

                                                                    
ubuntuAsus:
----------
          ID: mod_status
    Function: file.managed
        Name: /etc/apache2/conf-available/mod_status.conf
      Result: True
     Comment: File /etc/apache2/conf-available/mod_status.conf updated
     Started: 11:00:09.916316
    Duration: 31.164 ms
     Changes:   
              ----------
              diff:
                  --- 
                  +++ 
                  @@ -1,3 +1,4 @@
                   &lt;Location &quot;/status&quot;&gt;
                       SetHandler server-status
                  +
                   &lt;/Location&gt;
----------
          ID: enable_apache
    Function: service.running
        Name: apache2
      Result: True
     Comment: Service restarted
     Started: 11:00:10.005666
    Duration: 133.762 ms
     Changes:   
              ----------
              apache2:
                  True
----------
          ID: mod_info
    Function: file.managed
        Name: /etc/apache2/conf-available/mod_info.conf
      Result: True
     Comment: File /etc/apache2/conf-available/mod_info.conf updated
     Started: 11:00:09.947841
    Duration: 11.464 ms
     Changes:   
              ----------
              diff:
                  --- 
                  +++ 
                  @@ -1,3 +1,4 @@
                   &lt;Location &quot;/info&quot;&gt;
                       SetHandler server-info
                  +
                   &lt;/Location&gt;
----------
          ID: mod_status
    Function: cmd.run
        Name: a2enmod status &amp;&amp; a2enconf mod_status
      Result: True
     Comment: Command &quot;a2enmod status &amp;&amp; a2enconf mod_status&quot; run
     Started: 11:00:10.142729
    Duration: 59.029 ms
     Changes:   
              ----------
              pid:
                  83853
              retcode:
                  0
              stderr:
              stdout:
                  Module status already enabled
                  Conf mod_status already enabled
----------
          ID: mod_info
    Function: cmd.run
        Name: a2enmod info &amp;&amp; a2enconf mod_info
      Result: True
     Comment: Command &quot;a2enmod info &amp;&amp; a2enconf mod_info&quot; run
     Started: 11:00:10.202081
    Duration: 52.738 ms
     Changes:   
              ----------
              pid:
                  83864
              retcode:
                  0
              stderr:
              stdout:
                  Module info already enabled
                  Conf mod_info already enabled
</code></pre>
<h3 id="onfail">onFail</h3>
<p>With <code>onFail</code> we can run a state if another state does not complete successfully. Create a file <code>nano /srv/salt/apptest.sls</code> and let it <a href="https://docs.saltstack.com/en/master/ref/states/all/salt.states.git.html#salt.states.git.latest">download a git repository</a> for us:</p>
<pre><code class="language-yaml">apptest:
  git.latest:
    - name: https://github.com/mpolinowski/docker-elk.git
    - rev: master
    - target: /opt/apptest

notify_of_fail:
  event.send:
    - name: apptest/failed
    - onfail:
      - git: apptest
</code></pre>
<p>Then run the state:</p>
<pre><code class="language-bash">salt ubuntuAsus state.sls apptest
</code></pre>
<pre><code class="language-bash">ubuntuAsus:
----------
          ID: apptest
    Function: git.latest
        Name: https://github.com/mpolinowski/docker-elk.git
      Result: True
     Comment: https://github.com/mpolinowski/docker-elk.git cloned to /opt/apptest
     Started: 11:24:51.598681
    Duration: 13472.643 ms
     Changes:   
              ----------
              new:
                  https://github.com/mpolinowski/docker-elk.git =&gt; /opt/apptest
              revision:
                  ----------
                  new:
                      2358839589c36223984b6a0528289d9efefd5189
                  old:
                      None
----------
          ID: notify_of_fail
    Function: event.send
        Name: apptest/failed
      Result: True
     Comment: State was not run because onfail req did not change
     Started: 11:25:05.080430
    Duration: 0.013 ms
     Changes:   

Summary for ubuntuAsus
------------
Succeeded: 2 (changed=1)
Failed:    0
------------
Total states run:     2
Total run time:  13.473 s
</code></pre>
<p>The repository cloning was successful and the notification was <strong>NOT</strong> triggered.</p>
<h3 id="prereq">prereq</h3>
<p>Only run a state when another state will change the system. E.g. reload your webserver only if a new app version was downloaded by git:</p>
<pre><code class="language-yaml">{% from &quot;apache/map.sls&quot; import apache with context %}

include:
  - apache

apptest:
  git.latest:
    - name: https://github.com/mpolinowski/docker-elk.git
    - rev: master
    - target: /opt/apptest
    - watch_in:
      - service: enable_apache

reload_apache:
  module.run:
    - name: service.stop
    - m_name: {{ apache.srv }}
    - prereq:
      - git: apptest

notify_of_fail:
  event.send:
    - name: apptest/failed
    - onfail:
      - git: apptest
</code></pre>
<p>The prerequisite will run <code>apptest</code> in <em>Dry-Run</em>. If the code changed, <code>reload_apache</code> will be triggered once the new source code was cloned by git.</p>
<pre><code class="language-bash">salt ubuntuAsus state.sls apptest                                                                             
ubuntuAsus:
----------
          ID: install_apache
    Function: pkg.installed
        Name: apache2
      Result: True
     Comment: All specified packages are already installed
     Started: 11:44:57.106219
    Duration: 40.43 ms
     Changes:   
----------
          ID: reload_apache
    Function: module.run
        Name: service.stop
      Result: True
     Comment: Module function service.stop executed
     Started: 11:44:58.331330
    Duration: 97.635 ms
     Changes:   
              ----------
              ret:
                  True
----------
          ID: apptest
    Function: git.latest
        Name: https://github.com/mpolinowski/docker-elk.git
      Result: True
     Comment: https://github.com/mpolinowski/docker-elk.git cloned to /opt/apptest
     Started: 11:44:58.429290
    Duration: 4591.687 ms
     Changes:   
              ----------
              new:
                  https://github.com/mpolinowski/docker-elk.git =&gt; /opt/apptest
              revision:
                  ----------
                  new:
                      2358839589c36223984b6a0528289d9efefd5189
                  old:
                      None
----------
          ID: enable_apache
    Function: service.running
        Name: apache2
      Result: True
     Comment: Service apache2 is already enabled, and is running
     Started: 11:45:03.021324
    Duration: 118.316 ms
     Changes:   
              ----------
              apache2:
                  True
----------
          ID: notify_of_fail
    Function: event.send
        Name: apptest/failed
      Result: True
     Comment: State was not run because onfail req did not change
     Started: 11:45:03.141194
    Duration: 0.004 ms
     Changes:   

Summary for ubuntuAsus
------------
Succeeded: 5 (changed=3)
Failed:    0
------------
Total states run:     5
Total run time:   4.848 s
</code></pre>
<p><code>reload_apache</code> detected that <code>apptest</code> will add new source code and stopped the webserver. Once the code was cloned the watch task reloaded the webserver.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/salt">Salt</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Salt/2020-06-18--salt-execution-order/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Salt/2020-06-19--salt-mine-orchestrate/2020-06-19"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Salt Mine &amp; Orchestrate</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Salt/2020-06-17--salt-pillars-formulas/2020-06-17"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Salt Pillars &amp; Formulas</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#complex-state-trees" class="table-of-contents__link toc-highlight">Complex State Trees</a><ul><li><a href="#execution-order" class="table-of-contents__link toc-highlight">Execution Order</a></li><li><a href="#requisites" class="table-of-contents__link toc-highlight">Requisites</a></li><li><a href="#watch" class="table-of-contents__link toc-highlight">Watch</a></li></ul></li><li><a href="#conditionals-and-branching" class="table-of-contents__link toc-highlight">Conditionals and Branching</a><ul><li><a href="#onchanges" class="table-of-contents__link toc-highlight">onChanges</a></li><li><a href="#onfail" class="table-of-contents__link toc-highlight">onFail</a></li><li><a href="#prereq" class="table-of-contents__link toc-highlight">prereq</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>