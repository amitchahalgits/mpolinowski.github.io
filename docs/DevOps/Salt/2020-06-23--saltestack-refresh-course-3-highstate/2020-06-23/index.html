<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Saltstack Refresh Course 2: Highstate | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Saltstack Refresh Course 2: Highstate | Mike Polinowski"><meta data-rh="true" name="description" content="Shenzhen, China"><meta data-rh="true" property="og:description" content="Shenzhen, China"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.003ec094.js" defer="defer"></script>
<script src="/assets/js/main.0363f805.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Collapse sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-25--salt-orchestration-for-docker-containers/2020-06-25">Salt Orchestration for Docker Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-4-salt-mine/2020-06-23">Saltstack Refresh Course 2: Salt Mines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23">Saltstack Refresh Course 2: Highstate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-2-salt-state/2020-06-23">Saltstack Refresh Course 2: Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-1-setup/2020-06-23">Saltstack Refresh Course 1: Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22">NGINX Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-21--salt-events-and-thirdparty-apps/2020-06-21">Salt Beacons Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-20--salt-reactor-events/2020-06-20">Salt Reactor and System Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-19--salt-mine-orchestrate/2020-06-19">Salt Mine &amp; Orchestrate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18">Salt Execution Order</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-17--salt-pillars-formulas/2020-06-17">Salt Pillars &amp; Formulas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-16--salt-state/2020-06-16">Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-15--salty-devops/2020-06-15">Salty DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-14--install-salt-on-ubuntu-20-04/2020-06-14">Install Salt on Ubuntu Server 20.04</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/salt"><span itemprop="name">Salt</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Saltstack Refresh Course 2: Highstate</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Saltstack Refresh Course 2: Highstate</h1></header><p><img alt="Shenzhen, China" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-b85ef375780aae5f2bc637ee69b89448.jpg" width="1500" height="564"></p>
<ul>
<li><a href="#highstate">Highstate</a>
<ul>
<li><a href="#topsls">Top.sls</a></li>
<li><a href="#multi-environments">Multi Environments</a></li>
<li><a href="#creating-users">Creating Users</a></li>
</ul>
</li>
<li><a href="#salt-states-with-grains-and-pillars">Salt States with Grains and Pillars</a>
<ul>
<li><a href="#encryption-with-pillar-data">Encryption with Pillar Data</a></li>
</ul>
</li>
<li><a href="#identifying-minions-with-custom-grains">Identifying Minions with Custom Grains</a>
<ul>
<li><a href="#creating-grains-with-states">Creating Grains with States</a></li>
<li><a href="#custom-grains-with-python">Custom Grains with Python</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>Defining a <strong>Highstate</strong> for your Salt minions - or how to send out a bunch of commands in one go.</p>
</blockquote>
<h2 id="highstate">Highstate</h2>
<h3 id="topsls">Top.sls</h3>
<p>In the previous tutorial we created a state file that allowed us to install and configure Apache on an Ubuntu 20.04 server. This was done with an <code>Init.sls</code> file inside the <strong>Base environment</strong> (that the is the <code>/srv/salt/states/base/</code>).</p>
<p>In case that we have a large number of such states for a lot of minions in different environments we create create a <code>top.sls</code> file in each of those, that is used to group-apply all your states to the assigned servers using the <strong>Highstate</strong> command. For example, currently we only have one state that installs Apache to one minion. The <strong>Top File</strong> for it would look like this:</p>
<p><strong>/srv/salt/states/base/top.sls</strong></p>
<pre><code class="language-yaml">base:
  &#x27;*&#x27;:

  &#x27;salt-minion*&#x27;:
    - apache
</code></pre>
<h3 id="multi-environments">Multi Environments</h3>
<p>Let&#x27;s add a development and production Salt environment by creating a <code>dev</code> and <code>prod</code> folder next to our <code>base</code> folder and add this directory to the <code>roots.conf</code> file:</p>
<p><strong>/etc/salt/master.d/roots.conf</strong></p>
<pre><code class="language-yaml">file_roots:
  base:
    - /srv/salt/states/base
  dev:
    - /srv/salt/states/dev 
  prod:
    - /srv/salt/states/prod
</code></pre>
<h3 id="creating-users">Creating Users</h3>
<p>I want to create a user state that sets up a user login for me on the minion in the base environment. And also add another user state to the <code>dev</code> environment. Let&#x27;s start by creating a folder <code>users</code> in both <code>base</code> and <code>dev</code> directories and another folder ``keys inside for the public key of each user.</p>
<pre><code class="language-bash">mkdir /srv/salt/states/base/users &amp;&amp; mkdir /srv/salt/states/base/users/keys
mkdir /srv/salt/states/dev/users &amp;&amp; mkdir /srv/salt/states/dev/users/keys
</code></pre>
<p>Now we need to have the public keys of each user. You can get them by running the following command in the user <code>.ssh</code> directory on the machine from which they are going to access the minion servers from:</p>
<pre><code class="language-bash">cd ~/.ssh
ssh-keygen -t rsa
</code></pre>
<p>Adding a key name or a private key passphrase is optional - it does make sense to name the key by it&#x27;s user. Then copy the file with the <code>.pub</code> extension to the corresponding <code>keys</code> directory on your salt master.</p>
<p>We can now continue with creating the two <code>Init.sls</code> files for our user states:</p>
<p><strong>/srv/salt/states/base/users/init.sls</strong></p>
<pre><code class="language-yml">user_instar_admin:
  user.present:
    - name: instar.admin
    - fullname: Mike Polinowski
    - shell: /bin/bash
    - home: /home/instar.admin
    - uid: 10000
    - gid_from_name: True
    - groups:
      - sudo

instar_admin_key:
  ssh_auth.present:
    - name: instar.admin
    - user: instar.admin
    - source: salt://user/keys/instar.admin.pub
</code></pre>
<blockquote>
<p><strong>Note</strong> that the user group is <code>sudo</code> under Ubuntu but has to be set to <code>wheel</code> on CentOS.</p>
</blockquote>
<p><strong>/srv/salt/states/dev/users/init.sls</strong></p>
<pre><code class="language-yml">user_instar_dev:
  user.present:
    - name: instar.dev
    - fullname: Julia Hu
    - shell: /bin/bash
    - home: /home/instar.dev
    - uid: 10001
    - gid_from_name: True
    - groups:
      - sudo

instar_dev_key:
  ssh_auth.present:
    - name: instar.dev
    - user: instar.dev
    - source: salt://user/keys/instar.dev.pub
</code></pre>
<p>We can now add those two states to the environment <code>top.sls</code> files:</p>
<p><strong>/srv/salt/states/base/top.sls</strong></p>
<pre><code class="language-yaml">base:
  &#x27;*&#x27;:
    - users

  &#x27;salt-minion*&#x27;:
    - apache
</code></pre>
<p><strong>/srv/salt/states/dev/top.sls</strong></p>
<pre><code class="language-yaml">dev:
  &#x27;*&#x27;:
    - users
</code></pre>
<p>Now restart your master service and check if the two <code>top.sls</code> files are being picked up by the <strong>Highstate</strong> command:</p>
<pre><code class="language-bash">pkill -9 salt-master
salt-master -d
</code></pre>
<p>You can now run the <code>state.show</code> command to check the output for <strong>Highstate</strong> and <strong>Lowstate</strong> which should give you an overview over every state that is going to be applied by the Highstate command based on your <code>top.sls</code> files:</p>
<pre><code class="language-bash">salt &#x27;*&#x27; state.show_highstate
salt &#x27;*&#x27; state.show_lowstate
</code></pre>
<p>e.g.</p>
<pre><code class="language-yml">salt salt-minion state.show_lowstate


salt-minion:
    |_
      ----------
      __env__:
          base
      __id__:
          user_instar_admin
      __sls__:
          users
      fullname:
          Mike Polinowski
      fun:
          present
      gid_from_name:
          True
      groups:
          - sudo
      home:
          /home/instar.admin
      name:
          instar.admin
      order:
          10000
      shell:
          /bin/bash
      state:
          user
      uid:
          10000
    |_
      ----------

...
</code></pre>
<h2 id="salt-states-with-grains-and-pillars">Salt States with Grains and Pillars</h2>
<h3 id="encryption-with-pillar-data">Encryption with Pillar Data</h3>
<p>Salt Pillars allow for the building of global data that can be made selectively
available to different minions based on minion grain filtering. The Salt
Pillar is laid out in the same fashion as the file server, with environments,
a top file and sls files. However, pillar data does not need to be in the
highstate format, and is generally just key/value pairs. Let&#x27;s start by creating:</p>
<pre><code class="language-bash">mkdir /srv/salt/pillars/base
mkdir /srv/salt/pillars/dev
mkdir /srv/salt/pillars/prod
</code></pre>
<p>...and defining the directory where we want to collect our pillars:</p>
<p><strong>/etc/salt/master.d/roots.conf</strong></p>
<pre><code class="language-yml">pillar_roots:
  base:
    - /srv/salt/pillars/base
  dev:
    - /srv/salt/pillars/dev
  prod:
    - /srv/salt/pillars/prod
</code></pre>
<p>In each of those directories we need a <code>users/init.sls</code> and <code>top.sls</code> file:</p>
<p><strong>/srv/salt/pillars/base/users/init.sls</strong></p>
<pre><code class="language-yml">admin_users:
  instar.admin: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChOWhU8u...
</code></pre>
<p><strong>/srv/salt/pillars/base/top.sls</strong></p>
<pre><code class="language-yml">base:
  &#x27;*&#x27;:
    - users
</code></pre>
<p>So now we can edit our salt user states to use this pillar data using a JinJa loop. This approach allows for users to be safely defined in a pillar and then the user data is applied in an sls file:</p>
<p><strong>/srv/salt/states/base/users/init.sls</strong></p>
<h2 id="for-loop"><strong>FOR LOOP</strong></h2>
<pre><code class="language-yml">{% for user_key in pillar.get(&#x27;admin_users&#x27;, {}).items() %}

user_instar.admin:
  user.present:
    - name: instar.admin
    - fullname: Mike Polinowski
    - home: /home/admin
    - shell: /bin/bash
    - uid: 10000
    - gid_from_name: true
    - groups:
      - sudo

instar.admin_key:
  ssh_auth.present:
    - user: instar.admin
    - name: {{ user_key }}

{% endfor %}
</code></pre>
<p><strong>WITHOUT LOOP</strong></p>
<pre><code class="language-yml">user_instar.admin:
  user.present:
    - name: instar.admin
    - fullname: Mike Polinowski
    - home: /home/admin
    - shell: /bin/bash
    - uid: 10000
    - gid_from_name: true
    - groups:
      - sudo

instar.admin_key:
  ssh_auth.present:
    - user: instar.admin
    - name: {{ salt.pillar.get(&#x27;admin_users&#x27;, {}) }}
</code></pre>
<p>Now restart your master service and refresh your minions pillar data:</p>
<pre><code class="language-bash">service salt-master restart // OR pkill -9 salt-master
salt-master -d
salt &#x27;*&#x27; saltutil.pillar_refresh
</code></pre>
<p>We can check that our pillar data was picked up and send by:</p>
<pre><code class="language-bash">salt &#x27;*&#x27; pillar.items // on MASTER
salt-call pillar.get admin_users  // on MINION
salt-call state.show_sls users saltenv=base  // on MINION
salt &#x27;*&#x27; state.show_low_sls users
</code></pre>
<p>You should now have seen that your minion did received the pillar data and that the JinJa script was executed and your user state is ready to be applied.</p>
<h2 id="identifying-minions-with-custom-grains">Identifying Minions with Custom Grains</h2>
<h3 id="creating-grains-with-states">Creating Grains with States</h3>
<p>We now want to apply some custom grain data to our minions through a <code>grains</code> state file:</p>
<p><strong>/srv/salt/states/base/grains/init.sls</strong></p>
<pre><code class="language-bash">default_grains:
  grains.present:
    - name: environment
    - value:
      - monitoring: zabbix_master
      - versions:
        - &quot;Zabbix 5.0.3.&quot;
        - &quot;Debian Buster&quot;
</code></pre>
<p>We can test the state with:</p>
<pre><code class="language-bash">salt-call state.show_sls grains saltenv=base
</code></pre>
<pre><code class="language-yml">local:
    ----------
    default_grains:
        ----------
        grains:
            |_
              ----------
              name:
                  environment
            |_
              ----------
              value:
                  |_
                    ----------
                    monitoring:
                        zabbix_master
                  |_
                    ----------
                    versions:
                        - Zabbix 5.0.3.
                        - Debian Buster
            - present
            |_
              ----------
              order:
                  10000
        __sls__:
            grains
        __env__:
            base
</code></pre>
<p>To apply this state onto a minion - e.g. on &quot;salt-minion&quot; - run the following command:</p>
<pre><code class="language-bash">salt salt-minion state.apply grains saltenv=base
</code></pre>
<pre><code class="language-yml">salt-minion:
----------
          ID: default_grains
    Function: grains.present
        Name: environment
      Result: True
     Comment: Set grain environment to [OrderedDict([(&#x27;monitoring&#x27;, &#x27;zabbix_master&#x27;)]), OrderedDict([(&#x27;versions&#x27;, [&#x27;Zabbix 5.0.3.&#x27;, &#x27;Debian Buster&#x27;])])]
     Started: 17:10:21.850928
    Duration: 9.521 ms
     Changes:   
              ----------
              environment:
                  |_
                    ----------
                    monitoring:
                        zabbix_master
                  |_
                    ----------
                    versions:
                        - Zabbix 5.0.3.
                        - Debian Buster

Summary for salt-minion
------------
Succeeded: 1 (changed=1)
Failed:    0
------------
Total states run:     1
Total run time:   9.521 ms
</code></pre>
<p>Now verify that the state has been applied to the <code>salt-minion</code> server:</p>
<pre><code class="language-bash">salt salt-minion grains.item
</code></pre>
<pre><code class="language-yml">environment:
        |_
          ----------
          monitoring:
              zabbix_master
        |_
          ----------
          versions:
              - Zabbix 5.0.3.
              - Debian Buster
</code></pre>
<h3 id="custom-grains-with-python">Custom Grains with Python</h3>
<blockquote>
<p>I cannot get Salt to pick up my Python file following different tutorials (<a href="http://dev.mlsdigital.net/posts/SaltStackBeyondJinjaStates/">1</a>, <a href="https://fabianlee.org/2016/10/05/saltstack-creating-a-custom-grain-using-python/">2</a>, etc.). I have to look into this deeper later when I actually start to need it.</p>
</blockquote>
<p>Checking a Discourse Forum health:</p>
<pre><code class="language-py">python2.7
Python 2.7.18rc1 (default, Apr  7 2020, 12:05:55)

&gt;&gt;&gt; import urllib2
&gt;&gt;&gt; base_url = &#x27;https://forum.instar.de/&#x27;
&gt;&gt;&gt; discourse_health = urllib2.urlopen(base_url + &#x27;srv/status&#x27;)
&gt;&gt;&gt; discourse_health.read()
&#x27;ok&#x27;
</code></pre>
<p>The Discourse Forum software runs a couple of internal health checks. Once all of them succeed you will get an <code>ok</code> when querying the <code>/srv/status</code> URL. Let&#x27;s write this proof of health into a Salt grain using a python script.</p>
<p>Custom grains modules should be placed in a subdirectory named <code>_grains</code> located under the file_roots specified by the master config file. The default path would be <code>/srv/salt/_grains</code>:</p>
<p><strong>/etc/salt/master.d/roots.conf</strong></p>
<pre><code class="language-yml">grain_root:
  base:
    -/srv/salt/_grains
</code></pre>
<p>_<em>/srv/salt/<em>grains/forum_health.py</em></em></p>
<pre><code class="language-py">#!/usr/bin/python2.7
import urllib2

def gitlab_healthcheck():

    # instantiate grains dictionary
    grains = {}

    # instantiate grains key
    grains[&#x27;discourse&#x27;] = []

    # base url
    base_url = &#x27;https://forum.instar.de/&#x27;

    discourse_health = urllib2.urlopen(base_url + &#x27;srv/status&#x27;)
    discourse_health = discourse_health.read()

    grains[&#x27;discourse&#x27;].append({&#x27;service&#x27;: &#x27;forum_backend&#x27;})
    grains[&#x27;discourse&#x27;][0][&#x27;health&#x27;] = discourse_health
    return grains

if __name__ == &#x27;__main__&#x27;:
  gitlab_healthcheck()
</code></pre>
<p>You can verify that your script is working:</p>
<pre><code class="language-py">python2.7

Python 2.7.18rc1 (default, Apr  7 2020, 12:05:55) 

&gt;&gt;&gt; import urllib2
&gt;&gt;&gt; def gitlab_healthcheck():
...   grains = {}
...   grains[&#x27;discourse&#x27;] = []
...   base_url = &#x27;https://forum.instar.de/&#x27;
...   discourse_health = urllib2.urlopen(base_url + &#x27;srv/status&#x27;)
...   discourse_health = discourse_health.read()
...   grains[&#x27;discourse&#x27;].append({&#x27;service&#x27;: &#x27;discourse&#x27;})
...   grains[&#x27;discourse&#x27;][0][&#x27;health&#x27;] = discourse_health
...   print grains
... 
&gt;&gt;&gt; gitlab_healthcheck()
{&#x27;discourse&#x27;: [{&#x27;health&#x27;: &#x27;ok&#x27;, &#x27;service&#x27;: &#x27;forum_backend&#x27;}]}
</code></pre>
<p>Custom grains modules will be distributed to the minions when state.<strong>highstate</strong> is run, or by executing the <code>saltutil.sync_grains</code> or <code>saltutil.sync_all</code> functions.</p>
<pre><code class="language-bash">salt-call saltutil.sync_grains
salt-call grains.item discourse
salt &#x27;*&#x27; grains.get discourse
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/salt">Salt</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-4-salt-mine/2020-06-23"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Saltstack Refresh Course 2: Salt Mines</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-2-salt-state/2020-06-23"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Saltstack Refresh Course 2: Salt State</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#highstate" class="table-of-contents__link toc-highlight">Highstate</a><ul><li><a href="#topsls" class="table-of-contents__link toc-highlight">Top.sls</a></li><li><a href="#multi-environments" class="table-of-contents__link toc-highlight">Multi Environments</a></li><li><a href="#creating-users" class="table-of-contents__link toc-highlight">Creating Users</a></li></ul></li><li><a href="#salt-states-with-grains-and-pillars" class="table-of-contents__link toc-highlight">Salt States with Grains and Pillars</a><ul><li><a href="#encryption-with-pillar-data" class="table-of-contents__link toc-highlight">Encryption with Pillar Data</a></li></ul></li><li><a href="#for-loop" class="table-of-contents__link toc-highlight"><strong>FOR LOOP</strong></a></li><li><a href="#identifying-minions-with-custom-grains" class="table-of-contents__link toc-highlight">Identifying Minions with Custom Grains</a><ul><li><a href="#creating-grains-with-states" class="table-of-contents__link toc-highlight">Creating Grains with States</a></li><li><a href="#custom-grains-with-python" class="table-of-contents__link toc-highlight">Custom Grains with Python</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>