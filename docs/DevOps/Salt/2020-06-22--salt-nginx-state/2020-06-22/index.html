<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DevOps/Salt/2020-06-22--salt-nginx-state/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">NGINX Salt State | Mike Polinowski</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NGINX Salt State | Mike Polinowski"><meta data-rh="true" name="description" content="TST, Hong Kong"><meta data-rh="true" property="og:description" content="TST, Hong Kong"><link data-rh="true" rel="icon" href="/img/icons/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22" hreflang="en"><link data-rh="true" rel="alternate" href="https://mpolinowski.github.io/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mike Polinowski RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mike Polinowski Atom Feed">




<link rel="icon" href="/img/angular_momentum.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37,194,160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/angular_momentum.png">
<link rel="mask-icon" href="/img/angular_momentum.png" color="rgb(33,33,33)">
<meta name="msapplication-TileImage" content="/img/angular_momentum.png">
<meta name="msapplication-TileColor" content="#000">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P74BDWF0C6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-P74BDWF0C6",{})</script><link rel="stylesheet" href="/assets/css/styles.08c8c484.css">
<script src="/assets/js/runtime~main.37984c46.js" defer="defer"></script>
<script src="/assets/js/main.b3107e46.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/angular_momentum.png" alt="Mike Polinowski :: Dev Notebook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mike Polinowski</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/tags">Tags</a><a class="navbar__item navbar__link" href="/Search">Search</a><a href="https://mpolinowski.github.io/Personal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops">DevOps</a><button aria-label="Collapse sidebar category &#x27;DevOps&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hashicorp">Hashicorp</a><button aria-label="Expand sidebar category &#x27;Hashicorp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/zabbix">Zabbix</a><button aria-label="Expand sidebar category &#x27;Zabbix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-provisioning">Server Provisioning</a><button aria-label="Expand sidebar category &#x27;Server Provisioning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/gitops">GitOps</a><button aria-label="Expand sidebar category &#x27;GitOps&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/kubernetes">Kubernetes</a><button aria-label="Expand sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/nginx">NGINX</a><button aria-label="Expand sidebar category &#x27;NGINX&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/elasticsearch">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/ansible">Ansible</a><button aria-label="Expand sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/server-security">Server Security</a><button aria-label="Expand sidebar category &#x27;Server Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/linux">Linux</a><button aria-label="Expand sidebar category &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/windows">Windows</a><button aria-label="Expand sidebar category &#x27;Windows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tomcat">Tomcat</a><button aria-label="Expand sidebar category &#x27;Tomcat&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/salt">Salt</a><button aria-label="Collapse sidebar category &#x27;Salt&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-25--salt-orchestration-for-docker-containers/2020-06-25">Salt Orchestration for Docker Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-4-salt-mine/2020-06-23">Saltstack Refresh Course 2: Salt Mines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-3-highstate/2020-06-23">Saltstack Refresh Course 2: Highstate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-2-salt-state/2020-06-23">Saltstack Refresh Course 2: Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-1-setup/2020-06-23">Saltstack Refresh Course 1: Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/Salt/2020-06-22--salt-nginx-state/2020-06-22">NGINX Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-21--salt-events-and-thirdparty-apps/2020-06-21">Salt Beacons Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-20--salt-reactor-events/2020-06-20">Salt Reactor and System Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-19--salt-mine-orchestrate/2020-06-19">Salt Mine &amp; Orchestrate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-18--salt-execution-order/2020-06-18">Salt Execution Order</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-17--salt-pillars-formulas/2020-06-17">Salt Pillars &amp; Formulas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-16--salt-state/2020-06-16">Salt State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-15--salty-devops/2020-06-15">Salty DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/Salt/2020-06-14--install-salt-on-ubuntu-20-04/2020-06-14">Install Salt on Ubuntu Server 20.04</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/machine-learning-ai-and-computer-vision">Machine Learning, AI and Computer Vision</a><button aria-label="Expand sidebar category &#x27;Machine Learning, AI and Computer Vision&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/automation-deep-vision-and-robotics">Automation, Deep Vision and Robotics</a><button aria-label="Expand sidebar category &#x27;Automation, Deep Vision and Robotics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops"><span itemprop="name">DevOps</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/salt"><span itemprop="name">Salt</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NGINX Salt State</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>NGINX Salt State</h1></header><p><img alt="TST, Hong Kong" src="/assets/images/photo-kt443t6d_64hdh43hfh6dgjdfhg4_d-445649b262fc86c20c60ee46511b372b.jpg" width="1500" height="640"></p>
<ul>
<li><a href="#nginx-state-file">Nginx State File</a>
<ul>
<li><a href="#nginx-package-and-service-states">Nginx Package and Service States</a></li>
</ul>
</li>
<li><a href="#creating-the-master-files">Creating the Master Files</a>
<ul>
<li><a href="#nginx-config">NGINX Config</a></li>
<li><a href="#nginx-default-server">NGINX Default Server</a></li>
<li><a href="#nginx-default-frontpage-template">NGINX Default Frontpage Template</a></li>
</ul>
</li>
<li><a href="#testing-the-nginx-state-file">Testing the Nginx State File</a></li>
</ul>
<p>Configuration management with Salt State for an NGINX web proxy.</p>
<h2 id="nginx-state-file">Nginx State File</h2>
<p>To start off our Nginx configuration, we’ll create a directory in this location specific to the software we are configuring. Then create an <code>init.sls</code> file within this directory to get started::</p>
<pre><code class="language-bash">mkdir /srv/salt/nginx
nano /srv/salt/nginx/init.sls
</code></pre>
<h3 id="nginx-package-and-service-states">Nginx Package and Service States</h3>
<p>First we want to make sure that NGINX is installed on our Minion and the service is running:</p>
<p><strong>nginx/init.sls</strong></p>
<pre><code class="language-yml">nginx:
  pkg:
    - installed
  service.running:
    - watch:
        - pkg: nginx
        - file: /etc/nginx/nginx.conf
        - file: /etc/nginx/sites-available/default
</code></pre>
<p>Nginx should automatically reload when the package is updated, when the main configuration file has been changed, or when the default server block file is modified. We can tell Salt to restart the Nginx service when these conditions occur by using <code>watch</code>.</p>
<h3 id="nginx-configuration-file-states">Nginx Configuration File States</h3>
<p>We now want to define the contents of the <code>/etc/nginx/nginx.conf</code> file on the master server and upload it to each minion who needs it. <a href="#creating-the-master-files">We will later create this default configuration file</a> in <code>/srv/salt/nginx/files/etc/nginx</code>:</p>
<p><strong>nginx/init.sls</strong></p>
<pre><code class="language-yml">nginx:
  pkg:
    - installed
  service.running:
    - watch:
        - pkg: nginx
        - file: /etc/nginx/nginx.conf
        - file: /etc/nginx/sites-available/default

/etc/nginx/nginx.conf:
  file.managed:
    - source: salt://nginx/files/etc/nginx/nginx.conf
    - user: root
    - group: root
    - mode: 640
</code></pre>
<p>Additionally we need to define the server block that controls how our content will be served with the <code>/etc/nginx/sites-available/default</code> file. The difference here is that this file has to be a <strong>Jinja</strong> template. This means that we can pull information from each host and construct an appropriate, customized version of the file for each of our web servers:</p>
<p><strong>nginx/init.sls</strong></p>
<pre><code class="language-yml">nginx:
  pkg:
    - installed
  service.running:
    - watch:
        - pkg: nginx
        - file: /etc/nginx/nginx.conf
        - file: /etc/nginx/sites-available/default

/etc/nginx/nginx.conf:
  file.managed:
    - source: salt://nginx/files/etc/nginx/nginx.conf
    - user: root
    - group: root
    - mode: 640

/etc/nginx/sites-available/default:
  file.managed:
    - source: salt://nginx/files/etc/nginx/sites-available/default.jinja
    - template: jinja
    - user: root
    - group: root
    - mode: 640
</code></pre>
<p>Now, we just need to create a state for our <code>index.html</code> file which will be the frontpage for our site:</p>
<p><strong>nginx/init.sls</strong></p>
<pre><code class="language-yml">nginx:
  pkg:
    - installed
  service.running:
    - watch:
        - pkg: nginx
        - file: /etc/nginx/nginx.conf
        - file: /etc/nginx/sites-available/default

/etc/nginx/nginx.conf:
  file.managed:
    - source: salt://nginx/files/etc/nginx/nginx.conf
    - user: root
    - group: root
    - mode: 640

/etc/nginx/sites-available/default:
  file.managed:
    - source: salt://nginx/files/etc/nginx/sites-available/default.jinja
    - template: jinja
    - user: root
    - group: root
    - mode: 640

/usr/share/nginx/html/index.html:
  file.managed:
    - source: salt://nginx/files/usr/share/nginx/html/index.html.jinja
    - template: jinja
    - user: root
    - group: root
    - mode: 644
</code></pre>
<h2 id="creating-the-master-files">Creating the Master Files</h2>
<p>To get the default NGINX configuration files we can install it manually on our Minion using Salt:</p>
<pre><code class="language-bash">salt ubuntuMaster pkg.install nginx
</code></pre>
<p>We can now configure our master to allow file transfers from Minions <code>nano /etc/salt/master.d/local.conf</code>:</p>
<pre><code class="language-yml"># Allow minions to push files to the master. This is disabled by default, for
# security purposes.
file_recv: True
</code></pre>
<p>Save and <code>systemctl restart salt-master</code> your master. We can now grab the default versions of the files we’ll be managing:</p>
<pre><code class="language-bash">salt ubuntuMaster cp.push /etc/nginx/nginx.conf
salt ubuntuMaster cp.push /etc/nginx/sites-available/default
salt ubuntuMaster cp.push /usr/share/nginx/html/index.html
</code></pre>
<p>These files should now be available on the master. The path to these files is recreated within the <code>/var/cache/salt/master/minions/minion_id/files directory</code>. We can copy the directories beneath this location, which represents the file paths on the minion, to our Salt state directory:</p>
<pre><code class="language-bash">cp -r /var/cache/salt/master/minions/ubuntuMaster/files /srv/salt/nginx

find /srv/salt/nginx -printf &quot;%P\n&quot;

  init.sls
  files
  files/etc
  files/etc/nginx
  files/etc/nginx/sites-available
  files/etc/nginx/sites-available/default
  files/etc/nginx/nginx.conf
  files/usr
  files/usr/share
  files/usr/share/nginx
  files/usr/share/nginx/html
  files/usr/share/nginx/html/index.html
</code></pre>
<h3 id="nginx-config">NGINX Config</h3>
<p>Start by creating a backup of the original configuration and adjust the conf file according to your needs:</p>
<pre><code class="language-bash">cd /srv/salt/nginx/files/etc/nginx
cp nginx.conf nginx.conf.ori
diff nginx.conf nginx.conf.ori
</code></pre>
<h3 id="nginx-default-server">NGINX Default Server</h3>
<p>Next, let’s take a look at our default server block template. Start with making a copy of the original file and rename the file to <code>.jinja</code>:</p>
<pre><code class="language-bash">cd /srv/salt/nginx/files/etc/nginx/sites-available
cp default default.ori
mv default default.jinja
</code></pre>
<p>Now, we can open the template file to make some changes <code>nano default.jinja</code>. We’ll then use the grains.get execution module function to grab the address associated with the selected interface and use that as the value for the <code>addr</code> variable. We will add this to the very top of the file:</p>
<pre><code class="language-cfg"># Set interface to load balancer in production - change interface before using
{%- set interface = &#x27;enp3s0&#x27; if salt[&#x27;grains.get&#x27;](&#x27;env&#x27;) == &#x27;dev&#x27; else &#x27;enp3s0&#x27; -%}
{%- set addr = salt[&#x27;network.interface_ip&#x27;](interface) -%}
##
# You should look at the following URL&#x27;s in order to grasp a solid understanding
</code></pre>
<p>Next, we can edit the server block further down in the file. We can use the <code>addr</code> variable we set at the top in the listen and <code>server_name</code> directives. We’ve removed the IPv6 and default server portions to restrict what this block serves:</p>
<pre><code class="language-cfg">server {
    listen {{ addr }}:80;

    root /usr/share/nginx/html;
    index index.html index.htm;

    server_name {{ addr }};

    location / {
        try_files $uri $uri/ =404;
    }
}
</code></pre>
<p>Save and close the file when you are finished.</p>
<h3 id="nginx-default-frontpage-template">NGINX Default Frontpage Template</h3>
<pre><code class="language-bash">cd /srv/salt/nginx/files/usr/share/nginx/html

cp index.html index.html.ori
mv index.html index.html.jinja

nano index.html.jinja
</code></pre>
<p>At the top, we’ll set another variable using Jinja. We’ll use the <code>grains.get</code> execution module function to grab the minion’s hostname. We’ll store this in the host variable:</p>
<pre><code class="language-html">{% set host = salt[&#x27;grains.get&#x27;](&#x27;os-family&#x27;) -%}
{% set os = salt[&#x27;grains.get&#x27;](&#x27;os&#x27;) -%}

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;title&gt;Welcome from {{ host }}&lt;/title&gt;
    &lt;body&gt;
    &lt;h1&gt;This is NGINX!&lt;/h1&gt;
    &lt;p&gt;{{ os }} Rocks!&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="testing-the-nginx-state-file">Testing the Nginx State File</h2>
<p>First, we can use the <code>state.show_sls</code> execution module function to view how Salt will interpret our Nginx state file:</p>
<pre><code class="language-bash">salt ubuntuMaster state.show_sls nginx

ubuntuMaster:
    ----------
    /etc/nginx/nginx.conf:
        ----------
        __env__:
            base
        __sls__:
            nginx
        file:
            |_
              ----------
              source:
                  salt://nginx/files/etc/nginx/nginx.conf
            |_
              ----------
              user:
                  root
            |_
              ----------
              group:
                  root
            |_
              ----------
              mode:
                  640
            - managed
            |_
              ----------
              order:
                  10002
    /etc/nginx/sites-available/default:
        ----------
        __env__:
            base
        __sls__:
            nginx
        file:
            |_
              ----------
              source:
                  salt://nginx/files/etc/nginx/sites-available/default.jinja
            |_
              ----------
              template:
                  jinja
            |_
              ----------
              user:
                  root
            |_
              ----------
              group:
                  root
            |_
              ----------
              mode:
                  640
            - managed
            |_
              ----------
              order:
                  10003
    /usr/share/nginx/html/index.html:
        ----------
        __env__:
            base
        __sls__:
            nginx
        file:
            |_
              ----------
              source:
                  salt://nginx/files/usr/share/nginx/html/index.html.jinja
            |_
              ----------
              template:
                  jinja
            |_
              ----------
              user:
                  root
            |_
              ----------
              group:
                  root
            |_
              ----------
              mode:
                  644
            - managed
            |_
              ----------
              order:
                  10004
    nginx:
        ----------
        __env__:
            base
        __sls__:
            nginx
        pkg:
            - installed
            |_
              ----------
              order:
                  10000
        service:
            |_
              ----------
              watch:
                  |_
                    ----------
                    pkg:
                        nginx
                  |_
                    ----------
                    file:
                        /etc/nginx/nginx.conf
                  |_
                    ----------
                    file:
                        /etc/nginx/sites-available/default
            - running
            |_
              ----------
              order:
                  10001
</code></pre>
<p>Next, we can do a <strong>dry-run</strong> of applying our state file. We can do this with the <code>state.apply</code> function with the <code>test=True</code> option:</p>
<pre><code class="language-bash">salt ubuntuMaster state.apply nginx test=True
</code></pre>
<pre><code class="language-bash">ubuntuMaster:
----------
          ID: nginx
    Function: pkg.installed
      Result: True
     Comment: All specified packages are already installed
     Started: 11:14:33.183423
    Duration: 21.944 ms
     Changes:
----------
          ID: /etc/nginx/nginx.conf
    Function: file.managed
      Result: None
     Comment: The file /etc/nginx/nginx.conf is set to be changed
              Note: No changes made, actual changes may
              be different due to other states.
     Started: 11:14:33.209030
    Duration: 10.764 ms
     Changes:
              ----------
              mode:
                  0640
----------
          ID: /etc/nginx/sites-available/default
    Function: file.managed
      Result: None
     Comment: The file /etc/nginx/sites-available/default is set to be changed
              Note: No changes made, actual changes may
              be different due to other states.
     Started: 11:14:33.219892
    Duration: 70.677 ms
     Changes:
              ----------
              diff:
                  ---
                  +++
                  @@ -1,4 +1,4 @@
                  -##
                  +# Set interface to load balancer in production - change interface before using##
                   # You should look at the following URL&#x27;s in order to grasp a solid understanding
                   # of Nginx configuration files in order to fully unleash the power of Nginx.
                   # https://www.nginx.com/resources/wiki/start/
                  @@ -19,8 +19,7 @@
                   # Default server configuration
                   #
                   server {
                  -     listen 80 default_server;
                  -     listen [::]:80 default_server;
                  +     listen 192.168.2.110 80 default_server;

                        # SSL configuration
                        #
                  @@ -38,12 +37,12 @@
                        #
                        # include snippets/snakeoil.conf;

                  -     root /var/www/html;
                  +     root /usr/share/nginx/html/;

                        # Add index.php to the list if you are using PHP
                        index index.html index.htm index.nginx-debian.html;

                  -     server_name _;
                  +     server_name 192.168.2.110;

                        location / {
                                # First attempt to serve request as file, then
              mode:
                  0640
----------
          ID: nginx
    Function: service.running
      Result: None
     Comment: Service is set to be started
     Started: 11:14:33.330309
    Duration: 12.555 ms
     Changes:
----------
          ID: /usr/share/nginx/html/index.html
    Function: file.managed
      Result: None
     Comment: The file /usr/share/nginx/html/index.html is set to be changed
              Note: No changes made, actual changes may
              be different due to other states.
     Started: 11:14:33.343135
    Duration: 18.835 ms
     Changes:
              ----------
              diff:
                  ---
                  +++
                  @@ -1,25 +1,9 @@
                   &lt;!DOCTYPE html&gt;
                   &lt;html&gt;
                  -&lt;head&gt;
                  -&lt;title&gt;Welcome to nginx!&lt;/title&gt;
                  -&lt;style&gt;
                  -    body {
                  -        width: 35em;
                  -        margin: 0 auto;
                  -        font-family: Tahoma, Verdana, Arial, sans-serif;
                  -    }
                  -&lt;/style&gt;
                  -&lt;/head&gt;
                  -&lt;body&gt;
                  -&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
                  -&lt;p&gt;If you see this page, the nginx web server is successfully installed and
                  -working. Further configuration is required.&lt;/p&gt;
                  -
                  -&lt;p&gt;For online documentation and support please refer to
                  -&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
                  -Commercial support is available at
                  -&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
                  -
                  -&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
                  -&lt;/body&gt;
                  +  &lt;head&gt;
                  +  &lt;title&gt;Welcome from &lt;/title&gt;
                  +    &lt;body&gt;
                  +    &lt;h1&gt;This is NGINX!&lt;/h1&gt;
                  +    &lt;p&gt;Ubuntu Rocks!&lt;/p&gt;
                  +    &lt;/body&gt;
                   &lt;/html&gt;

Summary for ubuntuMaster
------------
Succeeded: 5 (unchanged=4, changed=3)
Failed:    0
------------
Total states run:     5
Total run time: 134.775 ms
</code></pre>
<p>If the dry-run did not reveal any problems, you can try to apply the state to all of your available web servers by typing:</p>
<pre><code class="language-bash">salt ubuntuMaster state.apply nginx
</code></pre>
<p>You can check that the Page is actually running on your Minions IP address:</p>
<pre><code class="language-bash">curl 192.168.2.110

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;title&gt;Welcome from &lt;/title&gt;
    &lt;body&gt;
    &lt;h1&gt;This is NGINX!&lt;/h1&gt;
    &lt;p&gt;Ubuntu Rocks!&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">LINUX</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/salt">Salt</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/DevOps/Salt/2020-06-22--salt-nginx-state/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/DevOps/Salt/2020-06-23--saltestack-refresh-course-1-setup/2020-06-23"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Saltstack Refresh Course 1: Setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/DevOps/Salt/2020-06-21--salt-events-and-thirdparty-apps/2020-06-21"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Salt Beacons Module</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#nginx-state-file" class="table-of-contents__link toc-highlight">Nginx State File</a><ul><li><a href="#nginx-package-and-service-states" class="table-of-contents__link toc-highlight">Nginx Package and Service States</a></li><li><a href="#nginx-configuration-file-states" class="table-of-contents__link toc-highlight">Nginx Configuration File States</a></li></ul></li><li><a href="#creating-the-master-files" class="table-of-contents__link toc-highlight">Creating the Master Files</a><ul><li><a href="#nginx-config" class="table-of-contents__link toc-highlight">NGINX Config</a></li><li><a href="#nginx-default-server" class="table-of-contents__link toc-highlight">NGINX Default Server</a></li><li><a href="#nginx-default-frontpage-template" class="table-of-contents__link toc-highlight">NGINX Default Frontpage Template</a></li></ul></li><li><a href="#testing-the-nginx-state-file" class="table-of-contents__link toc-highlight">Testing the Nginx State File</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Research</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Notebook</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags</a></li><li class="footer__item"><a class="footer__link-item" href="/Curriculum-Vitae">CV</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mike-polinowski-6396ba121/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MikePolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.flickr.com/people/149680084@N06/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flickr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mpolinowski" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mike Polinowski, INSTAR Deutschland GmbH, Shenzhen - China.</div></div></div></footer></div>
</body>
</html>